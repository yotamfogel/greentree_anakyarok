var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertyNames,i=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,l=(e,t)=>{for(var r in t||(t={}))a.call(t,r)&&s(e,r,t[r]);if(i)for(var r of i(t))o.call(t,r)&&s(e,r,t[r]);return e},d=(e,n)=>t(e,r(n)),c=(e,t,r)=>new Promise((n,i)=>{var a=e=>{try{s(r.next(e))}catch(t){i(t)}},o=e=>{try{s(r.throw(e))}catch(t){i(t)}},s=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,o);s((r=r.apply(e,t)).next())});import{r as p,a as g,R as u}from"./vendor-CANkOXcB.js";import{e as x}from"./excel-Dy7BQwje.js";import{P as m,I as h}from"./azure-Dk662cfU.js";var f,b,y=(f={"assets/index-CZ1SD407.js"(e){!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var t={exports:{}},r={},n=p,i=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,f={key:!0,ref:!0,__self:!0,__source:!0};function b(e,t,r){var n,a={},l=null,d=null;for(n in void 0!==r&&(l=""+r),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)o.call(t,n)&&!f.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:i,type:e,key:l,ref:d,props:a,_owner:s.current}}r.Fragment=a,r.jsx=b,r.jsxs=b,t.exports=r;var y=t.exports,v={},w=g;v.createRoot=w.createRoot,v.hydrateRoot=w.hydrateRoot;let j=0;function S(){return j+=1,String(j)}function k(e){if(null===e)return"null";const t=typeof e;return Array.isArray(e)?"array":"object"===t?"object":"string"===t?"string":"number"===t?Number.isInteger(e)?"integer":"number":"boolean"===t?"boolean":"unknown"}function C(e,t){try{switch(t){case"string":{const t=String(e),r=t.length>64?t.slice(0,61)+"…":t;return{description:`String of length ${t.length}.`,preview:'"'+r+'"'}}case"number":return{description:"Floating-point numeric value."};case"integer":return{description:"Numeric value."};case"boolean":return{description:"Boolean value."};case"null":return{description:"Null value."};case"array":{const t=Array.isArray(e)?e:[],r=t.length,n=r>0?k(t[0]):"unknown",i=t.slice(0,5).map(e=>function(e){const t=k(e);return"string"===t?'"'+String(e).replace(/\s+/g," ").slice(0,24)+(String(e).length>24?"…":"")+'"':"number"===t||"boolean"===t||"null"===t?String(e):"array"===t?"[…]":"object"===t?"{…}":String(e)}(e));return{description:`Array with ${r} item${1===r?"":"s"}${"unknown"!==n?` (e.g., ${n})`:""}.`,preview:`[${i.join(", ")}${r>5?", …":""}]`}}case"object":{const t=e&&"object"==typeof e?e:{};if("preview"in t||"excelMeta"in t){const e="string"==typeof t.preview?t.preview:void 0;return{description:void 0,preview:e,excelMeta:t.excelMeta}}const r=Object.keys(t),n=r.slice(0,5);return{description:`Object with ${r.length} key${1===r.length?"":"s"}.`,preview:`{ ${n.join(", ")}${r.length>5?", …":""} }`}}default:return{}}}catch(r){return{}}}function E(e,t,r=[]){const n=k(t),{description:i,preview:a,excelMeta:o}=C(t,n),s={id:(r.length?r.join("."):"root")+":"+S(),name:e,type:n,description:i,valuePreview:a,excelMeta:o};if("object"===n){const e=t;if(e&&(Object.prototype.hasOwnProperty.call(e,"preview")||Object.prototype.hasOwnProperty.call(e,"excelMeta")))return s.type="string",s;const n=Object.keys(e).sort();s.children=n.map(t=>E(t,e[t],[...r,t]))}else if("array"===n){const e=t;s.children=e.map((e,t)=>E(`[${t}]`,e,[...r,String(t)]))}return s}function T(e){const t=[];return e.enum&&t.push(`enum: ${e.enum.map(e=>JSON.stringify(e)).join(", ")}`),void 0!==e.const&&t.push(`const: ${JSON.stringify(e.const)}`),e.pattern&&t.push(`pattern: ${e.pattern}`),"number"==typeof e.minLength&&t.push(`minLength: ${e.minLength}`),"number"==typeof e.maxLength&&t.push(`maxLength: ${e.maxLength}`),e.format&&t.push(`format: ${e.format}`),"number"==typeof e.minimum&&t.push(`minimum: ${e.minimum}`),"number"==typeof e.maximum&&t.push(`maximum: ${e.maximum}`),"number"==typeof e.exclusiveMinimum&&t.push(`exclusiveMinimum: ${e.exclusiveMinimum}`),"number"==typeof e.exclusiveMaximum&&t.push(`exclusiveMaximum: ${e.exclusiveMaximum}`),"number"==typeof e.multipleOf&&t.push(`multipleOf: ${e.multipleOf}`),t.length?t:void 0}function z(e,t,r=[],n=!0){var i,a,o;const s=function(e){const t=Array.isArray(e.type)?e.type[0]:e.type;return t?"integer"===t?"integer":"number"===t?"number":"string"===t?"string":"boolean"===t?"boolean":"null"===t?"null":"array"===t?"array":"object":"object"}(t),l={id:(r.length?r.join("."):"root")+":"+S(),name:e,type:s,description:t.description,rules:T(t)},d=Array.isArray(t.allOf)&&t.allOf.length>0?t.allOf.map((e,t)=>{var i;const a=e.title||`[allOf ${t+1}]`,o=(null==(i=e.title)?void 0:i.replace(/\s+/g,"_"))||`allOf_${t+1}`;return z(a,e,[...r,o],n)}):[];if("object"===s){const e=null!=(i=t.properties)?i:{},o=Object.keys(e).sort(),s=new Set(null!=(a=t.required)?a:[]),c=o.map(t=>{const i=e[t],a=s.has(t),o=z(t,i,[...r,t],a&&n);return o.requiredState=a?n?"required":"conditional":"optional",o});l.children=[...c,...d]}else if("array"===s){const e=t.items;Array.isArray(e)?l.children=e.map((e,t)=>z(`[${t}]`,e,[...r,String(t)],n)):e&&(l.children=[z("[item]",e,[...r,"item"],n)]),d.length&&(l.children=(null!=(o=l.children)?o:[]).concat(d))}else d.length&&(l.children=d);return l}function D(e){if(function(e){if(!e||"object"!=typeof e)return!1;const t=e;return"$schema"in t||"properties"in t&&"object"==typeof t.properties||"type"in t&&("object"===t.type||"array"===t.type)}(e)){const t=e;return z(t.title||"root",t,[],!0)}return E("root",e)}function N({node:e,depth:t,isRoot:r=!1,defaultOpenChildren:n=!1,forcePreferredSide:i}){var a,o,s,c;const[g,u]=p.useState(n||0===t),[x,m]=p.useState(!1),[h,f]=p.useState(null!=i?i:"right"),[b,v]=p.useState(!1),w=p.useRef(null),j=p.useRef(0),S=(null!=(o=null==(a=e.children)?void 0:a.length)?o:0)>0,k=p.useMemo(()=>{const e=1.8*Math.pow(.85,t);return Math.max(.5,e)},[t]),C=p.useMemo(()=>{if(!S||!e.children)return!1;const t=e.children.filter(e=>"required"===e.requiredState);return 0!==t.length&&t.every(e=>e.excelMeta&&Object.keys(e.excelMeta).length>0)},[S,e.children]),E=p.useMemo(()=>{const t={"--scale":String(k),"--indicator-border":"rgba(255,255,255,0.20)","--indicator-bg":S?"linear-gradient(180deg, rgba(124,192,255,0.22), rgba(124,192,255,0.10))":"linear-gradient(180deg, rgba(255,140,26,0.22), rgba(255,140,26,0.10))","--indicator-shadow":"inset 0 1px 0 rgba(255,255,255,0.14), 0 10px 24px rgba(0,0,0,0.35)"};if(e.excelMeta&&Object.keys(e.excelMeta).length>0||C){const e=d(l({},t),{borderColor:"rgba(76,175,80,0.45)",background:"linear-gradient(180deg, rgba(76,175,80,0.12), rgba(76,175,80,0.06))",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.14), 0 12px 28px rgba(76,175,80,0.24)","--indicator-border":"rgba(76,175,80,0.45)","--indicator-bg":"linear-gradient(180deg, rgba(76,175,80,0.20), rgba(76,175,80,0.10))","--indicator-shadow":"inset 0 1px 0 rgba(255,255,255,0.14), 0 12px 28px rgba(76,175,80,0.24)"});return b&&(e.borderColor="rgba(76,175,80,0.85)",e.boxShadow="inset 0 1px 0 rgba(255,255,255,0.14), 0 0 0 2px rgba(76,175,80,0.85), 0 0 28px rgba(76,175,80,0.46)"),b&&S&&(e.cursor='url("./cursors/circle.cur"), copy'),e}if("required"===e.requiredState){const e=d(l({},t),{borderColor:"rgba(255,80,80,0.45)",background:"linear-gradient(180deg, rgba(255,80,80,0.12), rgba(255,80,80,0.06))",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.14), 0 12px 28px rgba(255,80,80,0.24)","--indicator-border":"rgba(255,80,80,0.45)","--indicator-bg":"linear-gradient(180deg, rgba(255,80,80,0.20), rgba(255,80,80,0.10))","--indicator-shadow":"inset 0 1px 0 rgba(255,255,255,0.14), 0 12px 28px rgba(255,80,80,0.24)"});return b&&(e.borderColor="rgba(255,80,80,0.85)",e.boxShadow="inset 0 1px 0 rgba(255,255,255,0.14), 0 0 0 2px rgba(255,80,80,0.85), 0 0 28px rgba(255,80,80,0.46)"),b&&S&&(e.cursor='url("./cursors/circle.cur"), copy'),e}return b&&S&&(t.cursor='url("./cursors/circle.cur"), copy'),t},[e.requiredState,k,S,b,e.excelMeta,C]),T=p.useMemo(()=>{var t;const r=null!=(t=e.children)?t:[],n=[];for(let e=0;e<r.length;e++)n.push({left:r[e],right:void 0});return n},[e.children]),z=p.useRef([]),D=p.useRef(null),I=e=>{var t;try{if(!0===window.__excelDragging)return!0;const r=null==(t=e.dataTransfer)?void 0:t.types;if(r){const e=Array.from(r);if(e.includes("application/vnd.excel-field"))return!0;if(e.includes("application/json"))return!0}}catch(r){console.debug("Excel drag detection failed",r)}return!1};p.useEffect(()=>{g&&w.current&&(window.clearTimeout(w.current),w.current=null)},[g]);const M=e=>{const{detail:t}=e;(null==t?void 0:t.forceSide)&&(f(t.forceSide),F(),L(6))},L=(t=8)=>{let r=0;const n=()=>{(()=>{var t;let r=null;const n=null==(t=D.current)?void 0:t.querySelector(":scope > .tree-node"),a=null==n?void 0:n.querySelector(".node-tile");if(a){const e=a.getBoundingClientRect();r=e.left+e.width/2}const o=document.querySelector('svg[data-role="connectors"]'),s=[];o&&o.querySelectorAll('path[data-orientation="trunk"]').forEach(e=>{const t=parseFloat(e.getAttribute("data-x")||"NaN"),r=parseFloat(e.getAttribute("data-y1")||"NaN"),n=parseFloat(e.getAttribute("data-y2")||"NaN"),i=e.getAttribute("data-parent-id")||void 0;Number.isNaN(t)||Number.isNaN(r)||Number.isNaN(n)||s.push({x:t,y1:r,y2:n,parentId:i})});let l=0,d=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(z.current.forEach(e=>{if(!e)return;const t=e.getBoundingClientRect();d=Math.min(d,t.top),c=Math.max(c,t.bottom)}),d<c){const t=(d+c)/2;s.forEach(({x:n,y1:i,y2:a,parentId:o})=>{if(o&&o===e.id)return;if(t<i||t>a)return;const s=Math.min(120,Math.min(120,.08*window.innerWidth)),d=n-18,c=n+18,p=(null!=r?r:0)+l-s,g=(null!=r?r:0)+l+s;if(!(g<d||p>c))if(null!=r&&n>=r){const e=Math.max(0,c-p);l-=e}else{const e=Math.max(0,g-d);l+=e}})}const p=Math.min(200,.12*window.innerWidth);l=Math.max(-p,Math.min(p,l));const g=null!=i?i:h;"left"===g&&(l=Math.min(0,l)),"right"===g&&(l=Math.max(0,l)),z.current.forEach(e=>{if(!e)return;const t=Math.min(120,Math.min(120,.08*window.innerWidth));e.style.setProperty("--child-spread",`${t.toFixed(2)}px`),e.style.setProperty("--branch-offset",`${l.toFixed(2)}px`)})})(),r+=1,r<t&&requestAnimationFrame(n)};requestAnimationFrame(n)},F=()=>{var t;if(i)return void f(i);const r=D.current,n=null==r?void 0:r.dataset.forceSide;if(n)return f(n),void delete r.dataset.forceSide;const a=null==(t=D.current)?void 0:t.querySelector(":scope > .tree-node"),o=null==a?void 0:a.querySelector(".node-tile");if(!o)return;const s=o.getBoundingClientRect(),l=s.left+s.width/2,d=s.top+s.height/2,c=document.querySelector('svg[data-role="connectors"]');let p=null;if(c&&c.querySelectorAll('path[data-orientation="trunk"]').forEach(t=>{if(t.getAttribute("data-parent-id")===e.id)return;const r=parseFloat(t.getAttribute("data-x")||"NaN"),n=parseFloat(t.getAttribute("data-y1")||"NaN"),i=parseFloat(t.getAttribute("data-y2")||"NaN");Number.isNaN(r)||Number.isNaN(n)||Number.isNaN(i)||d<n||d>i||(null==p||Math.abs(r-l)<Math.abs(p-l))&&(p=r)}),null!=p)f(l<p?"left":"right");else{const e=384,t=window.innerWidth-e;f(l<e+t/2?"left":"right")}};return y.jsxs("li",{ref:D,className:"tree-li "+(r?"root":""),role:r?"treeitem":"none","aria-expanded":S?g:void 0,children:[y.jsxs("div",{className:"tree-node","data-depth":t,children:[y.jsx("div",{className:"node-row",style:{paddingLeft:0},children:y.jsxs("div",{ref:e=>{e&&e.addEventListener("search:layout-update",M)},className:"node-tile "+(x?"active":""),role:"button",tabIndex:0,onDragEnter:e=>{if(I(e))return j.current+=1,v(!0),void(!S||g||w.current||(w.current=window.setTimeout(()=>{u(!0),F(),L(6)},500)))},onDragOver:e=>{if(I(e))return S?(e.preventDefault(),e.dataTransfer.dropEffect="copy",g||w.current||(w.current=window.setTimeout(()=>{u(!0),F(),L(6)},500))):(e.preventDefault(),e.dataTransfer.dropEffect="copy"),void v(!0);e.preventDefault()},onDrop:t=>{try{const r=t.dataTransfer.getData("application/json");if(!r)return;const n=JSON.parse(r);if("excelField"===(null==n?void 0:n.kind))if(S){const t=`${e.name} אינו שדה בתקן אלא היררכיה, אפשר להכניס שדות מהאקסל רק לשדות בתקן בעלי סממן ⓘ מעל הקובייה.`;window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:t,type:"error",durationMs:5e3}}))}else window.dispatchEvent(new CustomEvent("excel:drop-on-node",{detail:{targetNode:e,field:n.field}}))}catch(r){}v(!1),j.current=0,w.current&&(window.clearTimeout(w.current),w.current=null)},onDragLeave:()=>{j.current=Math.max(0,j.current-1),0===j.current&&(v(!1),w.current&&(window.clearTimeout(w.current),w.current=null))},onClick:()=>{var e;if(S){const t=void 0!==(null==(e=D.current)?void 0:e.dataset.forceSide);u(e=>{const r=!!t||!e;return r&&(F(),L(6),t&&D.current&&delete D.current.dataset.forceSide),r})}else m(e=>!e)},onContextMenu:e=>{e.preventDefault(),m(e=>!e)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||m(e=>!e)},style:E,"data-node-id":e.id,"data-dragover":b?"1":"0","data-mapped":e.excelMeta&&Object.keys(e.excelMeta).length>0?"1":"0","data-all-mandatory-mapped":C?"1":"0","data-required":e.requiredState||void 0,children:[y.jsx("div",{className:"node-indicator",role:"button",tabIndex:0,"aria-label":S?g?"Collapse":"Expand":"No children",onClick:e=>{var t;if(e.stopPropagation(),S){const e=void 0!==(null==(t=D.current)?void 0:t.dataset.forceSide);u(t=>{const r=!!e||!t;return r&&(F(),L(6),e&&D.current&&delete D.current.dataset.forceSide),r})}else m(e=>!e)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.stopPropagation(),e.preventDefault(),e.currentTarget.click())},"data-openable":S?"1":"0","data-dir":S?"left"===h?"left":"right":"none","data-open":g?"1":"0"}),y.jsx("div",{className:"node-name",children:e.name}),y.jsx("div",{className:`node-type under t-${e.type}`,children:e.type})]})}),y.jsx("div",{className:"desc-panel "+(x?"open":""),"data-node-id":`${e.id}-desc`,children:y.jsxs("div",{className:"desc-content",children:[y.jsx("div",{className:"desc-title",children:"Description"}),y.jsx("div",{className:"desc-text",children:e.description||"No description available."}),e.rules&&e.rules.length>0&&y.jsxs("div",{className:"desc-preview",children:[y.jsx("span",{className:"label",children:"Rules:"}),y.jsx("div",{style:{display:"grid",gap:4},children:e.rules.map((e,t)=>y.jsx("code",{children:e},t))})]}),e.valuePreview&&y.jsxs("div",{className:"desc-preview",children:[y.jsx("span",{className:"label",children:"Preview"}),y.jsx("code",{children:e.valuePreview})]})]})})]}),S&&!r&&y.jsx("div",{className:"binary-children "+(g?"open":""),"data-parent-id":e.id,style:{overflow:g?"visible":void 0,transform:`translateX(${"left"===(null!=i?i:h)?"-140px":"140px"})`},children:T.map((e,r)=>y.jsxs("div",{className:"branch-row",ref:e=>z.current[r]=e,style:{zIndex:10+r},children:[e.left?y.jsx("div",{className:"branch-cell left",children:y.jsx(N,{node:e.left,depth:t+1,forcePreferredSide:h})},e.left.id):y.jsx("div",{className:"branch-cell placeholder"}),e.right?y.jsx("div",{className:"branch-cell right",children:y.jsx(N,{node:e.right,depth:t+1,forcePreferredSide:h})},e.right.id):y.jsx("div",{className:"branch-cell placeholder"})]},r))}),S&&r&&y.jsxs("div",{className:"root-split",children:[y.jsx("div",{className:"root-col left",children:y.jsx("div",{className:"binary-children "+(g?"open":""),"data-parent-id":e.id,style:{overflow:g?"visible":void 0},children:(null!=(s=e.children)?s:[]).filter((e,t)=>t%2==0).map((e,r)=>y.jsxs("div",{className:"branch-row",ref:e=>z.current[z.current.length]=e,style:{zIndex:10+r},children:[y.jsx("div",{className:"branch-cell left",children:y.jsx(N,{node:e,depth:t+1,forcePreferredSide:"left"})}),y.jsx("div",{className:"branch-cell placeholder"})]},`L-${e.id}-${r}`))})}),y.jsx("div",{className:"root-col right",children:y.jsx("div",{className:"binary-children "+(g?"open":""),"data-parent-id":e.id,style:{overflow:g?"visible":void 0},children:(null!=(c=e.children)?c:[]).filter((e,t)=>t%2==1).map((e,r)=>y.jsxs("div",{className:"branch-row",ref:e=>z.current[z.current.length]=e,style:{zIndex:10+r},children:[y.jsx("div",{className:"branch-cell placeholder"}),y.jsx("div",{className:"branch-cell right",children:y.jsx(N,{node:e,depth:t+1,forcePreferredSide:"right"})})]},`R-${e.id}-${r}`))})})]})]})}function I({root:e}){const t=e.children&&e.children.length>0;return y.jsxs("div",{className:"tree-view",children:[y.jsx("div",{className:"tree-canvas",children:y.jsx("ul",{className:"tree-root",role:"tree",children:y.jsx(N,{node:e,depth:0,isRoot:!0,defaultOpenChildren:!0})})}),t?null:y.jsx("div",{className:"placeholder",children:"No nested fields"})]})}function M({containerRef:e}){const[t,r]=p.useState(new Map),n=p.useRef(null),i=p.useRef(null),a=p.useRef(0),o=p.useCallback(()=>{if(!e.current)return;const t=new Map,n=e.current;n.querySelectorAll(".node-tile[data-node-id]").forEach(e=>{const r=e.getAttribute("data-node-id");if(!r)return;const i=e.getBoundingClientRect(),a=n.getBoundingClientRect(),o=window.getComputedStyle(n).transform;let s=1,l=1;if(o&&"none"!==o){const e=o.match(/matrix\(([^)]+)\)/);if(e){const[t,r,n,i]=e[1].split(",").map(e=>parseFloat(e.trim()));s=Math.sqrt(t*t+r*r)||1,l=Math.sqrt(n*n+i*i)||1}}const d=e.closest(".tree-node"),c=null==d?void 0:d.closest(".branch-cell"),p=null==c?void 0:c.closest(".branch-row"),g=null==p?void 0:p.closest(".binary-children"),u=null==g?void 0:g.closest(".tree-li"),x=null==u?void 0:u.querySelector(".node-tile[data-node-id]"),m=null==x?void 0:x.getAttribute("data-node-id");let h=!0,f=e;for(;f&&f!==n;){if(f.classList&&f.classList.contains("binary-children")&&!f.classList.contains("open")){h=!1;break}f=f.parentElement}const b=(i.left-a.left)/s+i.width/2/s,y=(i.top-a.top)/l+i.height/l;t.set(r,{id:r,parentId:null!=m?m:void 0,x:b,y:y,width:i.width/s,height:i.height/l,isVisible:h})}),r(t)},[]);return p.useEffect(()=>{const t=(e=400)=>{const t=performance.now()+e;if(a.current=Math.max(a.current,t),null==i.current){const e=()=>{i.current=null,o(),performance.now()<a.current&&(i.current=requestAnimationFrame(e))};i.current=requestAnimationFrame(e)}};o(),t(300);const r=new MutationObserver(()=>t(500));e.current&&r.observe(e.current,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","style"]});const n=new ResizeObserver(()=>t(200));e.current&&n.observe(e.current);const s=()=>{t(120)};window.addEventListener("scroll",s),window.addEventListener("resize",s);const l=()=>t(400),d=e.current;null==d||d.addEventListener("transitionrun",l,!0),null==d||d.addEventListener("transitionend",l,!0),null==d||d.addEventListener("animationstart",l,!0),null==d||d.addEventListener("animationend",l,!0);const c=new MutationObserver(()=>t(200));return e.current&&c.observe(e.current,{attributes:!0,attributeFilter:["style"]}),()=>{r.disconnect(),n.disconnect(),c.disconnect(),window.removeEventListener("scroll",s),window.removeEventListener("resize",s);const e=d;e&&(e.removeEventListener("transitionrun",l,!0),e.removeEventListener("transitionend",l,!0),e.removeEventListener("animationstart",l,!0),e.removeEventListener("animationend",l,!0)),null!=i.current&&cancelAnimationFrame(i.current),i.current=null,a.current=0}},[e]),e.current?y.jsx("svg",{ref:n,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:100,overflow:"visible"},"data-role":"connectors",children:(()=>{const e=[],r=new Map;return t.forEach(e=>{var n;if(!e.parentId||!e.isVisible)return;const i=t.get(e.parentId);if(!i||!i.isVisible)return;if(Number.isNaN(i.x)||Number.isNaN(i.y)||Number.isNaN(e.x)||Number.isNaN(e.y)||Number.isNaN(e.height)||Number.isNaN(e.width))return;const a=null!=(n=r.get(e.parentId))?n:[];a.push(e),r.set(e.parentId,a)}),r.forEach((r,n)=>{const i=t.get(n);if(!i)return;const a=new Map;r.forEach(e=>{const t=e.y-e.height/2,r=String(Math.round(t)),n=a.get(r);n?(n.items.push(e),n.y=(n.y*(n.items.length-1)+t)/n.items.length):a.set(r,{y:t,items:[e]})});const o=Array.from(a.values()).sort((e,t)=>e.y-t.y);if(o.length>0){const t=i.x,r=i.y,n=o[o.length-1].y;e.push(y.jsx("path",{d:`M ${t.toFixed(2)} ${r.toFixed(2)} L ${t.toFixed(2)} ${n.toFixed(2)}`,stroke:"rgba(124,192,255,0.8)",strokeWidth:2,strokeDasharray:"6 6",fill:"none",strokeLinecap:"butt",strokeLinejoin:"round","data-orientation":"trunk","data-parent-id":i.id,"data-x":t.toFixed(2),"data-y1":r.toFixed(2),"data-y2":n.toFixed(2)},`trunk-${i.id}`)),o.forEach(({y:r,items:n})=>{n.forEach(n=>{const a=n.x,o=a<t?a+n.width/2:a-n.width/2;e.push(y.jsx("path",{d:`M ${t.toFixed(2)} ${r.toFixed(2)} L ${o.toFixed(2)} ${r.toFixed(2)}`,stroke:"rgba(124,192,255,0.8)",strokeWidth:2,strokeDasharray:"6 6",fill:"none",strokeLinecap:"butt",strokeLinejoin:"round","data-orientation":"branch","data-y":r.toFixed(2)},`branch-${i.id}-${n.id}`))})})}}),e})()}):null}function L(e){const t=e.replace("#","");return`FF${t.substring(0,2)}${t.substring(2,4)}${t.substring(4,6)}`}const F={default:{bg:"linear-gradient(180deg, rgba(124,192,255,0.18), rgba(124,192,255,0.08))"},green:{bg:"#4CAF50"},red:{bg:"#F44336"},yellow:{bg:"#E6A700"}};function A(){const e="Segoe UI",t=14,r="#ffffff",n="#2a6bff",i=p.useRef(null),a=p.useRef(null),o=p.useRef(null),[s,g]=p.useState([]),[u,m]=p.useState(null),[h,f]=p.useState(""),[b,v]=p.useState(null),w=p.useCallback((e,t)=>{g(r=>r.map(r=>r.id===e?d(l({},r),{color:t}):r)),v(null);const r=document.querySelector(`[data-field-id="${e}"]`);r&&(r.classList.add("color-changed"),setTimeout(()=>{r.classList.remove("color-changed")},600));const n=s.find(t=>t.id===e);if(n){const e={default:"Default Blue",green:"Green",red:"Red",yellow:"Yellow"};window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`Cube "${n.name}" color changed to ${e[t]}`,type:"ok",durationMs:2e3}}))}},[s]),j=p.useCallback((e,t)=>{e.preventDefault();const r=window.innerWidth,n=window.innerHeight;let i=e.clientX,a=e.clientY;i+140>r&&(i=r-140-10),a+200>n&&(a=n-200-10),v({visible:!0,x:i,y:a,fieldId:t})},[s]),S=p.useCallback(()=>{m(null),f("")},[]),k=p.useCallback((e,t,r)=>{try{const n=r.trim();g(r=>r.map(r=>r.id===e?d(l({},r),{[t]:n}):r)),m(null),f("");const i={fieldEssence:"Field Essence",dgh:"DGH",always:"Always Return",notes:"Notes"};console.log(`${i[t]} updated for field ${e}:`,n||"(empty)");const a=s.find(t=>t.id===e);if(a){const e=n?`${i[t]} updated for "${a.name}"`:`${i[t]} cleared for "${a.name}"`;window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:e,type:"ok",durationMs:2e3}}))}}catch(n){console.error(`Failed to update ${t}:`,n),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`Failed to update ${t}: ${n}`,type:"error",durationMs:3e3}}))}},[s]),C=p.useCallback(()=>{v(null)},[]);p.useEffect(()=>{const e=()=>C(),t=e=>{"Escape"===e.key&&C()};return document.addEventListener("click",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("click",e),document.removeEventListener("keydown",t)}},[C]);const E=p.useCallback(()=>c(this,null,function*(){try{const i=["שם שדה","סוג שדה","מהות השדה",'דג"ח',"האם יחזור תמיד?","הערות"],a=new x.Workbook,o=a.addWorksheet("Template",{views:[{rightToLeft:!0}]});i.forEach((r,n)=>{const i=o.getColumn(n+1);i.width=Math.max(18,r.length+2),i.alignment={horizontal:"center",vertical:"middle",wrapText:!0},i.font={name:e,size:t}}),o.addRow(i);const s=o.getRow(1);s.height=50,s.eachCell(i=>{i.font={name:e,size:t,bold:!0,color:{argb:L(r)}},i.fill={type:"pattern",pattern:"solid",fgColor:{argb:L(n)}},i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},i.alignment={horizontal:"center",vertical:"middle",wrapText:!0}});const l=50;for(let r=2;r<=1+l;r++){const n=o.getRow(r);i.forEach((r,i)=>{const a=n.getCell(i+1);a.font={name:e,size:t},a.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},a.alignment={horizontal:"center",vertical:"middle",wrapText:!0}})}const d=yield a.xlsx.writeBuffer(),c=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=URL.createObjectURL(c),g=document.createElement("a");g.href=p,g.download="PaaS Template.xlsx",document.body.appendChild(g),g.click(),g.remove(),URL.revokeObjectURL(p)}catch(i){console.error("Failed to generate template:",i),alert("Failed to generate template. Check console for details.")}}),[]),T=e=>{try{if(!e)return"";const t=null==e?void 0:e.path;if("string"==typeof t&&t.trim())return t.trim().split(".").join(" -> ");const r=String(e.id||"").trim();if(!r)return e.name||"";const n=r.split(":")[0];return n&&"root"!==n&&n.includes(".")?n.split(".").join(" -> "):e.name||""}catch(t){return console.error("Failed to compute full hierarchy label for targetNode:",t,e),(null==e?void 0:e.name)||""}},z=p.useCallback((i,a,o)=>c(this,null,function*(){try{const l=["שם שדה צד ספק","מהות השדה","סוג השדה צד ספק",'דג"ח',"שם השדה בתקן","סוג השדה בתקן","חוקי השדה בתקן","האם יחזור תמיד","פירוט הפרסר","המיפוי יתבצע בOUTPUTS הבאים:","הערות","האם צריך להזרים מהספק?"],d=new x.Workbook,c=d.addWorksheet("mapping",{views:[{rightToLeft:!0}]});l.forEach((r,n)=>{const i=c.getColumn(n+1);i.width=0===n?33:3===n?45:4===n?50:Math.max(18,r.length+2),i.alignment={horizontal:"center",vertical:"middle",wrapText:!0},i.font={name:e,size:t}}),c.addRow(l);const p=c.getRow(1);p.height=50,p.eachCell(i=>{i.font={name:e,size:t,bold:!0,color:{argb:L(r)}},i.fill={type:"pattern",pattern:"solid",fgColor:{argb:L(n)}},i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},i.alignment={horizontal:"center",vertical:"middle",wrapText:!0}});const g=new Map;if(a&&Array.isArray(a)&&a.forEach(e=>{var t,r;const n=`${(null==(t=null==e?void 0:e.field)?void 0:t.name)||""}__${(null==(r=null==e?void 0:e.field)?void 0:r.fieldType)||""}`;g.set(n,e)}),s&&s.length>0)s.forEach(r=>{var n,i,a,o;const s=g.get(`${r.name}__${r.fieldType}`),d=!(!s||!((null==(n=null==s?void 0:s.targetNode)?void 0:n.name)&&String(s.targetNode.name).trim()||(null==(i=null==s?void 0:s.targetNode)?void 0:i.path)))||!!r.isMapped,p=[r.name||"",r.fieldEssence||"",r.fieldType||"",r.dgh||"",T(null==s?void 0:s.targetNode)||"",(null==(a=null==s?void 0:s.targetNode)?void 0:a.type)||"",(null==(o=null==s?void 0:s.targetNode)?void 0:o.rules)?s.targetNode.rules.join(", "):"",r.always||"",(null==s?void 0:s.mappingDetails)||"",(null==s?void 0:s.outputs)||"",r.notes||"",""],u=c.addRow(p);try{if("yellow"===r.color||"red"===r.color){const e="yellow"===r.color?"#E6A700":"#F44336";u.eachCell(t=>{t.fill={type:"pattern",pattern:"solid",fgColor:{argb:L(e)}}})}}catch(x){console.warn("Failed to apply colored row background:",x)}l.forEach((n,i)=>{const a=u.getCell(i+1);if(a.font={name:e,size:t},a.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},a.alignment={horizontal:"center",vertical:"middle",wrapText:!0},i===l.length-1){const e=d?"FF90EE90":"yellow"===r.color?L("#E6A700"):"red"===r.color?L("#F44336"):"FFFFFFFF";a.fill={type:"pattern",pattern:"solid",fgColor:{argb:e}}}})});else if(i&&i.length>0)i.forEach((r,n)=>{const i=c.addRow(r);l.forEach((r,n)=>{const a=i.getCell(n+1);a.font={name:e,size:t},a.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},a.alignment={horizontal:"center",vertical:"middle",wrapText:!0},n===l.length-1&&(a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFFFFF"}})})});else if(a&&a.length>0)console.log("Processing saved mappings for Excel generation:",a),a.forEach((r,n)=>{console.log(`Processing mapping ${n+1}:`,r);const i=[r.field.name||"",r.field.fieldEssence||"",r.field.fieldType||"",r.field.dgh||"",T(r.targetNode)||"",r.targetNode.type||"",r.targetNode.rules?r.targetNode.rules.join(", "):"",r.field.always||"",r.mappingDetails||"",r.outputs||"",r.field&&r.field.notes?r.field.notes:"",""];console.log(`Generated Excel row ${n+1}:`,i);const a=c.addRow(i);try{const e=null==s?void 0:s.find(e=>e.name===r.field.name&&e.fieldType===r.field.fieldType);if(e&&("yellow"===e.color||"red"===e.color)){const t="yellow"===e.color?"#E6A700":"#F44336";a.eachCell(e=>{e.fill={type:"pattern",pattern:"solid",fgColor:{argb:L(t)}}})}}catch(o){console.warn("Failed to apply colored row background (savedMappings branch):",o)}l.forEach((n,i)=>{var o,s;const d=a.getCell(i+1);if(d.font={name:e,size:t},d.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},d.alignment={horizontal:"center",vertical:"middle",wrapText:!0},i===l.length-1){const e=!!((null==(o=null==r?void 0:r.targetNode)?void 0:o.name)&&String(r.targetNode.name).trim()||(null==(s=null==r?void 0:r.targetNode)?void 0:s.path));d.fill={type:"pattern",pattern:"solid",fgColor:{argb:e?"FF90EE90":"FFFFFFFF"}}}})}),console.log(`Added ${a.length} rows to Excel worksheet`);else{console.log("No saved mappings found, creating empty template rows");const r=50;for(let n=2;n<=1+r;n++){const r=c.getRow(n);l.forEach((n,i)=>{const a=r.getCell(i+1);a.font={name:e,size:t},a.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},a.alignment={horizontal:"center",vertical:"middle",wrapText:!0}})}}if(o){const e=d.addWorksheet("__meta");e.getCell("A1").value="schemaKey",e.getCell("B1").value=o,e.state="veryHidden"}return d}catch(l){throw console.error("Failed to generate mapping workbook:",l),l}}),[s]),D=p.useCallback(()=>c(this,null,function*(){try{console.log("Getting saved mappings from global state...");let e=[];const t=new CustomEvent("excel:request-mappings",{detail:{callback:t=>{e=t}}});window.dispatchEvent(t),yield new Promise(e=>setTimeout(e,100));let r="";const n=new CustomEvent("excel:request-selected-schema",{detail:{callback:e=>{r=e}}});window.dispatchEvent(n),yield new Promise(e=>setTimeout(e,50)),console.log("Final saved mappings for Excel generation:",e);const i=yield z(void 0,e,r),a=yield i.xlsx.writeBuffer(),o=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=URL.createObjectURL(o),l=document.createElement("a");l.href=s,l.download="mapping.xlsx",document.body.appendChild(l),l.click(),l.remove(),URL.revokeObjectURL(s)}catch(e){console.error("Failed to download mapping excel:",e),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`Failed to download mapping excel: ${e}`,type:"error",durationMs:5e3}}))}}),[z]),N=p.useCallback(e=>c(this,null,function*(){var t,r,n,i,a,o,d,c,p,u,m;try{const f=yield e.arrayBuffer(),b=new x.Workbook;yield b.xlsx.load(f);let y="";try{const e=b.getWorksheet("__meta");if(e){const t=e.getCell("B1"),r=null==t?void 0:t.value;"string"==typeof r&&(y=r.trim()),!y&&"object"==typeof r&&r&&"text"in r&&(y=String(r.text||"").trim())}}catch(h){console.warn("No __meta sheet found in mapping file or failed to read schema key")}const v=b.worksheets[0];if(!v)throw new Error("No worksheet found in uploaded mapping file");const w=v.getRow(1),j={};w.eachCell((e,t)=>{var r;const n=String(null!=(r=e.value)?r:"").trim();n&&(j[n]=t)});const S=e=>{for(const t of e)if(null!=j[t])return j[t];return-1},k=S(["שם שדה צד ספק"]),C=S(["מהות השדה"]),E=S(["סוג השדה צד ספק"]),z=S(['דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח']),D=S(["שם השדה בתקן"]),N=S(["סוג השדה בתקן"]),I=S(["חוקי השדה בתקן"]),M=S(["האם יחזור תמיד"]),F=S(["פירוט הפרסר"]),A=S(["המיפוי יתבצע בOUTPUTS הבאים:"]),R=S(["הערות"]),$=[],W=new Map;s.forEach(e=>{W.set(`${e.name}__${e.fieldType}`,l({},e))});const B=v.rowCount;for(let e=2;e<=B;e++){const s=v.getRow(e),g=(()=>{try{let e=!1;return s.eachCell(t=>{const r=t&&t.fill||null,n=r&&r.fgColor&&(r.fgColor.argb||r.fgColor.rgb)||"";if("string"==typeof n&&n){const t=n.toUpperCase();t!==L("#E6A700").toUpperCase()&&"FFE6A700"!==t||(e=!0)}}),e}catch(h){return!1}})(),x=(()=>{try{let e=!1;return s.eachCell(t=>{const r=t&&t.fill||null,n=r&&r.fgColor&&(r.fgColor.argb||r.fgColor.rgb)||"";if("string"==typeof n&&n){const t=n.toUpperCase();t!==L("#F44336").toUpperCase()&&"FFF44336"!==t||(e=!0)}}),e}catch(h){return!1}})(),f=k>0?String(null!=(t=s.getCell(k).value)?t:"").trim():"",b=E>0?String(null!=(r=s.getCell(E).value)?r:"").trim():"",y=C>0?String(null!=(n=s.getCell(C).value)?n:"").trim():"",w=z>0?String(null!=(i=s.getCell(z).value)?i:"").trim():"",j=D>0?String(null!=(a=s.getCell(D).value)?a:"").trim():"",S=(()=>{try{if(!j)return"";if(j.includes("->")){const e=j.split("->").map(e=>e.trim()).filter(Boolean),t=e.length?e[e.length-1]:j;return{targetName:t,targetPath:e.join(".")}}return{targetName:j,targetPath:""}}catch(h){return console.error("Failed to parse target name from imported mapping row:",h,j),{targetName:j,targetPath:""}}})(),B="object"==typeof S&&S?S.targetName:"",O="object"==typeof S&&S?S.targetPath:"",P=N>0?String(null!=(o=s.getCell(N).value)?o:"").trim():"",_=I>0?String(null!=(d=s.getCell(I).value)?d:"").trim():"",U=M>0?String(null!=(c=s.getCell(M).value)?c:"").trim():"",q=F>0?String(null!=(p=s.getCell(F).value)?p:"").trim():"",H=A>0?String(null!=(u=s.getCell(A).value)?u:"").trim():"",Y=R>0?String(null!=(m=s.getCell(R).value)?m:"").trim():"";if(![f,b,y,w,B,P,_,U,q,H,Y].some(Boolean))continue;const V=`${f}__${b}`,J=W.get(V);J?(J.fieldEssence=y||J.fieldEssence||"",J.dgh=w||J.dgh||"",J.always=U||J.always||"",J.notes=Y||J.notes||"",B||q||H?(J.isMapped=!0,J.mappedTargetLabel=T({id:"",name:B,path:O})||"",J.color=g?"yellow":x?"red":J.color||"green"):(g||x)&&(J.color=g?"yellow":"red"),W.set(V,J)):W.set(V,{id:`excel-imported-${W.size+1}`,name:f||`Field_${W.size+1}`,fieldType:b||"",fieldEssence:y||"",dgh:w||"",always:U||"",notes:Y||"",expanded:!1,isMapped:!!(B||q||H),mappedTargetLabel:B||q||H?T({id:"",name:B,path:O})||"":void 0,color:g?"yellow":x?"red":B||q||H?"green":"default"}),$.push({targetNode:l({id:`import-${e}`,name:B,type:P,rules:_?_.split(",").map(e=>e.trim()).filter(Boolean):[]},O?{path:O}:{}),field:{name:f,fieldType:b,fieldEssence:y,dgh:w,always:U,notes:Y},mappingDetails:q,outputs:H,timestamp:Date.now()})}const O=Array.from(W.values());g(O),window.dispatchEvent(new CustomEvent("excel:mappings-imported",{detail:{mappings:$}})),y&&window.dispatchEvent(new CustomEvent("excel:apply-selected-schema",{detail:{key:y}})),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`Mapping file loaded. ${O.length} fields refreshed`,type:"ok",durationMs:4e3}}))}catch(f){console.error("Failed to parse mapping Excel:",f),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"Failed to parse mapping Excel",type:"error",durationMs:5e3}}))}}),[s]),I=p.useCallback(e=>c(this,null,function*(){var t,r,n,i,a,o;try{const s=yield e.arrayBuffer(),l=new x.Workbook;yield l.xlsx.load(s);const d=l.worksheets[0];if(!d)throw new Error("No worksheet found in uploaded file");const c=[],p=d.rowCount;for(let e=2;e<=p;e++){const s=String(null!=(t=d.getRow(e).getCell(1).value)?t:"").trim(),l=String(null!=(r=d.getRow(e).getCell(2).value)?r:"").trim(),p=String(null!=(n=d.getRow(e).getCell(3).value)?n:"").trim(),g=String(null!=(i=d.getRow(e).getCell(4).value)?i:"").trim(),u=String(null!=(a=d.getRow(e).getCell(5).value)?a:"").trim(),x=String(null!=(o=d.getRow(e).getCell(6).value)?o:"").trim();(s||l||p||g||u||x)&&c.push({name:s,type:l,essence:p,dgh:g,always:u,notes:x})}const u=[];c.forEach((e,t)=>{u.push({id:`excel-${t+1}`,name:e.name||`Field_${t+1}`,fieldType:e.type||"",fieldEssence:e.essence||"",dgh:e.dgh||"",always:e.always||"",notes:e.notes||"",expanded:!1,color:"default"})}),g(u);const m=c.length,h=u.length;let f="",b="ok";0===m?(f="האקסל ריק או שלא הצלחתי לקרוא אותו :(",b="error"):h===m?(f=`אקסל הועלה בהצלחה! ${h} שדות חולצו מתוך ${m} שורות באקסל.`,b="ok"):(f=`אקסל הועלה בהצלחה! ${h} שדות חולצו מתוך ${m} שורות באקסל.`,b="warn"),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:f,type:b,durationMs:5e3}})),h>0&&window.dispatchEvent(new CustomEvent("excel:uploaded"))}catch(s){console.error("Failed to parse uploaded Excel:",s),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"Excel is empty or couldn't read it",type:"error",durationMs:5e3}}))}}),[]),M=p.useCallback(()=>{try{if(g([]),m(null),f(""),v(null),o.current){try{o.current.remove()}catch(e){}o.current=null}window.dispatchEvent(new Event("excel:clear-all-mappings")),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:'נוקה ממשק הדג"ח',type:"ok",durationMs:2500}}))}catch(t){console.error("Failed to clear Excel extractor:",t),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`ניקוי נכשל: ${t}`,type:"error",durationMs:4e3}}))}},[]);return p.useEffect(()=>{const e=()=>{E()},t=()=>{D()},r=()=>{var e;null==(e=i.current)||e.click()},n=()=>{var e;null==(e=a.current)||e.click()},o=e=>c(this,null,function*(){try{const{data:t,filename:r="mapping.xlsx"}=e.detail||{};let n="";const i=new CustomEvent("excel:request-selected-schema",{detail:{callback:e=>{n=e}}});window.dispatchEvent(i),yield new Promise(e=>setTimeout(e,50));const a=yield z(t,void 0,n),o=yield a.xlsx.writeBuffer(),s=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=URL.createObjectURL(s),d=document.createElement("a");d.href=l,d.download=r,document.body.appendChild(d),d.click(),d.remove(),URL.revokeObjectURL(l)}catch(t){console.error("Failed to save mapping excel:",t),alert("Failed to save mapping excel. Check console for details.")}}),s=e=>{const{field:t,targetNode:r}=e.detail||{};t&&g(e=>e.map(e=>{if(e.name===t.name&&e.fieldType===t.fieldType){const t=T(r);return d(l({},e),{isMapped:!0,mappedTargetLabel:t||void 0,color:e.color||"default"})}return e}))};return window.addEventListener("excel:download-template-request",e),window.addEventListener("excel:download-mapping-request",t),window.addEventListener("excel:upload-request",r),window.addEventListener("excel:upload-mapping-request",n),window.addEventListener("excel:save-mapping-request",o),window.addEventListener("excel:mapping-saved",s),()=>{window.removeEventListener("excel:download-template-request",e),window.removeEventListener("excel:download-mapping-request",t),window.removeEventListener("excel:upload-request",r),window.removeEventListener("excel:upload-mapping-request",n),window.removeEventListener("excel:save-mapping-request",o),window.removeEventListener("excel:mapping-saved",s)}},[E,D,z]),y.jsx("aside",{className:"fridge-panel",children:y.jsxs("div",{className:"fridge-door",children:[y.jsx("div",{className:"fridge-handle"}),y.jsx("div",{className:"fridge-title",children:'פרק תדג"ח'}),y.jsx("div",{className:"fridge-subtitle",children:'שדות מהדג"ח'}),y.jsx("div",{className:"fridge-divider"}),s.length>0&&y.jsx("div",{className:"excel-fields",onDragOver:e=>{e.preventDefault()},children:y.jsx("div",{className:"excel-fields-list",children:s.map((e,t)=>y.jsxs("div",{"data-field-id":e.id,"data-color":e.color,className:`excel-cube ${e.expanded?"open":""} ${e.isMapped?"mapped":""} ${(null==u?void 0:u.id)===e.id?"editing":""}`,draggable:!0,title:"Right-click to change color",style:{background:e.isMapped?void 0:e.color?F[e.color].bg:F.default.bg,boxShadow:e.isMapped?void 0:"0 4px 12px rgba(0,0,0,0.2)"},onDragStart:t=>{t.dataTransfer.setData("application/json",JSON.stringify({kind:"excelField",field:e})),t.dataTransfer.setData("application/vnd.excel-field","1"),t.dataTransfer.effectAllowed="copy",window.__excelDragging=!0,window.dispatchEvent(new CustomEvent("excel:drag-start",{detail:e}));try{o.current&&(o.current.remove(),o.current=null);const e=t.currentTarget.cloneNode(!0);e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.pointerEvents="none",e.style.transform="none",e.style.boxShadow="0 10px 28px rgba(0,0,0,0.36)",e.style.color="#ffffff",e.style.filter="saturate(1.1) brightness(1.05)",e.style.opacity="0.95",document.body.appendChild(e),o.current=e;const r=e.getBoundingClientRect(),n=r.width/2,i=r.height/2;t.dataTransfer.setDragImage&&t.dataTransfer.setDragImage(e,n,i)}catch(r){console.debug("Failed to set custom drag image",r)}},onDragEnd:()=>{if(window.__excelDragging=!1,window.dispatchEvent(new Event("excel:drag-end")),o.current){try{o.current.remove()}catch(e){}o.current=null}},onClick:e=>{const r=e.target;r.closest(".editable-field")||r.closest("input")||r.closest("textarea")?e.stopPropagation():g(e=>e.map((e,r)=>r===t?d(l({},e),{expanded:!e.expanded}):e))},onContextMenu:t=>{j(t,e.id)},children:[y.jsxs("div",{className:"excel-cube-head",style:{position:"relative"},children:[y.jsx("div",{className:"excel-cube-name",children:e.name}),e.fieldType&&y.jsx("div",{className:"excel-cube-sub",children:e.fieldType}),e.isMapped&&y.jsx("div",{className:"mapping-checkmark",title:"Field is mapped",style:{position:"absolute",top:"8px",right:"8px",width:"20px",height:"20px",borderRadius:"50%",backgroundColor:"#4CAF50",border:"2px solid #000",display:"flex",alignItems:"center",justifyContent:"center",color:"#000",fontSize:"12px",fontWeight:"bold",zIndex:1},children:"✓"})]}),y.jsxs("div",{className:"excel-cube-desc",dir:"rtl",style:{display:e.expanded?"grid":"none"},children:[y.jsxs("div",{className:"row",children:[y.jsx("span",{className:"k",children:"מהות השדה:"}),(null==u?void 0:u.id)===e.id&&"fieldEssence"===u.field?y.jsx("textarea",{className:"editable-field",value:h,onChange:e=>{f(e.target.value);const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onFocus:e=>{const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onKeyDown:t=>{var r,n;if("Enter"===t.key&&t.shiftKey){t.preventDefault();const e=t.currentTarget,i=null!=(r=e.selectionStart)?r:h.length,a=null!=(n=e.selectionEnd)?n:h.length,o=h.slice(0,i)+"\n"+h.slice(a);return f(o),void setTimeout(()=>{try{e.selectionStart=e.selectionEnd=i+1}catch(t){}},0)}"Enter"===t.key?k(e.id,"fieldEssence",h):"Escape"===t.key&&S()},onBlur:()=>{h.trim()!==(e.fieldEssence||"")?k(e.id,"fieldEssence",h):S()},autoFocus:!0,style:{border:"1px solid #7cc0ff",borderRadius:"4px",padding:"6px 8px",fontSize:"14px",width:"100%",minHeight:"64px",resize:"none",overflow:"hidden",backgroundColor:"rgba(124, 192, 255, 0.1)",color:"#e6f1ff",outline:"none",boxShadow:"0 0 0 2px rgba(124, 192, 255, 0.2)"}}):y.jsxs("span",{className:"v editable-field",onDoubleClick:t=>{t.stopPropagation(),m({id:e.id,field:"fieldEssence"}),f(e.fieldEssence||"")},style:{cursor:"pointer",whiteSpace:"pre-wrap"},title:"Double-click to edit",children:[e.fieldEssence||"-",y.jsx("span",{className:"edit-icon "+(e.fieldEssence?"":"empty"),children:y.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"18px",height:"18px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.1)",marginLeft:"6px"},children:y.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:y.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#000000"})})})})]})]}),y.jsxs("div",{className:"row",children:[y.jsx("span",{className:"k",children:'דג"ח:'}),(null==u?void 0:u.id)===e.id&&"dgh"===u.field?y.jsx("textarea",{className:"editable-field",value:h,onChange:e=>{f(e.target.value);const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onFocus:e=>{const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onKeyDown:t=>{var r,n;if("Enter"===t.key&&t.shiftKey){t.preventDefault();const e=t.currentTarget,i=null!=(r=e.selectionStart)?r:h.length,a=null!=(n=e.selectionEnd)?n:h.length,o=h.slice(0,i)+"\n"+h.slice(a);return f(o),void setTimeout(()=>{try{e.selectionStart=e.selectionEnd=i+1}catch(t){}},0)}"Enter"===t.key?k(e.id,"dgh",h):"Escape"===t.key&&S()},onBlur:()=>{h.trim()!==(e.dgh||"")?k(e.id,"dgh",h):S()},autoFocus:!0,style:{border:"1px solid #7cc0ff",borderRadius:"4px",padding:"6px 8px",fontSize:"14px",width:"100%",minHeight:"64px",resize:"none",overflow:"hidden",backgroundColor:"rgba(124, 192, 255, 0.1)",color:"#e6f1ff",outline:"none",boxShadow:"0 0 0 2px rgba(124, 192, 255, 0.2)"}}):y.jsxs("span",{className:"v editable-field",onDoubleClick:t=>{t.stopPropagation(),m({id:e.id,field:"dgh"}),f(e.dgh||"")},title:"Double-click to edit",style:{whiteSpace:"pre-wrap"},children:[e.dgh||"-",y.jsx("span",{className:"edit-icon "+(e.dgh?"":"empty"),children:y.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"18px",height:"18px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.1)",marginLeft:"6px"},children:y.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:y.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#000000"})})})})]})]}),y.jsxs("div",{className:"row",children:[y.jsx("span",{className:"k",children:"האם יחזור תמיד?"}),(null==u?void 0:u.id)===e.id&&"always"===u.field?y.jsx("textarea",{className:"editable-field",value:h,onChange:e=>{f(e.target.value);const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onFocus:e=>{const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onKeyDown:t=>{var r,n;if("Enter"===t.key&&t.shiftKey){t.preventDefault();const e=t.currentTarget,i=null!=(r=e.selectionStart)?r:h.length,a=null!=(n=e.selectionEnd)?n:h.length,o=h.slice(0,i)+"\n"+h.slice(a);return f(o),void setTimeout(()=>{try{e.selectionStart=e.selectionEnd=i+1}catch(t){}},0)}"Enter"===t.key?k(e.id,"always",h):"Escape"===t.key&&S()},onBlur:()=>{h.trim()!==(e.always||"")?k(e.id,"always",h):S()},autoFocus:!0,style:{border:"1px solid #7cc0ff",borderRadius:"4px",padding:"6px 8px",fontSize:"14px",width:"100%",minHeight:"64px",resize:"none",overflow:"hidden",backgroundColor:"rgba(124, 192, 255, 0.1)",color:"#e6f1ff",outline:"none",boxShadow:"0 0 0 2px rgba(124, 192, 255, 0.2)"}}):y.jsxs("span",{className:"v editable-field",onDoubleClick:t=>{t.stopPropagation(),m({id:e.id,field:"always"}),f(e.always||"")},title:"Double-click to edit",style:{whiteSpace:"pre-wrap"},children:[e.always||"-",y.jsx("span",{className:"edit-icon "+(e.always?"":"empty"),children:y.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"18px",height:"18px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.1)",marginLeft:"6px"},children:y.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:y.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#000000"})})})})]})]}),y.jsxs("div",{className:"row",children:[y.jsx("span",{className:"k",children:"הערות:"}),(null==u?void 0:u.id)===e.id&&"notes"===u.field?y.jsx("textarea",{className:"editable-field",value:h,onChange:e=>{f(e.target.value);const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onFocus:e=>{const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onKeyDown:t=>{var r,n;if("Enter"===t.key&&t.shiftKey){t.preventDefault();const e=t.currentTarget,i=null!=(r=e.selectionStart)?r:h.length,a=null!=(n=e.selectionEnd)?n:h.length,o=h.slice(0,i)+"\n"+h.slice(a);return f(o),void setTimeout(()=>{try{e.selectionStart=e.selectionEnd=i+1}catch(t){}},0)}"Enter"===t.key?k(e.id,"notes",h):"Escape"===t.key&&S()},onBlur:()=>{h.trim()!==(e.notes||"")?k(e.id,"notes",h):S()},autoFocus:!0,style:{border:"1px solid #7cc0ff",borderRadius:"4px",padding:"6px 8px",fontSize:"14px",width:"100%",minHeight:"64px",resize:"none",overflow:"hidden",backgroundColor:"rgba(124, 192, 255, 0.1)",color:"#e6f1ff",outline:"none",boxShadow:"0 0 0 2px rgba(124, 192, 255, 0.2)"}}):y.jsxs("span",{className:"v editable-field",onDoubleClick:t=>{t.stopPropagation(),m({id:e.id,field:"notes"}),f(e.notes||"")},style:{cursor:"pointer"},title:"Double-click to edit",children:[y.jsx("span",{style:{whiteSpace:"pre-wrap"},children:e.notes||"-"}),y.jsx("span",{className:"edit-icon "+(e.notes?"":"empty"),children:y.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"18px",height:"18px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.1)",marginLeft:"6px"},children:y.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:y.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#000000"})})})})]})]}),e.isMapped&&e.mappedTargetLabel&&y.jsxs("div",{className:"row",children:[y.jsx("span",{className:"k",children:"שדה בתקן:"}),y.jsx("span",{className:"v",style:{fontSize:"8px"},children:e.mappedTargetLabel})]})]})]},e.id))})}),b&&y.jsxs("div",{className:"cube-context-menu",style:{position:"fixed",top:b.y,left:b.x,zIndex:1e3,backgroundColor:"#2a2a2a",border:"1px solid #444",borderRadius:"8px",padding:"8px 0",boxShadow:"0 4px 20px rgba(0,0,0,0.3)",minWidth:"120px"},onClick:e=>e.stopPropagation(),children:[y.jsxs("div",{className:"context-menu-title",style:{padding:"8px 16px",fontSize:"12px",color:"#888",borderBottom:"1px solid #444",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[y.jsx("span",{children:"Change Cube Color"}),y.jsx("button",{onClick:C,style:{background:"none",border:"none",color:"#888",cursor:"pointer",fontSize:"14px",padding:"2px",borderRadius:"3px",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#444",e.currentTarget.style.color="#fff"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#888"},title:"Close",children:"✕"})]}),Object.entries(F).filter(([e])=>"green"!==e).map(([e,t])=>y.jsxs("div",{className:"color-option",onClick:()=>w(b.fieldId,e),style:{padding:"8px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",color:"#fff",transition:"background-color 0.2s"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#444"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[y.jsx("div",{className:"color-preview",style:{width:"16px",height:"16px",borderRadius:"3px",background:"default"===e?"linear-gradient(180deg, rgba(124,192,255,0.6), rgba(124,192,255,0.3))":t.bg}}),y.jsx("span",{style:{textTransform:"capitalize"},children:e})]},e))]}),y.jsxs("div",{className:"excel-actions",children:[y.jsx("input",{ref:i,type:"file",accept:".xlsx,.xls",style:{display:"none"},onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&I(r),i.current&&(i.current.value="")}}),y.jsx("input",{ref:a,type:"file",accept:".xlsx,.xls",style:{display:"none"},onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&N(r),a.current&&(a.current.value="")}}),s.filter(e=>e.isMapped).length>0&&y.jsxs("div",{className:"mappings-count",children:[s.filter(e=>e.isMapped).length," mapping",1!==s.filter(e=>e.isMapped).length?"s":""," saved"]})]}),y.jsx("div",{className:"fridge-note",children:0===s.length?'הורידו את הפורמט, מלאו אותו בדג"ח מהספק והעלו אותו לפירוק!':'גררו שדה מהדג"ח לשדה שמתאים לו מהתקן, הכניסו את הפרסר הרצוי ולחצו שמור. לאחר שסיימתם למפות את כל השדות הרלוונטים - לחצו על כפתור הורדת המאפינג ותיהנו!'}),0===s.length&&y.jsx("div",{className:"excel-cta"}),s.length>0&&y.jsx("button",{className:"btn ghost extractor-clear-btn","aria-label":'נקה את הדג"ח',title:'נקה את הדג"ח',onClick:e=>{e.stopPropagation(),M()},children:y.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:y.jsx("path",{d:"M9 3c-.55 0-1 .45-1 1v1H5.5c-.28 0-.5.22-.5.5s.22.5.5.5H6v13c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V6h.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5H16V4c0-.55-.45-1-1-1H9zm1 2V4h4v1h-4zm-2 2h10v12c0 .55-.45 1-1 1H8c-.55 0-1-.45-1-1V7zm3 2c-.28 0-.5.22-.5.5v7c0 .28.22.5.5.5s.5-.22.5-.5v-7c0-.28-.22-.5-.5-.5zm4 0c-.28 0-.5.22-.5.5v7c0 .28.22.5.5.5s.5-.22.5-.5v-7c0-.28-.22-.5-.5-.5z"})})})]})})}const R=e=>{switch(e){case"local":return"אימות מקומי";case"adfs":return"אימות ADFS";default:return"לא ידוע"}},$={auth:{clientId:"00000000-0000-0000-0000-000000000000",authority:"https://your-adfs-host/adfs",redirectUri:window.location.origin,postLogoutRedirectUri:window.location.origin},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!1}};let W=null;const B=()=>(!W&&$.auth.clientId&&$.auth.authority&&(W=new m($)),W),O={scopes:["openid","profile"]},P=e=>{var t,r;const n=e.idTokenClaims,i=(null==n?void 0:n.groups)||[];return["admin","admins","Administrators","Administrators@thegreentree"].some(e=>i.some(t=>t.toLowerCase().includes(e.toLowerCase())))||"admin"===(null==n?void 0:n.role)||(null==(t=null==n?void 0:n.roles)?void 0:t.includes("admin"))?"admin":["editor","editors","Editor","Writers"].some(e=>i.some(t=>t.toLowerCase().includes(e.toLowerCase())))||"editor"===(null==n?void 0:n.role)||(null==(r=null==n?void 0:n.roles)?void 0:r.includes("editor"))?"editor":"viewer"},_=()=>c(e,null,function*(){const t=B();if(!t)return null;const r=t.getAllAccounts();if(0===r.length)return null;const n=r[0];try{yield c(e,null,function*(){const e=B();if(!e)return null;const t=e.getAllAccounts();if(0===t.length)return null;try{const r=d(l({},O),{account:t[0]});return yield e.acquireTokenSilent(r)}catch(r){if(r instanceof h){const r=d(l({},O),{account:t[0]});return yield e.acquireTokenPopup(r)}throw r}})}catch(i){return console.warn("Unable to acquire token silently:",i),null}return{id:n.localAccountId||n.homeAccountId,name:n.name||n.username,email:n.username,role:P(n),lastLogin:(new Date).toISOString(),adfsAccount:n}}),U={viewer:["view_all"],editor:["view_all","chat_message"],admin:["view_all","edit_status","create_sagach","delete_sagach","chat_message","manage_users"]},q=p.createContext(void 0),H=({children:t})=>{const[r,n]=p.useState(null),[i,a]=p.useState(!0),[o]=p.useState(()=>(()=>{const e=localStorage.getItem("auth_mode");return!e||"local"!==e&&"adfs"!==e?"adfs":e})());p.useEffect(()=>{c(e,null,function*(){a(!0);try{if("adfs"===o){const t=yield c(e,null,function*(){const e=B();if(!e)return null;try{return yield e.initialize(),yield _()}catch(t){return console.error("ADFS initialization failed:",t),null}});if(t)return void n(t)}const t=localStorage.getItem("user");if(t){const e=JSON.parse(t);e.authMode=o,n(e)}}catch(t){console.error("Failed to initialize authentication:",t),localStorage.removeItem("user")}finally{a(!1)}})},[o]),p.useEffect(()=>{if(r)try{localStorage.setItem("user",JSON.stringify(r))}catch(e){console.error("Failed to save user to localStorage:",e)}else localStorage.removeItem("user")},[r]);const s=e=>!!r&&U[r.role].includes(e),l={user:r,login:t=>c(e,null,function*(){a(!0);try{yield new Promise(e=>setTimeout(e,500));const r={id:t.id||`user_${Date.now()}`,name:t.name||"משתמש",email:t.email||"user@example.com",role:t.role||"viewer",lastLogin:(new Date).toISOString(),authMode:"local"};if(n(r),"admin"===r.role)try{const e=localStorage.getItem("admin_users"),t=e?JSON.parse(e):[];t.some(e=>e.id===r.id||e.email===r.email)||(t.push(r),localStorage.setItem("admin_users",JSON.stringify(t)))}catch(e){console.error("Failed to add admin user to list:",e)}window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`ברוך הבא, ${r.name}!`,type:"ok",durationMs:3e3}}))}catch(e){console.error("Local login failed:",e),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"שגיאה בהתחברות מקומית",type:"error",durationMs:3e3}}))}finally{a(!1)}}),loginWithAdfs:()=>c(e,null,function*(){a(!0);try{yield c(e,null,function*(){const e=B();if(!e)throw new Error("ADFS is not configured. Please set VITE_ADFS_CLIENT_ID and VITE_ADFS_AUTHORITY in .env.local");try{return yield e.loginPopup(O)}catch(t){throw console.error("ADFS login failed:",t),t}});const t=yield _();if(!t)throw new Error("Failed to get user information from ADFS");n(t),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`ברוך הבא, ${t.name}!`,type:"ok",durationMs:3e3}}))}catch(t){console.error("ADFS login failed:",t),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"שגיאה בהתחברות ADFS",type:"error",durationMs:3e3}}))}finally{a(!1)}}),logout:()=>c(e,null,function*(){try{"adfs"===(null==r?void 0:r.authMode)&&(yield c(e,null,function*(){const e=B();if(!e)return;const t=e.getAllAccounts();if(0!==t.length)try{yield e.logoutPopup({account:t[0],postLogoutRedirectUri:window.location.origin})}catch(r){console.error("ADFS logout failed:",r),e.clearCache()}})),n(null),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"התנתקת בהצלחה",type:"ok",durationMs:2e3}}))}catch(t){console.error("Logout failed:",t),n(null),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"התנתקת (עם שגיאות)",type:"warn",durationMs:3e3}}))}}),hasPermission:s,hasRole:e=>(null==r?void 0:r.role)===e,canEditStatus:()=>s("edit_status"),canCreateSagach:()=>s("create_sagach"),canDeleteSagach:()=>s("delete_sagach"),canChat:()=>s("chat_message"),canManageUsers:()=>s("manage_users"),isLoading:i,authMode:o,canSwitchAuthMode:!0};return y.jsx(q.Provider,{value:l,children:t})},Y=()=>{const e=p.useContext(q);if(void 0===e)throw new Error("usePermissions must be used within a PermissionProvider");return e},V=e=>{switch(e){case"viewer":return"צופה";case"editor":return"עורך";case"admin":return"מנהל";default:return"לא ידוע"}},J=["110","130","150","160","180","190","על-זירתי"],K=p.createContext(void 0),G="shared_sagach_data",X="shared_sagachim_status_data",Z="shared_data_changes",Q="sagach_manager_data",ee="sagachim_data",te=({children:e})=>{const{user:t}=Y(),[r,n]=p.useState([]),[i,a]=p.useState([]),[o,s]=p.useState(!0),[c,g]=p.useState(null),[u,x]=p.useState(new Set),m=p.useCallback((e,t)=>{try{const r="sagachs"===e?G:X;localStorage.setItem(r,JSON.stringify(t))}catch(r){console.error("Failed to save shared data:",r),g("Failed to save data")}},[]),h=p.useCallback(e=>{try{const t=localStorage.getItem(Z),r=t?JSON.parse(t):[];r.push(e),r.length>100&&r.splice(0,r.length-100),localStorage.setItem(Z,JSON.stringify(r))}catch(t){console.error("Failed to store change event:",t)}u.forEach(r=>{try{r(e)}catch(t){console.error("Error in change listener:",t)}})},[u]);p.useEffect(()=>{(()=>{try{s(!0),g(null);let e=localStorage.getItem(G);if(e){const t=JSON.parse(e);n(t)}else{const e=localStorage.getItem(Q);if(e){console.log("🔄 Migrating sagach data from old key...");const t=JSON.parse(e),r=t.map(e=>d(l({},e),{createdBy:e.createdBy||"migrated",createdAt:e.createdAt||(new Date).toISOString(),lastModifiedBy:e.lastModifiedBy||"migrated",lastModifiedAt:e.lastModifiedAt||(new Date).toISOString()}));n(r),localStorage.setItem(G,JSON.stringify(r)),localStorage.removeItem(Q),console.log("✅ Sagach data migration completed")}}let t=localStorage.getItem(X);if(t){const e=JSON.parse(t);a(e)}else{const e=localStorage.getItem(ee);if(e){console.log("🔄 Migrating status data from old key...");const t=(e=>e.map(e=>d(l({},e),{priority:e.priority||"בינוני",arena:e.arena||[],createdBy:e.createdBy||"migrated",createdAt:e.createdAt||(new Date).toISOString(),lastModifiedBy:e.lastModifiedBy||"migrated",lastModifiedAt:e.lastModifiedAt||(new Date).toISOString()})))(JSON.parse(e));a(t),localStorage.setItem(X,JSON.stringify(t)),localStorage.removeItem(ee),console.log("✅ Status data migration completed")}}}catch(e){console.error("Failed to load shared data:",e),g("Failed to load data")}finally{s(!1)}})()},[]),p.useEffect(()=>{const e=e=>{if(e.key===G&&e.newValue)try{const t=JSON.parse(e.newValue);n(t)}catch(t){console.error("Failed to parse sagach data from storage event:",t)}else if(e.key===X&&e.newValue)try{const t=JSON.parse(e.newValue);a(t)}catch(t){console.error("Failed to parse status data from storage event:",t)}};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);const f=p.useCallback(e=>{if(!t)return void g("User must be logged in to create sagachs");const r=(new Date).toISOString(),i=d(l({},e),{createdBy:t.id,createdAt:r,lastModifiedBy:t.id,lastModifiedAt:r});n(e=>{const t=[...e,i];return m("sagachs",t),t}),h({type:"sagach_created",data:i,timestamp:r,userId:t.id,userName:t.name})},[t,m,h]),b=p.useCallback((e,r)=>{if(!t)return void g("User must be logged in to update sagachs");const i=(new Date).toISOString();n(n=>{const a=n.map(n=>n.id===e?d(l(l({},n),r),{lastModifiedBy:t.id,lastModifiedAt:i}):n);return m("sagachs",a),a}),h({type:"sagach_updated",data:{id:e,updates:r},timestamp:i,userId:t.id,userName:t.name})},[t,m,h]),v=p.useCallback(e=>{if(!t)return void g("User must be logged in to delete sagachs");const r=(new Date).toISOString();n(t=>{const r=t.filter(t=>t.id!==e);return m("sagachs",r),r}),h({type:"sagach_deleted",data:{id:e},timestamp:r,userId:t.id,userName:t.name})},[t,m,h]),w=p.useCallback(e=>{if(!t)return void g("User must be logged in to create status items");const r=(new Date).toISOString(),n=d(l({},e),{createdBy:t.id,createdAt:r,lastModifiedBy:t.id,lastModifiedAt:r});a(e=>{const t=[...e,n];return m("sagachimStatus",t),t}),h({type:"status_created",data:n,timestamp:r,userId:t.id,userName:t.name})},[t,m,h]),j=p.useCallback((e,r)=>{if(!t)return void g("User must be logged in to update status items");const n=(new Date).toISOString();a(i=>{const a=i.map(i=>i.id===e?d(l(l({},i),r),{lastModifiedBy:t.id,lastModifiedAt:n}):i);return m("sagachimStatus",a),a}),h({type:"status_updated",data:{id:e,updates:r},timestamp:n,userId:t.id,userName:t.name})},[t,m,h]),S=p.useCallback(e=>{if(!t)return void g("User must be logged in to delete status items");const r=(new Date).toISOString();a(t=>{const r=t.filter(t=>t.id!==e);return m("sagachimStatus",r),r}),h({type:"status_deleted",data:{id:e},timestamp:r,userId:t.id,userName:t.name})},[t,m,h]),k=p.useCallback(()=>{try{localStorage.removeItem(G),localStorage.removeItem(X),localStorage.removeItem(Z),localStorage.removeItem(Q),localStorage.removeItem(ee),n([]),a([]),g(null),console.log("🗑️ All data cleared successfully")}catch(e){console.error("Failed to clear data:",e),g("Failed to clear data")}},[]),C=p.useCallback(e=>(x(t=>new Set([...t,e])),()=>{x(t=>{const r=new Set(t);return r.delete(e),r})}),[]),E=p.useMemo(()=>({sagachs:r,addSagach:f,updateSagach:b,deleteSagach:v,sagachimStatus:i,addSagachimStatus:w,updateSagachimStatus:j,deleteSagachimStatus:S,clearAllData:k,subscribeToChanges:C,isLoading:o,error:c}),[r,f,b,v,i,w,j,S,k,C,o,c]);return p.useEffect(()=>(window.clearAllSagachData=k,()=>{delete window.clearAllSagachData}),[k]),y.jsx(K.Provider,{value:E,children:e})},re=()=>{const e=p.useContext(K);if(void 0===e)throw new Error("useSagachData must be used within a SagachDataProvider");return e},ne=()=>{var e,t;const{sagachs:r,addSagach:n,updateSagach:i,deleteSagach:a,isLoading:o,error:s}=re(),[c,g]=p.useState(""),[u,x]=p.useState(""),[m,h]=p.useState(null);p.useEffect(()=>{r.length>0&&!c&&(g(r[0].id),x(r[0].currentVersion))},[r,c]);const[f,b]=p.useState(new Set),[v,w]=p.useState(!1),[j,S]=p.useState(""),[k,C]=p.useState(""),[E,T]=p.useState(""),[z,D]=p.useState(!0),[N,I]=p.useState(!1),[M,L]=p.useState(!1),[F,A]=p.useState(null),[R,$]=p.useState(null),[W,B]=p.useState({}),[O,P]=p.useState(null),[_,U]=p.useState(["Column 1","Column 2","Column 3","Column 4"]),[q,H]=p.useState(null),[Y,V]=p.useState(""),[J,K]=p.useState(""),G=e=>e.toLocaleDateString("he-IL").replace(/\./g,"/");p.useEffect(()=>{const e={};_.forEach(t=>{W[t]||(e[t]=150)}),Object.keys(e).length>0&&B(t=>l(l({},t),e))},[_]);const X=()=>r.find(e=>e.id===c);p.useEffect(()=>{const e=X();e&&(x(e.currentVersion),I(!1))},[c]);const Z=()=>{const e=r.find(e=>e.id===c);return e?e.data:[]},Q=e=>{const t=e.split("."),r=parseInt(t[2])+1;return`${t[0]}.${t[1]}.${r}`},ee=e=>{if(!N||z)return{type:"modified",fields:[]};const t=X();if(!t)return{type:"modified",fields:[]};if(!t.versions.find(e=>e.version===u))return{type:"modified",fields:[]};const r=t.versions.findIndex(e=>e.version===u);if(r===t.versions.length-1)return{type:"modified",fields:[]};const n=t.versions[r+1];if(!n)return{type:"modified",fields:[]};const i=n.data.find(t=>t.id===e.id);if(!i)return{type:"new",fields:[]};const a=[];return i.name!==e.name&&a.push("name"),i.type!==e.type&&a.push("type"),i.data!==e.data&&a.push("data"),i.fieldName!==e.fieldName&&a.push("fieldName"),{type:(a.length,"modified"),fields:a}},te=(e,t)=>{h({rowId:e,field:t})},ne=(e,t,n)=>{r.forEach(r=>{if(r.data.some(t=>t.id===e)){const a=r.data.map(r=>r.id===e?d(l({},r),{[t]:n}):r);i(r.id,{data:a})}}),h(null)},oe=e=>{A(e),L(!0)},se=(e,t)=>{$({rowId:e,field:t});const r=document.querySelector('[tabindex="0"]');r&&r.focus()},le=(e,t,r)=>{console.log("handleCellDoubleClick called with:",{rowId:e,field:t,currentValue:r}),console.log("Setting editingCell to:",{rowId:e,field:t});const n={rowId:e,field:t};console.log("About to set editingCell to:",n),h(n),$(null),console.log("editingCell state should now be:",n)},de=()=>{q&&Y.trim()&&Y!==q&&((e,t)=>{if(t.trim()&&t!==e){const n=t.trim();U(t=>t.map(t=>t===e?n:t)),B(t=>{const r=l({},t);return r[n]=r[e]||150,delete r[e],r}),r.forEach(t=>{const r=t.data.map(t=>{const r=l({},t);return void 0!==r[e]&&(r[n]=r[e],delete r[e]),r}),a=t.versions.map(t=>d(l({},t),{data:t.data.map(t=>{const r=l({},t);return void 0!==r[e]&&(r[n]=r[e],delete r[e]),r})}));i(t.id,{data:r,versions:a})})}})(q,Y.trim()),H(null),V("")},ce=e=>{"Enter"===e.key?de():"Escape"===e.key&&(H(null),V(""))},pe=()=>{const e={id:`row_${Date.now()}`};return _.forEach(t=>{e[t]=""}),e},ge=e=>{r.forEach(t=>{const r=t.data.map(t=>d(l({},t),{[e]:""})),n=t.versions.map(t=>d(l({},t),{data:t.data.map(t=>d(l({},t),{[e]:""}))}));i(t.id,{data:r,versions:n})})},ue=()=>{if(!J.trim())return r;const e=J.toLowerCase().trim();return r.filter(t=>t.name.toLowerCase().includes(e)||t.data.some(t=>Object.values(t).some(t=>String(t).toLowerCase().includes(e))))};return y.jsxs("div",{className:"sagachim-manager",style:{height:"100vh",background:"radial-gradient(1200px 800px at 80% 20%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 10% 90%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",color:"var(--text)",fontFamily:'"Segoe UI", system-ui, sans-serif',position:"relative",width:"100vw",maxWidth:"100%",boxSizing:"border-box",overflow:"hidden"},children:[y.jsxs("div",{className:"versions-panel",style:{position:"fixed",left:"12px",top:"120px",bottom:"12px",width:z?"60px":"280px",background:"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"var(--radius)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 20px 60px rgba(0,0,0,0.35)",backdropFilter:"blur(8px)",padding:"16px",overflow:"hidden",zIndex:100,transition:"width 0.3s ease"},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px",borderBottom:"1px solid rgba(255,255,255,0.12)",paddingBottom:"12px"},children:[!z&&y.jsx("h2",{style:{color:"var(--accent)",fontSize:"20px",fontWeight:"700",letterSpacing:"0.4px",margin:0},children:"Versions"}),y.jsx("button",{onClick:()=>{D(!z),z?(I(!1),x("")):I(!1)},className:"btn ghost",style:{padding:"8px",fontSize:"16px",minWidth:"auto",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},title:z?"הרחב":"כווץ",children:z?"▶":"◀"})]}),!z&&y.jsxs(y.Fragment,{children:[y.jsx("div",{style:{padding:"8px 12px",background:"rgba(124,192,255,0.1)",border:"1px solid rgba(124,192,255,0.3)",borderRadius:"8px",textAlign:"center",color:"var(--accent)",fontSize:"14px",fontWeight:"600",direction:"rtl",marginBottom:"12px"},children:(null==(e=X())?void 0:e.name)||(0===r.length?'אין סג"חים':'בחר סג"ח')}),y.jsx("div",{className:"versions-list",children:(()=>{const e=X();return e?e.versions:[]})().map(e=>y.jsxs("div",{className:"version-item "+(u===e.version?"selected":""),onClick:()=>(e=>{const t=X();if(!t)return;const r=t.versions.find(t=>t.version===e);r&&(i(c,{data:[...r.data]}),x(e),I(!0),b(new Set))})(e.version),style:{background:u===e.version?"linear-gradient(180deg, rgba(124,192,255,0.22), rgba(124,192,255,0.1))":"rgba(255,255,255,0.06)",color:(e.version,"var(--text)"),border:u===e.version?"1px solid rgba(124,192,255,0.6)":"1px solid rgba(255,255,255,0.14)",borderRadius:"12px",padding:"12px",marginBottom:"10px",cursor:"pointer",transition:"transform 120ms ease, box-shadow 200ms ease, background 200ms ease",textAlign:"center",position:"relative",boxShadow:u===e.version?"0 6px 22px rgba(124,192,255,0.24)":"0 4px 12px rgba(0,0,0,0.2)",backdropFilter:"blur(6px)"},children:[y.jsxs("div",{style:{fontSize:"20px",fontWeight:"bold",marginBottom:"5px"},children:[e.version,e.changes&&e.changes.length>0&&y.jsx("span",{style:{position:"absolute",top:"6px",right:"6px",backgroundColor:"var(--accent)",color:"#000",borderRadius:"50%",width:"6px",height:"6px",fontSize:"6px",display:"inline-block",boxShadow:"0 0 8px rgba(124,192,255,0.6)"}})]}),y.jsx("div",{style:{fontSize:"12px",color:"var(--muted)"},children:e.date}),y.jsx("div",{style:{fontSize:"12px",color:"var(--muted)"},children:e.time}),e.changes&&e.changes.length>0&&y.jsxs("div",{style:{fontSize:"10px",marginTop:"6px",color:"var(--accent)",fontWeight:"bold"},children:[e.changes.length," שינויים"]})]},e.version))})]})]}),y.jsx("div",{className:"table-panel",style:{position:"fixed",left:z?"84px":"304px",right:"344px",top:"120px",bottom:"12px",background:"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"var(--radius)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 20px 60px rgba(0,0,0,0.35)",backdropFilter:"blur(8px)",padding:"16px",overflow:"auto",display:"flex",flexDirection:"column",zIndex:50},children:c?y.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px",paddingBottom:"12px",borderBottom:"1px solid rgba(255,255,255,0.12)"},children:[y.jsxs("div",{children:[y.jsx("h2",{style:{color:"var(--accent)",fontSize:"20px",fontWeight:"700",direction:"rtl",margin:0},children:null==(t=r.find(e=>e.id===c))?void 0:t.name}),N&&!z&&y.jsxs("div",{style:{display:"flex",gap:"16px",marginTop:"8px",fontSize:"12px",direction:"rtl"},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[y.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:"rgba(76,175,80,0.6)",borderRadius:"2px"}}),y.jsx("span",{style:{color:"var(--muted)"},children:"הוספו מהגרסה הקודמת"})]}),y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[y.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:"rgba(255,165,0,0.6)",borderRadius:"2px"}}),y.jsx("span",{style:{color:"var(--muted)"},children:"שונו מהגרסה הקודמת"})]}),y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[y.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:"rgba(255,80,80,0.6)",borderRadius:"2px"}}),y.jsx("span",{style:{color:"var(--muted)"},children:"הוסרו מהגרסה הקודמת"})]})]})]}),y.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[y.jsx("button",{onClick:()=>{const e=pe(),t=[...Z(),e];var r;r=t,c&&i(c,{data:r}),_.length>0&&$({rowId:e.id,field:_[0]})},className:"btn primary",style:{padding:"8px 16px",fontSize:"12px",direction:"rtl"},children:"+ הוסף רשומה"}),y.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===r.type&&console.log("Excel file uploaded:",r.name),e.target.value=""},style:{display:"none"},id:"excel-upload"}),y.jsx("label",{htmlFor:"excel-upload",className:"btn ghost",style:{padding:"8px 16px",fontSize:"12px",cursor:"pointer",direction:"rtl"},children:"📁 העלה אקסל"})]})]}),y.jsxs("div",{style:{flex:1,overflow:"auto",position:"relative",outline:"none"},onKeyDown:e=>{if(!R)return;const t=Z(),r=t.findIndex(e=>e.id===R.rowId),n=_.indexOf(R.field);let i=r,a=n;switch(e.key){case"ArrowUp":e.preventDefault(),i=Math.max(0,r-1);break;case"ArrowDown":e.preventDefault(),i=Math.min(t.length-1,r+1);break;case"ArrowLeft":e.preventDefault(),a=Math.max(0,n-1);break;case"ArrowRight":e.preventDefault(),a=Math.min(_.length-1,n+1);break;case"Enter":if(e.preventDefault(),t[r]){const e=t[r][R.field]||"";le(R.rowId,R.field,e)}return;case"Tab":e.preventDefault(),a=e.shiftKey?Math.max(0,n-1):Math.min(_.length-1,n+1);break;default:return}t[i]&&_[a]&&$({rowId:t[i].id,field:_[a]})},tabIndex:0,onFocus:e=>{e.currentTarget.focus()},children:[y.jsx("style",{children:"\n                  .table-container::-webkit-scrollbar {\n                    width: 12px;\n                    height: 12px;\n                  }\n                  .table-container::-webkit-scrollbar-track {\n                    background: rgba(255,255,255,0.05);\n                    border-radius: 6px;\n                  }\n                  .table-container::-webkit-scrollbar-thumb {\n                    background: linear-gradient(135deg, rgba(124,192,255,0.6), rgba(167,90,255,0.6));\n                    border-radius: 6px;\n                    border: 2px solid rgba(255,255,255,0.1);\n                  }\n                  .table-container::-webkit-scrollbar-thumb:hover {\n                    background: linear-gradient(135deg, rgba(124,192,255,0.8), rgba(167,90,255,0.8));\n                  }\n                  .table-container::-webkit-scrollbar-corner {\n                    background: rgba(255,255,255,0.05);\n                  }\n                "}),y.jsx("div",{className:"table-container",style:{overflow:"auto",height:"100%",position:"relative"},children:y.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:`${Object.values(W).reduce((e,t)=>e+t,0)+100}px`},children:[y.jsx("thead",{children:y.jsxs("tr",{style:{background:"rgba(255,255,255,0.08)"},children:[y.jsx("th",{style:{padding:"12px",textAlign:"center",color:"var(--accent)",fontWeight:"600",borderBottom:"2px solid rgba(124,192,255,0.3)",width:"80px",minWidth:"80px"},children:y.jsx("button",{onClick:()=>{const e=`Column ${_.length+1}`;U(t=>[e,...t]),B(t=>d(l({},t),{[e]:150})),ge(e);const t=Z();if(t.length>0){const r=t[0].id;$({rowId:r,field:e})}},style:{background:"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",border:"1px solid rgba(76,175,80,0.4)",borderRadius:"8px",padding:"6px 8px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 2px 8px rgba(76,175,80,0.3)",minWidth:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(76,175,80,0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="0 2px 8px rgba(76,175,80,0.3)"},title:"הוסף עמודה חדשה",children:"+"})}),_.map((e,t)=>y.jsxs("th",{style:{padding:"12px",textAlign:"center",color:"var(--accent)",fontWeight:"600",direction:"rtl",borderBottom:"2px solid rgba(124,192,255,0.3)",width:`${W[e]||150}px`,minWidth:"80px",position:"relative",userSelect:"none"},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[q===e?y.jsx("input",{type:"text",value:Y,onChange:e=>V(e.target.value),onBlur:de,onKeyDown:ce,autoFocus:!0,style:{background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.6)",borderRadius:"4px",padding:"4px 8px",color:"var(--text)",fontSize:"14px",fontWeight:"600",width:"100%",direction:"rtl",outline:"none"}}):y.jsx("span",{style:{flex:1,cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background 0.2s ease"},onClick:()=>{return H(t=e),void V(t);var t},onMouseEnter:e=>{e.currentTarget.style.background="rgba(124,192,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},title:"לחץ לעריכה",children:e}),y.jsx("button",{onClick:()=>{return t=e,void(_.length>1&&(U(e=>e.filter(e=>e!==t)),B(e=>{const r=l({},e);return delete r[t],r})));var t},style:{background:"transparent",border:"none",color:"#ff5050",cursor:"pointer",fontSize:"12px",padding:"2px 4px",marginLeft:"8px",opacity:_.length>1?1:.3},disabled:_.length<=1,title:"מחק עמודה",children:"×"})]}),y.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:"4px",cursor:"col-resize",background:O===e?"rgba(124,192,255,0.8)":"transparent",transition:"background 0.2s ease"},onMouseDown:t=>{t.preventDefault(),(e=>{P(e)})(e);const r=t.clientX,n=W[e]||150,i=t=>{const i=n+(t.clientX-r);((e,t)=>{B(r=>d(l({},r),{[e]:Math.max(80,t)}))})(e,i)},a=()=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",a),P(null)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",a)},onMouseEnter:e=>{O||(e.currentTarget.style.background="rgba(124,192,255,0.3)")},onMouseLeave:e=>{O||(e.currentTarget.style.background="transparent")}})]},e))]})}),y.jsxs("tbody",{children:[Z().map((e,t)=>y.jsx(ie,{item:e,isEven:t%2==0,changes:ee(e),editingCell:m,selectedCell:R,columnWidths:W,tableColumns:_,onCellClick:te,onCellSelect:se,onCellDoubleClick:le,onCellSave:ne,onDelete:oe},e.id)),(()=>{if(!N||z)return[];const e=X();if(!e)return[];if(!e.versions.find(e=>e.version===u))return[];const t=e.versions.findIndex(e=>e.version===u);if(t===e.versions.length-1)return[];const r=e.versions[t+1];if(!r)return[];const n=Z();return r.data.filter(e=>!n.find(t=>t.id===e.id))})().map((e,t)=>y.jsx(ie,{item:e,isEven:(Z().length+t)%2==0,changes:{type:"removed",fields:[]},editingCell:m,selectedCell:R,columnWidths:W,tableColumns:_,onCellClick:te,onCellSelect:se,onCellDoubleClick:le,onCellSave:ne,onDelete:()=>{}},`removed-${e.id}`))]})]})}),0===Z().length&&y.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"200px",color:"var(--muted)",fontSize:"16px",direction:"rtl"},children:'אין רשומות בסג"ח זה'})]})]}):y.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--muted)",fontSize:"16px",direction:"rtl"},children:y.jsx("div",{children:0===r.length?'אין סג"חים זמינים - צור סג"ח חדש כדי להתחיל':'בחר סג"ח כדי להציג את הנתונים'})})}),y.jsxs("div",{className:"sagach-manager-panel",style:{position:"fixed",right:"12px",top:"120px",bottom:"12px",width:"320px",background:"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"var(--radius)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 20px 60px rgba(0,0,0,0.35)",backdropFilter:"blur(8px)",padding:"16px",display:"flex",flexDirection:"column",gap:"12px",zIndex:100,overflow:"auto"},children:[y.jsx("h2",{style:{color:"var(--accent)",fontSize:"18px",marginBottom:"12px",textAlign:"center",fontWeight:"700",letterSpacing:"0.4px",borderBottom:"1px solid rgba(255,255,255,0.12)",paddingBottom:"10px",direction:"rtl"},children:'מנהל סג"חים'}),y.jsx("div",{style:{marginBottom:"16px"},children:y.jsx("button",{onClick:()=>w(!0),className:"btn primary",style:{width:"100%",padding:"10px",fontSize:"14px",direction:"rtl"},children:'+ צור סג"ח חדש'})}),y.jsx("div",{style:{marginBottom:"16px"},children:y.jsx("input",{type:"text",value:J,onChange:e=>K(e.target.value),placeholder:"חפש סגחים...",style:{width:"100%",padding:"10px 12px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"8px",color:"var(--text)",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 8px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}})}),y.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px",flex:1},children:ue().length>0?ue().map(e=>y.jsx(ae,{sagach:e,isSelected:c===e.id,onSelect:()=>g(e.id)},e.id)):y.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px 20px",textAlign:"center",color:"var(--muted)",direction:"rtl"},children:[y.jsx("div",{style:{fontSize:"48px",marginBottom:"16px",opacity:.5},children:"📋"}),y.jsx("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:'אין סג"חים'}),y.jsx("div",{style:{fontSize:"14px",opacity:.8},children:'צור סג"ח חדש כדי להתחיל'})]})}),y.jsxs("div",{style:{marginTop:"16px",display:"flex",flexDirection:"column",gap:"8px"},children:[y.jsx("button",{onClick:()=>(()=>{const e=c,t=r.find(t=>t.id===e);if(!t)return;const n=t.versions[0],a=[];if(t.data.forEach(e=>{const t=n.data.find(t=>t.id===e.id);t?(t.name!==e.name&&a.push(`Name changed: ${t.name} → ${e.name}`),t.type!==e.type&&a.push(`Type changed for ${e.name}: ${t.type} → ${e.type}`),t.data!==e.data&&a.push(`Data changed for ${e.name}: ${t.data} → ${e.data}`),t.fieldName!==e.fieldName&&a.push(`Field name changed for ${e.name}: ${t.fieldName} → ${e.fieldName}`)):a.push(`Added: ${e.name}`)}),n.data.forEach(e=>{t.data.find(t=>t.id===e.id)||a.push(`Removed: ${e.name}`)}),a.length>0){const r=Q(t.currentVersion),n=new Date,o={version:r,date:G(n),time:n.toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"}),data:[...t.data],changes:a};i(e,{currentVersion:r,versions:[o,...t.versions]}),e===c&&x(r)}})(),className:"btn primary",style:{padding:"10px 16px",fontSize:"13px",fontWeight:"600",direction:"rtl",letterSpacing:"0.3px"},children:'שמור שינויים לסג"ח הנוכחי'}),y.jsx("button",{className:"btn ghost",style:{padding:"10px 16px",fontSize:"13px",fontWeight:"600",direction:"rtl",letterSpacing:"0.3px"},children:"פרסם לשותפים"})]})]}),v&&y.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:y.jsxs("div",{style:{background:"radial-gradient(1200px 800px at 50% 50%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 50% 50%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",border:"2px solid rgba(124,192,255,0.3)",borderRadius:"24px",padding:"32px",width:"480px",maxWidth:"90vw",boxShadow:"0 20px 60px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1)",backdropFilter:"blur(12px)"},children:[y.jsx("h2",{style:{color:"var(--text)",fontSize:"24px",fontWeight:"700",textAlign:"center",marginBottom:"24px",direction:"rtl"},children:'צור סג"ח חדש'}),y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[y.jsx("label",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",direction:"rtl"},children:"שם יחיד לשיתוף"}),y.jsx("input",{type:"text",value:j,onChange:e=>S(e.target.value),style:{background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",padding:"14px 16px",color:"var(--text)",fontSize:"16px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 20px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}})]}),y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[y.jsx("label",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",direction:"rtl"},children:'שם הסג"ח'}),y.jsx("input",{type:"text",value:k,onChange:e=>C(e.target.value),style:{background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",padding:"14px 16px",color:"var(--text)",fontSize:"16px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 20px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}})]}),y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[y.jsx("label",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",direction:"rtl"},children:"סיפק"}),y.jsx("input",{type:"text",value:E,onChange:e=>T(e.target.value),style:{background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",padding:"14px 16px",color:"var(--text)",fontSize:"16px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 20px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}})]}),y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[y.jsx("label",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",direction:"rtl"},children:"העלה קובץ אקסל (אופציונלי)"}),y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",background:"rgba(255,255,255,0.05)",border:"2px dashed rgba(124,192,255,0.3)",borderRadius:"12px",padding:"20px",transition:"all 0.2s ease"},children:[y.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&console.log("Excel file uploaded:",r.name)},style:{display:"none"},id:"excel-upload-popup"}),y.jsx("label",{htmlFor:"excel-upload-popup",style:{background:"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",border:"1px solid rgba(76,175,80,0.4)",borderRadius:"8px",padding:"10px 16px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"8px",direction:"rtl"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(76,175,80,0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="none"},children:"📁 בחר קובץ אקסל"}),y.jsx("span",{style:{color:"var(--muted)",fontSize:"14px",direction:"rtl"},children:"או גרור קובץ לכאן"})]})]})]}),y.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"32px",justifyContent:"center"},children:[y.jsx("button",{onClick:()=>{if(j.trim()){const e=`sagach${Date.now()}`,t=new Date,r=pe(),i={version:"1.0.1",date:G(t),time:t.toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"}),data:[r],changes:["Initial version"]},a={id:e,name:j.trim(),data:[r],currentVersion:"1.0.1",versions:[i]};n(a),g(e),x("1.0.1"),S(""),C(""),T(""),w(!1)}},style:{background:"linear-gradient(135deg, rgba(124,192,255,0.8), rgba(124,192,255,0.6))",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"12px",padding:"12px 24px",color:"white",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",direction:"rtl",boxShadow:"0 4px 16px rgba(124,192,255,0.3)"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 8px 24px rgba(124,192,255,0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="0 4px 16px rgba(124,192,255,0.3)"},children:"הוסף פורמט להעלאת דגימה"}),y.jsx("button",{onClick:()=>{w(!1),S(""),C(""),T("")},style:{background:"transparent",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"12px",padding:"12px 24px",color:"var(--text)",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",direction:"rtl"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(124,192,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"מעלה דגימה"})]})]})}),M&&y.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:y.jsxs("div",{style:{background:"radial-gradient(1200px 800px at 50% 50%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 50% 50%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",border:"2px solid rgba(255,80,80,0.3)",borderRadius:"24px",padding:"32px",width:"400px",maxWidth:"90vw",boxShadow:"0 20px 60px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1)",backdropFilter:"blur(12px)"},children:[y.jsx("h2",{style:{color:"#ff5050",fontSize:"24px",fontWeight:"700",textAlign:"center",marginBottom:"16px",direction:"rtl"},children:"מחק רשומה"}),y.jsx("p",{style:{color:"var(--text)",fontSize:"16px",textAlign:"center",marginBottom:"24px",direction:"rtl"},children:"האם אתה בטוח שברצונך למחוק את הרשומה הזו? פעולה זו לא ניתנת לביטול."}),y.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[y.jsx("button",{onClick:()=>{L(!1),A(null)},style:{background:"transparent",border:"1px solid rgba(255,255,255,0.4)",borderRadius:"12px",padding:"12px 24px",color:"var(--text)",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",direction:"rtl"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"ביטול"}),y.jsx("button",{onClick:()=>{return F&&(e=F,r.forEach(t=>{if(t.data.some(t=>t.id===e)){const r=t.data.filter(t=>t.id!==e);i(t.id,{data:r})}}),L(!1),void A(null));var e},style:{background:"linear-gradient(135deg, rgba(255,80,80,0.8), rgba(255,80,80,0.6))",border:"1px solid rgba(255,80,80,0.4)",borderRadius:"12px",padding:"12px 24px",color:"white",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",direction:"rtl",boxShadow:"0 4px 16px rgba(255,80,80,0.3)"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 8px 24px rgba(255,80,80,0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="0 4px 16px rgba(255,80,80,0.3)"},children:"מחק"})]})]})})]})},ie=p.memo(({item:e,isEven:t,changes:r,editingCell:n,selectedCell:i,columnWidths:a,tableColumns:o,onCellClick:s,onCellSelect:c,onCellDoubleClick:g,onCellSave:u,onDelete:x})=>{const[m,h]=p.useState(""),[f,b]=p.useState(null),[v,w]=p.useState(null),[j,S]=p.useState(0),[k,C]=p.useState(0);p.useEffect(()=>()=>{f&&clearTimeout(f)},[f]),p.useEffect(()=>{if((null==n?void 0:n.rowId)===e.id&&(null==n?void 0:n.field)){const t=e[n.field]||"";h(t)}},[n,e.id]);const E=(t,a)=>{const o=(null==n?void 0:n.rowId)===e.id&&(null==n?void 0:n.field)===t,s=(null==i?void 0:i.rowId)===e.id&&(null==i?void 0:i.field)===t,c=r.fields.includes(t),p="new"===r.type,g="removed"===r.type,u=v===t;let x=a.backgroundColor,m=a.border,h="none",f=1;return o?(x="rgba(124,192,255,0.2)",m="1px solid rgba(124,192,255,0.6)",h="0 0 8px rgba(124,192,255,0.3)"):s?(x="rgba(124,192,255,0.1)",m="1px solid rgba(124,192,255,0.4)",h="0 0 4px rgba(124,192,255,0.2)"):g?(x="rgba(255,80,80,0.15)",m="1px solid rgba(255,80,80,0.4)",h="0 0 8px rgba(255,80,80,0.2)",f=.7):p?(x="rgba(76,175,80,0.15)",m="1px solid rgba(76,175,80,0.4)",h="0 0 8px rgba(76,175,80,0.2)"):c?(x="rgba(255,165,0,0.15)",m="1px solid rgba(255,165,0,0.4)",h="0 0 8px rgba(255,165,0,0.2)"):u&&(x="rgba(124,192,255,0.08)",m="1px solid rgba(124,192,255,0.3)",h="0 0 4px rgba(124,192,255,0.15)"),d(l({},a),{backgroundColor:x,border:m,boxShadow:h,opacity:f,cursor:o?"text":"pointer",transition:"all 0.2s ease"})},T=()=>{console.log("TEST: testEditFunction called"),console.log("TEST: item.id:",e.id,"field:","Column 1"),console.log("TEST: calling onCellDoubleClick directly"),g(e.id,"Column 1","test value"),console.log("TEST: onCellDoubleClick called")};p.useEffect(()=>(window.testEditFunction=T,()=>{delete window.testEditFunction}),[T]);const z=t=>{u(e.id,t,m)},D=(t,r)=>{const i=(null==n?void 0:n.rowId)===e.id&&(null==n?void 0:n.field)===t;return console.log("renderCell called with:",{field:t,value:r,isEditing:i,itemId:e.id,editingCell:n,item:e,itemFieldValue:e[t]}),i?y.jsx("textarea",{value:m,onChange:e=>h(e.target.value),onBlur:()=>z(t),onKeyDown:r=>((t,r)=>{if("Enter"!==t.key||t.shiftKey)if("Enter"===t.key&&t.shiftKey){const e=t.currentTarget,r=e.selectionStart,n=e.selectionEnd,i=e.value,a=i.substring(0,r)+"\n"+i.substring(n);h(a),setTimeout(()=>{e.selectionStart=e.selectionEnd=r+1},0)}else"Escape"===t.key&&u(e.id,r,m);else z(r)})(r,t),autoFocus:!0,style:{background:"transparent",border:"none",outline:"none",color:"var(--text)",fontSize:"13px",width:"100%",minHeight:"20px",maxHeight:"100px",resize:"none",textAlign:"center",direction:"name"===t?"rtl":"ltr",fontFamily:"inherit",lineHeight:"1.4"}}):y.jsx("div",{onClick:n=>{console.log("Click event on field:",t,"value:",r,"item:",e),n.stopPropagation(),((t,r)=>{console.log("Click detected on field:",t,"clickCount:",j,"lastClickTime:",k);const n=Date.now();if(f&&(clearTimeout(f),b(null)),n-k<300&&j>0)return console.log("Double click detected via click counting"),S(0),C(0),void g(e.id,t,r||"");S(e=>(console.log("Incrementing click count from",e,"to",e+1),e+1)),C(n);const i=setTimeout(()=>{console.log("Single click timeout triggered, selecting cell"),c(e.id,t),S(0)},300);b(i)})(t,r)},onDoubleClick:n=>{console.log("Double click event on field:",t,"value:",r),n.stopPropagation(),n.preventDefault(),console.log("Double click event handler triggered"),((t,r)=>{console.log("Double click event detected on field:",t,"value:",r),console.log("About to call onCellDoubleClick with:",{rowId:e.id,field:t,currentValue:r}),f&&(clearTimeout(f),b(null)),S(0),C(0),g(e.id,t,r||""),console.log("onCellDoubleClick called successfully")})(t,r)},onMouseEnter:()=>w(t),onMouseLeave:()=>w(null),style:{cursor:"pointer",display:"flex",width:"100%",height:"100%",minHeight:"40px",whiteSpace:"pre-wrap",wordBreak:"break-word",userSelect:"none",padding:"8px",margin:"-8px",alignItems:"center",justifyContent:"center",position:"relative"},children:y.jsx("span",{style:{textAlign:"center",width:"100%"},children:r})})},N={padding:"10px 12px",border:"none",textAlign:"center",color:"var(--text)",fontSize:"13px"},I=(()=>{const e="new"===r.type,n="removed"===r.type;let i=t?"rgba(255,255,255,0.04)":"rgba(255,255,255,0.02)",a="1px solid rgba(255,255,255,0.06)",o=1;return e?(i="rgba(76,175,80,0.08)",a="1px solid rgba(76,175,80,0.3)"):n&&(i="rgba(255,80,80,0.08)",a="1px solid rgba(255,80,80,0.3)",o=.7),{background:i,borderBottom:a,opacity:o,transition:"background 0.2s ease, opacity 0.2s ease"}})();return y.jsxs("tr",{style:I,onMouseEnter:e=>{n||"removed"===r.type||(e.currentTarget.style.background="new"===r.type?"rgba(76,175,80,0.12)":"rgba(255,255,255,0.08)")},onMouseLeave:e=>{n||(e.currentTarget.style.background=I.background)},children:[y.jsx("td",{style:{width:"80px",minWidth:"80px",padding:"10px 12px",border:"none",textAlign:"center",color:"var(--text)",fontSize:"13px"}}),o.map((t,n)=>y.jsx("td",{style:d(l({},E(t,d(l({},N),{direction:0===n?"rtl":"ltr"}))),{width:`${a[t]||150}px`,minWidth:"80px"}),children:n===o.length-1?y.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[y.jsx("span",{style:{flex:1},children:D(t,e[t]||"")}),"removed"===r.type?y.jsx("span",{style:{color:"#ff5050",fontSize:"12px",fontWeight:"bold",marginLeft:"8px"},children:"הוסר"}):y.jsx("button",{onClick:()=>x(e.id),className:"btn ghost",style:{padding:"2px 4px",fontSize:"10px",borderColor:"rgba(255,80,80,0.4)",color:"#ff5050",marginLeft:"8px",minWidth:"auto",width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center"},title:"מחק רשומה",children:"🗑"})]}):D(t,e[t]||"")},t))]})});ie.displayName="TableRow";const ae=({sagach:e,isSelected:t,onSelect:r})=>y.jsxs("div",{style:{background:t?"linear-gradient(180deg, rgba(124,192,255,0.15), rgba(124,192,255,0.08))":"rgba(255,255,255,0.06)",border:t?"1px solid rgba(124,192,255,0.6)":"1px solid rgba(255,255,255,0.14)",borderRadius:"12px",padding:"12px",transition:"all 0.2s ease",boxShadow:t?"0 6px 22px rgba(124,192,255,0.24)":"0 4px 12px rgba(0,0,0,0.2)"},children:[y.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:y.jsx("div",{onClick:r,style:{cursor:"pointer",fontSize:"16px",fontWeight:"600",color:"var(--text)",direction:"rtl",flex:1},children:e.name})}),y.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",marginBottom:"8px",direction:"rtl"},children:[e.data.length," רשומות"]})]}),oe=e=>`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`,se=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]},le=["נמוך","בינוני","גבוה","TOP"],de={"נמוך":"נמוך","בינוני":"בינוני","גבוה":"גבוה",TOP:"TOP"},ce=["ממתין לבשלות בצד ספק",'ממתין לקבלת דג"ח והתנעה',"בתהליכי אפיון","ממתין לאינטגרציות","אינטגרציות","מבצוע"],pe=["ממתין לבשלות בצד ספק",'ממתין לקבלת דג"ח והתנעה',"בתהליכי אפיון","ממתין לאינטגרציות","אינטגרציות","מבצוע","מובצע"];if("undefined"!=typeof document&&!document.head.querySelector("#spinner-animation")){const e=document.createElement("style");e.id="spinner-animation",e.textContent="\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n",document.head.appendChild(e)}const ge=p.memo(()=>{var t;const{canEditStatus:r,canCreateSagach:n,canDeleteSagach:i,canChat:a,user:o,hasRole:s}=Y(),{sagachimStatus:g,addSagachimStatus:u,updateSagachimStatus:x,deleteSagachimStatus:m,clearAllData:h,isLoading:f,error:b}=re(),v=(e,t)=>{var r;return(null==(r=e.notificationSubscribers)?void 0:r.some(e=>e.userId===t))||!1},w=(e,t,r,n,i)=>{const a={userId:t,userName:r,notificationMethod:n,notificationFrequency:i,subscribedAt:(new Date).toISOString()},o=[...(e.notificationSubscribers||[]).filter(e=>e.userId!==t),a];return d(l({},e),{notificationSubscribers:o,notifications:v(e,t),notificationMethod:n,notificationFrequency:i})},j={primary:{appearance:"none",border:"none",borderRadius:"12px",padding:"12px 20px",cursor:"pointer",transition:"all 0.2s ease",fontSize:"14px",fontWeight:"600",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",direction:"rtl",outline:"none"},filter:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"transparent",color:"var(--text)",borderRadius:"12px",padding:"8px 14px",cursor:"pointer",transition:"transform 120ms ease",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"right",boxShadow:"none"},close:{background:"none",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:"14px",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",width:"16px",height:"16px",borderRadius:"50%",transition:"all 0.2s ease"}},[S,k]=p.useState(""),[C,E]=p.useState(""),[T,z]=p.useState(""),[D,N]=p.useState(""),[I,M]=p.useState("none"),[L,F]=p.useState(null),[A,R]=p.useState(""),[$,W]=p.useState(!1),[B,O]=p.useState(1),P=p.useRef(null),[_,U]=p.useState(!1),[q,H]=p.useState(!1),[V,K]=p.useState(!1),[G,X]=p.useState(!1),[Z,Q]=p.useState(!1),[ee,te]=p.useState(!1),[ne,ie]=p.useState(!1),[ae,ge]=p.useState(!1),[ue,xe]=p.useState(!1),[me,he]=p.useState("email"),[fe,be]=p.useState("status_change"),[ye,ve]=p.useState(!1),[we,je]=p.useState(!1),[Se,ke]=p.useState(!1),[Ce,Ee]=p.useState(!1),[Te,ze]=p.useState({name:"",description:"",provider:"",arena:[],priority:"בינוני",sagachType:""}),[De,Ne]=p.useState({message:"",type:"success",isVisible:!1}),[Ie,Me]=p.useState(null),[Le,Fe]=p.useState(!1),[Ae,Re]=p.useState(!1),[$e,We]=p.useState(""),[Be,Oe]=p.useState(!1),[Pe,_e]=p.useState(""),[Ue,qe]=p.useState(!1),[He,Ye]=p.useState({description:"",provider:"",arena:[],priority:"בינוני",sagachType:"",processStatus:1,processStartDate:"",attachments:[]}),[Ve,Je]=p.useState(new Date),Ke=()=>Ie||new Date,Ge=e=>{if(!e.trim())return null;const t=e.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(!t)return null;const[,r,n,i]=t,a=parseInt(r,10),o=parseInt(n,10),s=parseInt(i,10);if(a<1||a>31||o<1||o>12||s<1900)return null;const l=new Date(s,o-1,a);return l.getFullYear()!==s||l.getMonth()!==o-1||l.getDate()!==a?null:l.toISOString()},Xe=e=>{if(!e.trim())return null;const t=e.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(!t)return"פורמט תאריך לא תקין. השתמש בפורמט DD/MM/YYYY";const[,r,n,i]=t,a=parseInt(r,10),o=parseInt(n,10),s=parseInt(i,10);if(s<1900)return"שנת התאריך חייבת להיות 1900 או מאוחר יותר";if(o<1||o>12)return"חודש התאריך חייב להיות בין 1 ל-12";if(a<1||a>31)return"יום התאריך חייב להיות בין 1 ל-31";const l=new Date(s,o-1,a);if(l.getFullYear()!==s||l.getMonth()!==o-1||l.getDate()!==a){const e=["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],t=new Date(s,o,0).getDate();return`${a} ${e[o-1]} ${s} אינו תאריך תקין. ${e[o-1]} ${s} יש לו רק ${t} ימים`}return null},Ze=e=>{if(!e)return"לא צוין";try{const t=new Date(e);if(isNaN(t.getTime()))return"לא צוין";const r=t.getDate().toString().padStart(2,"0"),n=(t.getMonth()+1).toString().padStart(2,"0");return`${r}/${n}/${t.getFullYear()}`}catch(t){return"לא צוין"}};p.useEffect(()=>{Ie?(Je(Ie),console.log("🗓️ Mock date changed to:",Ie.toISOString())):Je(new Date)},[Ie]),p.useEffect(()=>{const e=setInterval(()=>{Ie||Je(new Date)},6e4);return()=>clearInterval(e)},[Ie]);const[,Qe]=p.useState(0);p.useEffect(()=>{Qe(e=>e+1)},[null==L?void 0:L.id,null==L?void 0:L.processStatus,null==L?void 0:L.lastUpdated,Ie,Ve,g.length]);const[,et]=p.useState(0);p.useEffect(()=>{L&&et(e=>e+1)},[Ie,Ve]),p.useEffect(()=>{g.length>0&&g.map(e=>{const t=Ke(),r=l({},e.phaseData||{});return Object.keys(r).forEach(n=>{var i;const a=parseInt(n),o=r[a];if(o){let n=0;o.entries&&o.entries.forEach(e=>{e.timeSpentDays&&(n+=e.timeSpentDays)});let s=(null==(i=o.currentEntry)?void 0:i.timeSpentDays)||0;if(o.currentEntry&&a===e.processStatus){const e=new Date(o.currentEntry.startDate+"T00:00:00"),r=new Date(t.toISOString().split("T")[0]+"T23:59:59"),n=Math.max(0,r.getTime()-e.getTime());s=Math.max(1,Math.ceil(n/864e5))}const c=n+s;r[a]=d(l({},o),{currentEntry:o.currentEntry?d(l({},o.currentEntry),{timeSpentDays:s}):void 0,totalTimeSpentDays:Math.max(o.totalTimeSpentDays||0,c)})}}),d(l({},e),{phaseData:r})}).forEach(e=>{x(e.id,e)}),Qe(e=>e+1),et(e=>e+1)},[Ie,Ve,g.length,Qe,et]);const tt=p.useCallback((e,t=!1)=>{var r,n,i;if(!e)return 0;const a=(e.entries||[]).reduce((e,t)=>"number"!=typeof t.timeSpentDays||Number.isNaN(t.timeSpentDays)?e:e+t.timeSpentDays,0),o="number"!=typeof e.totalTimeSpentDays||Number.isNaN(e.totalTimeSpentDays)?0:e.totalTimeSpentDays,s="number"!=typeof(null==(r=e.currentEntry)?void 0:r.timeSpentDays)||Number.isNaN(null==(n=e.currentEntry)?void 0:n.timeSpentDays)?0:e.currentEntry.timeSpentDays,l=Math.max(a,o),d=Math.max(a,Math.max(0,o-s));if(t&&(null==(i=e.currentEntry)?void 0:i.startDate)){const t=new Date(e.currentEntry.startDate+"T00:00:00"),r=Ke(),n=new Date(r.toISOString().split("T")[0]+"T23:59:59"),i=Math.max(0,n.getTime()-t.getTime());return d+Math.max(1,Math.ceil(i/864e5))}return l},[Ie,Ve]),rt=p.useCallback((e,t=!1)=>{if(!e)return"";const r=[...e.entries||[]];if(e.currentEntry&&r.push(e.currentEntry),0===r.length)return"";const n=r.map(e=>new Date(e.startDate)),i=new Date(Math.min(...n.map(e=>e.getTime())));let a;if(t&&e.currentEntry)a=Ke();else{const e=r.filter(e=>e.completionDate).map(e=>new Date(e.completionDate));a=e.length>0?new Date(Math.max(...e.map(e=>e.getTime()))):i}const o=oe(i),s=oe(a);return o===s?o:`${o} - ${s}`},[Ke]);p.useEffect(()=>{const e=e=>{e.target.closest("[data-dropdown-container]")||(U(!1),H(!1),K(!1),X(!1),Q(!1),te(!1),ie(!1),ge(!1))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),p.useEffect(()=>{const e=e=>{"Escape"===e.key&&L&&(qe(!1),F(null))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[L]),p.useEffect(()=>{L&&P.current&&setTimeout(()=>{P.current&&(P.current.scrollTop=P.current.scrollHeight)},100)},[L]),p.useEffect(()=>{L&&P.current&&L.statusUpdates&&setTimeout(()=>{P.current&&(P.current.scrollTop=P.current.scrollHeight)},50)},[null==L?void 0:L.statusUpdates]);const nt=(e,t="success")=>{Ne({message:e,type:t,isVisible:!0}),setTimeout(()=>{Ne(e=>d(l({},e),{isVisible:!1}))},3e3)},it=p.useMemo(()=>[...new Set(g.map(e=>e.provider))].sort(),[g]),at=p.useMemo(()=>{const e=g.flatMap(e=>e.arena);return[...new Set(e)].sort()},[g]),ot=p.useMemo(()=>{console.log("🔍 Filtering sagachim. Total sagachs:",g.length);let e=g.filter(e=>{if(7===e.processStatus&&e.completionDate){const t=new Date(e.completionDate),r=new Date(Ke());if(r.setDate(r.getDate()-7),t<r)return!1}const t=!S||e.name.toLowerCase().includes(S.toLowerCase())||e.description.toLowerCase().includes(S.toLowerCase()),r=!C||e.provider===C,n=!T||e.arena.includes(T),i=!D||e.processStatus.toString()===D;return t&&r&&n&&i});return"none"!==I&&e.sort((e,t)=>"asc"===I?e.processStatus-t.processStatus:"desc"===I?t.processStatus-e.processStatus:0),console.log("🔍 Filtered sagachs result:",e.length,"sagachs"),e.forEach(e=>{console.log(`  - ${e.name} (processStatus: ${e.processStatus})`)}),e},[g,S,C,T,D,I]),st=e=>{switch(e){case 1:return"rgba(128, 128, 128, 0.8)";case 2:return"rgba(33, 150, 243, 0.8)";case 3:return"rgba(255, 152, 0, 0.8)";case 4:return"rgba(233, 30, 99, 0.8)";case 5:return"rgba(156, 39, 176, 0.8)";case 6:return"rgba(46, 125, 50, 0.8)";case 7:return"rgba(27, 94, 32, 0.8)";default:return"rgba(158, 158, 158, 0.8)"}},lt=e=>{qe(!1),F(e),R(""),W(!1),O(e.processStatus)},dt=()=>{if(!L||!A.trim())return;if(!a())return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"אין לך הרשאה להוסיף הודעות",type:"error",durationMs:3e3}}));const e={id:Date.now().toString(),message:A.trim(),timestamp:mt(Ke().toISOString()),type:"user",processStatus:L.processStatus,author:(null==o?void 0:o.name)||"משתמש"},t=d(l({},L),{statusUpdates:[...L.statusUpdates||[],e],lastUpdated:oe(Ke())});console.log("💬 Adding update to sagach:",L.name),x(L.id,t),F(t),R(""),nt("הודעה נוספה בהצלחה","success")},ct=()=>{if(!L)return;const e=Ge($e);if($e.trim()&&!e){const e=Xe($e);return void nt(e||"פורמט תאריך לא תקין. השתמש בפורמט DD/MM/YYYY","warning")}const t=d(l({},L),{estimatedCompletion:e||void 0});x(L.id,t),F(t),Re(!1),nt('תאריך התג"ב עודכן בהצלחה',"success")},pt=()=>{Re(!1),We("")},gt=()=>{if(!L)return;const e=Ge(Pe);if(Pe.trim()&&!e){const e=Xe(Pe);return void nt(e||"פורמט תאריך לא תקין. השתמש בפורמט DD/MM/YYYY","warning")}const t=d(l({},L),{processStartDate:e||void 0});x(L.id,t),F(t),Oe(!1),nt("תאריך התחלה עודכן בהצלחה","success")},ut=()=>{Oe(!1),_e("")},xt=t=>c(e,null,function*(){var e,r,n,i,a,s;if(L&&t!==L.processStatus)try{let c=0;if(null==(n=null==(r=null==(e=L.phaseData)?void 0:e[L.processStatus])?void 0:r.currentEntry)?void 0:n.startDate){const e=L.phaseData[L.processStatus];c=tt(e,!0)}const p={id:Date.now().toString(),message:`שונה סטטוס מ-"${7===L.processStatus?"מובצע":ce[L.processStatus-1]}" ל-"${7===t?"מובצע":ce[t-1]}"${c>0?` •בשלב הקודם ${c} ימים`:""}`,timestamp:mt(Ke().toISOString()),type:"status_change",oldStatus:L.processStatus,newStatus:t,processStatus:L.processStatus,author:(null==o?void 0:o.name)||"משתמש"},g=Ke(),u=l({},L.phaseData||{});if(null==(s=null==(a=null==(i=L.phaseData)?void 0:i[L.processStatus])?void 0:a.currentEntry)?void 0:s.startDate){const e=u[L.processStatus]||{},t=new Date(e.currentEntry.startDate+"T00:00:00"),r=new Date(g.toISOString().split("T")[0]+"T23:59:59"),n=Math.abs(r.getTime()-t.getTime()),i=Math.ceil(n/864e5),a={startDate:e.currentEntry.startDate,completionDate:g.toISOString().split("T")[0],timeSpentDays:i};u[L.processStatus]={entries:[...e.entries||[],a],currentEntry:void 0,totalTimeSpentDays:i}}if(t<7){const e=u[t]||{};if(e.currentEntry){const r={startDate:e.currentEntry.startDate,completionDate:g.toISOString().split("T")[0],timeSpentDays:Math.ceil(Math.abs(new Date(g.toISOString().split("T")[0]+"T23:59:59").getTime()-new Date(e.currentEntry.startDate+"T00:00:00").getTime())/864e5)};u[t]=d(l({},e),{entries:[...e.entries||[],r],currentEntry:{startDate:g.toISOString().split("T")[0],timeSpentDays:0},totalTimeSpentDays:Math.max(tt(e,!1)+r.timeSpentDays,e.totalTimeSpentDays||0)})}else{const r={startDate:g.toISOString().split("T")[0],timeSpentDays:0};u[t]=d(l({},e),{currentEntry:r,totalTimeSpentDays:Math.max(tt(e,!1),e.totalTimeSpentDays||0)})}}const m=d(l({},L),{description:He.description.trim(),provider:He.provider.trim(),arena:He.arena,priority:He.priority,sagachType:He.sagachType.trim()||void 0,attachments:He.attachments,processStatus:t,statusUpdates:[...L.statusUpdates||[],p],lastUpdated:oe(g),phaseData:u,completionDate:7===t?g.toISOString():L.completionDate});console.log("🔄 Changing status of sagach:",L.name,"to status",t),x(L.id,m),F(m),qe(!1),nt(`פרטים נשמרו וסטטוס עודכן ל-"${7===t?"מובצע":ce[t-1]}"`,"success")}catch(c){console.error("Error updating process status:",c),nt("שגיאה בעדכון השלב בתהליך","warning")}}),mt=e=>{if(!e)return"לא צוין";try{const t=new Date(e);if(isNaN(t.getTime()))return e;const r=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0"),i=t.getSeconds().toString().padStart(2,"0"),a=t.getDate().toString().padStart(2,"0"),o=(t.getMonth()+1).toString().padStart(2,"0");return`${a}/${o}/${t.getFullYear()} ${r}:${n}:${i}`}catch(t){return e}},ht=()=>{if(!L||!o)return;const e=o.id||"current_user",t=o.name||"משתמש",r=v(L,e);let n;n=r?((e,t)=>{const r=(e.notificationSubscribers||[]).filter(e=>e.userId!==t);return d(l({},e),{notificationSubscribers:r,notifications:!1})})(L,e):w(L,e,t,"email","status_change"),x(L.id,n),F(n),nt(r?"התראות בוטלו בהצלחה":"התראות הופעלו בהצלחה","success")};return y.jsxs(y.Fragment,{children:[y.jsx("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:1e3,background:"rgba(0,0,0,0.8)",borderRadius:"12px",padding:Le?"16px":"8px",border:"1px solid rgba(255,255,255,0.2)",backdropFilter:"blur(8px)",transition:"all 0.3s ease",cursor:"pointer"},onClick:()=>Fe(!Le),title:"לחץ לפתיחת פאנל בדיקת תאריכים",children:Le&&y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",minWidth:"200px"},onClick:e=>e.stopPropagation(),children:[y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",color:"var(--text)",fontSize:"11px",fontWeight:"600"},children:[y.jsx("span",{children:"בדיקת תאריכים"}),y.jsx("button",{onClick:()=>Fe(!1),style:{background:"none",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:"14px",padding:"0",width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"},title:"סגור פאנל",children:"×"})]}),y.jsx("input",{type:"date",value:(null==Ie?void 0:Ie.toISOString().split("T")[0])||"",onChange:e=>{e.target.value?Me(new Date(e.target.value+"T12:00:00")):Me(null)},onClick:e=>e.stopPropagation(),style:{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"6px",padding:"6px 8px",color:"var(--text)",fontSize:"12px",fontFamily:"Segoe UI, sans-serif"}}),y.jsx("div",{style:{fontSize:"10px",color:"var(--muted)",textAlign:"center"},children:Ie?`תאריך מדומה: ${oe(Ie)}`:`תאריך אמיתי: ${oe(new Date)}`}),y.jsx("button",{onClick:e=>{e.stopPropagation(),Me(null)},disabled:!Ie,style:{background:Ie?"linear-gradient(135deg, rgba(244,67,54,0.8), rgba(244,67,54,0.6))":"rgba(255,255,255,0.1)",border:"none",borderRadius:"6px",padding:"4px 8px",color:Ie?"white":"var(--muted)",fontSize:"10px",fontWeight:"600",cursor:Ie?"pointer":"not-allowed"},children:"איפוס לתאריך אמיתי"}),y.jsx("button",{onClick:e=>{e.stopPropagation(),h(),window.location.reload()},style:{background:"linear-gradient(135deg, rgba(255,152,0,0.8), rgba(255,152,0,0.6))",border:"none",borderRadius:"6px",padding:"4px 8px",color:"white",fontSize:"10px",fontWeight:"600",cursor:"pointer"},children:"איפוס נתונים"})]})}),y.jsx("style",{children:"\n          @keyframes pulse-glow {\n            0%, 100% {\n              box-shadow: 0 0 12px rgba(124,192,255,0.6), 0 0 20px rgba(167,90,255,0.4);\n              transform: scale(1);\n            }\n            50% {\n              box-shadow: 0 0 20px rgba(124,192,255,0.8), 0 0 32px rgba(167,90,255,0.6), 0 0 44px rgba(124,192,255,0.4);\n              transform: scale(1.05);\n            }\n          }\n          \n          /* Custom scrollbar styling for left-side positioning */\n          .sagachim-grid-scroll::-webkit-scrollbar {\n            width: 8px;\n          }\n          \n          .sagachim-grid-scroll::-webkit-scrollbar-track {\n            background: rgba(255, 255, 255, 0.1);\n            border-radius: 4px;\n          }\n          \n          .sagachim-grid-scroll::-webkit-scrollbar-thumb {\n            background: rgba(124, 192, 255, 0.6);\n            border-radius: 4px;\n            transition: background 0.3s ease;\n          }\n          \n          .sagachim-grid-scroll::-webkit-scrollbar-thumb:hover {\n            background: rgba(124, 192, 255, 0.8);\n          }\n          \n          /* For Firefox */\n          .sagachim-grid-scroll {\n            scrollbar-width: thin;\n            scrollbar-color: rgba(124, 192, 255, 0.6) rgba(255, 255, 255, 0.1);\n          }\n        "}),y.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"radial-gradient(1200px 800px at 80% 20%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 10% 90%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",zIndex:-1}}),y.jsx("div",{className:"sagachim-status",style:{minHeight:"100vh",color:"var(--text)",fontFamily:'"Segoe UI", system-ui, sans-serif',width:"100%",boxSizing:"border-box",padding:"20px",position:"relative"},children:y.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",maxWidth:"1400px",margin:"0 auto",width:"100%"},children:[y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"40px",width:"100%"},children:[y.jsxs("div",{style:{textAlign:"center",flex:1},children:[y.jsx("h1",{style:{fontSize:"32px",fontWeight:"700",color:"var(--accent)",margin:"0 0 16px 0",letterSpacing:"0.5px",direction:"rtl"},children:'סטטוס סג"חים'}),y.jsx("p",{style:{fontSize:"16px",color:"var(--muted)",margin:0,direction:"rtl"},children:'מעקב אחר מצב הסג"חים בתהליך הכניסה'})]}),n()&&y.jsx("button",{onClick:()=>ke(!0),style:d(l({},j.primary),{background:"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",color:"white",marginLeft:"20px"}),onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 6px 20px rgba(76,175,80,0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="none"},children:'+ צור סג"ח חדש'})]}),y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",marginBottom:"32px",alignItems:"center",width:"100%"},children:[y.jsxs("div",{style:{display:"flex",gap:"16px",justifyContent:"center",flexWrap:"wrap",alignItems:"center",width:"100%"},children:[y.jsxs("div",{style:{position:"relative",minWidth:"280px",maxWidth:"400px",flex:"1 1 300px"},children:[y.jsx("input",{type:"text",placeholder:"חיפוש לפי שם או תיאור...",value:S,onChange:e=>k(e.target.value),style:{width:"100%",padding:"12px 16px 12px 40px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 20px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}}),y.jsx("div",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--muted)",fontSize:"16px"},children:"🔍"})]}),y.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[y.jsxs("button",{onClick:()=>U(!_),style:j.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[y.jsx("span",{children:C||"כל הספקים"}),y.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),_&&y.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[y.jsx("div",{onClick:()=>{E(""),U(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הספקים"}),it.map(e=>y.jsx("div",{onClick:()=>{E(e),U(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),y.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[y.jsxs("button",{onClick:()=>H(!q),style:j.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},onFocus:e=>{const t=e.target;t.style.boxShadow="none",t.style.outline="none"},onBlur:e=>{e.target.style.boxShadow="none"},children:[y.jsx("span",{children:T||"כל הזירות"}),y.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),q&&y.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[y.jsx("div",{onClick:()=>{z(""),H(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הזירות"}),at.map(e=>y.jsx("div",{onClick:()=>{z(e),H(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),y.jsxs("div",{style:{position:"relative",minWidth:"180px",maxWidth:"240px",flex:"0 1 200px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[y.jsxs("button",{onClick:()=>K(!V),style:j.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[y.jsx("span",{children:D?7===parseInt(D)?"מובצע":ce[parseInt(D)-1]:"כל שלבי התהליך"}),y.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),V&&y.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[y.jsx("div",{onClick:()=>{N(""),K(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל שלבי התהליך"}),pe.map((e,t)=>y.jsx("div",{onClick:()=>{N((t+1).toString()),K(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:t+1===7?"מובצע":e},t+1))]})]}),y.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[y.jsxs("button",{onClick:()=>Q(!Z),style:j.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},onFocus:e=>{const t=e.target;t.style.boxShadow="none",t.style.outline="none"},onBlur:e=>{e.target.style.boxShadow="none"},children:[y.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[y.jsx("span",{children:"☰"}),y.jsx("span",{children:"asc"===I?"מההתחלה לסוף":"desc"===I?"מהסוף להתחלה":"סדר לפי"})]}),y.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),Z&&y.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[y.jsxs("div",{onClick:()=>{M("none"),Q(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"none"===I?"var(--accent)":"#ffffff",textAlign:"center",direction:"rtl",background:"none"===I?"rgba(124,192,255,0.1)":"transparent",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseEnter:e=>{"none"!==I&&(e.target.style.background="rgba(255,255,255,0.08)")},onMouseLeave:e=>{e.target.style.background="none"!==I?"transparent":"rgba(124,192,255,0.1)"},children:["none"===I&&y.jsx("span",{style:{fontSize:"12px"},children:"✓"}),y.jsx("span",{children:"ללא מיון"})]}),y.jsxs("div",{onClick:()=>{M("asc"),Q(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"asc"===I?"var(--accent)":"#ffffff",textAlign:"center",direction:"rtl",background:"asc"===I?"rgba(124,192,255,0.1)":"transparent",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseEnter:e=>{"asc"!==I&&(e.target.style.background="rgba(255,255,255,0.08)")},onMouseLeave:e=>{e.target.style.background="asc"!==I?"transparent":"rgba(124,192,255,0.1)"},children:[y.jsx("span",{style:{fontSize:"12px",opacity:.7}}),"asc"===I&&y.jsx("span",{style:{fontSize:"12px"},children:"✓"}),y.jsx("span",{children:" מההתחלה לסוף"})]}),y.jsxs("div",{onClick:()=>{M("desc"),Q(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"desc"===I?"var(--accent)":"#ffffff",textAlign:"center",direction:"rtl",background:"desc"===I?"rgba(124,192,255,0.1)":"transparent",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseEnter:e=>{"desc"!==I&&(e.target.style.background="rgba(255,255,255,0.08)")},onMouseLeave:e=>{e.target.style.background="desc"!==I?"transparent":"rgba(124,192,255,0.1)"},children:[y.jsx("span",{style:{fontSize:"12px",opacity:.7}}),"desc"===I&&y.jsx("span",{style:{fontSize:"12px"},children:"✓"}),y.jsx("span",{children:"מהסוף להתחלה"})]})]})]})]}),(C||T||D||S)&&y.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",justifyContent:"center",alignItems:"center",marginBottom:"16px"},children:[S&&y.jsxs("div",{style:{display:"flex",alignItems:"center",background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"20px",padding:"6px 12px",gap:"8px",direction:"rtl"},children:[y.jsxs("span",{style:{color:"var(--text)",fontSize:"12px",fontWeight:"500"},children:['חיפוש: "',S,'"']}),y.jsx("button",{onClick:()=>{k("")},style:j.close,onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.2)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]}),C&&y.jsxs("div",{style:{display:"flex",alignItems:"center",background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"20px",padding:"6px 12px",gap:"8px",direction:"rtl"},children:[y.jsxs("span",{style:{color:"var(--text)",fontSize:"12px",fontWeight:"500"},children:["ספק: ",C]}),y.jsx("button",{onClick:()=>{E("")},style:j.close,onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.2)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]}),T&&y.jsxs("div",{style:{display:"flex",alignItems:"center",background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"20px",padding:"6px 12px",gap:"8px",direction:"rtl"},children:[y.jsxs("span",{style:{color:"var(--text)",fontSize:"12px",fontWeight:"500"},children:["זירה: ",T]}),y.jsx("button",{onClick:()=>{z("")},style:j.close,onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.2)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]}),D&&y.jsxs("div",{style:{display:"flex",alignItems:"center",background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"20px",padding:"6px 12px",gap:"8px",direction:"rtl"},children:[y.jsxs("span",{style:{color:"var(--text)",fontSize:"12px",fontWeight:"500"},children:["שלב: ",7===parseInt(D)?"מובצע":ce[parseInt(D)-1]]}),y.jsx("button",{onClick:()=>{N("")},style:j.close,onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.2)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]})]}),y.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"24px",width:"100%",maxWidth:"1200px"},children:y.jsx("span",{style:{color:"var(--muted)",fontSize:"14px",direction:"rtl"}})}),y.jsx("div",{className:"sagachim-grid-scroll",style:{display:"flex",flexDirection:"column",gap:"32px",width:"100%",padding:"0 20px 0 20px",maxHeight:"calc(100vh - 400px)",overflowY:"auto",overflowX:"hidden",direction:"rtl"},children:C||T||D||S||"none"!==I?("desc"===I?[7,6,5,4,3,2,1]:[1,2,3,4,5,6,7]).map(e=>{const t=ot.filter(t=>t.processStatus===e);return console.log(`📋 Phase ${e}: ${t.length} sagachs`),t.forEach(e=>{console.log(`  - ${e.name} (processStatus: ${e.processStatus})`)}),0===t.length?null:y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px",padding:"0 8px"},children:[y.jsxs("div",{style:{background:st(e),color:"white",padding:"8px 16px",borderRadius:"20px",fontSize:"14px",fontWeight:"600",letterSpacing:"0.5px",display:"flex",alignItems:"center",gap:"6px"},children:[7===e&&"✅",7===e?"מובצע":ce[e-1]]}),y.jsx("span",{style:{color:"var(--muted)",fontSize:"12px",fontWeight:"500"}})]}),y.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"24px",justifyItems:"center"},children:t.map(e=>{const t=(e=>{var t;if(console.log(`🔍 Checking overdue status for ${e.name}:`),console.log("  Full sagach object:",e),console.log(`  estimatedCompletion: "${e.estimatedCompletion}"`),console.log("  estimatedCompletion type: "+typeof e.estimatedCompletion),console.log(`  estimatedCompletion truthy: ${!!e.estimatedCompletion}`),console.log(`  estimatedCompletion length: ${null==(t=e.estimatedCompletion)?void 0:t.length}`),!e.estimatedCompletion)return console.log("  ❌ No estimated completion date - not overdue"),console.log(`  Why is it falsy? estimatedCompletion = "${e.estimatedCompletion}"`),!1;try{const t=new Date(e.estimatedCompletion),r=Ke();console.log(`  Expected date (raw): "${e.estimatedCompletion}"`),console.log(`  Expected date (parsed): ${t.toISOString()}`),console.log(`  Current date: ${r.toISOString()}`);const n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),i=new Date(r.getFullYear(),r.getMonth(),r.getDate());console.log(`  Expected date (date only): ${n.toISOString()}`),console.log(`  Current date (date only): ${i.toISOString()}`);const a=n<i;return console.log(`  Is overdue: ${a}`),console.log(`  Comparison: ${n.getTime()} < ${i.getTime()} = ${n.getTime()<i.getTime()}`),a}catch(r){return console.error("Error checking overdue status:",r),!1}})(e),r=7===e.processStatus;return console.log(`🎨 Rendering card for ${e.name}:`),console.log(`  isOverdue: ${t}`),console.log(`  isCompleted: ${r}`),console.log(`  estimatedCompletion: ${e.estimatedCompletion}`),console.log(`  🎨 WILL APPLY ORANGE STYLING: ${t}`),y.jsxs("div",{onClick:()=>lt(e),style:{background:r?"linear-gradient(180deg, rgba(76,175,80,0.15), rgba(46,125,50,0.10))":t?"linear-gradient(180deg, rgba(255,165,0,0.15), rgba(255,140,0,0.10))":"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:r?"1px solid rgba(76,175,80,0.3)":t?"1px solid rgba(255,165,0,0.3)":"1px solid rgba(255,255,255,0.12)",borderRadius:"16px",padding:"24px",boxShadow:r?"0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)":t?"0 8px 32px rgba(255,165,0,0.2), inset 0 1px 0 rgba(255,165,0,0.1)":"0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)",backdropFilter:"blur(8px)",transition:"all 0.3s ease",cursor:"pointer",position:"relative",overflow:"hidden",width:"100%",maxWidth:"320px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-4px)",e.currentTarget.style.boxShadow=r?"0 12px 40px rgba(76,175,80,0.3), inset 0 1px 0 rgba(76,175,80,0.15)":t?"0 12px 40px rgba(255,165,0,0.3), inset 0 1px 0 rgba(255,165,0,0.15)":"0 12px 40px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.15)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow=r?"0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)":t?"0 8px 32px rgba(255,165,0,0.2), inset 0 1px 0 rgba(255,165,0,0.1)":"0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)"},children:[y.jsxs("div",{style:{position:"absolute",top:"16px",left:"16px",background:st(e.processStatus),color:"white",padding:"6px 12px",borderRadius:"20px",fontSize:"11px",fontWeight:"600",letterSpacing:"0.5px",direction:"rtl",textAlign:"center",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"4px"},children:[7===e.processStatus&&"✅",7===e.processStatus?"מובצע":ce[e.processStatus-1]]}),t&&y.jsx("div",{style:{position:"absolute",top:"16px",right:"16px",background:"linear-gradient(135deg, rgba(255, 193, 7, 0.9), rgba(255, 152, 0, 0.8))",color:"#1f1f1f",padding:"6px 12px",borderRadius:"999px",fontSize:"11px",fontWeight:"700",letterSpacing:"0.5px",display:"flex",alignItems:"center",gap:"6px",boxShadow:"0 6px 18px rgba(255, 193, 7, 0.35)",direction:"rtl"},children:'⚠️ לא עומד בתג"ב'}),y.jsxs("div",{style:{marginTop:"40px",direction:"rtl"},children:[y.jsx("h3",{style:{fontSize:"24px",fontWeight:"700",color:"var(--text)",margin:"0 0 12px 0",lineHeight:"1.3"},children:e.name}),y.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0 0 16px 0",lineHeight:"1.5",minHeight:"42px",whiteSpace:"pre-wrap",direction:"rtl",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e.description}),y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"16px"},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[y.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"ספק:"}),y.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.provider})]}),y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[y.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"זירה:"}),y.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.arena.join(", ")})]})]})]}),y.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:r?"linear-gradient(135deg, rgba(76,175,80,0.15), rgba(46,125,50,0.1))":t?"linear-gradient(135deg, rgba(255,165,0,0.15), rgba(255,140,0,0.1))":"linear-gradient(135deg, rgba(124,192,255,0.1), rgba(167,90,255,0.1))",opacity:0,transition:"opacity 0.3s ease",pointerEvents:"none"}})]},e.id)})}),y.jsx("div",{style:{width:"100%",height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent)",margin:"24px 0 8px 0"}})]},e)}):y.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"24px",justifyItems:"center",width:"100%"},children:ot.map(e=>y.jsxs("div",{onClick:()=>lt(e),style:{background:7===e.processStatus?"linear-gradient(180deg, rgba(76,175,80,0.15), rgba(46,125,50,0.10))":"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:7===e.processStatus?"1px solid rgba(76,175,80,0.3)":"1px solid rgba(255,255,255,0.12)",borderRadius:"16px",padding:"24px",boxShadow:7===e.processStatus?"0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)":"0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)",backdropFilter:"blur(8px)",transition:"all 0.3s ease",cursor:"pointer",position:"relative",overflow:"hidden",width:"100%",maxWidth:"320px"},onMouseEnter:t=>{t.currentTarget.style.transform="translateY(-4px)",t.currentTarget.style.boxShadow=7===e.processStatus?"0 12px 40px rgba(76,175,80,0.3), inset 0 1px 0 rgba(76,175,80,0.15)":"0 12px 40px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.15)"},onMouseLeave:t=>{t.currentTarget.style.transform="translateY(0px)",t.currentTarget.style.boxShadow=7===e.processStatus?"0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)":"0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)"},children:[y.jsxs("div",{style:{position:"absolute",top:"16px",left:"16px",background:st(e.processStatus),color:"white",padding:"6px 12px",borderRadius:"20px",fontSize:"11px",fontWeight:"600",letterSpacing:"0.5px",direction:"rtl",textAlign:"center",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"4px"},children:[7===e.processStatus&&"✅",7===e.processStatus?"מובצע":ce[e.processStatus-1]]}),"TOP"===e.priority&&y.jsx("div",{style:{position:"absolute",top:"16px",right:"16px",background:"linear-gradient(135deg, rgba(146, 23, 23, 0.9), rgba(236, 35, 35, 0.7))",color:"#FFFFFF",padding:"6px 12px",borderRadius:"999px",fontSize:"11px",fontWeight:"700",letterSpacing:"0.5px",display:"flex",alignItems:"center",gap:"6px",boxShadow:"0 6px 18px rgba(255, 0, 0, 0.35)"},children:"TOP"}),y.jsxs("div",{style:{marginTop:"40px",direction:"rtl"},children:[y.jsx("h3",{style:{fontSize:"24px",fontWeight:"700",color:"var(--text)",margin:"0 0 12px 0",lineHeight:"1.3"},children:e.name}),y.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0 0 16px 0",lineHeight:"1.5",minHeight:"42px",whiteSpace:"pre-wrap",direction:"rtl",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e.description}),y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"16px"},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[y.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"ספק:"}),y.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.provider})]}),y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[y.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"זירה:"}),y.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.arena.join(", ")})]}),y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[y.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"תעדוף:"}),y.jsx("span",{style:{fontSize:"12px"},children:de[e.priority]})]}),y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[y.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"עודכן לאחרונה:"}),y.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:(()=>{const t=new Date(e.lastUpdated);return isNaN(t.getTime())?e.lastUpdated:`${t.getDate().toString().padStart(2,"0")}.${(t.getMonth()+1).toString().padStart(2,"0")}.${t.getFullYear()}`})()})]})]})]}),y.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:7===e.processStatus?"linear-gradient(135deg, rgba(76,175,80,0.15), rgba(46,125,50,0.1))":"linear-gradient(135deg, rgba(124,192,255,0.1), rgba(167,90,255,0.1))",opacity:0,transition:"opacity 0.3s ease",pointerEvents:"none"}})]},e.id))})}),0===ot.length&&y.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%"},children:[y.jsx("div",{style:{fontSize:"48px",marginBottom:"16px",opacity:.5},children:"📋"}),y.jsx("h3",{style:{fontSize:"20px",color:"var(--muted)",margin:"0 0 8px 0",direction:"rtl"},children:'לא נמצאו סג"חים'}),y.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:0,direction:"rtl"},children:"נסה לשנות את החיפוש או הסינון"})]})]})]})}),L&&y.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)",zIndex:1e3},onClick:()=>{qe(!1),F(null)},children:y.jsxs("div",{style:{background:"radial-gradient(1200px 800px at 50% 50%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 50% 50%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",border:"none",borderRadius:"0px",padding:"40px",width:"100vw",height:"100vh",overflow:"auto",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.1)",backdropFilter:"blur(12px)",direction:"rtl",position:"fixed",top:0,left:0,boxSizing:"border-box"},onClick:e=>e.stopPropagation(),children:[y.jsx("div",{style:{marginBottom:"32px",borderBottom:"1px solid rgba(255,255,255,0.2)",paddingBottom:"16px"},children:y.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},children:[y.jsx("div",{style:{width:"200px",display:"flex",justifyContent:"flex-start"},children:i()&&y.jsx("button",{onClick:e=>{e.stopPropagation(),((e,t)=>{if(t.stopPropagation(),!i())return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:'אין לך הרשאה למחוק סג"חים',type:"error",durationMs:3e3}}));const r=g.find(t=>t.id===e);r&&window.confirm(`האם אתה בטוח שברצונך למחוק את הסג"ח "${r.name}"?\nפעולה זו לא ניתנת לביטול.`)&&(m(e),console.log(`Deleted sagach "${r.name}" (ID: ${e}). Remaining sagachs: ${g.length-1}`),(null==L?void 0:L.id)===e&&(qe(!1),F(null)),nt(`הסג"ח "${r.name}" נמחק בהצלחה`,"success"))})(L.id,e)},style:d(l({},j.primary),{background:"rgba(137, 37, 30, 0.9)",color:"white",fontSize:"16px"}),onMouseEnter:e=>{e.currentTarget.style.background="rgba(244, 67, 54, 1)",e.currentTarget.style.transform="scale(1.05)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(244, 67, 54, 0.9)",e.currentTarget.style.transform="scale(1)"},title:'מחק סג"ח',children:"🗑️"})}),y.jsx("h2",{style:{color:"var(--accent)",fontSize:"40px",fontWeight:"700",margin:"0",textAlign:"center",flex:1},children:L.name}),y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",width:"200px",justifyContent:"flex-end"},children:[y.jsxs("button",{onClick:()=>c(e,null,function*(){const e=(null==o?void 0:o.id)||"current_user";v(L,e)?(ve(!0),yield new Promise(e=>setTimeout(e,500)),ht(),ve(!1)):xe(!0)}),disabled:ye,style:d(l({},j.primary),{background:v(L,(null==o?void 0:o.id)||"current_user")?"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))":"rgba(255,255,255,0.1)",border:"1px solid "+(v(L,(null==o?void 0:o.id)||"current_user")?"rgba(76,175,80,0.8)":"rgba(255,255,255,0.2)"),borderRadius:"25px",color:v(L,(null==o?void 0:o.id)||"current_user")?"white":"var(--text)",fontSize:"16px",cursor:ye?"not-allowed":"pointer",opacity:ye?.7:1}),onMouseEnter:e=>{L.notifications||ye||(e.currentTarget.style.background="rgba(124,192,255,0.2)",e.currentTarget.style.borderColor="rgba(124,192,255,0.5)")},onMouseLeave:e=>{L.notifications||ye||(e.currentTarget.style.background="rgba(255,255,255,0.1)",e.currentTarget.style.borderColor="rgba(255,255,255,0.2)")},children:[ye?y.jsx("div",{style:{width:"18px",height:"18px",border:"2px solid transparent",borderTop:"2px solid currentColor",borderRadius:"50%",animation:"spin 1s linear infinite"}}):v(L,(null==o?void 0:o.id)||"current_user")?"🔔":"🔕",ye?"מעדכן...":v(L,(null==o?void 0:o.id)||"current_user")?"מקבל התראות":"הירשם לעדכונים"]}),y.jsx("button",{onClick:()=>{qe(!1),F(null)},style:d(l({},j.close),{fontSize:"28px",padding:"12px",borderRadius:"12px",width:"auto",height:"auto"}),onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"←"})]})]})}),y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(300px, 35%) minmax(400px, 65%)",gap:"24px",height:"calc(100vh - 120px)",minHeight:"600px",alignItems:"stretch",overflow:"hidden",maxWidth:"100%",boxSizing:"border-box"},children:[y.jsxs("div",{style:{background:"rgba(124,192,255,0.08)",border:"2px solid rgba(124,192,255,0.2)",borderRadius:"20px",padding:"24px",display:"flex",flexDirection:"column",height:"100%",overflowY:"auto"},children:[y.jsx("h4",{style:{color:"white",fontSize:"24px",fontWeight:"600",margin:"0 0 12px 0",textAlign:"center",paddingBottom:"8px",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:'פרטי הסג"ח'}),s("admin")&&y.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"12px",marginBottom:"20px"},children:Ue?y.jsxs(y.Fragment,{children:[y.jsx("button",{onClick:()=>c(e,null,function*(){if(L)try{if(He.processStatus!==L.processStatus){if(!r())return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"אין לך הרשאה לערוך סטטוסים",type:"error",durationMs:3e3}}));yield xt(He.processStatus)}else{const e=He.processStartDate.trim()?Ge(He.processStartDate.trim()):null;if(He.processStartDate.trim()&&!e){const e=Xe(He.processStartDate.trim());return void nt(e||"פורמט תאריך התחלה לא תקין. השתמש בפורמט DD/MM/YYYY","warning")}const t=d(l({},L),{description:He.description.trim(),provider:He.provider.trim(),arena:He.arena,priority:He.priority,sagachType:He.sagachType.trim()||void 0,processStartDate:e||void 0,attachments:He.attachments,lastUpdated:oe(Ke())}),r={description:He.description.trim(),provider:He.provider.trim(),arena:He.arena,priority:He.priority,processStartDate:e||void 0,attachments:He.attachments,lastUpdated:oe(Ke())};He.sagachType.trim()?r.sagachType=He.sagachType.trim():r.sagachType=void 0,x(L.id,r),F(t),qe(!1),nt('פרטי הסג"ח עודכנו בהצלחה',"success")}}catch(e){console.error("Error updating sagach details:",e),nt('שגיאה בעדכון פרטי הסג"ח',"warning")}}),style:{background:"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",border:"none",borderRadius:"12px",color:"white",padding:"10px 20px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 6px 20px rgba(76,175,80,0.3)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:"✅ שמור"}),y.jsx("button",{onClick:()=>{qe(!1),Ye({description:"",provider:"",arena:[],priority:"בינוני",sagachType:"",processStatus:1,processStartDate:"",attachments:[]})},style:{background:"linear-gradient(135deg, rgba(244,67,54,0.8), rgba(244,67,54,0.6))",border:"none",borderRadius:"12px",color:"white",padding:"10px 20px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 6px 20px rgba(244,67,54,0.3)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:"❌ בטל"})]}):y.jsx("button",{onClick:()=>{L&&(Ye({description:L.description,provider:L.provider,arena:[...L.arena],priority:L.priority,sagachType:L.sagachType||"",processStatus:L.processStatus,processStartDate:L.processStartDate?Ze(L.processStartDate):"",attachments:L.attachments||[]}),qe(!0))},style:{background:"linear-gradient(135deg, rgba(255,193,7,0.8), rgba(255,193,7,0.6))",border:"none",borderRadius:"12px",color:"white",padding:"10px 20px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 6px 20px rgba(255,193,7,0.3)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:"✏️ ערוך פרטים"})}),y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px",marginBottom:"16px"},children:[y.jsxs("div",{children:[y.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"תיאור"}),Ue?y.jsx("textarea",{value:He.description,onChange:e=>Ye(t=>d(l({},t),{description:e.target.value})),style:{width:"100%",minHeight:"80px",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"16px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",resize:"vertical",lineHeight:"1.6",boxSizing:"border-box"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}}):y.jsx("p",{style:{color:"var(--text)",fontSize:"16px",margin:0,lineHeight:"1.6",whiteSpace:"pre-wrap",direction:"rtl"},children:L.description})]}),y.jsxs("div",{children:[y.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"ספק"}),Ue?y.jsx("input",{type:"text",value:He.provider,onChange:e=>Ye(t=>d(l({},t),{provider:e.target.value})),style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"18px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",boxSizing:"border-box"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}}):y.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8"},children:L.provider})]}),y.jsxs("div",{children:[y.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"זירה"}),Ue?y.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[y.jsxs("button",{type:"button",onClick:()=>ie(e=>!e),style:{appearance:"none",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.08)",borderRadius:"12px",color:"#ffffff",padding:"12px 16px",cursor:"pointer",fontSize:"16px",direction:"rtl",outline:"none",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",fontFamily:"Segoe UI, sans-serif"},children:[y.jsx("span",{style:{textAlign:"right",flex:1},children:0===He.arena.length?"בחר זירות...":He.arena.join(", ")}),y.jsx("span",{style:{marginLeft:"8px",fontSize:"12px"},children:"▼"})]}),ne&&y.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",zIndex:1e3,boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",overflow:"hidden",maxHeight:"200px",overflowY:"auto"},children:J.map(e=>y.jsxs("div",{onClick:t=>{t.stopPropagation();const r=He.arena.includes(e);Ye(t=>d(l({},t),{arena:r?t.arena.filter(t=>t!==e):[...t.arena,e]}))},style:{padding:"10px 16px",cursor:"pointer",transition:"background 0.2s ease",direction:"rtl",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"space-between",background:He.arena.includes(e)?"rgba(124,192,255,0.15)":"transparent",color:"var(--text)"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(124,192,255,0.15)"},onMouseLeave:t=>{He.arena.includes(e)||(t.currentTarget.style.background="transparent")},children:[y.jsx("span",{children:e}),He.arena.includes(e)&&y.jsx("span",{style:{color:"var(--accent)",fontSize:"12px"},children:"✓"})]},`edit-arena-${e}`))})]}):y.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8"},children:L.arena.join(", ")})]}),y.jsxs("div",{children:[y.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"תעדוף"}),Ue?y.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[y.jsxs("button",{type:"button",onClick:()=>te(e=>!e),style:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.06)",borderRadius:"12px",color:"#ffffff",padding:"10px 16px",cursor:"pointer",fontSize:"16px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[y.jsx("span",{children:de[He.priority]}),y.jsx("span",{style:{marginLeft:"8px",fontSize:"12px"},children:"▼"})]}),ee&&y.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",zIndex:1e3,boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",overflow:"hidden"},children:le.map(e=>y.jsxs("div",{onClick:()=>{te(!1),Ye(t=>d(l({},t),{priority:e}))},style:{padding:"10px 16px",cursor:"pointer",transition:"background 0.2s ease",direction:"rtl",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"space-between",background:He.priority===e?"rgba(124,192,255,0.15)":"transparent",fontWeight:"TOP"===e?700:500},onMouseEnter:e=>{e.currentTarget.style.background="rgba(124,192,255,0.15)"},onMouseLeave:t=>{He.priority!==e&&(t.currentTarget.style.background="transparent")},children:[y.jsx("span",{children:"TOP"===e?"TOP":e}),e===He.priority&&y.jsx("span",{children:"✓"})]},`edit-priority-${e}`))})]}):y.jsx("p",{style:{fontSize:"18px",margin:0,lineHeight:"1.8"},children:de[L.priority]})]}),(Ue||L.sagachType)&&y.jsxs("div",{children:[y.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:'סוג הסג"ח'}),Ue?y.jsx("input",{type:"text",value:He.sagachType,onChange:e=>Ye(t=>d(l({},t),{sagachType:e.target.value})),placeholder:"הכנס סוג הסג'ח (אופציונלי)...",style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"18px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",boxSizing:"border-box"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}}):y.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8"},children:L.sagachType})]}),y.jsxs("div",{children:[y.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"שלב בתהליך"}),Ue?y.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[y.jsxs("button",{type:"button",onClick:()=>K(e=>!e),style:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.06)",borderRadius:"12px",color:"#ffffff",padding:"10px 16px",cursor:"pointer",fontSize:"16px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[y.jsx("span",{children:pe[He.processStatus-1]}),y.jsx("span",{style:{marginLeft:"8px",fontSize:"12px"},children:"▼"})]}),V&&y.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",zIndex:1e3,boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",overflow:"hidden"},children:pe.map((e,t)=>y.jsx("div",{onClick:()=>{Ye(e=>d(l({},e),{processStatus:t+1})),K(!1)},style:{padding:"12px 16px",cursor:"pointer",borderBottom:t<pe.length-1?"1px solid rgba(255,255,255,0.08)":"none",transition:"background 0.2s ease",fontSize:"14px",direction:"rtl",color:He.processStatus===t+1?"rgba(124,192,255,1)":"#ffffff"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},t+1))})]}):y.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8"},children:pe[L.processStatus-1]})]}),y.jsxs("div",{children:[y.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"סטטוס נוכחי"}),y.jsx("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"20px",fontSize:"18px",color:"var(--text)",lineHeight:"1.8",direction:"rtl"},children:(()=>{if(!(null==L?void 0:L.statusUpdates)||0===L.statusUpdates.length)return y.jsx("span",{style:{fontStyle:"italic",color:"var(--muted)"},children:"אין עדכוני סטטוס"});const e=[...L.statusUpdates].sort((e,t)=>{const r=e=>{if(e.includes("/")){const[t,r]=e.split(" "),[n,i,a]=t.split("/");return new Date(`${a}-${i}-${n} ${r}`)}return new Date(e)},n=r(e.timestamp),i=r(t.timestamp);if(isNaN(n.getTime())&&isNaN(i.getTime()))return parseInt(t.id)-parseInt(e.id);if(isNaN(n.getTime()))return 1;if(isNaN(i.getTime()))return-1;const a=i.getTime()-n.getTime();return 0!==a?a:parseInt(t.id)-parseInt(e.id)})[0];return(null==e?void 0:e.message)?y.jsxs("div",{children:[y.jsxs("div",{style:{fontSize:"16px",color:"var(--muted)",marginBottom:"10px",display:"flex",alignItems:"center",gap:"4px"},children:["status_change"===e.type&&"🔄","system"===e.type&&"⚙️","user"===e.type&&"👤",y.jsx("span",{children:mt(e.timestamp)})]}),y.jsx("div",{children:e.message})]}):y.jsx("span",{style:{fontStyle:"italic",color:"var(--muted)"},children:"אין עדכוני סטטוס"})})()},(null==(t=L.statusUpdates)?void 0:t.length)||0)]}),y.jsxs("div",{children:[y.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"תאריך התחלה"}),Be?y.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[y.jsx("input",{type:"text",value:Pe,onChange:e=>{let t=e.target.value.replace(/[^\d\/]/g,"");2!==t.length||t.includes("/")?5===t.length&&2===t.split("/").length&&(t+="/"):t+="/",t.length>10&&(t=t.substring(0,10)),_e(t)},placeholder:"DD/MM/YYYY",maxLength:10,style:{background:"var(--bg-secondary)",border:"2px solid rgba(124,192,255,0.5)",borderRadius:"8px",padding:"8px 12px",color:"var(--text)",fontSize:"16px",fontFamily:"Segoe UI, system-ui, sans-serif",width:"150px",direction:"ltr",textAlign:"center"},onKeyDown:e=>{"Enter"===e.key?gt():"Escape"===e.key&&ut()},autoFocus:!0}),y.jsx("button",{onClick:gt,style:{background:"rgba(34,197,94,0.8)",border:"none",borderRadius:"6px",padding:"8px 12px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(34,197,94,1)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(34,197,94,0.8)"},children:"✓"}),y.jsx("button",{onClick:ut,style:{background:"rgba(239,68,68,0.8)",border:"none",borderRadius:"6px",padding:"8px 12px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(239,68,68,1)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(239,68,68,0.8)"},children:"✕"})]}):Ue&&r()?y.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8",cursor:"pointer",padding:"8px",borderRadius:"8px",border:"2px dashed rgba(124,192,255,0.3)",background:"rgba(124,192,255,0.05)",transition:"all 0.2s ease"},onClick:()=>{if(!L)return;if(!r())return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"אין לך הרשאה לערוך תאריך התחלה",type:"error",durationMs:3e3}}));const e=L.processStartDate?Ze(L.processStartDate):"";_e(e),Oe(!0)},onMouseEnter:e=>{e.currentTarget.style.border="2px dashed rgba(124,192,255,0.6)",e.currentTarget.style.background="rgba(124,192,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.border="2px dashed rgba(124,192,255,0.3)",e.currentTarget.style.background="rgba(124,192,255,0.05)"},children:L.processStartDate?Ze(L.processStartDate):"לא צוין - לחץ לעריכה"}):y.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8"},children:L.processStartDate?Ze(L.processStartDate):"לא צוין"})]}),y.jsxs("div",{children:[y.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:'תג"ב למעבר לשלב הבא'}),Ae?y.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[y.jsx("input",{type:"text",value:$e,onChange:e=>{let t=e.target.value.replace(/[^\d\/]/g,"");2!==t.length||t.includes("/")?5===t.length&&2===t.split("/").length&&(t+="/"):t+="/",t.length>10&&(t=t.substring(0,10)),We(t)},placeholder:"DD/MM/YYYY",maxLength:10,style:{background:"var(--bg-secondary)",border:"2px solid rgba(124,192,255,0.5)",borderRadius:"8px",padding:"8px 12px",color:"var(--text)",fontSize:"16px",fontFamily:"Segoe UI, system-ui, sans-serif",width:"150px",direction:"ltr",textAlign:"center"},onKeyDown:e=>{"Enter"===e.key?ct():"Escape"===e.key&&pt()},autoFocus:!0}),y.jsx("button",{onClick:ct,style:{background:"rgba(34,197,94,0.8)",border:"none",borderRadius:"6px",padding:"8px 12px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(34,197,94,1)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(34,197,94,0.8)"},children:"✓"}),y.jsx("button",{onClick:pt,style:{background:"rgba(239,68,68,0.8)",border:"none",borderRadius:"6px",padding:"8px 12px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(239,68,68,1)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(239,68,68,0.8)"},children:"✕"})]}):Ue&&r()?y.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8",cursor:"pointer",padding:"8px",borderRadius:"8px",border:"2px dashed rgba(124,192,255,0.3)",background:"rgba(124,192,255,0.05)",transition:"all 0.2s ease"},onClick:()=>{if(!L)return;if(!r())return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:'אין לך הרשאה לערוך תג"ב למעבר לשלב הבא',type:"error",durationMs:3e3}}));const e=L.estimatedCompletion?Ze(L.estimatedCompletion):"";We(e),Re(!0)},onMouseEnter:e=>{e.currentTarget.style.border="2px dashed rgba(124,192,255,0.6)",e.currentTarget.style.background="rgba(124,192,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.border="2px dashed rgba(124,192,255,0.3)",e.currentTarget.style.background="rgba(124,192,255,0.05)"},children:L.estimatedCompletion?Ze(L.estimatedCompletion):"לא צוין - לחץ לעריכה"}):y.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8",direction:"rtl"},children:L.estimatedCompletion?Ze(L.estimatedCompletion):"לא צוין"})]}),s("admin")&&y.jsxs("div",{children:[y.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"קבצים רלוונטים"}),Ue?y.jsxs("div",{style:{border:"2px dashed rgba(124,192,255,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center",background:"rgba(255,255,255,0.02)",marginBottom:"16px"},children:[y.jsx("input",{type:"file",multiple:!0,onChange:e=>{const t=Array.from(e.target.files||[]);t.forEach(e=>{if(e.size>10485760)return void nt(`הקובץ "${e.name}" גדול מדי (${se(e.size)}). מקסימום: 10MB`,"warning");const t=new FileReader;t.onload=t=>{var r;const n={id:Date.now().toString()+Math.random().toString(36),name:e.name,size:e.size,type:e.type||"application/octet-stream",uploadDate:(new Date).toISOString(),data:null==(r=t.target)?void 0:r.result};Ye(e=>d(l({},e),{attachments:[...e.attachments,n]})),nt(`הקובץ "${e.name}" הועלה בהצלחה`,"success")},t.readAsDataURL(e)}),e.target.value=""},style:{display:"none"},id:"file-upload-input"}),y.jsxs("label",{htmlFor:"file-upload-input",style:{cursor:"pointer",display:"block"},children:[y.jsx("div",{style:{fontSize:"48px",marginBottom:"12px",color:"rgba(124,192,255,0.6)"},children:"📁"}),y.jsx("div",{style:{fontSize:"16px",color:"rgba(124,192,255,0.8)",marginBottom:"8px"},children:"לחץ כאן או גרור קבצים להעלאה"}),y.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",opacity:.7},children:"תומך בכל סוגי הקבצים • מקסימום 10MB לקובץ"})]})]}):null,y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(Ue?He.attachments:L.attachments||[]).map((e,t)=>y.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px",padding:"12px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.08)",e.currentTarget.style.borderColor="rgba(124,192,255,0.3)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(255,255,255,0.05)",e.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flex:1},children:[y.jsx("div",{style:{fontSize:"20px"},children:e.type.startsWith("image/")?"🖼️":e.type.startsWith("video/")?"🎥":e.type.startsWith("audio/")?"🎵":"application/pdf"===e.type?"📄":e.type.includes("word")?"📝":e.type.includes("excel")||e.type.includes("spreadsheet")?"📊":e.type.includes("powerpoint")||e.type.includes("presentation")?"📈":"📎"}),y.jsxs("div",{style:{flex:1},children:[y.jsx("div",{style:{fontSize:"14px",color:"var(--text)",fontWeight:"500",marginBottom:"2px"},children:e.name}),y.jsxs("div",{style:{fontSize:"11px",color:"var(--muted)",opacity:.7},children:[se(e.size)," • ",oe(new Date(e.uploadDate))]})]})]}),y.jsxs("div",{style:{display:"flex",gap:"8px"},children:[y.jsx("button",{onClick:()=>{const t=document.createElement("a");t.href=e.data||e.url||"",t.download=e.name,t.click()},style:{background:"rgba(76,175,80,0.2)",border:"1px solid rgba(76,175,80,0.3)",borderRadius:"6px",padding:"6px 10px",color:"rgba(76,175,80,1)",fontSize:"16px",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(76,175,80,0.3)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(76,175,80,0.2)"},title:"הורד קובץ",children:"⬇️"}),Ue&&y.jsx("button",{onClick:()=>{Ye(t=>d(l({},t),{attachments:t.attachments.filter(t=>t.id!==e.id)}))},style:{background:"rgba(244,67,54,0.2)",border:"1px solid rgba(244,67,54,0.3)",borderRadius:"6px",padding:"6px 10px",color:"rgba(244,67,54,1)",fontSize:"12px",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(244,67,54,0.3)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(244,67,54,0.2)"},title:"מחק קובץ",children:"🗑️"})]})]},e.id)),0===(Ue?He.attachments:L.attachments||[]).length&&y.jsx("div",{style:{textAlign:"center",color:"var(--muted)",fontSize:"14px",padding:"20px",opacity:.6},children:Ue?"לא הועלו קבצים עדיין":"אין קבצים רלוונטים"})]})]})]})]}),y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px",height:"100%",overflow:"hidden",minWidth:0,boxSizing:"border-box"},children:[y.jsxs("div",{style:{background:"rgba(124,192,255,0.08)",border:"2px solid rgba(124,192,255,0.2)",borderRadius:"20px",padding:"20px",height:"300px",flexShrink:0,overflowY:"hidden",maxWidth:"100%",boxSizing:"border-box"},children:[y.jsx("h3",{style:{color:"white",fontSize:"24px",fontWeight:"600",marginBottom:"4px",marginTop:"0px",textAlign:"center",direction:"rtl"},children:'תהליך הכנסת הסג"ח'}),y.jsx("div",{style:{display:"flex",flexDirection:"row",gap:"20px",overflowX:"auto",direction:"rtl",padding:"12px",justifyContent:"center",marginTop:"0px"},children:ce.map((e,t)=>{var r,n;const i=t+1,a=7!==L.processStatus&&L.processStatus===i,o=7===L.processStatus?i<=6:L.processStatus>i,s=7!==L.processStatus&&L.processStatus<i,l=null==(r=L.phaseData)?void 0:r[i];return y.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"130px",maxWidth:"150px",padding:"8px 8px",position:"relative"},children:[y.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:a?(()=>{const e=st(i),t=e.replace("0.8)","0.6)");return`linear-gradient(135deg, ${e}, ${t})`})():o?"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))":"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"600",fontSize:"18px",flexShrink:0,animation:a?"pulse-glow 2s ease-in-out infinite":"none",marginBottom:"12px"},children:o?"✓":i}),y.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:a?"var(--accent)":"var(--text)",marginBottom:"8px",textAlign:"center",lineHeight:"1.2",direction:"rtl"},children:e}),y.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"2px",fontSize:"12px",color:"var(--muted)",textAlign:"center",direction:"rtl"},children:(a||o)&&l&&y.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"2px"},children:[y.jsxs("div",{children:[y.jsxs("strong",{children:[tt(l,a)," ימים"]}),l.entries&&l.entries.length>1&&y.jsx("span",{style:{fontSize:"10px",color:"var(--accent)",marginRight:"4px"},children:'(סה"כ)'})]}),(l.entries&&l.entries.length>0||l.currentEntry)&&y.jsx("div",{style:{fontSize:"8px",color:"var(--muted)",opacity:.7},children:rt(l,a)}),(null==(n=l.currentEntry)?void 0:n.startDate)&&y.jsxs("div",{style:{fontSize:"9px",color:"var(--muted)",opacity:.8},children:["החל: ",oe(new Date(l.currentEntry.startDate))]})]})}),a&&y.jsx("div",{style:{fontSize:"12px",color:"var(--accent)",fontWeight:"600",marginTop:"8px",textAlign:"center",background:"rgba(124,192,255,0.2)",padding:"6px 12px",borderRadius:"12px",direction:"rtl"},children:"נוכחי"}),o&&y.jsx("div",{style:{fontSize:"12px",color:"rgba(76,175,80,0.9)",fontWeight:"600",marginTop:"8px",textAlign:"center",background:"rgba(76,175,80,0.2)",padding:"6px 12px",borderRadius:"12px",direction:"rtl"},children:7===L.processStatus&&6===i?"הושלם ":"הושלם"}),s&&y.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"500",marginTop:"8px",textAlign:"center",background:"rgba(255,255,255,0.1)",padding:"6px 12px",borderRadius:"12px",direction:"rtl"},children:"ממתין"}),t<5&&y.jsx("div",{style:{position:"absolute",left:"-20px",top:"40px",width:"40px",height:"3px",background:(7===L.processStatus?t<5:o)?"rgba(76,175,80,0.6)":a&&t<L.processStatus-1?"rgba(124,192,255,0.6)":"rgba(255,255,255,0.3)",zIndex:1},children:y.jsx("div",{style:{position:"absolute",left:"-6px",top:"50%",transform:"translateY(-50%)",width:0,height:0,borderTop:"4px solid transparent",borderBottom:"4px solid transparent",borderRight:"8px solid "+((7===L.processStatus?t<5:o)?"rgba(76,175,80,0.6)":a&&t<L.processStatus-1?"rgba(124,192,255,0.6)":"rgba(255,255,255,0.3)")}})})]},`${i}-${L.id}-${L.processStatus}-${L.lastUpdated}-${Ve.getTime()}-${Qe}-${et}`)})})]}),y.jsxs("div",{style:{background:"rgba(124,192,255,0.08)",border:"2px solid rgba(124,192,255,0.2)",borderRadius:"20px",padding:"24px",display:"flex",flexDirection:"column",height:"65%",minHeight:0,overflow:"hidden",maxWidth:"100%",boxSizing:"border-box"},children:[y.jsx("h4",{style:{color:"white",fontSize:"28px",fontWeight:"600",margin:"0 0 16px 0",textAlign:"center"},children:"עדכוני סטטוס"}),y.jsx("div",{ref:P,style:{height:"100%",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px",marginBottom:"16px",overflowY:"auto",direction:"rtl",minHeight:0},children:L.statusUpdates&&L.statusUpdates.length>0?L.statusUpdates.sort((e,t)=>{const r=e=>{if(e.includes("/")){const[t,r]=e.split(" "),[n,i,a]=t.split("/");return new Date(`${a}-${i}-${n} ${r}`)}return new Date(e)},n=r(e.timestamp),i=r(t.timestamp),a=n.getTime()-i.getTime();return 0!==a?a:parseInt(e.id)-parseInt(t.id)}).map(e=>{let t;if("system"===e.type)t="rgba(124,192,255, 0.8)";else{const r="status_change"===e.type&&e.newStatus?e.newStatus:e.processStatus;t=r?st(r):"rgba(158, 158, 158, 0.8)"}const r=t.replace("0.8)","0.1)"),n=t.replace("0.8)","0.3)");return t.replace("0.8)","0.2)"),y.jsxs("div",{style:{padding:"12px",marginBottom:"8px",background:r,border:`1px solid ${n}`,borderRadius:"8px",position:"relative"},children:[y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"6px"},children:[y.jsxs("div",{style:{fontSize:"11px",color:"var(--muted)",display:"flex",alignItems:"center",gap:"8px"},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:["status_change"===e.type&&"🔄","system"===e.type&&"⚙️","user"===e.type&&"👤",mt(e.timestamp)]}),e.author&&y.jsx("div",{style:{fontSize:"11px",color:"var(--accent)",fontWeight:"600"},children:e.author})]}),y.jsx("div",{style:{fontSize:"10px",color:"white",fontWeight:"600",background:t,padding:"2px 6px",borderRadius:"10px"},children:(()=>{const t="status_change"===e.type&&e.newStatus?e.newStatus:e.processStatus;return t?7===t?"מובצע":ce[t-1]:"לא זמין"})()})]}),y.jsx("div",{style:{fontSize:"14px",color:"var(--text)",lineHeight:"1.4"},children:e.message})]},e.id)}):y.jsx("div",{style:{textAlign:"center",color:"var(--muted)",fontSize:"14px",padding:"20px"},children:"אין עדכונים עדיין"})}),a()&&y.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px"},children:[y.jsx("textarea",{value:A,onChange:e=>R(e.target.value),placeholder:"הכנס עדכון או הערה על התהליך...",style:{width:"100%",minHeight:"60px",background:"transparent",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"8px",padding:"12px",color:"var(--text)",fontSize:"14px",direction:"rtl",fontFamily:"Segoe UI, sans-serif",outline:"none",resize:"vertical",lineHeight:"1.5"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 2px rgba(124,192,255,0.2)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),dt())}}),y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"12px"},children:[y.jsx("div",{style:{fontSize:"12px",color:"var(--muted)"},children:"Enter לשליחה, Shift+Enter לשורה חדשה"}),y.jsx("button",{onClick:dt,disabled:!A.trim(),style:{background:A.trim()?"linear-gradient(135deg, rgba(124,192,255,0.8), rgba(124,192,255,0.6))":"rgba(255,255,255,0.1)",border:"none",borderRadius:"8px",padding:"8px 16px",color:A.trim()?"white":"var(--muted)",fontSize:"14px",fontWeight:"600",cursor:A.trim()?"pointer":"not-allowed",transition:"all 0.2s ease",direction:"rtl"},onMouseEnter:e=>{A.trim()&&(e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(124,192,255,0.4)")},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="none"},children:"שלח עדכון"})]})]})]})]})]})]})}),ue&&y.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)",zIndex:1100,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>xe(!1),children:y.jsxs("div",{style:{background:"radial-gradient(1200px 800px at 50% 50%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 50% 50%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"20px",padding:"32px",maxWidth:"500px",width:"90%",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",backdropFilter:"blur(12px)",direction:"rtl"},onClick:e=>e.stopPropagation(),children:[y.jsxs("div",{style:{textAlign:"center",marginBottom:"24px"},children:[y.jsx("h3",{style:{color:"var(--accent)",fontSize:"24px",fontWeight:"600",margin:"0 0 8px 0"},children:"הגדרות התראות"}),y.jsx("p",{style:{color:"var(--muted)",fontSize:"14px",margin:0},children:'בחר איך תרצה לקבל עדכונים על סג"ח זה'})]}),y.jsxs("div",{style:{marginBottom:"24px"},children:[y.jsx("h4",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",margin:"0 0 12px 0"},children:"איך תרצה לקבל עדכונים?"}),y.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[y.jsx("button",{onClick:()=>he("email"),style:{background:"email"===me?"linear-gradient(135deg, rgba(124,192,255,0.8), rgba(124,192,255,0.6))":"rgba(255,255,255,0.08)",border:"1px solid "+("email"===me?"rgba(124,192,255,0.8)":"rgba(255,255,255,0.2)"),borderRadius:"12px",padding:"12px 20px",color:"email"===me?"white":"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",flex:"1",minWidth:"120px"},children:"📧 מייל"}),y.jsx("button",{onClick:()=>he("whatsapp"),style:{background:"whatsapp"===me?"linear-gradient(135deg, rgba(49, 10, 244, 0.8), rgba(49, 19, 245, 0.6))":"rgba(255,255,255,0.08)",border:"1px solid "+("whatsapp"===me?"rgba(13, 27, 224, 0.8)":"rgba(255,255,255,0.2)"),borderRadius:"12px",padding:"12px 20px",color:"whatsapp"===me?"white":"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",flex:"1",minWidth:"120px"},children:"💬 HiChat"})]})]}),y.jsxs("div",{style:{marginBottom:"32px"},children:[y.jsx("h4",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",margin:"0 0 12px 0"},children:"באיזו תדירות?"}),y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[y.jsx("button",{onClick:()=>be("status_change"),style:{background:"status_change"===fe?"linear-gradient(135deg, rgba(124,192,255,0.8), rgba(124,192,255,0.6))":"rgba(255,255,255,0.08)",border:"1px solid "+("status_change"===fe?"rgba(124,192,255,0.8)":"rgba(255,255,255,0.2)"),borderRadius:"12px",padding:"12px 16px",color:"status_change"===fe?"white":"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",textAlign:"right"},children:"🔄 רק כשמשתנה סטטוס"}),y.jsx("button",{onClick:()=>be("weekly"),style:{background:"weekly"===fe?"linear-gradient(135deg, rgba(255,152,0,0.8), rgba(255,152,0,0.6))":"rgba(255,255,255,0.08)",border:"1px solid "+("weekly"===fe?"rgba(255,152,0,0.8)":"rgba(255,255,255,0.2)"),borderRadius:"12px",padding:"12px 16px",color:"weekly"===fe?"white":"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",textAlign:"right"},children:"📅 שבועי"}),y.jsx("button",{onClick:()=>be("daily"),style:{background:"daily"===fe?"linear-gradient(135deg, rgba(233,30,99,0.8), rgba(233,30,99,0.6))":"rgba(255,255,255,0.08)",border:"1px solid "+("daily"===fe?"rgba(233,30,99,0.8)":"rgba(255,255,255,0.2)"),borderRadius:"12px",padding:"12px 16px",color:"daily"===fe?"white":"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",textAlign:"right"},children:"🌅 יומי"})]})]}),y.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[y.jsxs("button",{onClick:()=>c(e,null,function*(){if(L){ve(!0);try{yield new Promise(e=>setTimeout(e,600));const e=(null==o?void 0:o.id)||"current_user",t=(null==o?void 0:o.name)||"משתמש",r=w(L,e,t,me,fe);x(L.id,r),F(r),xe(!1),nt("התראות הוגדרו בהצלחה דרך "+("email"===me?"מייל":"וואטסאפ"),"success")}catch(e){console.error("Error setting up notifications:",e),nt("שגיאה בהגדרת התראות","warning")}finally{ve(!1)}}}),disabled:ye,style:d(l({},j.primary),{background:ye?"linear-gradient(135deg, rgba(76,175,80,0.4), rgba(76,175,80,0.3))":"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",color:"white",cursor:ye?"not-allowed":"pointer",opacity:ye?.7:1}),children:[ye?y.jsx("div",{style:{width:"16px",height:"16px",border:"2px solid transparent",borderTop:"2px solid currentColor",borderRadius:"50%",animation:"spin 1s linear infinite"}}):"✅",ye?"מגדיר התראות...":"אשר והפעל התראות"]}),y.jsx("button",{onClick:()=>xe(!1),style:d(l({},j.primary),{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"var(--text)"}),children:"ביטול"})]})]})}),Se&&y.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)",zIndex:1200,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>{Ce||(ke(!1),ze({name:"",description:"",provider:"",arena:[],priority:"בינוני",sagachType:""}))},children:y.jsxs("div",{style:{background:"radial-gradient(1200px 800px at 50% 50%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 50% 50%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"20px",padding:"32px",maxWidth:"600px",width:"90%",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",backdropFilter:"blur(12px)",direction:"rtl"},onClick:e=>e.stopPropagation(),children:[y.jsxs("div",{style:{textAlign:"center",marginBottom:"32px"},children:[y.jsx("h3",{style:{color:"var(--accent)",fontSize:"28px",fontWeight:"700",margin:"0 0 12px 0"},children:'יצירת סג"ח חדש'}),y.jsx("p",{style:{color:"var(--muted)",fontSize:"16px",margin:0},children:'מלא את הפרטים הדרושים ליצירת הסג"ח החדש'})]}),y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px",marginBottom:"32px"},children:[y.jsxs("div",{children:[y.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:'שם הסג"ח *'}),y.jsx("input",{type:"text",value:Te.name,onChange:e=>ze(t=>d(l({},t),{name:e.target.value})),placeholder:"הכנס שם לסג'ח החדש...",disabled:Ce,style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",opacity:Ce?.6:1,cursor:Ce?"not-allowed":"text",boxSizing:"border-box"},onFocus:e=>{Ce||(e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)")},onBlur:e=>{Ce||(e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none")}})]}),y.jsxs("div",{children:[y.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:"תיאור *"}),y.jsx("textarea",{value:Te.description,onChange:e=>ze(t=>d(l({},t),{description:e.target.value})),placeholder:"הכנס תיאור מפורט לסג'ח...",disabled:Ce,rows:3,style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",resize:"vertical",minHeight:"80px",opacity:Ce?.6:1,cursor:Ce?"not-allowed":"text",boxSizing:"border-box"},onFocus:e=>{Ce||(e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)")},onBlur:e=>{Ce||(e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none")}})]}),y.jsxs("div",{children:[y.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:'סוג הסג"ח'}),y.jsx("input",{type:"text",value:Te.sagachType,onChange:e=>ze(t=>d(l({},t),{sagachType:e.target.value})),placeholder:"הכנס סוג הסג'ח (אופציונלי)...",disabled:Ce,style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",opacity:Ce?.6:1,cursor:Ce?"not-allowed":"text",boxSizing:"border-box"},onFocus:e=>{Ce||(e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)")},onBlur:e=>{Ce||(e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none")}})]}),y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"16px"},children:[y.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),children:[y.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:"ספק *"}),y.jsx("input",{type:"text",value:Te.provider,onChange:e=>ze(t=>d(l({},t),{provider:e.target.value})),placeholder:"שם הספק...",disabled:Ce,style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",opacity:Ce?.6:1,cursor:Ce?"not-allowed":"text",boxSizing:"border-box"},onFocus:e=>{Ce||(e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)")},onBlur:e=>{Ce||(e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none")}})]}),y.jsxs("div",{children:[y.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:"זירה *"}),y.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[y.jsxs("button",{type:"button",disabled:Ce,onClick:()=>ge(e=>!e),style:{appearance:"none",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.08)",borderRadius:"12px",color:Ce?"rgba(255,255,255,0.5)":"#ffffff",padding:"12px 16px",cursor:Ce?"not-allowed":"pointer",fontSize:"14px",direction:"rtl",outline:"none",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",fontFamily:"Segoe UI, sans-serif",opacity:Ce?.6:1,boxSizing:"border-box"},children:[y.jsx("span",{style:{textAlign:"right",flex:1},children:0===Te.arena.length?"בחר זירות...":Te.arena.join(", ")}),y.jsx("span",{style:{marginLeft:"8px",fontSize:"12px"},children:"▼"})]}),ae&&y.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",zIndex:1e3,boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",overflow:"hidden",maxHeight:"200px",overflowY:"auto"},children:J.map(e=>y.jsxs("div",{onClick:t=>{if(t.stopPropagation(),!Ce){const t=Te.arena.includes(e);ze(r=>d(l({},r),{arena:t?r.arena.filter(t=>t!==e):[...r.arena,e]}))}},style:{padding:"10px 16px",cursor:Ce?"not-allowed":"pointer",transition:"background 0.2s ease",direction:"rtl",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"space-between",background:Te.arena.includes(e)?"rgba(124,192,255,0.15)":"transparent",color:Ce?"rgba(255,255,255,0.5)":"var(--text)"},onMouseEnter:e=>{Ce||(e.currentTarget.style.background="rgba(124,192,255,0.15)")},onMouseLeave:t=>{Ce||Te.arena.includes(e)||(t.currentTarget.style.background="transparent")},children:[y.jsx("span",{children:e}),Te.arena.includes(e)&&y.jsx("span",{style:{color:"var(--accent)",fontSize:"12px"},children:"✓"})]},`new-arena-${e}`))})]})]}),y.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[y.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:"תעדוף *"}),y.jsxs("button",{type:"button",onClick:e=>{e.stopPropagation(),Ce||te(e=>!e)},style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",opacity:Ce?.6:1,cursor:Ce?"not-allowed":"pointer",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"space-between"},disabled:Ce,onMouseEnter:e=>{Ce||(e.currentTarget.style.borderColor="rgba(124,192,255,0.6)",e.currentTarget.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)")},onMouseLeave:e=>{Ce||(e.currentTarget.style.borderColor="rgba(255,255,255,0.2)",e.currentTarget.style.boxShadow="none")},children:[y.jsx("span",{children:Te.priority}),y.jsx("span",{style:{fontSize:"12px",marginLeft:"8px"},children:"▼"})]}),ee&&y.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",zIndex:1e3,boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",overflow:"hidden"},children:le.map(e=>y.jsxs("div",{onClick:t=>{t.stopPropagation(),ze(t=>d(l({},t),{priority:e})),te(!1)},style:{padding:"10px 16px",cursor:"pointer",transition:"background 0.2s ease",direction:"rtl",color:"var(--text)",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"space-between",background:Te.priority===e?"rgba(124,192,255,0.15)":"transparent"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(124,192,255,0.15)"},onMouseLeave:t=>{Te.priority!==e&&(t.currentTarget.style.background="transparent")},children:[y.jsx("span",{children:e}),"TOP"===e&&y.jsx("span",{style:{fontSize:"12px",color:"var(--accent)"},children:"🔥"})]},e))})]})]})]}),y.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[y.jsxs("button",{onClick:()=>c(e,null,function*(){if(n())if(Te.name.trim()&&Te.description.trim()&&Te.provider.trim()&&0!==Te.arena.length&&Te.priority){Ee(!0);try{yield new Promise(e=>setTimeout(e,800));const e={id:"sagach"+(g.length+1),name:Te.name.trim(),description:Te.description.trim(),provider:Te.provider.trim(),lastUpdated:oe(Ke()),arena:Te.arena,priority:Te.priority,sagachType:Te.sagachType.trim()||void 0,attachments:[],processStatus:1,processStartDate:Ke().toISOString().split("T")[0],estimatedCompletion:"-",contactPerson:"",notes:"",notifications:!1,statusUpdates:[{id:Date.now().toString(),message:`נוצר סג"ח חדש: "${Te.name.trim()}" • ספק: ${Te.provider.trim()} • זירות: ${Te.arena.join(", ")}${Te.sagachType.trim()?` • סוג: ${Te.sagachType.trim()}`:""}`,timestamp:Ke().toISOString(),type:"system",processStatus:1,author:(null==o?void 0:o.name)||"משתמש"}],phaseData:{1:{currentEntry:{startDate:Ke().toISOString().split("T")[0],timeSpentDays:0},totalTimeSpentDays:0},2:{},3:{},4:{},5:{},6:{},7:{}}};console.log("🆕 Creating new sagach:",e.name),u(e),ze({name:"",description:"",provider:"",arena:[],priority:"בינוני",sagachType:""}),ke(!1),F(e),nt('סג"ח חדש נוצר בהצלחה',"success")}catch(e){console.error("Error creating sagach:",e),nt('שגיאה ביצירת הסג"ח',"warning")}finally{Ee(!1)}}else alert("יש למלא את כל השדות הדרושים");else window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:'אין לך הרשאה ליצור סג"חים חדשים',type:"error",durationMs:3e3}}))}),disabled:Ce,style:d(l({},j.primary),{background:Ce?"linear-gradient(135deg, rgba(76,175,80,0.4), rgba(76,175,80,0.3))":"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",color:"white",fontSize:"16px",padding:"14px 28px",cursor:Ce?"not-allowed":"pointer",opacity:Ce?.7:1}),children:[Ce?y.jsx("div",{style:{width:"18px",height:"18px",border:"2px solid transparent",borderTop:"2px solid currentColor",borderRadius:"50%",animation:"spin 1s linear infinite"}}):"✅",Ce?'יוצר סג"ח...':'צור סג"ח']}),y.jsx("button",{onClick:()=>{Ce||(ke(!1),ze({name:"",description:"",provider:"",arena:[],priority:"בינוני",sagachType:""}))},disabled:Ce,style:d(l({},j.primary),{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"var(--text)",fontSize:"16px",padding:"14px 28px",cursor:Ce?"not-allowed":"pointer",opacity:Ce?.5:1}),children:"ביטול"})]})]})}),De.isVisible&&y.jsxs("div",{style:{position:"fixed",bottom:"30px",left:"50%",transform:"translateX(-50%)",background:"success"===De.type?"linear-gradient(135deg, rgba(76,175,80,0.95), rgba(76,175,80,0.85))":"warning"===De.type?"linear-gradient(135deg, rgba(255,152,0,0.95), rgba(255,152,0,0.85))":"linear-gradient(135deg, rgba(33,150,243,0.95), rgba(33,150,243,0.85))",border:"1px solid "+("success"===De.type?"rgba(76,175,80,0.8)":"warning"===De.type?"rgba(255,152,0,0.8)":"rgba(33,150,243,0.8)"),borderRadius:"25px",padding:"12px 24px",color:"white",fontSize:"14px",fontWeight:"600",fontFamily:"Segoe UI, sans-serif",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",backdropFilter:"blur(12px)",zIndex:2e3,display:"flex",alignItems:"center",gap:"8px",direction:"rtl",minWidth:"200px",justifyContent:"center",animation:De.isVisible?"slideUpFadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1)":"slideDownFadeOut 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:[y.jsx("span",{style:{fontSize:"16px"},children:"success"===De.type?"✅":"warning"===De.type?"⚠️":"ℹ️"}),De.message]}),y.jsx("style",{children:"\n        @keyframes slideUpFadeIn {\n          0% {\n            opacity: 0;\n            transform: translateX(-50%) translateY(20px);\n          }\n          100% {\n            opacity: 1;\n            transform: translateX(-50%) translateY(0);\n          }\n        }\n        \n        @keyframes slideDownFadeOut {\n          0% {\n            opacity: 1;\n            transform: translateX(-50%) translateY(0);\n          }\n          100% {\n            opacity: 0;\n            transform: translateX(-50%) translateY(20px);\n          }\n        }\n      "})]})});function ue({schemas:e}){var t,r;const[n,i]=p.useState(""),[a,o]=p.useState(null),[s,l]=p.useState("all"),[d,c]=p.useState(!1),[g,u]=p.useState(0),[x,m]=p.useState("all"),[h,f]=p.useState(!1),b=p.useRef(null),v=p.useRef(null),w=p.useRef(null);p.useEffect(()=>{const e=e=>{const t=e.target;t.closest(".action-dropdown")||t.closest(".schema-dropdown")||(b.current&&!b.current.contains(t)&&c(!1),w.current&&!w.current.contains(t)&&f(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const j=p.useMemo(()=>{const t=[];try{Object.entries(e).forEach(([e,r])=>{t.push(...function(e,t,r){const n=[],i=(r,a,o)=>{try{const s=Array.isArray(null==r?void 0:r.type)?r.type[0]:null==r?void 0:r.type;if("object"===s&&(null==r?void 0:r.properties)&&"object"==typeof r.properties){const e=Array.isArray(null==r?void 0:r.required)?r.required:[],t=new Set(e);for(const[n,o]of Object.entries(r.properties))i(o,[...a,String(n)],t.has(String(n)))}else if("array"===s&&(null==r?void 0:r.items))i(r.items,[...a,"item"],o);else{const i=a[a.length-1]||t,l=a.join(".");if(l){const a=[];o&&a.push("required"),"string"==typeof(null==r?void 0:r.pattern)&&a.push(`pattern: ${r.pattern}`),"string"==typeof(null==r?void 0:r.format)&&a.push(`format: ${r.format}`),"number"==typeof(null==r?void 0:r.minLength)&&a.push(`minLength: ${r.minLength}`),"number"==typeof(null==r?void 0:r.maxLength)&&a.push(`maxLength: ${r.maxLength}`),"number"==typeof(null==r?void 0:r.minimum)&&a.push(`minimum: ${r.minimum}`),"number"==typeof(null==r?void 0:r.maximum)&&a.push(`maximum: ${r.maximum}`),Array.isArray(null==r?void 0:r.enum)&&a.push(`enum: ${r.enum.join(", ")}`),n.push({id:`${e}:${l}`,schemaKey:e,schemaTitle:t,path:l,name:i,type:s||void 0,description:"string"==typeof(null==r?void 0:r.description)?r.description:void 0,rules:a.length?a:void 0})}}}catch(s){console.error("Failed to traverse schema at path:",a.join("."),s)}};return i(r,[t],!1),n}(e,r.title||e,r.schema))})}catch(r){console.error("Failed to flatten schemas:",r)}return t.sort((e,t)=>e.schemaTitle.localeCompare(t.schemaTitle)||e.path.localeCompare(t.path))},[e]),S=p.useMemo(()=>{let e=j;x&&"all"!==x&&(e=e.filter(e=>e.schemaKey===x)),"fields"===s?e=e.filter(e=>e.path.split(".").length>2):"hierarchies"===s&&(e=e.filter(e=>e.path.split(".").length<=2));const t=n.trim().toLowerCase();return t?e.filter(e=>e.path.toLowerCase().includes(t)||e.name.toLowerCase().includes(t)||e.schemaTitle.toLowerCase().includes(t)||!!e.type&&e.type.toLowerCase().includes(t)||!!e.description&&e.description.toLowerCase().includes(t)):e},[j,n,s,x]);return p.useEffect(()=>{const e=e=>{if(0!==S.length)switch(e.key){case"ArrowDown":e.preventDefault(),u(e=>Math.min(e+1,S.length-1));break;case"ArrowUp":e.preventDefault(),u(e=>Math.max(e-1,0));break;case"Home":e.preventDefault(),u(0);break;case"End":e.preventDefault(),u(S.length-1);break;case"Enter":e.preventDefault(),S[g]&&(console.log("Enter pressed - clearing old selection and setting new one"),o(null),setTimeout(()=>{o(S[g]),u(g)},10))}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[S,g]),p.useEffect(()=>{v.current&&v.current.scrollIntoView({behavior:"smooth",block:"nearest"})},[g]),p.useEffect(()=>{console.log("Selected state changed to:",(null==a?void 0:a.id)||"null")},[a]),y.jsxs(y.Fragment,{children:[y.jsx("aside",{className:"value-panel",dir:"rtl",style:{background:"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:"1px solid rgba(255,255,255,0.12)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 20px 60px rgba(0,0,0,0.35)"},children:y.jsxs("div",{className:"value-panel-inner",children:[y.jsxs("div",{className:"value-search",children:[y.jsxs("div",{className:"schema-selector",ref:w,style:{marginBottom:"12px",width:"100%"},children:[y.jsxs("button",{className:"btn ghost "+(x?"":"is-placeholder"),onClick:()=>f(!h),style:{width:"100%"},children:["all"===x?"כל התקנים":x&&e[x]?e[x].title:y.jsx("span",{className:"schema-placeholder",dir:"rtl",children:"בחר תקן"}),y.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),h&&y.jsxs("div",{className:"schema-dropdown",children:[y.jsx("div",{className:"schema-option",onClick:()=>{m("all"),f(!1)},children:"כל התקנים"}),Object.entries(e).map(([e,t])=>y.jsx("div",{className:"schema-option",onClick:()=>{m(e),f(!1)},children:t.title},e))]})]}),y.jsxs("div",{className:"value-search-row",children:[y.jsx("input",{type:"text",placeholder:"חפש לפי שם/תיאור/היררכיה...",value:n,onChange:e=>i(e.target.value),className:"value-search-input"}),y.jsxs("div",{className:"value-filter-dropdown",ref:b,children:[y.jsxs("button",{className:"btn",onClick:()=>c(!d),children:[y.jsx("span",{children:"⏷"}),y.jsx("span",{children:"all"===s?"הכל":"fields"===s?"רק שדות בסיסיים":"רק היררכיות"})]}),d&&y.jsxs("div",{className:"value-filter-options",children:[y.jsx("div",{className:"value-filter-option "+("all"===s?"active":""),onClick:()=>{l("all"),c(!1)},children:"הכל"}),y.jsx("div",{className:"value-filter-option "+("fields"===s?"active":""),onClick:()=>{l("fields"),c(!1)},children:"רק שדות בסיסיים"}),y.jsx("div",{className:"value-filter-option "+("hierarchies"===s?"active":""),onClick:()=>{l("hierarchies"),c(!1)},children:"רק היררכיות"})]})]})]})]}),y.jsx("div",{className:"value-list custom-scrollbar",role:"list",children:S.map((e,t)=>y.jsx("button",{ref:t===g?v:null,className:`value-item ${t===g?"selected":""} ${(null==a?void 0:a.id)===e.id?"clicked":""}`,role:"listitem",title:`${e.schemaTitle} / ${e.path}`,onClick:()=>{o(e),u(-1)},children:y.jsxs("div",{className:"value-row",children:[y.jsx("span",{className:"value-hierarchy",children:(()=>{const t=e.path.split(".");return t.length<=2?"":t.slice(1,t.length-1).join(".")})()}),y.jsx("span",{className:"value-name",children:e.name})]})},e.id))})]})}),y.jsxs("section",{className:"value-detail-panel dictionary-box",dir:"rtl",style:{background:"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:"1px solid rgba(255,255,255,0.12)",overflow:"auto",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 20px 60px rgba(0,0,0,0.35)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",textAlign:"center"},children:[y.jsxs("div",{className:"value-detail-headline",style:{fontSize:"80px !important",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",textAlign:"center"},children:[y.jsx("div",{}),y.jsx("div",{className:"value-detail-path "+(a?"selected":""),style:{fontSize:a?"40px !important":"35px !important",fontWeight:a?"700":"400",color:a?"rgb(19, 124, 223)":"var(--muted)",textDecoration:a?"underline":"none",borderBottom:"none",paddingBottom:"0px"},children:a?(()=>{const e=a.path.split(".");return e.length<=2?a.name:`${e.slice(1,e.length-1).join(" -> ")} -> ${a.name}`})():"-"})]}),y.jsx("hr",{style:{width:"75%",marginBottom:"20px",height:"0px"}}),y.jsxs("div",{className:"value-detail-body",style:{fontSize:"40px !important",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",textAlign:"center"},children:[y.jsxs("div",{className:"detail-row",children:[y.jsx("span",{className:"k",style:{fontSize:"60px !important",color:"var(--muted) !important"},children:"מהות השדה:"}),y.jsx("span",{className:"v",style:{fontSize:"2px !important",color:"var(--text) !important"},children:(null==a?void 0:a.description)||"-"})]}),y.jsxs("div",{className:"detail-row",children:[y.jsx("span",{className:"k",style:{color:"var(--muted) !important"},children:"סוג השדה:"}),y.jsx("span",{className:"v",style:{fontSize:"26px !important",color:"var(--text) !important"},children:(null==a?void 0:a.type)||"-"})]}),y.jsxs("div",{className:"detail-row",children:[y.jsx("span",{className:"k",style:{fontSize:"26px !important",color:"var(--muted) !important"},children:"האם שדה חובה:"}),y.jsx("span",{className:"v",style:{fontSize:"26px !important",color:"var(--text) !important"},children:(null==(t=null==a?void 0:a.rules)?void 0:t.some(e=>"required"===e))?"כן":"-"})]}),y.jsxs("div",{className:"detail-row",children:[y.jsx("span",{className:"k",style:{fontSize:"26px !important",color:"var(--muted) !important"},children:'דג"ח/רשימה סגורה:'}),y.jsx("span",{className:"v",style:{fontSize:"26px !important",color:"var(--text) !important"},children:(null==(r=null==a?void 0:a.rules)?void 0:r.find(e=>e.startsWith("enum")))?(()=>{const e=a.rules.find(e=>e.startsWith("enum"));if(e){const t=e.replace("enum: ","").split(", ");return y.jsx("div",{className:"enum-values",style:{fontSize:"26px !important"},children:t.map((e,t)=>y.jsx("div",{className:"enum-value",style:{fontSize:"26px !important"},children:e},t))})}return"-"})():"-"})]}),y.jsxs("div",{className:"detail-row",children:[y.jsx("span",{className:"k",style:{fontSize:"26px !important",color:"var(--muted) !important"},children:"חוקים:"}),y.jsx("span",{className:"v",style:{fontSize:"26px !important",color:"var(--text) !important"},children:(null==a?void 0:a.rules)&&a.rules.length?a.rules.join(" | "):"-"})]}),y.jsxs("div",{className:"detail-row",children:[y.jsx("span",{className:"k",style:{fontSize:"26px !important",color:"var(--muted) !important"},children:"בשימוש במשפחות:"}),y.jsx("span",{className:"v",style:{fontSize:"26px !important",color:"var(--text) !important"},children:a?(()=>{const e=new Set;return j.forEach(t=>{t.name===a.name&&t.path.split(".").slice(1,-1).join(".")===a.path.split(".").slice(1,-1).join(".")&&e.add(t.schemaTitle)}),Array.from(e).sort().join(", ")||"-"})():"-"})]})]})]})]})}ge.displayName="SagachimStatus";const xe=["ממתין לבשלות בצד ספק",'ממתין לקבלת דג"ח והתנעה',"בתהליכי אפיון","ממתין לאינטגרציות","אינטגרציות","מבצוע","מובצע"],me=e=>!e||isNaN(e.getTime())?"תאריך לא זמין":`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`,he=e=>{if(!e)return"תאריך לא זמין";try{const t=new Date(e);return isNaN(t.getTime())?"תאריך לא זמין":me(t)}catch(t){return"תאריך לא זמין"}},fe=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]},be=({isOpen:e,onClose:t,sagach:r})=>{var n;const[i,a]=p.useState("overview"),o=p.useMemo(()=>{if(!(null==r?void 0:r.processStartDate)||!(null==r?void 0:r.completionDate))return 0;const e=new Date(r.processStartDate),t=new Date(r.completionDate);return Math.ceil((t.getTime()-e.getTime())/864e5)},[r]),s=p.useMemo(()=>{if(!r)return[];const e=[];if(r.phaseData&&(Object.entries(r.phaseData).forEach(([t,r])=>{const n=parseInt(t);n>=1&&n<=7&&r.entries&&r.entries.forEach(t=>{t.timeSpentDays>0&&e.push({phase:n,phaseName:xe[n-1],startDate:t.startDate,endDate:t.completionDate||t.startDate,duration:t.timeSpentDays,isBacktrack:!1})})}),e.length>0))return e;if(!r.statusUpdates||0===r.statusUpdates.length){const t=r.processStartDate||r.lastUpdated,n=r.completionDate||r.lastUpdated,i=Math.ceil((new Date(n).getTime()-new Date(t).getTime())/864e5);return i>0&&e.push({phase:r.processStatus,phaseName:xe[r.processStatus-1],startDate:t,endDate:n,duration:i,isBacktrack:!1}),e}const t=[...r.statusUpdates].filter(e=>"status_change"===e.type&&e.oldStatus&&e.newStatus).sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime());let n=1,i=r.processStartDate||r.lastUpdated;for(let r=0;r<t.length;r++){const a=t[r];if(a.oldStatus&&a.newStatus){const t=a.timestamp,r=new Date(i),o=new Date(t),s=Math.ceil((o.getTime()-r.getTime())/864e5);s>0&&e.push({phase:a.oldStatus,phaseName:xe[a.oldStatus-1],startDate:i,endDate:t,duration:s,isBacktrack:a.oldStatus>a.newStatus}),n=a.newStatus,i=t}}const a=r.completionDate||r.lastUpdated,o=new Date(i),s=new Date(a),l=Math.ceil((s.getTime()-o.getTime())/864e5);return l>0&&e.push({phase:n,phaseName:xe[n-1],startDate:i,endDate:a,duration:l,isBacktrack:!1}),e},[r]),l=p.useMemo(()=>{const e={};for(let r=1;r<=7;r++)e[r]={totalDays:0,visits:0,avgDays:0,returns:0};const t={};return s.forEach(r=>{r.phase>=1&&r.phase<=7&&(e[r.phase].totalDays+=r.duration||0,e[r.phase].visits+=1,t[r.phase]=(t[r.phase]||0)+1)}),Object.keys(e).forEach(r=>{const n=parseInt(r),i=t[n]||0;i>0?(e[n].avgDays=e[n].totalDays/e[n].visits,e[n].returns=Math.max(0,i-1)):(e[n].avgDays=0,e[n].returns=0)}),e},[s]),d=p.useMemo(()=>(null==r?void 0:r.statusUpdates)?[...r.statusUpdates].sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()):[],[r]);return e&&r?y.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"20px",fontFamily:"Segoe UI, sans-serif"},children:y.jsxs("div",{style:{background:"var(--panel)",borderRadius:"20px",width:"100%",maxWidth:"1200px",maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",backdropFilter:"blur(20px)"},children:[y.jsxs("div",{style:{padding:"24px 32px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[y.jsxs("div",{children:[y.jsxs("h2",{style:{fontSize:"24px",fontWeight:"700",color:"var(--text)",margin:"0 0 8px 0",textAlign:"right"},children:["אנליטיקות: ",r.name]}),y.jsxs("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0",textAlign:"right"},children:[r.provider," • ",r.arena.join(", ")]})]}),y.jsx("button",{onClick:t,style:{background:"none",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:"24px",padding:"8px",borderRadius:"8px",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.1)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]}),y.jsx("div",{style:{display:"flex",borderBottom:"1px solid rgba(255,255,255,0.1)",direction:"rtl"},children:[{id:"overview",label:"סקירה כללית"},{id:"timeline",label:"ציר זמן"},{id:"chat",label:"עדכוני סטטוס"},{id:"files",label:"קבצים"}].map(e=>y.jsx("button",{onClick:()=>a(e.id),style:{padding:"16px 24px",background:"none",border:"none",color:i===e.id?"var(--text)":"var(--muted)",cursor:"pointer",fontSize:"14px",fontWeight:"600",borderBottom:i===e.id?"2px solid #4CAF50":"2px solid transparent",transition:"all 0.2s ease",direction:"rtl"},children:e.label},e.id))}),y.jsxs("div",{style:{flex:1,overflow:"auto",padding:"24px 32px"},children:["overview"===i&&y.jsxs("div",{style:{direction:"rtl"},children:[y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"20px",marginBottom:"32px"},children:[y.jsxs("div",{style:{background:"rgba(76,175,80,0.1)",border:"1px solid rgba(76,175,80,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[y.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#4CAF50",marginBottom:"8px"},children:o}),y.jsx("div",{style:{fontSize:"14px",color:"var(--muted)"},children:"ימים כוללים"})]}),y.jsxs("div",{style:{background:"rgba(33,150,243,0.1)",border:"1px solid rgba(33,150,243,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[y.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#2196F3",marginBottom:"8px"},children:s.length}),y.jsx("div",{style:{fontSize:"14px",color:"var(--muted)"},children:"שלבים בתהליך"})]}),y.jsxs("div",{style:{background:"rgba(255,152,0,0.1)",border:"1px solid rgba(255,152,0,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[y.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#FF9800",marginBottom:"8px"},children:Object.values(l).reduce((e,t)=>e+t.returns,0)}),y.jsx("div",{style:{fontSize:"14px",color:"var(--muted)"},children:"חזרות לשלבים"})]}),y.jsxs("div",{style:{background:"rgba(156,39,176,0.1)",border:"1px solid rgba(156,39,176,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[y.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#9C27B0",marginBottom:"8px"},children:(null==(n=r.statusUpdates)?void 0:n.length)||0}),y.jsx("div",{style:{fontSize:"14px",color:"var(--muted)"},children:"עדכוני סטטוס"})]})]}),y.jsxs("div",{children:[y.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"var(--text)",margin:"0 0 16px 0",textAlign:"right"},children:"סטטיסטיקות שלבים"}),y.jsxs("div",{style:{display:"grid",gap:"12px"},children:[Object.entries(l).filter(([e,t])=>t.visits>0).map(([e,t])=>y.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[y.jsxs("div",{style:{textAlign:"right"},children:[y.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text)",marginBottom:"4px"},children:xe[parseInt(e)-1]}),y.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)"},children:[t.returns," חזרה",t.returns>1?"ות":""]})]}),y.jsxs("div",{style:{textAlign:"left"},children:[y.jsxs("div",{style:{fontSize:"18px",fontWeight:"700",color:"#4CAF50"},children:[t.totalDays," ימים"]}),y.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)"},children:["ממוצע: ",t.avgDays.toFixed(1)," ימים"]})]})]},e)),Object.values(l).every(e=>0===e.visits)&&y.jsx("div",{style:{textAlign:"center",padding:"40px",color:"var(--muted)",fontSize:"14px"},children:"אין נתונים זמינים על שלבי התהליך"})]})]})]}),"timeline"===i&&y.jsxs("div",{style:{direction:"rtl"},children:[y.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"var(--text)",margin:"0 0 24px 0",textAlign:"right"},children:"ציר זמן מפורט"}),y.jsx("div",{style:{position:"relative",paddingRight:"20px"},children:(()=>{const e=s.sort((e,t)=>{const r=new Date(e.endDate||e.startDate),n=new Date(t.endDate||t.startDate),i=r.getTime()-n.getTime();return 0===i?e.phase-t.phase:i}),t=new Set;return e.map((r,n)=>{const i=!t.has(r.phase);return i&&t.add(r.phase),y.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px",position:"relative"},children:[!i&&y.jsx("div",{style:{marginLeft:"8px",fontSize:"16px",color:"#FF9800",zIndex:3,position:"relative"},children:"↶"}),y.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",background:i?"#4CAF50":"#FF9800",marginLeft:i?"16px":"8px",flexShrink:0,position:"relative",zIndex:2}}),n<e.length-1&&y.jsx("div",{style:{position:"absolute",right:"5px",top:"12px",width:"2px",height:"16px",background:"rgba(255,255,255,0.2)",zIndex:1}}),y.jsxs("div",{style:{flex:1,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px",marginRight:"8px"},children:[y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[y.jsxs("div",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text)"},children:[r.phaseName,!i&&y.jsx("span",{style:{fontSize:"12px",color:"#FF9800",marginRight:"8px"},children:"(חזרה)"})]}),y.jsxs("div",{style:{fontSize:"14px",fontWeight:"700",color:"#4CAF50"},children:[r.duration," ימים"]})]}),y.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",display:"flex",gap:"16px"},children:[y.jsxs("span",{children:["התחלה: ",me(new Date(r.startDate))]}),r.endDate&&y.jsxs("span",{children:["סיום: ",me(new Date(r.endDate))]})]})]})]},n)})})()})]}),"chat"===i&&y.jsxs("div",{style:{direction:"rtl"},children:[y.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"var(--text)",margin:"0 0 24px 0",textAlign:"right"},children:"עדכוני סטטוס"}),y.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"12px"},children:d.map((e,t)=>y.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px"},children:[y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[y.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"var(--text)"},children:e.author||"מערכת"}),y.jsx("div",{style:{fontSize:"12px",color:"var(--muted)"},children:he(e.timestamp)})]}),y.jsx("div",{style:{fontSize:"14px",color:"var(--text)",lineHeight:"1.5",marginBottom:"8px"},children:e.message}),"status_change"===e.type&&e.oldStatus&&e.newStatus&&y.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",background:"rgba(255,255,255,0.05)",padding:"8px 12px",borderRadius:"8px",display:"inline-block"},children:[xe[e.oldStatus-1]," → ",xe[e.newStatus-1]]})]},e.id||t))})]}),"files"===i&&y.jsxs("div",{style:{direction:"rtl"},children:[y.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"var(--text)",margin:"0 0 24px 0",textAlign:"right"},children:"קבצים רלוונטיים"}),r.attachments&&r.attachments.length>0?y.jsx("div",{style:{display:"grid",gap:"12px"},children:r.attachments.map(e=>y.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[y.jsxs("div",{children:[y.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"var(--text)",marginBottom:"4px"},children:e.name}),y.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)"},children:[fe(e.size)," • ",me(new Date(e.uploadDate))]})]}),y.jsx("button",{style:{padding:"8px 16px",background:"rgba(76,175,80,0.8)",border:"none",borderRadius:"8px",color:"white",fontSize:"12px",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(76,175,80,1)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(76,175,80,0.8)"},children:"הורד"})]},e.id))}):y.jsx("div",{style:{textAlign:"center",padding:"40px",color:"var(--muted)"},children:"אין קבצים רלוונטיים"})]})]})]})}):null},ye=e=>{switch(e){case 1:return"rgba(128, 128, 128, 0.8)";case 2:return"rgba(33, 150, 243, 0.8)";case 3:return"rgba(255, 152, 0, 0.8)";case 4:return"rgba(233, 30, 99, 0.8)";case 5:return"rgba(156, 39, 176, 0.8)";case 6:return"rgba(46, 125, 50, 0.8)";case 7:return"rgba(27, 94, 32, 0.8)";default:return"rgba(158, 158, 158, 0.8)"}},ve=e=>{if(!e.processStartDate||!e.completionDate)return 0;const t=new Date(e.processStartDate),r=new Date(e.completionDate);return Math.ceil((r.getTime()-t.getTime())/864e5)},we=({onBack:e})=>{const{user:t}=Y(),{sagachimStatus:r,isLoading:n,error:i}=re(),[a,o]=p.useState(""),[s,l]=p.useState(""),[d,c]=p.useState(""),[g,u]=p.useState("preset"),[x,m]=p.useState(""),[h,f]=p.useState("days"),[b,v]=p.useState(""),[w,j]=p.useState(!1),[S,k]=p.useState(!1),[C,E]=p.useState(!1),[T,z]=p.useState(!1),[D,N]=p.useState(null);p.useEffect(()=>{const e=e=>{e.target.closest("[data-dropdown-container]")||(j(!1),k(!1),E(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const I={filter:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"transparent",color:"var(--text)",borderRadius:"12px",padding:"8px 14px",cursor:"pointer",transition:"transform 120ms ease",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"right",boxShadow:"none"}},M=p.useMemo(()=>r?r.filter(e=>7===e.processStatus):[],[r]),L=p.useMemo(()=>{let e=M;if(a){const t=a.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t))}if(s&&(e=e.filter(e=>e.provider===s)),d&&(e=e.filter(e=>e.arena.includes(d))),"preset"===g&&b){const t=new Date;let r=new Date;switch(b){case"last7days":r.setDate(t.getDate()-7);break;case"last30days":r.setDate(t.getDate()-30);break;case"last3months":r.setMonth(t.getMonth()-3);break;case"last6months":r.setMonth(t.getMonth()-6);break;case"lastyear":r.setFullYear(t.getFullYear()-1)}e=e.filter(e=>{const t=e.completionDate?new Date(e.completionDate):new Date(e.lastUpdated);return t>=r&&t<=new Date&&!isNaN(t.getTime())})}else if("custom"===g&&x){const t=parseInt(x);if(!isNaN(t)){const r=new Date;let n=new Date;switch(h){case"days":n.setDate(r.getDate()-t);break;case"months":n.setMonth(r.getMonth()-t);break;case"years":n.setFullYear(r.getFullYear()-t)}e=e.filter(e=>{const t=e.completionDate?new Date(e.completionDate):new Date(e.lastUpdated);return t>=n&&t<=new Date&&!isNaN(t.getTime())})}}return e.sort((e,t)=>ve(t)-ve(e)),e},[M,a,s,d,g,b,x,h]),F=p.useMemo(()=>{if(!r)return[];const e=new Set;return r.forEach(t=>{t.provider&&e.add(t.provider)}),Array.from(e).sort()},[r]),A=p.useMemo(()=>{if(!r)return[];const e=new Set;return r.forEach(t=>{t.arena.forEach(t=>e.add(t))}),Array.from(e).sort()},[r]);return n?y.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"18px",color:"var(--text)",fontFamily:"Segoe UI, sans-serif"},children:"טוען ארכיון..."}):i?y.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"18px",color:"var(--error)",fontFamily:"Segoe UI, sans-serif"},children:["שגיאה בטעינת הארכיון: ",i]}):y.jsxs("main",{className:"app-main",style:{display:"flex",flexDirection:"column",direction:"rtl",fontFamily:"Segoe UI, sans-serif",height:"100vh",overflow:"hidden",width:"100%"},children:[y.jsx("style",{children:"\n          .archive-scroll::-webkit-scrollbar {\n            width: 8px;\n          }\n          \n          .archive-scroll::-webkit-scrollbar-track {\n            background: rgba(255, 255, 255, 0.1);\n            border-radius: 4px;\n          }\n          \n          .archive-scroll::-webkit-scrollbar-thumb {\n            background: rgba(76, 175, 80, 0.6);\n            border-radius: 4px;\n            transition: background 0.3s ease;\n          }\n          \n          .archive-scroll::-webkit-scrollbar-thumb:hover {\n            background: rgba(76, 175, 80, 0.8);\n          }\n          \n          /* For Firefox */\n          .archive-scroll {\n            scrollbar-width: thin;\n            scrollbar-color: rgba(76, 175, 80, 0.6) rgba(255, 255, 255, 0.1);\n          }\n        "}),y.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:"32px",padding:"16px 0",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[y.jsx("span",{style:{fontSize:"28px",fontWeight:"700",color:"var(--text)",margin:"0 0 8px 0",textAlign:"center"},children:'ארכיון - סג"חים מובצעים'}),y.jsx("span",{style:{fontSize:"16px",color:"var(--muted)",margin:"0 0 20px 0",textAlign:"center"},children:'עיינו בסטטיסטיקות של תהליכי ההכנסה של סג"חים שמובצעו'}),y.jsxs("span",{style:{fontSize:"16px",color:"var(--muted)",margin:"0 0 12px 0",textAlign:"center"},children:["מוצגים ",L.length," מתוך ",M.length," סגחים"]})]}),y.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px",marginBottom:"32px",alignItems:"center",width:"100%"},children:y.jsxs("div",{style:{display:"flex",gap:"16px",justifyContent:"center",flexWrap:"wrap",alignItems:"center",width:"100%"},children:[y.jsxs("div",{style:{position:"relative",minWidth:"280px",maxWidth:"400px",flex:"1 1 300px"},children:[y.jsx("input",{type:"text",placeholder:"חיפוש לפי שם...",value:a,onChange:e=>o(e.target.value),style:{width:"100%",padding:"12px 16px 12px 40px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 20px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}}),y.jsx("div",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--muted)",fontSize:"16px"},children:"🔍"})]}),y.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[y.jsxs("button",{onClick:()=>j(!w),style:I.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[y.jsx("span",{children:s||"כל הספקים"}),y.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),w&&y.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[y.jsx("div",{onClick:()=>{l(""),j(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הספקים"}),F.map(e=>y.jsx("div",{onClick:()=>{l(e),j(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),y.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[y.jsxs("button",{onClick:()=>k(!S),style:I.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[y.jsx("span",{children:d||"כל הזירות"}),y.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),S&&y.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[y.jsx("div",{onClick:()=>{c(""),k(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הזירות"}),A.map(e=>y.jsx("div",{onClick:()=>{c(e),k(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),y.jsxs("div",{style:{position:"relative",minWidth:"200px",maxWidth:"280px",flex:"0 1 200px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[y.jsxs("button",{onClick:()=>E(!C),style:I.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[y.jsx("span",{children:"preset"===g?b?"last7days"===b?"7 ימים אחרונים":"last30days"===b?"30 ימים אחרונים":"last3months"===b?"3 חודשים אחרונים":"last6months"===b?"6 חודשים אחרונים":"lastyear"===b?"שנה אחרונה":"טווח זמנים":"טווח זמנים":x?`${x} ${"days"===h?"ימים":"months"===h?"חודשים":"שנים"}`:"טווח זמנים"}),y.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),C&&y.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"300px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",padding:"8px"},children:[y.jsxs("div",{style:{marginBottom:"8px"},children:[y.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",marginBottom:"4px",textAlign:"right"},children:"טווחים מוגדרים:"}),[{value:"last7days",label:"7 ימים אחרונים"},{value:"last30days",label:"30 ימים אחרונים"},{value:"last3months",label:"3 חודשים אחרונים"},{value:"last6months",label:"6 חודשים אחרונים"},{value:"lastyear",label:"שנה אחרונה"}].map(e=>y.jsx("div",{onClick:()=>{u("preset"),v(e.value),E(!1)},style:{padding:"6px 8px",cursor:"pointer",borderRadius:"6px",transition:"background 0.2s ease",fontSize:"13px",color:"#ffffff",textAlign:"right",direction:"rtl",marginBottom:"2px"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e.label},e.value))]}),y.jsxs("div",{style:{borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:"8px"},children:[y.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",marginBottom:"4px",textAlign:"right"},children:"טווח מותאם אישית:"}),y.jsxs("div",{style:{display:"flex",gap:"4px",alignItems:"center",marginBottom:"8px"},children:[y.jsx("input",{type:"number",placeholder:"מספר",value:x,onChange:e=>m(e.target.value),style:{width:"60px",padding:"4px 6px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"6px",color:"var(--text)",fontSize:"12px",direction:"rtl",outline:"none"}}),y.jsxs("select",{value:h,onChange:e=>f(e.target.value),style:{padding:"4px 6px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"6px",color:"var(--text)",fontSize:"12px",direction:"rtl",outline:"none"},children:[y.jsx("option",{value:"days",children:"ימים"}),y.jsx("option",{value:"months",children:"חודשים"}),y.jsx("option",{value:"years",children:"שנים"})]}),y.jsx("button",{onClick:()=>{u("custom"),E(!1)},style:{padding:"4px 8px",background:"rgba(76,175,80,0.8)",border:"none",borderRadius:"6px",color:"white",fontSize:"12px",cursor:"pointer"},children:"החל"})]})]}),y.jsx("div",{onClick:()=>{v(""),m(""),u("preset"),E(!1)},style:{padding:"6px 8px",cursor:"pointer",borderRadius:"6px",transition:"background 0.2s ease",fontSize:"13px",color:"#ffffff",textAlign:"right",direction:"rtl",borderTop:"1px solid rgba(255,255,255,0.1)",marginTop:"8px",paddingTop:"8px"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"נקה סינון"})]})]})]})}),y.jsxs("div",{className:"archive-scroll",style:{display:"flex",flexDirection:"column",gap:"32px",width:"100%",padding:"0 20px 0 20px",maxHeight:"calc(100vh - 400px)",overflowY:"auto",overflowX:"hidden",direction:"rtl"},children:[y.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:"24px",justifyItems:"center",width:"100%"},children:L.map(e=>{return y.jsxs("div",{onClick:()=>(N(e),void z(!0)),style:{background:"linear-gradient(180deg, rgba(76,175,80,0.15), rgba(46,125,50,0.10))",border:"1px solid rgba(76,175,80,0.3)",borderRadius:"16px",padding:"24px",boxShadow:"0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)",backdropFilter:"blur(8px)",transition:"all 0.3s ease",cursor:"pointer",position:"relative",overflow:"hidden",width:"100%",maxWidth:"320px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-4px)",e.currentTarget.style.boxShadow="0 12px 40px rgba(76,175,80,0.3), inset 0 1px 0 rgba(76,175,80,0.15)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)"},children:[y.jsx("div",{style:{position:"absolute",top:"16px",left:"16px",background:ye(e.processStatus),color:"white",padding:"6px 12px",borderRadius:"20px",fontSize:"11px",fontWeight:"600",letterSpacing:"0.5px",direction:"rtl",textAlign:"center",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"4px"},children:"✅ מובצע"}),(()=>{const t=ve(e);return t>0?y.jsxs("div",{style:{position:"absolute",top:"16px",right:"16px",background:(r=t,r<=14?"#4CAF50":r<=30?"#FF9800":"#F44336"),color:"white",padding:"6px 12px",borderRadius:"20px",fontSize:"11px",fontWeight:"600",letterSpacing:"0.5px",direction:"rtl",textAlign:"center",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[t," ימים"]}):null;var r})(),y.jsxs("div",{style:{marginTop:"40px",direction:"rtl"},children:[y.jsx("h3",{style:{fontSize:"24px",fontWeight:"700",color:"var(--text)",margin:"0 0 12px 0",lineHeight:"1.3"},children:e.name}),y.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0 0 16px 0",lineHeight:"1.5",minHeight:"42px",whiteSpace:"pre-wrap",direction:"rtl",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e.description}),y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"16px"},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[y.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"ספק:"}),y.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.provider})]}),y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[y.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"זירה:"}),y.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.arena.join(", ")})]}),e.completionDate&&y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[y.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"הושלם:"}),y.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:(t=new Date(e.completionDate),`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`)})]}),e.contactPerson&&y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[y.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"איש קשר:"}),y.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.contactPerson})]})]})]}),y.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(135deg, rgba(76,175,80,0.15), rgba(46,125,50,0.1))",opacity:0,transition:"opacity 0.3s ease",pointerEvents:"none"}})]},e.id);var t})}),y.jsx("div",{style:{height:"150px",width:"100%"}}),0===L.length&&y.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",textAlign:"center"},children:[y.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"currentColor",style:{color:"var(--muted)",marginBottom:"16px"},children:y.jsx("path",{d:"M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 9.5l4 4h-2.5V16h-3v-2.5H8l4-4z"})}),y.jsx("h3",{style:{fontSize:"18px",color:"var(--text)",margin:"0 0 8px 0"},children:"לא נמצאו סגחים מובצעים"}),y.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0"},children:a||s||d?"נסה לשנות את הפילטרים או החיפוש":"עדיין לא הושלמו סגחים במערכת"})]})]}),y.jsx(be,{isOpen:T,onClose:()=>{z(!1),N(null)},sagach:D})]})},je=["ממתין לבשלות בצד ספק",'ממתין לקבלת דג"ח והתנעה',"בתהליכי אפיון","ממתין לאינטגרציות","אינטגרציות","מבצוע","מובצע"],Se=()=>{const{user:e}=Y(),{sagachimStatus:t,isLoading:r,error:n}=re(),[i,a]=p.useState(""),[o,s]=p.useState(""),[l,d]=p.useState(!1),[c,g]=p.useState(!1);p.useEffect(()=>{const e=e=>{e.target.closest("[data-dropdown-container]")||(d(!1),g(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const u=p.useMemo(()=>{if(!t)return[];const e=t.filter(e=>7===e.processStatus),r=new Set;return e.forEach(e=>{e.provider&&r.add(e.provider)}),Array.from(r).sort()},[t]),x=p.useMemo(()=>{if(!t)return[];const e=t.filter(e=>7===e.processStatus),r=new Set;return e.forEach(e=>{e.arena.forEach(e=>r.add(e))}),Array.from(r).sort()},[t]),m={filter:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"transparent",color:"var(--text)",borderRadius:"12px",padding:"8px 14px",cursor:"pointer",transition:"transform 120ms ease",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"right",boxShadow:"none"}},h=(e,t)=>isNaN(e)||isNaN(t)?"#9E9E9E":Math.abs(e-t)<=.5?"#FF9800":e<t?"#4CAF50":"#F44336";if(r)return y.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"18px",color:"var(--text)",fontFamily:"Segoe UI, sans-serif"},children:"טוען אנליטיקות..."});if(n)return y.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"18px",color:"var(--error)",fontFamily:"Segoe UI, sans-serif"},children:["שגיאה בטעינת האנליטיקות: ",n]});const f=(()=>{if(!t)return{averageDaysPerPhase:{},averageImplementationDays:0,totalCompleted:0,overallAverageImplementationDays:0,overallAverageDaysPerPhase:{},overallTotalCompleted:0};console.log("🔍 Analytics Debug - Total sagachimStatus items:",t.length);const e=t.filter(e=>7===e.processStatus);console.log("🔍 Completed items:",e.length),e.forEach((e,t)=>{console.log(`🔍 Item ${t+1}:`,{name:e.name,processStartDate:e.processStartDate,completionDate:e.completionDate,processStatus:e.processStatus})});const r=e.filter(e=>{if(!e.processStartDate||!e.completionDate)return!1;const t=new Date(e.processStartDate),r=new Date(e.completionDate);return!isNaN(t.getTime())&&!isNaN(r.getTime())&&t<r});console.log("🔍 Valid completed items with dates:",r.length);const n=t.filter(e=>7===e.processStatus),a=n.filter(e=>e.phaseData&&Object.keys(e.phaseData).length>0);let s=n;i&&(s=s.filter(e=>e.provider===i)),o&&(s=s.filter(e=>e.arena.includes(o)));const l=s.filter(e=>e.phaseData&&Object.keys(e.phaseData).length>0),d={},c={};a.forEach(e=>{e.phaseData&&Object.entries(e.phaseData).forEach(([t,r])=>{const n=parseInt(t);if(r&&r.entries){const t=r.entries.reduce((t,r)=>{if(r.completionDate){const n=r.startDate?new Date(r.startDate):new Date(e.processStartDate||e.lastUpdated),i=new Date(r.completionDate);return t+Math.ceil((i.getTime()-n.getTime())/864e5)}return t},0);d[n]=(d[n]||0)+t,c[n]=(c[n]||0)+1}})});const p={};Object.keys(d).forEach(e=>{const t=parseInt(e);p[t]=c[t]>0?Math.round(d[t]/c[t]*10)/10:0});const g=n.reduce((e,t)=>{if(t.processStartDate&&t.completionDate){const r=new Date(t.processStartDate),n=new Date(t.completionDate);if(isNaN(r.getTime())||isNaN(n.getTime()))return console.warn("Invalid date found in sagach:",t.name,"start:",t.processStartDate,"end:",t.completionDate),e;const i=Math.ceil((n.getTime()-r.getTime())/864e5);return i<0?(console.warn("Negative days difference for sagach:",t.name,"days:",i),e):e+i}return e},0),u=n.length>0?Math.round(g/n.length*10)/10:0;if(console.log("🔍 Overall calculation debug:",{totalOverallImplementationDays:g,allCompletedSagachimLength:n.length,overallAverageImplementationDays:u}),0===s.length||0===l.length)return{averageDaysPerPhase:{},averageImplementationDays:0,totalCompleted:0,overallAverageImplementationDays:u,overallAverageDaysPerPhase:p,overallTotalCompleted:n.length};const x={},m={};l.forEach(e=>{e.phaseData&&Object.entries(e.phaseData).forEach(([t,r])=>{const n=parseInt(t);if(r&&r.entries){const t=r.entries.reduce((t,r)=>{if(r.completionDate){const n=r.startDate?new Date(r.startDate):new Date(e.processStartDate||e.lastUpdated),i=new Date(r.completionDate);return t+Math.ceil((i.getTime()-n.getTime())/864e5)}return t},0);x[n]=(x[n]||0)+t,m[n]=(m[n]||0)+1}})});const h={};Object.keys(x).forEach(e=>{const t=parseInt(e);h[t]=m[t]>0?Math.round(x[t]/m[t]*10)/10:0});const f=s.reduce((e,t)=>{if(t.processStartDate&&t.completionDate){const r=new Date(t.processStartDate),n=new Date(t.completionDate);if(isNaN(r.getTime())||isNaN(n.getTime()))return console.warn("Invalid date found in filtered sagach:",t.name,"start:",t.processStartDate,"end:",t.completionDate),e;const i=Math.ceil((n.getTime()-r.getTime())/864e5);return i<0?(console.warn("Negative days difference for filtered sagach:",t.name,"days:",i),e):e+i}return e},0),b=s.length>0?Math.round(f/s.length*10)/10:0;return console.log("🔍 Filtered calculation debug:",{totalImplementationDays:f,completedSagachimLength:s.length,averageImplementationDays:b,selectedProvider:i,selectedArena:o}),{averageDaysPerPhase:h,averageImplementationDays:b,totalCompleted:s.length,overallAverageImplementationDays:u,overallAverageDaysPerPhase:p,overallTotalCompleted:n.length}})();return y.jsxs("main",{className:"app-main",style:{display:"flex",flexDirection:"column",direction:"rtl",fontFamily:"Segoe UI, sans-serif",height:"100vh",overflow:"auto",width:"100%",padding:"20px"},children:[y.jsx("style",{children:"\n          .analytics-scroll::-webkit-scrollbar {\n            width: 8px;\n          }\n          \n          .analytics-scroll::-webkit-scrollbar-track {\n            background: rgba(255, 255, 255, 0.1);\n            border-radius: 4px;\n          }\n          \n          .analytics-scroll::-webkit-scrollbar-thumb {\n            background: rgba(76, 175, 80, 0.6);\n            border-radius: 4px;\n            transition: background 0.3s ease;\n          }\n          \n          .analytics-scroll::-webkit-scrollbar-thumb:hover {\n            background: rgba(76, 175, 80, 0.8);\n          }\n          \n          /* For Firefox */\n          .analytics-scroll {\n            scrollbar-width: thin;\n            scrollbar-color: rgba(76, 175, 80, 0.6) rgba(255, 255, 255, 0.1);\n          }\n        "}),y.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:"32px",padding:"16px 0",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[y.jsx("span",{style:{fontSize:"32px",fontWeight:"700",color:"var(--text)",margin:"0 0 8px 0",textAlign:"center"},children:'אנליטיקות - הכנסות סג"חים'}),y.jsx("span",{style:{fontSize:"16px",color:"var(--muted)",margin:"0 0 16px 0",textAlign:"center"},children:' ניתוח מפורט של תהליכי הכנסת סג"חים עד היום'}),y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",width:"100%",maxWidth:"800px",marginTop:"16px"},children:[y.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(76,175,80,0.15), rgba(46,125,50,0.10))",border:"1px solid rgba(76,175,80,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[y.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#4CAF50",marginBottom:"8px"},children:isNaN(f.overallAverageImplementationDays)?"אין נתונים":f.overallAverageImplementationDays}),y.jsx("div",{style:{fontSize:"20px",color:"var(--muted)",marginBottom:"4px"},children:'ממוצע ימים למבצוע סג"ח'})]}),y.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(33,150,243,0.15), rgba(21,101,192,0.10))",border:"1px solid rgba(33,150,243,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[y.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#2196F3",marginBottom:"8px"},children:f.overallTotalCompleted}),y.jsx("div",{style:{fontSize:"20px",color:"var(--muted)",marginBottom:"4px"},children:'סה"כ סג"חים שמובצעו'})]})]}),y.jsxs("div",{style:{display:"flex",gap:"16px",justifyContent:"center",flexWrap:"wrap",alignItems:"center",width:"100%",marginTop:"24px"},children:[y.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[y.jsxs("button",{onClick:()=>d(!l),style:m.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[y.jsx("span",{children:i||"כל הספקים"}),y.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),l&&y.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[y.jsx("div",{onClick:()=>{a(""),d(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הספקים"}),u.map(e=>y.jsx("div",{onClick:()=>{a(e),d(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),y.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[y.jsxs("button",{onClick:()=>g(!c),style:m.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[y.jsx("span",{children:o||"כל הזירות"}),y.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),c&&y.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[y.jsx("div",{onClick:()=>{s(""),g(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הזירות"}),x.map(e=>y.jsx("div",{onClick:()=>{s(e),g(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]})]})]}),y.jsxs("div",{className:"analytics-scroll",style:{display:"flex",justifyContent:"center",gap:"24px",width:"100%",maxHeight:"calc(100vh - 300px)",overflowY:"auto",padding:"0 20px"},children:[(i||o)&&y.jsx("div",{style:{minWidth:"280px",maxWidth:"320px",height:"fit-content",textAlign:"right",direction:"rtl",marginLeft:"120px"},children:y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",fontSize:"24px",fontWeight:"700",color:"var(--text)"},children:[y.jsx("span",{style:{fontSize:"26px",fontWeight:"700",color:"var(--text)",marginBottom:"20px",textAlign:"center",borderBottom:"2px solid rgba(255,255,255,0.1)",padding:"8px 0"},children:"פלטורים פעילים"}),i&&y.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[y.jsx("span",{style:{color:"white",fontWeight:"600",fontSize:"26px"},children:"ספק"}),y.jsx("div",{style:{color:"rgb(33, 150, 243)",fontWeight:"600",fontSize:"40px",marginTop:"16px"},children:i})]}),o&&y.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"16px"},children:[y.jsx("span",{style:{color:"white",fontWeight:"600",fontSize:"26px"},children:"זירה"}),y.jsx("div",{style:{color:"rgb(33, 150, 243)",fontWeight:"600",fontSize:"40px",marginTop:"16px"},children:o})]}),y.jsxs("div",{children:[y.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"16px"},children:[y.jsx("span",{style:{color:"white",fontWeight:"600",fontSize:"26px"},children:'סג"חים שמובצעו'}),y.jsx("div",{style:{color:"rgb(76, 175, 80)",fontWeight:"600",fontSize:"40px",marginTop:"16px"},children:f.totalCompleted}),y.jsxs("div",{style:{color:"rgba(255,255,255,0.7)",fontWeight:"400",fontSize:"18px",marginTop:"8px"},children:[t?Math.round(f.totalCompleted/t.filter(e=>7===e.processStatus).length*100):0,'% מכלל הסג"חים']})]}),y.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"16px"},children:[y.jsx("span",{style:{color:"white",fontWeight:"600",fontSize:"26px"},children:"ממוצע ימים למבצוע"}),y.jsx("div",{style:{color:h(f.averageImplementationDays,f.overallAverageImplementationDays),fontWeight:"600",fontSize:"40px",marginTop:"16px"},children:isNaN(f.averageImplementationDays)?"אין נתונים":f.averageImplementationDays}),y.jsxs("div",{style:{color:"rgba(255,255,255,0.7)",fontWeight:"400",fontSize:"18px",marginTop:"8px"},children:["ממוצע כולל: ",isNaN(f.overallAverageImplementationDays)?"אין נתונים":f.overallAverageImplementationDays," ימים"]})]})]})]})}),Object.keys(f.averageDaysPerPhase).length>0&&y.jsxs("div",{style:{minWidth:"400px",maxWidth:"500px",height:"fit-content",textAlign:"right",direction:"rtl"},children:[y.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:"var(--text)",marginBottom:"20px",textAlign:"center",borderBottom:"2px solid rgba(255,255,255,0.1)",padding:"8px 0"},children:"ממוצע ימים בפילוח לשלבים"}),y.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",fontSize:"16px",color:"var(--text)"},children:Object.entries(f.averageDaysPerPhase).sort(([e],[t])=>parseInt(e)-parseInt(t)).map(([e,t])=>{const r=parseInt(e),n=f.overallAverageDaysPerPhase[r]||0,a=h(t,n);return y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[y.jsxs("div",{style:{textAlign:"right"},children:[y.jsxs("div",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"4px"},children:["שלב ",e,": ",je[parseInt(e)-1]]}),(i||o)&&y.jsxs("div",{style:{fontSize:"14px",color:"var(--muted)"},children:["ממוצע כולל: ",n," ימים"]})]}),y.jsxs("div",{style:{color:a,fontWeight:"700",fontSize:"20px"},children:[t," ימים"]})]},e)})})]})]}),y.jsx("div",{style:{marginTop:"24px",padding:"16px",background:"rgba(255,255,255,0.05)",borderRadius:"12px",textAlign:"center",margin:"24px 20px 0 20px"},children:y.jsx("div",{style:{fontSize:"14px",color:"var(--muted)"},children:0===f.overallTotalCompleted?'אין סג"חים מובצעים במערכת - האנליטיקות יופיעו לאחר הכנסת סג"חים וסימונם כמובצעים':'האנליטיקות מבוססות על סג"חים שהוכנסו למערכת ומובצעו'})})]})},ke=({isOpen:t,onClose:r})=>{const{login:n,loginWithAdfs:i,isLoading:a,authMode:o,canSwitchAuthMode:s}=Y(),[g,u]=p.useState({name:"",email:"",password:"",role:"viewer"}),x=()=>{var e;e="local"===o?"adfs":"local",localStorage.setItem("auth_mode",e),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"adfs"===e?"עבר למצב אימות ADFS - נא לרענן את הדף":"עבר למצב אימות מקומי - נא לרענן את הדף",type:"ok",durationMs:4e3}}))},m=e=>{const{name:t,value:r}=e.target;u(e=>d(l({},e),{[t]:r}))};return t?y.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,fontFamily:"Segoe UI, Arial, sans-serif"},children:y.jsxs("div",{style:{backgroundColor:"var(--panel)",borderRadius:"12px",padding:"32px",maxWidth:"400px",width:"90%",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",border:"1px solid var(--border)"},children:[y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[y.jsxs("div",{style:{direction:"rtl"},children:[y.jsx("h2",{style:{margin:0,color:"var(--text)",fontSize:"24px",fontWeight:"600"},children:"התחברות למערכת"}),y.jsxs("div",{style:{fontSize:"14px",color:"var(--muted)",marginTop:"4px"},children:["מצב אימות: ",R(o)]})]}),y.jsx("button",{onClick:r,style:{background:"none",border:"none",color:"var(--muted)",fontSize:"24px",cursor:"pointer",padding:"4px",borderRadius:"4px",transition:"color 0.2s"},onMouseOver:e=>e.currentTarget.style.color="var(--text)",onMouseOut:e=>e.currentTarget.style.color="var(--muted)",children:"×"})]}),s&&y.jsx("div",{style:{marginBottom:"20px",textAlign:"center",direction:"rtl"},children:y.jsxs("button",{type:"button",onClick:x,style:{padding:"8px 16px",borderRadius:"8px",border:"1px solid var(--accent)",backgroundColor:"transparent",color:"var(--accent)",fontSize:"12px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",transition:"all 0.2s"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="var(--accent)",e.currentTarget.style.color="white"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="var(--accent)"},children:["עבור ל","local"===o?"אימות ADFS":"אימות מקומי"]})}),"adfs"===o&&y.jsxs("div",{style:{direction:"rtl",textAlign:"center",marginBottom:"20px"},children:[y.jsx("button",{type:"button",onClick:()=>c(e,null,function*(){try{yield i(),r()}catch(e){console.error("ADFS login failed:",e)}}),disabled:a,style:{width:"100%",padding:"16px",borderRadius:"8px",border:"none",backgroundColor:a?"var(--muted)":"#0078d4",color:"white",fontSize:"16px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:a?"not-allowed":"pointer",transition:"background-color 0.2s",fontWeight:"600"},children:a?"מתחבר...":"התחבר עם ADFS"}),y.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",marginTop:"8px"},children:"תועבר לדף ההתחברות של ADFS"}),y.jsxs("div",{style:{marginTop:"16px",padding:"12px",backgroundColor:"rgba(124, 192, 255, 0.1)",borderRadius:"8px",border:"1px solid rgba(124, 192, 255, 0.2)"},children:[y.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",marginBottom:"8px"},children:"או התחבר עם חשבון מקומי:"}),y.jsx("button",{type:"button",onClick:x,style:{padding:"8px 16px",borderRadius:"6px",border:"1px solid var(--accent)",backgroundColor:"transparent",color:"var(--accent)",fontSize:"12px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",transition:"all 0.2s"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="var(--accent)",e.currentTarget.style.color="white"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="var(--accent)"},children:"עבור לאימות מקומי"})]})]}),"local"===o&&y.jsxs("form",{onSubmit:t=>c(e,null,function*(){if(t.preventDefault(),g.name.trim())try{if("admin"===g.name.trim()&&"admin"===g.password)return yield n({name:"מנהל מערכת",email:"admin@system.com",role:"admin"}),r(),void u({name:"",email:"",password:"",role:"viewer"});yield n(g),r(),u({name:"",email:"",password:"",role:"viewer"})}catch(e){console.error("Login failed:",e)}else window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"אנא הזן שם משתמש",type:"error",durationMs:3e3}}))}),style:{direction:"rtl"},children:[y.jsxs("div",{style:{marginBottom:"20px"},children:[y.jsx("label",{style:{display:"block",marginBottom:"8px",color:"var(--text)",fontWeight:"500",fontSize:"14px"},children:"שם משתמש *"}),y.jsx("input",{type:"text",name:"name",value:g.name,onChange:m,placeholder:"הזן שם משתמש",required:!0,style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid var(--border)",backgroundColor:"var(--bg)",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:e=>e.currentTarget.style.borderColor="var(--accent)",onBlur:e=>e.currentTarget.style.borderColor="var(--border)"})]}),y.jsxs("div",{style:{marginBottom:"20px"},children:[y.jsx("label",{style:{display:"block",marginBottom:"8px",color:"var(--text)",fontWeight:"500",fontSize:"14px"},children:"סיסמה (אופציונלי)"}),y.jsx("input",{type:"password",name:"password",value:g.password,onChange:m,placeholder:"הזן סיסמה",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid var(--border)",backgroundColor:"var(--bg)",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:e=>e.currentTarget.style.borderColor="var(--accent)",onBlur:e=>e.currentTarget.style.borderColor="var(--border)"})]}),y.jsxs("div",{style:{marginBottom:"20px"},children:[y.jsx("label",{style:{display:"block",marginBottom:"8px",color:"var(--text)",fontWeight:"500",fontSize:"14px"},children:"כתובת אימייל (אופציונלי)"}),y.jsx("input",{type:"email",name:"email",value:g.email,onChange:m,placeholder:"הזן כתובת אימייל",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid var(--border)",backgroundColor:"var(--bg)",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:e=>e.currentTarget.style.borderColor="var(--accent)",onBlur:e=>e.currentTarget.style.borderColor="var(--border)"})]}),y.jsxs("div",{style:{marginBottom:"24px"},children:[y.jsx("label",{style:{display:"block",marginBottom:"8px",color:"var(--text)",fontWeight:"500",fontSize:"14px"},children:"הרשאות"}),y.jsxs("select",{name:"role",value:g.role,onChange:m,style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid var(--border)",backgroundColor:"var(--bg)",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:e=>e.currentTarget.style.borderColor="var(--accent)",onBlur:e=>e.currentTarget.style.borderColor="var(--border)",children:[y.jsx("option",{value:"viewer",children:"צופה - צפייה בלבד"}),y.jsx("option",{value:"editor",children:"עורך - הוספת הודעות"}),y.jsx("option",{value:"admin",children:"מנהל - הרשאות מלאות"})]})]}),y.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[y.jsx("button",{type:"button",onClick:r,style:{padding:"12px 24px",borderRadius:"8px",border:"2px solid var(--border)",backgroundColor:"transparent",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",transition:"all 0.2s",direction:"rtl"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="var(--border)",e.currentTarget.style.color="var(--text)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="var(--text)"},children:"ביטול"}),y.jsx("button",{type:"submit",disabled:a,style:{padding:"12px 24px",borderRadius:"8px",border:"none",backgroundColor:a?"var(--muted)":"var(--accent)",color:"white",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:a?"not-allowed":"pointer",transition:"background-color 0.2s",direction:"rtl"},children:a?"מתחבר...":"התחבר"})]})]}),y.jsx("div",{style:{marginTop:"20px",padding:"16px",backgroundColor:"rgba(124, 192, 255, 0.1)",borderRadius:"8px",border:"1px solid rgba(124, 192, 255, 0.2)",direction:"rtl"},children:"local"===o?y.jsxs(y.Fragment,{children:[y.jsx("h4",{style:{margin:"0 0 8px 0",color:"var(--text)",fontSize:"14px",fontWeight:"600"},children:"הסבר על הרשאות:"}),y.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",lineHeight:"1.4"},children:[y.jsxs("div",{children:[y.jsx("strong",{children:"צופה:"}),' צפייה בלבד בסג"חים']}),y.jsxs("div",{children:[y.jsx("strong",{children:"עורך:"})," הוספת הודעות בצ'אט"]}),y.jsxs("div",{children:[y.jsx("strong",{children:"מנהל:"}),' עריכת סטטוסים, יצירת סג"חים, הודעות וניהול משתמשים']}),y.jsxs("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(124, 192, 255, 0.3)"},children:[y.jsx("div",{style:{color:"var(--accent)",fontWeight:"600"},children:"חשבון מנהל לדמו:"}),y.jsxs("div",{children:["שם משתמש: ",y.jsx("strong",{children:"admin"})]}),y.jsxs("div",{children:["סיסמה: ",y.jsx("strong",{children:"admin"})]})]})]})]}):y.jsxs(y.Fragment,{children:[y.jsx("h4",{style:{margin:"0 0 8px 0",color:"var(--text)",fontSize:"14px",fontWeight:"600"},children:"אימות ADFS:"}),y.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",lineHeight:"1.4"},children:[y.jsx("div",{children:"ההרשאות נקבעות אוטומטית על פי חברות בקבוצות Active Directory:"}),y.jsxs("div",{children:[y.jsx("strong",{children:"מנהלים:"})," admin, admins, Administrators"]}),y.jsxs("div",{children:[y.jsx("strong",{children:"עורכים:"})," editor, editors, Writers"]}),y.jsxs("div",{children:[y.jsx("strong",{children:"צופים:"})," כל המשתמשים האחרים"]}),s&&y.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(124, 192, 255, 0.3)"},children:y.jsx("div",{style:{color:"var(--accent)",fontWeight:"600"},children:"ניתן לעבור בין מצבי אימות בלחיצה על הכפתור למעלה"})})]})]})})]})}):null},Ce=()=>{const{user:e,logout:t,canManageUsers:r,authMode:n}=Y(),[i,a]=p.useState(!1);return e?y.jsxs("div",{style:{position:"relative",direction:"rtl"},children:[y.jsxs("button",{onClick:()=>a(!i),style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 14px",maxHeight:"35px",backgroundColor:"var(--panel)",border:"1px solid var(--border)",borderRadius:"12px",color:"var(--text)",fontSize:"10px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",transition:"all 0.2s",direction:"rtl"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="var(--border)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="var(--panel)"},children:[y.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",backgroundColor:"var(--accent)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"14px",fontWeight:"600"},children:e.name.charAt(0).toUpperCase()}),y.jsxs("div",{style:{textAlign:"right"},children:[y.jsx("div",{style:{fontWeight:"600",fontSize:"12px"},children:e.name}),y.jsx("div",{style:{fontSize:"10px",color:"var(--muted)",marginTop:"2px"},children:V(e.role)})]}),y.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",transform:i?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},children:"▼"})]}),i&&y.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"4px",backgroundColor:"var(--panel)",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:1e3,minWidth:"200px",direction:"rtl"},children:[y.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--border)"},children:[y.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"var(--text)",marginBottom:"4px"},children:e.name}),y.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",marginBottom:"2px"},children:e.email}),y.jsx("div",{style:{fontSize:"12px",color:"var(--accent)",fontWeight:"500"},children:V(e.role)}),y.jsx("div",{style:{fontSize:"10px",color:"var(--muted)",marginTop:"2px"},children:R(n)})]}),y.jsxs("div",{style:{padding:"8px"},children:[r()&&y.jsx("button",{onClick:()=>{window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"פונקציונליות ניהול משתמשים תהיה זמינה בקרוב",type:"info",durationMs:3e3}})),a(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",color:"var(--accent)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",borderRadius:"8px",transition:"background-color 0.2s",textAlign:"right",direction:"rtl",marginBottom:"8px"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="rgba(124, 192, 255, 0.1)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent"},children:"👥 ניהול משתמשים"}),y.jsx("button",{onClick:()=>{t(),a(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",borderRadius:"8px",transition:"background-color 0.2s",textAlign:"right",direction:"rtl"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="rgba(255, 0, 0, 0.1)",e.currentTarget.style.color="#ff4444"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="var(--text)"},children:"התנתק"})]})]}),i&&y.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:999},onClick:()=>a(!1)})]}):null};function Ee({isOpen:e,onClose:t}){const{user:r,canManageUsers:n}=Y(),[i,a]=p.useState([]),[o,s]=p.useState(null),[c,g]=p.useState(!1),[u,x]=p.useState({name:"",email:"",role:"viewer"});p.useEffect(()=>{e&&m()},[e]);const m=()=>{try{const e=localStorage.getItem("admin_users");if(e){const t=JSON.parse(e);a(t)}else r&&a([r])}catch(e){console.error("Failed to load users:",e),a([])}},h=e=>{try{localStorage.setItem("admin_users",JSON.stringify(e)),a(e)}catch(t){console.error("Failed to save users:",t),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"שגיאה בשמירת משתמשים",type:"error",durationMs:3e3}}))}},f=()=>{if(!o)return;const e=i.map(e=>e.id===o.id?o:e);h(e),s(null),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`משתמש ${o.name} עודכן בהצלחה`,type:"ok",durationMs:3e3}}))};return e&&n()?y.jsx("div",{className:"permission-manager-overlay",onClick:t,children:y.jsxs("div",{className:"permission-manager-modal",onClick:e=>e.stopPropagation(),children:[y.jsxs("div",{className:"permission-manager-header",children:[y.jsx("h2",{style:{margin:0,color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif"},children:"ניהול הרשאות משתמשים"}),y.jsx("button",{className:"close-button",onClick:t,style:{background:"none",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:"4px 8px"},children:"×"})]}),y.jsxs("div",{className:"permission-manager-content",children:[y.jsxs("div",{className:"add-user-section",children:[y.jsx("button",{className:"btn primary",onClick:()=>g(!c),style:{marginBottom:"16px"},children:c?"ביטול":"הוסף משתמש חדש"}),c&&y.jsx("div",{className:"add-user-form",style:{background:"rgba(255,255,255,0.1)",padding:"16px",borderRadius:"8px",marginBottom:"20px",border:"1px solid rgba(255,255,255,0.2)"},children:y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[y.jsx("input",{type:"text",placeholder:"שם משתמש",value:u.name||"",onChange:e=>x(d(l({},u),{name:e.target.value})),style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.1)",color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl"}}),y.jsx("input",{type:"email",placeholder:"אימייל",value:u.email||"",onChange:e=>x(d(l({},u),{email:e.target.value})),style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.1)",color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl"}}),y.jsxs("select",{value:u.role||"viewer",onChange:e=>x(d(l({},u),{role:e.target.value})),style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.1)",color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl"},children:[y.jsx("option",{value:"viewer",children:"צופה"}),y.jsx("option",{value:"editor",children:"עורך"}),y.jsx("option",{value:"admin",children:"מנהל"})]}),y.jsxs("div",{style:{display:"flex",gap:"8px"},children:[y.jsx("button",{className:"btn primary",onClick:()=>{if(!u.name||!u.email)return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"יש למלא שם ואימייל",type:"warn",durationMs:3e3}}));if(i.some(e=>e.email===u.email))return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"משתמש עם אימייל זה כבר קיים",type:"warn",durationMs:3e3}}));const e={id:`user_${Date.now()}`,name:u.name,email:u.email,role:u.role,lastLogin:(new Date).toISOString()},t=[...i,e];h(t),x({name:"",email:"",role:"viewer"}),g(!1),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`משתמש ${e.name} נוסף בהצלחה`,type:"ok",durationMs:3e3}}))},style:{flex:1},children:"הוסף"}),y.jsx("button",{className:"btn ghost",onClick:()=>{g(!1),x({name:"",email:"",role:"viewer"})},style:{flex:1},children:"ביטול"})]})]})})]}),y.jsxs("div",{className:"users-list",children:[y.jsx("h3",{style:{color:"#fff",marginBottom:"16px",fontFamily:"Segoe UI, Arial, sans-serif"},children:"רשימת משתמשים"}),0===i.length?y.jsx("div",{style:{color:"#ccc",textAlign:"center",padding:"20px"},children:"אין משתמשים רשומים"}):y.jsx("div",{className:"users-table",children:i.map(e=>y.jsxs("div",{className:"user-row",style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px",background:"rgba(255,255,255,0.05)",borderRadius:"6px",marginBottom:"8px",border:"1px solid rgba(255,255,255,0.1)"},children:[y.jsxs("div",{className:"user-info",style:{flex:1},children:[y.jsx("div",{style:{color:"#fff",fontWeight:"bold",fontFamily:"Segoe UI, Arial, sans-serif"},children:e.name}),y.jsx("div",{style:{color:"#ccc",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif"},children:e.email}),e.lastLogin&&y.jsxs("div",{style:{color:"#999",fontSize:"12px",fontFamily:"Segoe UI, Arial, sans-serif"},children:["התחברות אחרונה: ",new Date(e.lastLogin).toLocaleString("he-IL")]})]}),y.jsx("div",{className:"user-actions",style:{display:"flex",alignItems:"center",gap:"8px"},children:(null==o?void 0:o.id)===e.id?y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[y.jsxs("select",{value:o.role,onChange:e=>s(d(l({},o),{role:e.target.value})),style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.1)",color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl"},children:[y.jsx("option",{value:"viewer",children:"צופה"}),y.jsx("option",{value:"editor",children:"עורך"}),y.jsx("option",{value:"admin",children:"מנהל"})]}),y.jsx("button",{className:"btn primary",onClick:f,style:{padding:"4px 8px",fontSize:"12px"},children:"שמור"}),y.jsx("button",{className:"btn ghost",onClick:()=>s(null),style:{padding:"4px 8px",fontSize:"12px"},children:"ביטול"})]}):y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[y.jsx("span",{style:{color:"#fff",background:"rgba(124,192,255,0.2)",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontFamily:"Segoe UI, Arial, sans-serif"},children:V(e.role)}),y.jsx("button",{className:"btn ghost",onClick:()=>(e=>{s(e)})(e),style:{padding:"4px 8px",fontSize:"12px"},children:"ערוך"}),e.id!==(null==r?void 0:r.id)&&y.jsx("button",{className:"btn ghost",onClick:()=>(e=>{if(e===(null==r?void 0:r.id))return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"לא ניתן למחוק את המשתמש הנוכחי",type:"warn",durationMs:3e3}}));const t=i.filter(t=>t.id!==e);h(t),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"משתמש נמחק בהצלחה",type:"ok",durationMs:3e3}}))})(e.id),style:{padding:"4px 8px",fontSize:"12px",color:"#ff6b6b"},children:"מחק"})]})})]},e.id))})]})]})]})}):null}class Te extends p.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("🚨 ErrorBoundary caught an error:",e,t),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?y.jsxs("div",{style:{padding:"20px",backgroundColor:"#ffebee",border:"1px solid #f44336",borderRadius:"8px",margin:"20px",fontFamily:"Segoe UI, sans-serif"},children:[y.jsx("h2",{style:{color:"#d32f2f",margin:"0 0 10px 0"},children:"🚨 Application Error"}),y.jsx("p",{style:{color:"#666",margin:"0 0 10px 0"},children:"Something went wrong. Please check the console for details."}),y.jsxs("details",{style:{marginTop:"10px"},children:[y.jsx("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Error Details"}),y.jsxs("pre",{style:{backgroundColor:"#f5f5f5",padding:"10px",borderRadius:"4px",overflow:"auto",marginTop:"10px",fontSize:"12px"},children:[this.state.error&&this.state.error.toString(),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}),y.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:"10px",padding:"8px 16px",backgroundColor:"#2196f3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Reload Page"})]}):this.props.children}}function ze(){const{user:e,isLoading:t,canManageUsers:r}=Y(),{sagachimStatus:n}=re(),[i,a]=p.useState(!1),[o,s]=p.useState(!1),[c,g]=p.useState(!1),[u,x]=p.useState("status"),[m,h]=p.useState(null),[f,b]=p.useState("ok"),[v,w]=p.useState(!1),[j,S]=p.useState(!1),k=p.useRef(null),C=p.useRef(null),[E,T]=p.useState('{\n  "person": {\n    "id": "GILI-2025-001",\n    "basic_info": {\n      "first_name": "Gili",\n      "last_name": "Levi",\n      "gender": "Male",\n      "date_of_birth": "1992-05-14",\n      "nationality": "Israeli",\n      "description": "Gili is a 33-year-old software engineer who enjoys hiking, photography, and playing the guitar."\n    },\n    "contact_details": {\n      "phone_numbers": [\n        {\n          "type": "mobile",\n          "country_code": "+972",\n          "number": "54-123-4567",\n          "description": "Primary contact number"\n        },\n        {\n          "type": "home",\n          "country_code": "+972",\n          "number": "3-987-6543",\n          "description": "Landline at home"\n        }\n      ],\n      "email": "gili.levi@example.com"\n    },\n    "address": {\n      "primary_residence": {\n        "street": "HaPalmach Street",\n        "house_number": 17,\n        "city": "Tel Aviv",\n        "postal_code": "6329204",\n        "country": "Israel",\n        "coordinates": {\n          "latitude": 32.0853,\n          "longitude": 34.7818\n        },\n        "description": "Main apartment located in the heart of Tel Aviv, close to cafes and the beach."\n      },\n      "secondary_residence": {\n        "street": "Herzl Avenue",\n        "house_number": 45,\n        "city": "Haifa",\n        "postal_code": "3200000",\n        "country": "Israel",\n        "description": "Vacation apartment in Haifa with a view of the Mediterranean Sea."\n      }\n    },\n    "employment": {\n      "current_job": {\n        "position": "Senior Software Engineer",\n        "company": "TechNova Ltd.",\n        "department": "AI Research & Development",\n        "start_date": "2018-09-01",\n        "description": "Leads a team of 6 engineers developing machine learning models for predictive analytics."\n      },\n      "previous_jobs": [\n        {\n          "position": "Backend Developer",\n          "company": "CodeWorks",\n          "start_date": "2015-06-15",\n          "end_date": "2018-08-31",\n          "description": "Worked on API development and database optimization."\n        },\n        {\n          "position": "Junior Web Developer",\n          "company": "Creative Web Studio",\n          "start_date": "2013-02-01",\n          "end_date": "2015-05-30",\n          "description": "Built responsive websites for small businesses."\n        }\n      ]\n    },\n    "personal_interests": {\n      "hobbies": [\n        {\n          "name": "Hiking",\n          "description": "Explores nature trails around Israel and abroad."\n        },\n        {\n          "name": "Photography",\n          "description": "Specializes in landscape and street photography."\n        },\n        {\n          "name": "Music",\n          "description": "Plays acoustic guitar and writes original songs."\n        }\n      ],\n      "sports": [\n        {\n          "name": "Basketball",\n          "description": "Plays in a local amateur league every weekend."\n        }\n      ]\n    },\n    "identifiers": {\n      "passport_number": "IL9876543",\n      "national_id": "203456789",\n      "driver_license": {\n        "number": "DL-IL-456789",\n        "category": "B",\n        "expiry_date": "2030-12-31"\n      }\n    },\n    "emergency_contacts": [\n      {\n        "name": "Maya Levi",\n        "relationship": "Sister",\n        "phone": {\n          "country_code": "+972",\n          "number": "52-765-4321"\n        }\n      },\n      {\n        "name": "David Cohen",\n        "relationship": "Friend",\n        "phone": {\n          "country_code": "+972",\n          "number": "50-987-6543"\n        }\n      }\n    ]\n  }\n}'),[z,N]=p.useState(null),[L,F]=p.useState(null),[R,$]=p.useState(!1),[W,B]=p.useState(1),[O,P]=p.useState({x:0,y:0}),[_,U]=p.useState(!1),[q,H]=p.useState({x:0,y:0}),[V,J]=p.useState(""),[K,G]=p.useState([]),[X,Z]=p.useState(!1),[Q,ee]=p.useState(!1),[te,ie]=p.useState(null),[ae,oe]=p.useState(""),[se,le]=p.useState(""),[de,ce]=p.useState(""),[pe,xe]=p.useState(!1),[me,he]=p.useState(""),[fe,be]=p.useState([]),[ye,ve]=p.useState(""),[je,Te]=p.useState(!1),[ze,De]=p.useState(!1),[Ne,Ie]=p.useState(!0),[Me,Le]=p.useState(!1),[Fe,Ae]=p.useState(!1),[Re,$e]=p.useState(!1),[We,Be]=p.useState(!1),[Oe,Pe]=p.useState(!1),[_e,Ue]=p.useState(null),[qe,He]=p.useState(null),[Ye,Ve]=p.useState(null),Je=p.useRef(null),Ke=p.useRef(1),Ge=p.useRef({x:0,y:0}),Xe=p.useRef(null),Ze=p.useRef(null),Qe=p.useRef(null),et=p.useRef(null),tt=p.useRef(null),rt=p.useRef(null),nt=p.useRef([]);p.useEffect(()=>{e&&"admin"!==e.role&&("viz"!==u&&"dictionary"!==u&&"common"!==u||x("status"))},[e,u]);const it=p.useMemo(()=>{try{return typeof JSON.parse(E)}catch(e){return null}},[E]),at=p.useMemo(()=>{if(!z)return[];const e=[],t=(r,n)=>{var i;const a=null!=(i=r.children)?i:[],o=0===a.length,s=!!(r.excelMeta&&Object.keys(r.excelMeta).length>0),l="required"===r.requiredState,d=[...n,r.name];if(o&&l&&!s){const t=d.slice(1).join(" -> ");e.push({id:r.id,path:t,requiredState:r.requiredState})}a.forEach(e=>t(e,d))};return t(z,[]),e},[z]),ot=p.useMemo(()=>at,[at]),st=p.useCallback(()=>{try{if(!ye)return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"בחר סכמה לויזואליזציה בעץ",type:"error",durationMs:4e3}}));const e=dt[ye];if(e){T(JSON.stringify(e.schema,null,2)),F(null);const t=D(e.schema),r=pt(t,fe);N(r)}else F("Selected schema not found")}catch(e){F(e instanceof Error?e.message:"Failed to parse JSON")}},[ye,fe]),lt=p.useCallback(()=>{T(""),N(null),F(null)},[]),dt={person:{title:"Person",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"Person",type:"object",required:["firstName","lastName","address"],properties:{firstName:{type:"string",description:"Given name of the person",minLength:1},lastName:{type:"string",description:"Family name of the person",minLength:1},email:{type:"string",format:"email",description:"Primary contact email address"},phone:{type:"string",pattern:"^\\+?[0-9\n\r-s]{7,15}$",description:"Phone number with optional country code"},account:{type:"object",description:"User account settings and preferences",properties:{username:{type:"string",description:"Unique username for login",minLength:3,maxLength:16},password:{type:"string",description:"Secure password for account access",minLength:8},preferences:{type:"object",description:"User interface and notification preferences",properties:{notifications:{type:"boolean",description:"Enable push notifications"},theme:{type:"string",description:"Visual theme preference",enum:["light","dark","system"]},shortcuts:{type:"array",description:"Custom keyboard shortcuts",items:{type:"object",required:["name","keys"],properties:{name:{type:"string",description:"Shortcut action name"},keys:{type:"string",description:"Keyboard combination",pattern:"^[A-Z]++[A-Z]+$"}}}}}}}},address:{type:"object",description:"Primary residential address",required:["street","city"],properties:{street:{type:"string",description:"Street name and number",minLength:1},city:{type:"string",description:"City name",minLength:1},state:{type:"string",description:"State or province"},zip:{type:"string",description:"Postal code",pattern:"^[0-9]{5}(?:-[0-9]{4})?$"}}},secondary_residence:{type:"object",description:"Optional secondary residence; if present, street and city are required",required:["street","city"],properties:{street:{type:"string",description:"Street name and number"},city:{type:"string",description:"City name"},coordinates:{type:"object",description:"Geographic coordinates of the residence",properties:{lat:{type:"number",description:"Latitude coordinate",minimum:-90,maximum:90},lng:{type:"number",description:"Longitude coordinate",minimum:-180,maximum:180}}}}},documents:{type:"array",description:"Collection of uploaded documents",items:{type:"object",required:["fileName","mimeType"],properties:{fileName:{type:"string",description:"Original filename of the document"},mimeType:{type:"string",description:"MIME type of the document",pattern:"^[-w.]+/[-w.]+$"},sizeKb:{type:"integer",description:"File size in kilobytes",minimum:1,maximum:10240}}}},age:{type:"integer",description:"Age in years",minimum:0,maximum:120},tags:{type:"array",description:"User-defined tags for categorization",items:{type:"string",maxLength:20}}}}},gps_location:{title:"GPS Location Device",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"GPSLocationDevice",type:"object",required:["deviceId","location","timestamp"],properties:{deviceId:{type:"string",description:"Unique identifier for the GPS device",minLength:1},deviceInfo:{type:"object",description:"Device hardware and software information",required:["model","firmwareVersion"],properties:{model:{type:"string",description:"Device model name",minLength:1},manufacturer:{type:"string",description:"Device manufacturer",minLength:1},firmwareVersion:{type:"string",description:"Current firmware version",pattern:"^\\d+\\.\\d+\\.\\d+$"},serialNumber:{type:"string",description:"Device serial number",pattern:"^[A-Z0-9]{8,16}$"},batteryLevel:{type:"number",description:"Battery level percentage",minimum:0,maximum:100},lastMaintenance:{type:"string",description:"Last maintenance date",format:"date"}}},location:{type:"object",description:"Current GPS location data",required:["latitude","longitude","accuracy"],properties:{latitude:{type:"number",description:"Latitude coordinate in decimal degrees",minimum:-90,maximum:90},longitude:{type:"number",description:"Longitude coordinate in decimal degrees",minimum:-180,maximum:180},accuracy:{type:"number",description:"GPS accuracy in meters",minimum:0,maximum:1e3},altitude:{type:"number",description:"Altitude above sea level in meters",minimum:-1e3,maximum:1e4},heading:{type:"number",description:"Direction of movement in degrees",minimum:0,maximum:360},speed:{type:"number",description:"Speed in meters per second",minimum:0,maximum:100},satellites:{type:"integer",description:"Number of GPS satellites in view",minimum:0,maximum:32}}},timestamp:{type:"string",description:"ISO 8601 timestamp of location reading",format:"date-time"},environmental:{type:"object",description:"Environmental sensor data if available",properties:{temperature:{type:"number",description:"Ambient temperature in Celsius",minimum:-50,maximum:80},humidity:{type:"number",description:"Relative humidity percentage",minimum:0,maximum:100},pressure:{type:"number",description:"Atmospheric pressure in hPa",minimum:800,maximum:1200}}},connectivity:{type:"object",description:"Communication and connectivity status",required:["status"],properties:{status:{type:"string",description:"Connection status",enum:["online","offline","error","maintenance"]},signalStrength:{type:"number",description:"Signal strength in dBm",minimum:-120,maximum:-30},lastSync:{type:"string",description:"Last successful data sync timestamp",format:"date-time"},protocol:{type:"string",description:"Communication protocol used",enum:["4G","5G","WiFi","Satellite"]}}},alerts:{type:"array",description:"Active alerts and notifications",items:{type:"object",required:["type","message","severity"],properties:{type:{type:"string",description:"Alert type",enum:["low_battery","out_of_range","maintenance_due","error"]},message:{type:"string",description:"Alert description",minLength:1},severity:{type:"string",description:"Alert severity level",enum:["low","medium","high","critical"]},timestamp:{type:"string",description:"When the alert was generated",format:"date-time"}}}}}}},cellular_tracking:{title:"Cellular Mobile Tracking",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"CellularMobileTracking",type:"object",required:["mobileNumber","trackingData","timestamp"],properties:{mobileNumber:{type:"string",description:"Mobile phone number being tracked",pattern:"^\\+[1-9]\\d{1,14}$"},subscriberInfo:{type:"object",description:"Mobile subscriber identification and details",required:["imsi","msisdn"],properties:{imsi:{type:"string",description:"International Mobile Subscriber Identity",pattern:"^[0-9]{14,15}$"},msisdn:{type:"string",description:"Mobile Station International Subscriber Directory Number",pattern:"^[0-9]{12,15}$"},iccid:{type:"string",description:"Integrated Circuit Card Identifier",pattern:"^[0-9]{19,20}$"},carrier:{type:"string",description:"Mobile network operator name",minLength:1},planType:{type:"string",description:"Subscription plan type",enum:["prepaid","postpaid","corporate"]}}},trackingData:{type:"object",description:"Real-time location and movement tracking information",required:["cellTower","signalStrength"],properties:{cellTower:{type:"object",description:"Current serving cell tower information",required:["cellId","lac","mcc","mnc"],properties:{cellId:{type:"integer",description:"Cell tower identifier",minimum:1,maximum:65535},lac:{type:"integer",description:"Location Area Code",minimum:1,maximum:65535},mcc:{type:"integer",description:"Mobile Country Code",minimum:100,maximum:999},mnc:{type:"integer",description:"Mobile Network Code",minimum:0,maximum:999},coordinates:{type:"object",description:"Cell tower geographic coordinates",properties:{latitude:{type:"number",description:"Tower latitude",minimum:-90,maximum:90},longitude:{type:"number",description:"Tower longitude",minimum:-180,maximum:180}}}}},signalStrength:{type:"number",description:"Signal strength in dBm",minimum:-120,maximum:-30},networkType:{type:"string",description:"Current network technology",enum:["2G","3G","4G","5G"]},roaming:{type:"boolean",description:"Whether device is roaming"},estimatedLocation:{type:"object",description:"Estimated device location based on cell tower triangulation",properties:{latitude:{type:"number",description:"Estimated latitude",minimum:-90,maximum:90},longitude:{type:"number",description:"Estimated longitude",minimum:-180,maximum:180},accuracy:{type:"number",description:"Location accuracy in meters",minimum:100,maximum:5e4}}}}},timestamp:{type:"string",description:"Tracking data timestamp",format:"date-time"},movement:{type:"object",description:"Movement and velocity information",properties:{speed:{type:"number",description:"Movement speed in km/h",minimum:0,maximum:500},direction:{type:"number",description:"Movement direction in degrees",minimum:0,maximum:360},acceleration:{type:"number",description:"Acceleration in m/s²",minimum:-50,maximum:50},stationary:{type:"boolean",description:"Whether device is currently stationary"}}},callLog:{type:"array",description:"Recent call activity log",items:{type:"object",required:["type","timestamp","duration"],properties:{type:{type:"string",description:"Call type",enum:["incoming","outgoing","missed"]},timestamp:{type:"string",description:"Call timestamp",format:"date-time"},duration:{type:"integer",description:"Call duration in seconds",minimum:0},number:{type:"string",description:"Phone number involved in call",pattern:"^\\+[1-9]\\d{1,14}$"}}}},dataUsage:{type:"object",description:"Mobile data consumption statistics",properties:{currentPeriod:{type:"integer",description:"Data used in current billing period (MB)",minimum:0},totalLimit:{type:"integer",description:"Total data limit for period (MB)",minimum:0},lastReset:{type:"string",description:"Last data reset date",format:"date"}}}}}},license_plate:{title:"License Plate Identification",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"LicensePlateIdentification",type:"object",required:["plateNumber","detectionData","timestamp"],properties:{plateNumber:{type:"string",description:"Identified license plate number",pattern:"^[A-Z0-9\\-\\s]{2,12}$"},vehicleInfo:{type:"object",description:"Vehicle information associated with the license plate",required:["make","model"],properties:{make:{type:"string",description:"Vehicle manufacturer brand",minLength:1},model:{type:"string",description:"Vehicle model name",minLength:1},year:{type:"integer",description:"Vehicle manufacturing year",minimum:1900,maximum:2030},color:{type:"string",description:"Primary vehicle color",minLength:1},bodyType:{type:"string",description:"Vehicle body style",enum:["sedan","suv","truck","motorcycle","bus","van"]},fuelType:{type:"string",description:"Vehicle fuel type",enum:["gasoline","diesel","electric","hybrid","hydrogen"]}}},detectionData:{type:"object",description:"License plate detection and recognition details",required:["confidence","imageQuality"],properties:{confidence:{type:"number",description:"Recognition confidence score (0-100)",minimum:0,maximum:100},imageQuality:{type:"string",description:"Image quality assessment",enum:["excellent","good","fair","poor"]},processingTime:{type:"number",description:"Processing time in milliseconds",minimum:0,maximum:1e4},algorithm:{type:"string",description:"Recognition algorithm used",minLength:1},ocrVersion:{type:"string",description:"OCR software version",pattern:"^\\d+\\.\\d+\\.\\d+$"}}},timestamp:{type:"string",description:"Detection timestamp",format:"date-time"},location:{type:"object",description:"Location where the license plate was detected",required:["cameraId","coordinates"],properties:{cameraId:{type:"string",description:"Unique camera identifier",minLength:1},coordinates:{type:"object",description:"Geographic coordinates of detection point",required:["latitude","longitude"],properties:{latitude:{type:"number",description:"Detection latitude",minimum:-90,maximum:90},longitude:{type:"number",description:"Detection longitude",minimum:-180,maximum:180},altitude:{type:"number",description:"Detection altitude in meters",minimum:-1e3,maximum:1e4}}},address:{type:"string",description:"Human-readable address of detection point"},zone:{type:"string",description:"Traffic zone or area designation"}}},imageData:{type:"object",description:"Captured image and processing information",required:["imageUrl"],properties:{imageUrl:{type:"string",description:"URL to captured image",format:"uri"},thumbnailUrl:{type:"string",description:"URL to thumbnail version",format:"uri"},imageFormat:{type:"string",description:"Image file format",enum:["JPEG","PNG","BMP","TIFF"]},resolution:{type:"string",description:"Image resolution (width x height)",pattern:"^\\d+x\\d+$"},fileSize:{type:"integer",description:"Image file size in bytes",minimum:1}}},trafficViolations:{type:"array",description:"Traffic violations associated with this vehicle",items:{type:"object",required:["type","timestamp","location"],properties:{type:{type:"string",description:"Violation type",enum:["speeding","red_light","parking","toll_evasion","other"]},timestamp:{type:"string",description:"Violation timestamp",format:"date-time"},location:{type:"string",description:"Violation location description"},fine:{type:"number",description:"Fine amount in local currency",minimum:0},status:{type:"string",description:"Violation status",enum:["pending","paid","disputed","dismissed"]}}}},registration:{type:"object",description:"Vehicle registration and ownership information",properties:{ownerName:{type:"string",description:"Registered owner name",minLength:1},registrationDate:{type:"string",description:"Registration date",format:"date"},expiryDate:{type:"string",description:"Registration expiry date",format:"date"},insurance:{type:"object",description:"Insurance policy details",properties:{provider:{type:"string",description:"Insurance company name"},policyNumber:{type:"string",description:"Insurance policy number"},expiryDate:{type:"string",description:"Insurance expiry date",format:"date"}}}}}}}},product:{title:"Product",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"Product",type:"object",required:["name","price","category"],properties:{name:{type:"string",description:"Product name",minLength:1},price:{type:"number",minimum:0,description:"Product price"},category:{type:"string",description:"Product category"},description:{type:"string",description:"Product description"},inStock:{type:"boolean",description:"Product availability"},tags:{type:"array",items:{type:"string"}}}}},order:{title:"Order",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"Order",type:"object",required:["orderId","customer","items"],properties:{orderId:{type:"string",description:"Unique order identifier"},customer:{type:"object",properties:{name:{type:"string"},email:{type:"string",format:"email"}}},items:{type:"array",items:{type:"object",properties:{productId:{type:"string"},quantity:{type:"integer",minimum:1},price:{type:"number",minimum:0}}}}}}},optional_hierarchy_demo:{title:"Optional hierarchy demo",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"OptionalHierarchyDemo",type:"object",required:["userId"],properties:{userId:{type:"string",description:"Unique user identifier",minLength:1},profile:{type:"object",description:"Optional profile. If present, name and email are mandatory",required:["name","email"],properties:{name:{type:"string",description:"Full name",minLength:1},email:{type:"string",description:"Email",format:"email"},bio:{type:"string",description:"Short biography",maxLength:200},address:{type:"object",description:"Optional address. If present, street and city are mandatory",required:["street","city"],properties:{street:{type:"string",minLength:1},city:{type:"string",minLength:1},country:{type:"string"},zip:{type:"string",pattern:"^[0-9]{5}(?:-[0-9]{4})?$"}}}}},attachments:{type:"array",description:"Optional attachments. If used, fileName is mandatory",items:{type:"object",required:["fileName"],properties:{fileName:{type:"string",minLength:1},mimeType:{type:"string",pattern:"^[-w.]+/[-w.]+$"},sizeKb:{type:"integer",minimum:1}}}}}}}};p.useEffect(()=>{const e=e=>{e.ctrlKey&&"f"===e.key&&(e.preventDefault(),ee(!0),setTimeout(()=>{const e=document.getElementById("tree-search");null==e||e.focus()},50)),"Escape"===e.key&&(ee(!1),J(""),$(!1),ie(null),Te(!1),Ae(!1),$e(!1))},t=e=>{const{targetNode:t,field:r}=e.detail;if(fe.find(e=>{var n,i,a,o;const s=(null==(n=null==e?void 0:e.targetNode)?void 0:n.name)===(null==t?void 0:t.name)&&(null==(i=null==e?void 0:e.targetNode)?void 0:i.type)===(null==t?void 0:t.type),l=(null==(a=null==e?void 0:e.field)?void 0:a.name)!==(null==r?void 0:r.name)||(null==(o=null==e?void 0:e.field)?void 0:o.fieldType)!==(null==r?void 0:r.fieldType);return s&&l}))return He({targetNode:t,field:r}),Ve("drop"),void Pe(!0);ie({targetNode:t,field:r}),oe(r.name||""),le(""),ce(t.name||""),xe(!1),he("")},r=e=>{var t;console.log("Sending saved mappings to ExcelExtractor:",nt.current);const r=null==(t=e.detail)?void 0:t.callback;r&&"function"==typeof r&&r(nt.current)},n=e=>{var t;const r=null==(t=e.detail)?void 0:t.callback;r&&"function"==typeof r&&r(ye)},i=e=>{var t;const r=null==(t=e.detail)?void 0:t.key;if(r&&"string"==typeof r){ve(r);const e=dt[r];if(e){T(JSON.stringify(e.schema,null,2)),F(null);const t=D(e.schema),r=rt.current&&rt.current.length>0?rt.current:fe,n=pt(t,r);N(n),rt.current=null,window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`נטענה סכמה: ${e.title}`,type:"ok",durationMs:2500}}))}else window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"סכמה שהוטענה מהאקסל לא נמצאה",type:"error",durationMs:4e3}}))}},a=e=>{var t;const r=(null==(t=e.detail)?void 0:t.mappings)||[];r.length&&(rt.current=r,be(e=>{const t=e=>{var t,r,n,i;return`${null==(t=null==e?void 0:e.targetNode)?void 0:t.name}__${null==(r=null==e?void 0:e.targetNode)?void 0:r.type}__${null==(n=null==e?void 0:e.field)?void 0:n.name}__${null==(i=null==e?void 0:e.field)?void 0:i.fieldType}`},n=new Map;e.forEach(e=>n.set(t(e),e)),r.forEach(e=>n.set(t(e),e));const i=Array.from(n.values());return nt.current=i,i}),z&&N(pt(z,r)))};return window.addEventListener("keydown",e),window.addEventListener("excel:drop-on-node",t),window.addEventListener("excel:request-mappings",r),window.addEventListener("excel:request-selected-schema",n),window.addEventListener("excel:apply-selected-schema",i),window.addEventListener("excel:mappings-imported",a),()=>{window.removeEventListener("keydown",e),window.removeEventListener("excel:drop-on-node",t),window.removeEventListener("excel:request-mappings",r),window.removeEventListener("excel:request-selected-schema",n),window.removeEventListener("excel:apply-selected-schema",i),window.removeEventListener("excel:mappings-imported",a)}},[fe,ye,z]),p.useEffect(()=>{const e=e=>{var t;const r=e.target;Qe.current&&!Qe.current.contains(r)&&Ae(!1),et.current&&!et.current.contains(r)&&$e(!1);const n=tt.current&&tt.current.contains(r),i=null==(t=null==r?void 0:r.closest)?void 0:t.call(r,'.schema-dropdown[role="menu"]');n||i||Be(!1)};return document.addEventListener("mousedown",e,!0),()=>document.removeEventListener("mousedown",e,!0)},[]),p.useEffect(()=>{const e=()=>De(!0);return window.addEventListener("excel:uploaded",e),()=>window.removeEventListener("excel:uploaded",e)},[]),p.useEffect(()=>{if(!R)return;const e=e=>{var t,r;const n=e.target,i=null==(t=Xe.current)?void 0:t.contains(n),a=null==(r=Ze.current)?void 0:r.contains(n);i||a||$(!1)};return document.addEventListener("mousedown",e,!0),()=>document.removeEventListener("mousedown",e,!0)},[R]),p.useEffect(()=>{if(!je)return;const e=e=>{var t;const r=e.target;(null==(t=document.querySelector(".schema-selector"))?void 0:t.contains(r))||Te(!1)};return document.addEventListener("mousedown",e,!0),()=>document.removeEventListener("mousedown",e,!0)},[je]),p.useEffect(()=>{(()=>{if(document.querySelectorAll(".search-highlight").forEach(e=>{const t=e.parentNode;t.replaceChild(document.createTextNode(e.textContent||""),e),t.normalize()}),!V.trim())return;const e=document.createTreeWalker(document.querySelector(".tree-view")||document.body,NodeFilter.SHOW_TEXT,{acceptNode:e=>{const t=e.parentElement;return t&&!t.classList.contains("search-highlight")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),t=[];let r;for(;r=e.nextNode();)t.push(r);const n=new RegExp(`(${V.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");t.forEach(e=>{const t=e.textContent||"";if(n.test(t)){const r=e.parentElement,i=t.replace(n,'<span class="search-highlight">$1</span>'),a=document.createElement("div");for(a.innerHTML=i,r.replaceChild(a,e);a.firstChild;)r.insertBefore(a.firstChild,a);r.removeChild(a)}})})()},[V,z]);const ct=(e,t=[],r=[])=>{var n;const i=Array.isArray(e.rules)&&e.rules.length?e.rules.join(" "):void 0,a=[...r,e.name].slice(1).join(" -> ");return t.push({id:e.id,path:a,name:e.name,description:e.description,rulesText:i}),null==(n=e.children)||n.forEach(n=>ct(n,t,[...r,e.name])),t},pt=(e,t)=>{var r,n,i;if(!t||0===t.length)return e;const a=new Map,o=new Map;for(const l of t){const e=((null==(r=null==l?void 0:l.targetNode)?void 0:r.path)||"").trim();e&&a.set(e,l);const t=`${(null==(n=null==l?void 0:l.targetNode)?void 0:n.name)||""}__${(null==(i=null==l?void 0:l.targetNode)?void 0:i.type)||""}`;o.set(t,l)}const s=e=>{const t=(e=>(e.id||"").split(":")[0])(e),r=a.get(t),n=o.get(`${e.name}__${e.type}`),i=r||n,c=i?d(l({},e),{excelMeta:(p=i,{fieldEssence:(null==(g=null==p?void 0:p.field)?void 0:g.fieldEssence)||"",dgh:(null==(u=null==p?void 0:p.field)?void 0:u.dgh)||"",always:(null==(x=null==p?void 0:p.field)?void 0:x.always)||"",mappingDetails:(null==p?void 0:p.mappingDetails)||"",outputs:(null==p?void 0:p.outputs)||""})}):e;var p,g,u,x;return c.children&&c.children.length>0?d(l({},c),{children:c.children.map(e=>s(e))}):c};return s(e)};p.useEffect(()=>{if(!V.trim())return G([]),Z(!1),void document.querySelectorAll(".search-highlight").forEach(e=>{e.classList.remove("search-highlight")});const e=z?ct(z):[],t=V.trim().toLowerCase(),r=e.reduce((e,r)=>{const n=r.path.toLowerCase().includes(t),i=r.description||"",a=i.toLowerCase().indexOf(t),o=r.rulesText||"",s=o.toLowerCase().indexOf(t);if(n||-1!==a||-1!==s){let n;if(-1!==a){const e=40,r=60,o=Math.max(0,a-e),s=Math.min(i.length,a+t.length+r),l=o>0?"…":"",d=s<i.length?"…":"";n=`${l}${i.slice(o,s)}${d}`}else if(-1!==s){const e=40,r=60,i=Math.max(0,s-e),a=Math.min(o.length,s+t.length+r),l=i>0?"…":"",d=a<o.length?"…":"";n=`${l}${o.slice(i,a)}${d}`}e.push(d(l({},r),{snippet:n}))}return e},[]).slice(0,20);G(r),Z(r.length>0)},[z,V]);const gt=e=>Math.min(2.5,Math.max(.5,Math.round(100*e)/100));p.useEffect(()=>{const e=e=>{if(!window.__excelDragging)return;const t=Je.current;if(!t)return;const r=t.getBoundingClientRect();e.preventDefault();const n=e.deltaY>0?-.08:.08,i=Ke.current,a=gt(i+n);if(a===i)return;const o=e.clientX-r.left,s=e.clientY-r.top,l=a/i,d=Ge.current,c=o-(o-d.x)*l,p=s-(s-d.y)*l;B(a),P({x:c,y:p})},t={passive:!1};return window.addEventListener("wheel",e,t),document.addEventListener("wheel",e,t),document.body.addEventListener("wheel",e,t),window.addEventListener("mousewheel",e,t),document.addEventListener("mousewheel",e,t),document.addEventListener("DOMMouseScroll",e,t),()=>{window.removeEventListener("wheel",e),document.removeEventListener("wheel",e),document.body.removeEventListener("wheel",e),window.removeEventListener("mousewheel",e),document.removeEventListener("mousewheel",e),document.removeEventListener("DOMMouseScroll",e)}},[]),p.useEffect(()=>{nt.current=fe},[fe]),p.useEffect(()=>{Ke.current=W},[W]),p.useEffect(()=>{Ge.current=O},[O]);const ut=e=>{try{be(t=>{const r=e=>{var t,r;return`${null==(t=null==e?void 0:e.field)?void 0:t.name}__${null==(r=null==e?void 0:e.field)?void 0:r.fieldType}`},n=new Map;t.forEach(e=>n.set(r(e),e)),n.set(r(e),e);const i=Array.from(n.values());return nt.current=i,i});const t=r=>r.id===e.targetNode.id?d(l({},r),{excelMeta:{fieldEssence:e.field.fieldEssence||"",dgh:e.field.dgh||"",always:e.field.always||"",mappingDetails:e.mappingDetails||"",outputs:e.outputs||""}}):r.children?d(l({},r),{children:r.children.map(e=>t(e))}):r;if(z){const e=t(z);N(e)}window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`Mapping saved for ${e.targetNode.name}`,type:"ok",durationMs:3e3}})),window.dispatchEvent(new CustomEvent("excel:mapping-saved",{detail:{field:e.field,targetNode:e.targetNode}})),ie(null)}catch(t){console.error("Failed to save mapping:",t),alert("Failed to save mapping. Check console for details.")}},xt=(e,t)=>{e.style.transform=t?"translateY(-1px)":"translateY(0px)",e.style.boxShadow=t?"0 6px 20px rgba(0,0,0,0.35)":"none"},mt=(e,t,r)=>{if(e.dataset.baseBg||(e.dataset.baseBg=e.style.background||""),e.classList.contains("opt-orange")){if(t)return void(e.style.background="rgba(228, 184, 27, 0.55)")}else if(e.classList.contains("opt-green")&&t)return void(e.style.background="rgba(38, 216, 56, 0.55)");const n=e.dataset.baseBg;"string"==typeof n?e.style.background=n:e.style.removeProperty("background")};return p.useEffect(()=>{const e=()=>{k.current&&(window.clearTimeout(k.current),k.current=null),C.current&&(window.clearTimeout(C.current),C.current=null)},t=t=>{const{message:r,type:n,durationMs:i}=t.detail||{};e(),w(!1),S(!1),h(r||""),b(n||"ok"),requestAnimationFrame(()=>S(!0));const a="number"==typeof i?i:5e3;k.current=window.setTimeout(()=>{w(!0),C.current=window.setTimeout(()=>{h(null),w(!1),S(!1)},420)},a)};return window.addEventListener("excel:status",t),()=>{e(),window.removeEventListener("excel:status",t)}},[]),p.useEffect(()=>{const e=()=>{try{if(be([]),nt.current=[],z){const e=t=>d(l({},t),{excelMeta:void 0,children:t.children?t.children.map(e):t.children});N(e(z))}window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"נוקו כל המיפויים מהעץ",type:"ok",durationMs:2500}}))}catch(e){console.error("Failed to clear mappings:",e),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`ניקוי מיפויים נכשל: ${e}`,type:"error",durationMs:4e3}}))}};return window.addEventListener("excel:clear-all-mappings",e),()=>window.removeEventListener("excel:clear-all-mappings",e)},[z]),y.jsxs("div",{className:"page-root",children:[y.jsxs("div",{className:"app-shell",children:[y.jsxs("header",{className:"app-header floating",children:[y.jsxs("div",{className:"brand",children:[y.jsx("img",{src:"./images/logo.png",alt:"העץ הירוק",style:{height:"80px",width:"80px",objectFit:"contain",marginRight:"8px",marginTop:"-12px",marginBottom:"-12px"}}),"archive"===u&&y.jsx("div",{className:"archive-back",style:{marginRight:"16px"},children:y.jsxs("button",{className:"btn glow-blue",onClick:()=>x("status"),style:{padding:"12px 16px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl",fontFamily:"Segoe UI, sans-serif"},title:"חזור לסטטוס סגחים",children:[y.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",style:{marginLeft:"8px"},children:y.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})}),"חזרה"]})}),"analytics"===u&&y.jsx("div",{className:"analytics-back",style:{marginRight:"16px"},children:y.jsxs("button",{className:"btn glow-blue",onClick:()=>x("status"),style:{padding:"12px 16px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl",fontFamily:"Segoe UI, sans-serif"},title:"חזור לסטטוס סגחים",children:[y.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",style:{marginLeft:"8px"},children:y.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})}),"חזרה"]})}),"status"===u&&y.jsxs("div",{className:"status-controls",style:{display:"flex",alignItems:"center",gap:"12px",marginRight:"16px"},children:[y.jsxs("button",{className:"btn glow-blue",onClick:()=>x("archive"),style:{padding:"12px 16px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl",fontFamily:"Segoe UI, sans-serif"},title:"ארכיון סגחים מובצעים",children:[y.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",style:{marginLeft:"8px"},children:y.jsx("path",{d:"M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 9.5l4 4h-2.5V16h-3v-2.5H8l4-4z"})}),"ארכיון"]}),y.jsxs("button",{className:"btn glow-green",onClick:()=>x("analytics"),style:{padding:"12px 16px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl",fontFamily:"Segoe UI, sans-serif"},title:"אנליטיקות סגחים",children:[y.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",style:{marginLeft:"8px"},children:y.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"})}),"אנליטיקות"]})]}),"viz"===u&&"admin"===(null==e?void 0:e.role)&&y.jsxs("div",{className:"excel-header-actions",style:{display:"flex",alignItems:"center",gap:8},children:[y.jsxs("div",{className:"action-dropdown",ref:Qe,style:{position:"relative",width:240},children:[y.jsxs("button",{className:"btn glow-orange",style:{width:"100%",padding:"12px 14px",minHeight:"35px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl"},onClick:()=>{Ae(!Fe),$e(!1)},onMouseEnter:e=>xt(e.currentTarget,!0),onMouseLeave:e=>xt(e.currentTarget,!1),children:[y.jsx("span",{style:{marginLeft:5,marginTop:"2px",fontSize:"10px"},children:"▲"}),y.jsx("span",{style:{display:"flex",alignItems:"center",gap:6},children:y.jsx("span",{children:"העלאה"})})]}),Fe&&y.jsxs("div",{className:"schema-dropdown",style:{right:0,left:"auto",width:"100%",minWidth:"100%",border:"1px solid rgba(201, 168, 25, 0.17)",borderRadius:"12px",marginTop:"4px",maxHeight:"200px",overflowY:"auto",background:"rgba(182, 130, 32, 0.93)",boxShadow:"0 18px 44px rgba(0,0,0,0.7)",backdropFilter:"blur(48px)",overflow:"hidden"},children:[y.jsx("div",{className:"schema-option opt-orange",onClick:()=>{window.dispatchEvent(new Event("excel:upload-mapping-request")),Ae(!1)},dir:"rtl",style:{padding:"10px 12px",borderBottom:"1px solid rgba(255,255,255,0.08)",textAlign:"center",background:"rgba(10,24,45,0.98)",color:"#ffffff"},onMouseEnter:e=>mt(e.currentTarget,!0),onMouseLeave:e=>mt(e.currentTarget,!1),children:"העלה Mapping"}),y.jsx("div",{className:"schema-option opt-orange",onClick:()=>{window.dispatchEvent(new Event("excel:upload-request")),Ae(!1)},style:{padding:"10px 12px",borderBottom:"none",textAlign:"center",background:"rgba(10,24,45,0.98)",color:"#ffffff"},onMouseEnter:e=>mt(e.currentTarget,!0),onMouseLeave:e=>mt(e.currentTarget,!1),children:'העלה קובץ דג"ח'})]})]}),y.jsxs("div",{className:"action-dropdown",ref:et,style:{position:"relative",width:240},children:[y.jsxs("button",{className:"btn glow-green",style:{width:"100%",padding:"12px 14px",minHeight:"35px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl"},onClick:()=>{$e(!Re),Ae(!1)},onMouseEnter:e=>xt(e.currentTarget,!0),onMouseLeave:e=>xt(e.currentTarget,!1),children:[y.jsx("span",{style:{marginLeft:5,marginTop:"2px",fontSize:"10px"},children:"▼"}),y.jsx("span",{style:{display:"flex",alignItems:"center",textAlign:"center",justifyContent:"center",gap:6},children:y.jsx("span",{children:"הורדה"})})]}),Re&&y.jsxs("div",{className:"schema-dropdown",style:{right:0,left:"auto",width:"100%",minWidth:"100%",border:"1px solid rgba(39, 228, 22, 0.76)",borderRadius:"12px",marginTop:"4px",maxHeight:"200px",overflowY:"auto",background:"rgba(10,24,45,0.98)",boxShadow:"0 12px 32px rgba(0,0,0,0.6)",backdropFilter:"blur(40px)",overflow:"hidden"},children:[y.jsx("div",{className:"schema-option opt-green",onClick:()=>0===fe.length?(window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"No mappings to download yet",type:"warn",durationMs:2500}})),void $e(!1)):(ot.length,window.dispatchEvent(new Event("excel:download-mapping-request")),void $e(!1)),dir:"rtl",style:{padding:"10px 12px",borderBottom:"1px solid rgba(255,255,255,0.08)",textAlign:"center",background:"rgba(10,24,45,0.98)",color:"#ffffff"},onMouseEnter:e=>mt(e.currentTarget,!0),onMouseLeave:e=>mt(e.currentTarget,!1),children:"הורד Mapping"}),y.jsx("div",{className:"schema-option opt-green",onClick:()=>{window.dispatchEvent(new Event("excel:download-template-request")),$e(!1)},style:{padding:"10px 12px",borderBottom:"none",textAlign:"center",background:"rgba(10,24,45,0.98)",color:"#ffffff"},onMouseEnter:e=>mt(e.currentTarget,!0),onMouseLeave:e=>mt(e.currentTarget,!1),children:'הורד פורמט דג"ח'})]})]})]})]}),y.jsxs("div",{className:"header-actions",children:[y.jsx("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:e?y.jsxs(y.Fragment,{children:[y.jsx(Ce,{}),r()&&y.jsxs("button",{onClick:()=>s(!0),style:{padding:"8px 16px",backgroundColor:"rgba(255, 165, 0, 0.2)",color:"#ffa500",border:"1px solid rgba(255, 165, 0, 0.4)",borderRadius:"8px",fontSize:"12px",maxHeight:"35px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",transition:"all 0.2s",direction:"rtl",display:"flex",alignItems:"center",gap:"6px"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="rgba(255, 165, 0, 0.3)",e.currentTarget.style.borderColor="rgba(255, 165, 0, 0.6)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="rgba(255, 165, 0, 0.2)",e.currentTarget.style.borderColor="rgba(255, 165, 0, 0.4)"},children:[y.jsx("span",{children:"⚙️"}),"ניהול הרשאות"]})]}):y.jsx("button",{onClick:()=>a(!0),style:{padding:"8px 16px",backgroundColor:"var(--accent)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",transition:"background-color 0.2s",direction:"rtl"},onMouseOver:e=>e.currentTarget.style.backgroundColor="var(--accent-hover)",onMouseOut:e=>e.currentTarget.style.backgroundColor="var(--accent)",children:"התחבר"})}),"viz"===u&&"admin"===(null==e?void 0:e.role)&&y.jsx("div",{className:"schema-group",style:{display:"flex",alignItems:"center",gap:6},children:y.jsxs("div",{className:"schema-selector",children:[y.jsxs("button",{className:"btn ghost "+(ye?"":"is-placeholder"),onClick:()=>Te(!je),children:[ye&&dt[ye]?dt[ye].title:y.jsx("span",{className:"schema-placeholder",dir:"rtl",children:"בחר תקן"}),y.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),je&&y.jsx("div",{className:"schema-dropdown",children:Object.entries(dt).map(([e,t])=>y.jsx("div",{className:"schema-option",onClick:()=>{ve(e),Te(!1)},children:t.title},e))})]})}),"viz"===u&&"admin"===(null==e?void 0:e.role)&&y.jsxs(y.Fragment,{children:[y.jsx("button",{className:"btn ghost",onClick:lt,style:{display:"flex",padding:"12px 14px",maxHeight:"35px",justifyContent:"center",alignItems:"center",alignSelf:"center"},children:"נקה"}),y.jsx("button",{className:"btn primary",onClick:st,style:{display:"flex",padding:"12px 14px",maxHeight:"35px",justifyContent:"center",alignItems:"center",alignSelf:"center"},children:"ויזואליזציה"}),y.jsx("div",{className:"zoom-controls",children:y.jsxs("div",{className:"zoom-readout",children:[Math.round(100*W),"%"]})})]}),"admin"===(null==e?void 0:e.role)&&y.jsx("div",{ref:Xe,className:"input-dropdown anchored "+(R?"open":""),children:y.jsxs("div",{className:"panel input dropdown",children:[y.jsx("div",{className:"panel-title",children:"קלט JSON"}),y.jsx("textarea",{className:"json-input",spellCheck:!1,placeholder:"הדבק JSON כאן...",value:E,onChange:e=>T(e.target.value)}),y.jsxs("div",{className:"panel-footer",children:[L?y.jsx("div",{className:"notice error",children:L}):y.jsx("div",{className:"notice ok",children:it?`זוהה: ${it}`:"ממתין ל-JSON תקין..."}),y.jsx("div",{style:{display:"flex",gap:8},children:y.jsx("button",{className:"btn primary",onClick:st,style:{padding:"12px 14px",minHeight:"48px"},children:"ויזואליזציה"})})]})]})}),"common"===u&&"admin"===(null==e?void 0:e.role)&&y.jsx("div",{className:"notification-container",children:y.jsxs("button",{className:"notification-btn",onClick:()=>console.log("Notifications clicked"),children:[y.jsx("svg",{className:"notification-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:y.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"})}),y.jsx("span",{className:"notification-count",children:"3"})]})}),y.jsxs("div",{className:"action-dropdown",ref:tt,style:{position:"relative"},children:[y.jsx("button",{className:"btn ghost","aria-haspopup":"menu","aria-expanded":We?"true":"false",onClick:()=>{console.log("Hamburger clicked, current isNavOpen:",We,"activeScreen:",u),Be(!We)},title:"ניווט",children:y.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:[y.jsx("rect",{x:"3",y:"6",width:"18",height:"2",rx:"1"}),y.jsx("rect",{x:"3",y:"11",width:"18",height:"2",rx:"1"}),y.jsx("rect",{x:"3",y:"16",width:"18",height:"2",rx:"1"})]})}),We&&y.jsxs("div",{className:"schema-dropdown",style:{right:0,left:"auto",minWidth:220,position:"absolute"},role:"menu",dir:"rtl",children:["admin"===(null==e?void 0:e.role)&&y.jsx("div",{className:"schema-option",role:"menuitem",onClick:()=>{console.log("Clicking viz option"),x("viz"),Be(!1),Ae(!1),$e(!1),Te(!1)},onMouseEnter:()=>console.log("Hovering over viz option"),onMouseLeave:()=>console.log("Leaving viz option"),style:{position:"relative",padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",pointerEvents:"auto",zIndex:9999999},children:"ויואליזציה + Mapping"}),"admin"===(null==e?void 0:e.role)&&y.jsx("div",{className:"schema-option",role:"menuitem",onClick:()=>{console.log("Clicking dictionary option"),x("dictionary"),Be(!1),Ae(!1),$e(!1),Te(!1)},onMouseEnter:()=>console.log("Hovering over dictionary option"),onMouseLeave:()=>console.log("Leaving dictionary option"),style:{position:"relative",padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",pointerEvents:"auto",zIndex:9999999},children:"מילון התקן"}),y.jsx("div",{className:"schema-option",role:"menuitem",onClick:()=>{console.log("Clicking status option"),x("status"),Be(!1),Ae(!1),$e(!1),Te(!1)},onMouseEnter:()=>console.log("Hovering over status option"),onMouseLeave:()=>console.log("Leaving status option"),style:{position:"relative",padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",pointerEvents:"auto",zIndex:9999999},children:'סטטוס סג"חים'})]})]})]})]}),"viz"===u&&"admin"===(null==e?void 0:e.role)?y.jsxs("main",{className:"app-main full-screen has-extractor",children:[y.jsx(A,{}),Q&&y.jsxs("div",{className:"search-overlay",children:[y.jsxs("div",{className:"search-box",children:[y.jsx("input",{id:"tree-search",type:"text",placeholder:"Search cubes and descriptions...",value:V,onChange:e=>J(e.target.value),className:"search-input"}),y.jsx("button",{onClick:()=>{ee(!1),J("")},className:"search-close",children:"×"})]}),X&&y.jsx("div",{className:"search-results",children:K.map(e=>y.jsxs("div",{className:"search-result-item",onClick:()=>{(e=>{document.querySelectorAll(".search-highlight").forEach(e=>{e.classList.remove("search-highlight")});const t=e.split(":")[0].split(".");(()=>{const e=document.querySelector(".tree-root .node-tile"),r=null==e?void 0:e.getBoundingClientRect(),n=r?r.left+r.width/2:window.innerWidth/2;for(let i=1;i<=t.length;i++){const e=t.slice(0,i).join("."),r=document.querySelector(`[data-node-id^="${e}:"]`);if(r){const e=r.closest(".tree-li"),t=null==e?void 0:e.querySelector(".node-tile"),i=null==e?void 0:e.querySelector(".binary-children");if(t&&i&&(!i.classList.contains("open")||!("hidden"!==i.style.overflow||i.offsetHeight>0))){const r=t.getBoundingClientRect(),i=r.left+r.width/2<n?"left":"right";e&&(e.dataset.forceSide=i),t.click(),requestAnimationFrame(()=>{const e=new CustomEvent("search:layout-update",{detail:{forceSide:i}});t.dispatchEvent(e)})}}}})();const r=document.querySelector(`[data-node-id="${e}"]`);r&&setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{r.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),r.classList.add("search-highlight"),setTimeout(()=>r.classList.remove("search-highlight"),3e3)})})},100)})(e.id),Z(!1)},children:[y.jsx("div",{className:"search-result-path",children:e.path}),e.snippet&&y.jsx("div",{className:"search-snippet",dangerouslySetInnerHTML:{__html:(e=>{const t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=new RegExp(`(${(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))(V)})`,"gi");return t.replace(r,'<span class="search-snippet-highlight">$1</span>')})(e.snippet)}})]},e.id))})]}),y.jsx("section",{className:"viz-section",onWheel:e=>{var t;if(window.__excelDragging)return;e.preventDefault();const r=e.deltaY>0?-.08:.08,n=gt(W+r);if(n!==W){const r=(null!=(t=Je.current)?t:e.currentTarget).getBoundingClientRect(),i=e.clientX-r.left,a=e.clientY-r.top,o=O.x,s=O.y,l=n/W,d=i-(i-o)*l,c=a-(a-s)*l;B(n),P({x:d,y:c})}},children:y.jsx("div",{className:"full-viz",onMouseDown:e=>{0===e.button&&(U(!0),H({x:e.clientX-O.x,y:e.clientY-O.y}))},onMouseMove:e=>{_&&P({x:e.clientX-q.x,y:e.clientY-q.y})},onMouseUp:()=>U(!1),onMouseLeave:()=>U(!1),children:y.jsxs("div",{className:"viz-wrapper",ref:Je,style:{transform:`translate(${O.x}px, ${O.y}px) scale(${W})`},children:[z?y.jsx(I,{root:z}):y.jsx("div",{className:"placeholder",children:"בחר סכמה ולחץ על ויזואליזציה"}),z&&y.jsx(M,{containerRef:Je})]})})})]}):"dictionary"===u&&"admin"===(null==e?void 0:e.role)?y.jsx(ue,{schemas:dt}):"common"===u&&"admin"===(null==e?void 0:e.role)?y.jsx(ne,{}):"status"===u?y.jsx(ge,{}):"archive"===u?y.jsx(we,{onBack:()=>x("status")}):"analytics"===u?y.jsx(Se,{}):e&&"admin"!==e.role?y.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",padding:"40px",textAlign:"center",direction:"rtl"},children:y.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(255,165,0,0.1), rgba(255,165,0,0.05))",border:"1px solid rgba(255,165,0,0.3)",borderRadius:"16px",padding:"40px",maxWidth:"600px",boxShadow:"0 8px 32px rgba(0,0,0,0.1)"},children:[y.jsx("div",{style:{fontSize:"48px",marginBottom:"20px",color:"var(--accent)"},children:"🔒"}),y.jsx("h2",{style:{color:"var(--text)",fontSize:"24px",fontWeight:"600",marginBottom:"16px"},children:"גישה מוגבלת"}),y.jsxs("p",{style:{color:"var(--muted)",fontSize:"16px",lineHeight:"1.6",marginBottom:"24px"},children:["רק מנהלים יכולים לגשת למסכי העץ, הבנק והמרחב המשותף.",y.jsx("br",{}),'אתה יכול לגשת למסך סטטוס הסג"חים בלבד.']}),y.jsx("div",{style:{display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap"},children:y.jsxs("div",{style:{background:"rgba(124,192,255,0.1)",border:"1px solid rgba(124,192,255,0.3)",borderRadius:"8px",padding:"12px 16px",fontSize:"14px",color:"var(--accent)"},children:[y.jsx("strong",{children:"תפקיד נוכחי:"})," ","viewer"===e.role?"צופה":"editor"===e.role?"עורך":"מנהל"]})})]})}):null,"viz"===u&&z&&"admin"===(null==e?void 0:e.role)&&y.jsxs("div",{className:"required-panel "+(Ne?"open":"collapsed"),children:[y.jsxs("div",{className:"required-header",dir:"rtl",onClick:()=>Ie(e=>!e),children:[y.jsx("div",{className:"required-title",children:"שדות חובה בתקן:"}),y.jsx("button",{className:"required-toggle","aria-label":Ne?"סגור":"פתח",children:Ne?"▲":"▼"})]}),Ne&&y.jsx("div",{className:"required-body",dir:"rtl",children:0===ot.length?y.jsx("div",{className:"required-empty",children:"אין שדות חובה חסרים"}):y.jsx("ul",{className:"required-list",children:ot.map(e=>y.jsxs("li",{className:"req-item","data-state":"required",title:e.path,children:[y.jsx("span",{className:"req-dot","aria-hidden":"true"}),y.jsx("span",{className:"req-text",children:e.path})]},e.id))})})]}),m&&y.jsx("div",{className:`toast-bottom ${f} ${v?"leaving":""} ${j?"show":""}`,dir:"rtl",children:m}),te&&y.jsx("div",{className:"modal-overlay",onClick:()=>ie(null),children:y.jsx("div",{className:"modal",onClick:e=>e.stopPropagation(),children:y.jsxs("div",{style:{padding:"24px"},children:[y.jsx("h2",{style:{margin:"0 0 20px 0",fontSize:"18px",fontWeight:"600"},children:"Field Mapping"}),y.jsxs("div",{className:"mapping-grid",style:{gridTemplateColumns:pe?"1fr auto 1fr auto 1fr auto 1fr":"1fr auto 1fr auto 1fr",alignItems:"center"},children:[y.jsxs("div",{className:"map-col",children:[y.jsx("div",{className:"small-h",dir:"rtl",style:{textAlign:"center"},children:"שדה בתקן"}),y.jsxs("div",{className:"map-card",style:{textAlign:"center"},children:[y.jsx("div",{className:"map-main",children:te.targetNode.name}),y.jsx("div",{className:"map-sub",children:te.targetNode.type}),y.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",marginTop:"8px"},children:[y.jsxs("div",{children:[y.jsx("strong",{children:"Description:"})," ",te.targetNode.description||"No description"]}),te.targetNode.rules&&te.targetNode.rules.length>0&&y.jsxs("div",{children:[y.jsx("strong",{children:"Rules:"})," ",te.targetNode.rules.join(", ")]}),te.targetNode.valuePreview&&y.jsxs("div",{children:[y.jsx("strong",{children:"Preview:"})," ",te.targetNode.valuePreview]})]})]})]}),y.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"0 8px"},children:y.jsx("span",{style:{fontSize:"24px",color:"var(--muted)"},children:"←"})}),pe&&y.jsxs(y.Fragment,{children:[y.jsxs("div",{className:"map-col",children:[y.jsx("div",{className:"small-h",dir:"rtl",style:{textAlign:"center"},children:"רק בOUTPUTS"}),y.jsx("div",{className:"map-card",children:y.jsx("textarea",{className:"map-notes",placeholder:"Specify outputs...",value:me,onChange:e=>he(e.target.value),style:{minHeight:"120px",textAlign:"center"}})})]}),y.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"0 8px"},children:y.jsx("span",{style:{fontSize:"24px",color:"var(--muted)"},children:"←"})})]}),y.jsxs("div",{className:"map-col",children:[y.jsx("div",{className:"small-h",dir:"rtl",style:{textAlign:"center"},children:"פירוט הפרסר"}),y.jsx("div",{className:"map-card",children:y.jsx("textarea",{className:"map-notes",placeholder:"Define mapping logic...",value:se,onChange:e=>le(e.target.value),style:{minHeight:"120px",textAlign:"center"}})})]}),y.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"0 8px"},children:y.jsx("span",{style:{fontSize:"24px",color:"var(--muted)"},children:"←"})}),y.jsxs("div",{className:"map-col",children:[y.jsx("div",{className:"small-h",dir:"rtl",style:{textAlign:"center"},children:'שדה מהדג"ח'}),y.jsxs("div",{className:"map-card",style:{textAlign:"center"},children:[y.jsx("div",{className:"map-main",children:te.field.name}),y.jsx("div",{className:"map-sub",children:te.field.fieldType}),y.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",marginTop:"8px"},children:[y.jsxs("div",{children:[y.jsx("strong",{children:"מהות השדה:"})," ",te.field.fieldEssence||"-"]}),y.jsxs("div",{children:[y.jsx("strong",{children:'דג"ח:'})," ",te.field.dgh||"-"]}),y.jsxs("div",{children:[y.jsx("strong",{children:"האם יחזור תמיד:"})," ",te.field.always||"-"]})]})]})]})]}),y.jsx("div",{style:{marginTop:"20px",display:"flex",alignItems:"center",gap:"12px"},children:y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"14px"},children:[y.jsx("input",{type:"checkbox",checked:pe,onChange:e=>xe(e.target.checked),style:{width:"16px",height:"16px",accentColor:"var(--accent)",cursor:"pointer"}}),y.jsx("span",{dir:"rtl",children:"הפרסור יתבצע רק בoutputs ספציפיים"})]})}),y.jsxs("div",{style:{marginTop:"24px",display:"flex",gap:"12px",justifyContent:"flex-end"},children:[y.jsx("button",{className:"btn ghost",onClick:()=>ie(null),children:"Cancel"}),y.jsx("button",{className:"btn primary",onClick:()=>{try{const e={targetNode:te.targetNode,field:te.field,mappingDetails:se,outputs:me,timestamp:Date.now()};ut(e)}catch(e){console.error("Failed to prepare mapping:",e),alert("Failed to save mapping. Check console for details.")}},children:"Save Mapping"})]})]})})}),Oe&&y.jsx("div",{className:"modal-overlay",onClick:()=>{Pe(!1),Ue(null)},children:y.jsx("div",{className:"modal",onClick:e=>e.stopPropagation(),children:y.jsxs("div",{style:{padding:"20px"},dir:"rtl",children:[y.jsx("h3",{style:{margin:"0 0 12px 0",textAlign:"center"},children:"זהירות!"}),y.jsx("p",{style:{margin:"0 0 16px 0",textAlign:"center"},children:'אתם משתמשים בשדה בתקן שכבר נמצא בשימוש עם שדה אחר בדג"ח! אתם בטוחים שאתם רוצים להמשיך?'}),y.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[y.jsx("button",{className:"btn ghost",onClick:()=>{Pe(!1),Ue(null),He(null),Ve(null)},children:"בטל"}),y.jsx("button",{className:"btn primary",onClick:()=>{if("drop"===Ye&&qe){const{targetNode:e,field:t}=qe;ie({targetNode:e,field:t}),oe(t.name||""),le(""),ce(e.name||""),xe(!1),he("")}else"save"===Ye&&_e&&ut(_e);Pe(!1),Ue(null),He(null),Ve(null)},children:"המשך"})]})]})})}),Me&&y.jsx("div",{className:"modal-overlay",onClick:()=>Le(!1),children:y.jsx("div",{className:"modal",onClick:e=>e.stopPropagation(),children:y.jsxs("div",{style:{padding:"20px"},dir:"rtl",children:[y.jsx("h3",{style:{margin:"0 0 12px 0",textAlign:"center"},children:"חסרים שדות חובה"}),y.jsxs("p",{style:{margin:"0 0 16px 0",textAlign:"center"},children:["ישנם ",ot.length," שדות חובה שעדיין לא מולאו."]}),y.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[y.jsx("button",{className:"btn ghost",onClick:()=>Le(!1),children:"בטל"}),y.jsx("button",{className:"btn primary",onClick:()=>{window.dispatchEvent(new Event("excel:download-mapping-request")),Le(!1)},children:"הורד בכל זאת"})]})]})})})]}),y.jsx(ke,{isOpen:i,onClose:()=>a(!1)}),y.jsx(Ee,{isOpen:o,onClose:()=>s(!1)})]})}function De(){return y.jsx(Te,{children:y.jsx(H,{children:y.jsx(te,{children:y.jsx(ze,{})})})})}v.createRoot(document.getElementById("root")).render(y.jsx(u.StrictMode,{children:y.jsx(De,{})}))}},function(){return b||(0,f[n(f)[0]])((b={exports:{}}).exports,b),b.exports});export default y();
