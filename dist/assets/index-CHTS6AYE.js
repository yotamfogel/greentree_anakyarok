var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertyNames,i=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,l=(e,t)=>{for(var r in t||(t={}))a.call(t,r)&&s(e,r,t[r]);if(i)for(var r of i(t))o.call(t,r)&&s(e,r,t[r]);return e},d=(e,n)=>t(e,r(n)),c=(e,t,r)=>s(e,"symbol"!=typeof t?t+"":t,r),p=(e,t,r)=>new Promise((n,i)=>{var a=e=>{try{s(r.next(e))}catch(t){i(t)}},o=e=>{try{s(r.throw(e))}catch(t){i(t)}},s=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,o);s((r=r.apply(e,t)).next())});import{j as u}from"./window-BAetggk2.js";import{a as g,r as x,R as h}from"./vendor-BGBPj_TM.js";import{e as m}from"./excel-B-g06joY.js";var f,y,b=(f={"assets/index-CHTS6AYE.js"(e){!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var t={},r=g;t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot;let n=0;function i(){return n+=1,String(n)}function a(e){if(null===e)return"null";const t=typeof e;return Array.isArray(e)?"array":"object"===t?"object":"string"===t?"string":"number"===t?Number.isInteger(e)?"integer":"number":"boolean"===t?"boolean":"unknown"}function o(e,t,r=[]){const n=a(t),{description:s,preview:l,excelMeta:d}=function(e,t){try{switch(t){case"string":{const t=String(e),r=t.length>64?t.slice(0,61)+"…":t;return{description:`String of length ${t.length}.`,preview:'"'+r+'"'}}case"number":return{description:"Floating-point numeric value."};case"integer":return{description:"Numeric value."};case"boolean":return{description:"Boolean value."};case"null":return{description:"Null value."};case"array":{const t=Array.isArray(e)?e:[],r=t.length,n=r>0?a(t[0]):"unknown",i=t.slice(0,5).map(e=>function(e){const t=a(e);return"string"===t?'"'+String(e).replace(/\s+/g," ").slice(0,24)+(String(e).length>24?"…":"")+'"':"number"===t||"boolean"===t||"null"===t?String(e):"array"===t?"[…]":"object"===t?"{…}":String(e)}(e));return{description:`Array with ${r} item${1===r?"":"s"}${"unknown"!==n?` (e.g., ${n})`:""}.`,preview:`[${i.join(", ")}${r>5?", …":""}]`}}case"object":{const t=e&&"object"==typeof e?e:{};if("preview"in t||"excelMeta"in t)return{description:void 0,preview:"string"==typeof t.preview?t.preview:void 0,excelMeta:t.excelMeta};const r=Object.keys(t),n=r.slice(0,5);return{description:`Object with ${r.length} key${1===r.length?"":"s"}.`,preview:`{ ${n.join(", ")}${r.length>5?", …":""} }`}}default:return{}}}catch(r){return{}}}(t,n),c={id:(r.length?r.join("."):"root")+":"+i(),name:e,type:n,description:s,valuePreview:l,excelMeta:d};if("object"===n){const e=t;if(e&&(Object.prototype.hasOwnProperty.call(e,"preview")||Object.prototype.hasOwnProperty.call(e,"excelMeta")))return c.type="string",c;const n=Object.keys(e).sort();c.children=n.map(t=>o(t,e[t],[...r,t]))}else if("array"===n){const e=t;c.children=e.map((e,t)=>o(`[${t}]`,e,[...r,String(t)]))}return c}function s(e){const t=[];return e.enum&&t.push(`enum: ${e.enum.map(e=>JSON.stringify(e)).join(", ")}`),void 0!==e.const&&t.push(`const: ${JSON.stringify(e.const)}`),e.pattern&&t.push(`pattern: ${e.pattern}`),"number"==typeof e.minLength&&t.push(`minLength: ${e.minLength}`),"number"==typeof e.maxLength&&t.push(`maxLength: ${e.maxLength}`),e.format&&t.push(`format: ${e.format}`),"number"==typeof e.minimum&&t.push(`minimum: ${e.minimum}`),"number"==typeof e.maximum&&t.push(`maximum: ${e.maximum}`),"number"==typeof e.exclusiveMinimum&&t.push(`exclusiveMinimum: ${e.exclusiveMinimum}`),"number"==typeof e.exclusiveMaximum&&t.push(`exclusiveMaximum: ${e.exclusiveMaximum}`),"number"==typeof e.multipleOf&&t.push(`multipleOf: ${e.multipleOf}`),t.length?t:void 0}function f(e,t,r=[],n=!0){var a,o,l;const d=function(e){const t=Array.isArray(e.type)?e.type[0]:e.type;return t?"integer"===t?"integer":"number"===t?"number":"string"===t?"string":"boolean"===t?"boolean":"null"===t?"null":"array"===t?"array":"object":"object"}(t),c={id:(r.length?r.join("."):"root")+":"+i(),name:e,type:d,description:t.description,rules:s(t)},p=Array.isArray(t.allOf)&&t.allOf.length>0?t.allOf.map((e,t)=>{var i;const a=e.title||`[allOf ${t+1}]`,o=(null==(i=e.title)?void 0:i.replace(/\s+/g,"_"))||`allOf_${t+1}`;return f(a,e,[...r,o],n)}):[];if("object"===d){const e=null!=(a=t.properties)?a:{},i=Object.keys(e).sort(),s=new Set(null!=(o=t.required)?o:[]),l=i.map(t=>{const i=e[t],a=s.has(t),o=f(t,i,[...r,t],a&&n);return o.requiredState=a?n?"required":"conditional":"optional",o});c.children=[...l,...p]}else if("array"===d){const e=t.items;Array.isArray(e)?c.children=e.map((e,t)=>f(`[${t}]`,e,[...r,String(t)],n)):e&&(c.children=[f("[item]",e,[...r,"item"],n)]),p.length&&(c.children=(null!=(l=c.children)?l:[]).concat(p))}else p.length&&(c.children=p);return c}function y(e){if(function(e){if(!e||"object"!=typeof e)return!1;const t=e;return"$schema"in t||"properties"in t&&"object"==typeof t.properties||"type"in t&&("object"===t.type||"array"===t.type)}(e)){const t=e;return f(t.title||"root",t,[],!0)}return o("root",e)}const b=x.memo(function e({node:t,depth:r,isRoot:n=!1,defaultOpenChildren:i=!1,forcePreferredSide:a}){var o,s,c,p;const[g,h]=x.useState(i||0===r),[m,f]=x.useState(!1),[y,b]=x.useState(null!=a?a:"right"),[v,w]=x.useState(!1),S=x.useRef(null),j=x.useRef(0),k=(null!=(s=null==(o=t.children)?void 0:o.length)?s:0)>0,C=x.useMemo(()=>{const e=1.8*Math.pow(.85,r);return Math.max(.5,e)},[r]),E=x.useMemo(()=>{if(!k||!t.children)return!1;const e=t.children.filter(e=>"required"===e.requiredState);return 0!==e.length&&e.every(e=>e.excelMeta&&Object.keys(e.excelMeta).length>0)},[k,t.children]),T=x.useMemo(()=>{const e={"--scale":String(C),"--indicator-border":"rgba(255,255,255,0.20)","--indicator-bg":k?"linear-gradient(180deg, rgba(124,192,255,0.22), rgba(124,192,255,0.10))":"linear-gradient(180deg, rgba(255,140,26,0.22), rgba(255,140,26,0.10))","--indicator-shadow":"inset 0 1px 0 rgba(255,255,255,0.14), 0 10px 24px rgba(0,0,0,0.35)"};if(t.excelMeta&&Object.keys(t.excelMeta).length>0||E){const t=d(l({},e),{borderColor:"rgba(76,175,80,0.45)",background:"linear-gradient(180deg, rgba(76,175,80,0.12), rgba(76,175,80,0.06))",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.14), 0 12px 28px rgba(76,175,80,0.24)","--indicator-border":"rgba(76,175,80,0.45)","--indicator-bg":"linear-gradient(180deg, rgba(76,175,80,0.20), rgba(76,175,80,0.10))","--indicator-shadow":"inset 0 1px 0 rgba(255,255,255,0.14), 0 12px 28px rgba(76,175,80,0.24)"});return v&&(t.borderColor="rgba(76,175,80,0.85)",t.boxShadow="inset 0 1px 0 rgba(255,255,255,0.14), 0 0 0 2px rgba(76,175,80,0.85), 0 0 28px rgba(76,175,80,0.46)"),v&&k&&(t.cursor='url("./cursors/circle.cur"), copy'),t}if("required"===t.requiredState){const t=d(l({},e),{borderColor:"rgba(255,80,80,0.45)",background:"linear-gradient(180deg, rgba(255,80,80,0.12), rgba(255,80,80,0.06))",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.14), 0 12px 28px rgba(255,80,80,0.24)","--indicator-border":"rgba(255,80,80,0.45)","--indicator-bg":"linear-gradient(180deg, rgba(255,80,80,0.20), rgba(255,80,80,0.10))","--indicator-shadow":"inset 0 1px 0 rgba(255,255,255,0.14), 0 12px 28px rgba(255,80,80,0.24)"});return v&&(t.borderColor="rgba(255,80,80,0.85)",t.boxShadow="inset 0 1px 0 rgba(255,255,255,0.14), 0 0 0 2px rgba(255,80,80,0.85), 0 0 28px rgba(255,80,80,0.46)"),v&&k&&(t.cursor='url("./cursors/circle.cur"), copy'),t}return v&&k&&(e.cursor='url("./cursors/circle.cur"), copy'),e},[t.requiredState,C,k,v,t.excelMeta,E]),D=x.useMemo(()=>{var e;const r=null!=(e=t.children)?e:[],n=[];for(let t=0;t<r.length;t++)n.push({left:r[t],right:void 0});return n},[t.children]),N=x.useRef([]),z=x.useRef(null),I=e=>{var t;try{if(!0===window.__excelDragging)return!0;const r=null==(t=e.dataTransfer)?void 0:t.types;if(r){const e=Array.from(r);if(e.includes("application/vnd.excel-field"))return!0;if(e.includes("application/json"))return!0}}catch(r){}return!1};x.useEffect(()=>{g&&S.current&&(window.clearTimeout(S.current),S.current=null)},[g]);const M=e=>{const{detail:t}=e;(null==t?void 0:t.forceSide)&&(b(t.forceSide),A(),L(6))},L=(e=8)=>{let r=0;const n=()=>{(()=>{var e;let r=null;const n=null==(e=z.current)?void 0:e.querySelector(":scope > .tree-node"),i=null==n?void 0:n.querySelector(".node-tile");if(i){const e=i.getBoundingClientRect();r=e.left+e.width/2}const o=document.querySelector('svg[data-role="connectors"]'),s=[];o&&o.querySelectorAll('path[data-orientation="trunk"]').forEach(e=>{const t=parseFloat(e.getAttribute("data-x")||"NaN"),r=parseFloat(e.getAttribute("data-y1")||"NaN"),n=parseFloat(e.getAttribute("data-y2")||"NaN"),i=e.getAttribute("data-parent-id")||void 0;Number.isNaN(t)||Number.isNaN(r)||Number.isNaN(n)||s.push({x:t,y1:r,y2:n,parentId:i})});let l=0,d=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(N.current.forEach(e=>{if(!e)return;const t=e.getBoundingClientRect();d=Math.min(d,t.top),c=Math.max(c,t.bottom)}),d<c){const e=(d+c)/2;s.forEach(({x:n,y1:i,y2:a,parentId:o})=>{if(o&&o===t.id)return;if(e<i||e>a)return;const s=Math.min(120,Math.min(120,.08*window.innerWidth)),d=n-18,c=n+18,p=(null!=r?r:0)+l-s,u=(null!=r?r:0)+l+s;if(!(u<d||p>c))if(null!=r&&n>=r){const e=Math.max(0,c-p);l-=e}else{const e=Math.max(0,u-d);l+=e}})}const p=Math.min(200,.12*window.innerWidth);l=Math.max(-p,Math.min(p,l));const u=null!=a?a:y;"left"===u&&(l=Math.min(0,l)),"right"===u&&(l=Math.max(0,l)),N.current.forEach(e=>{if(!e)return;const t=Math.min(120,Math.min(120,.08*window.innerWidth));e.style.setProperty("--child-spread",`${t.toFixed(2)}px`),e.style.setProperty("--branch-offset",`${l.toFixed(2)}px`)})})(),r+=1,r<e&&requestAnimationFrame(n)};requestAnimationFrame(n)},A=()=>{var e;if(a)return void b(a);const r=z.current,n=null==r?void 0:r.dataset.forceSide;if(n)return b(n),void delete r.dataset.forceSide;const i=null==(e=z.current)?void 0:e.querySelector(":scope > .tree-node"),o=null==i?void 0:i.querySelector(".node-tile");if(!o)return;const s=o.getBoundingClientRect(),l=s.left+s.width/2,d=s.top+s.height/2,c=document.querySelector('svg[data-role="connectors"]');let p=null;if(c&&c.querySelectorAll('path[data-orientation="trunk"]').forEach(e=>{if(e.getAttribute("data-parent-id")===t.id)return;const r=parseFloat(e.getAttribute("data-x")||"NaN"),n=parseFloat(e.getAttribute("data-y1")||"NaN"),i=parseFloat(e.getAttribute("data-y2")||"NaN");Number.isNaN(r)||Number.isNaN(n)||Number.isNaN(i)||d<n||d>i||(null==p||Math.abs(r-l)<Math.abs(p-l))&&(p=r)}),null!=p)b(l<p?"left":"right");else{const e=384,t=window.innerWidth-e;b(l<e+t/2?"left":"right")}};return u.jsxs("li",{ref:z,className:"tree-li "+(n?"root":""),role:n?"treeitem":"none","aria-expanded":k?g:void 0,children:[u.jsxs("div",{className:"tree-node","data-depth":r,children:[u.jsx("div",{className:"node-row",style:{paddingLeft:0},children:u.jsxs("div",{ref:e=>{e&&e.addEventListener("search:layout-update",M)},className:"node-tile "+(m?"active":""),role:"button",tabIndex:0,onDragEnter:e=>{if(I(e))return j.current+=1,w(!0),void(!k||g||S.current||(S.current=window.setTimeout(()=>{h(!0),A(),L(6)},500)))},onDragOver:e=>{if(I(e))return k?(e.preventDefault(),e.dataTransfer.dropEffect="copy",g||S.current||(S.current=window.setTimeout(()=>{h(!0),A(),L(6)},500))):(e.preventDefault(),e.dataTransfer.dropEffect="copy"),void w(!0);e.preventDefault()},onDrop:e=>{try{const r=e.dataTransfer.getData("application/json");if(!r)return;const n=JSON.parse(r);if("excelField"===(null==n?void 0:n.kind))if(k){const e=`${t.name} אינו שדה בתקן אלא היררכיה, אפשר להכניס שדות מהאקסל רק לשדות בתקן בעלי סממן ⓘ מעל הקובייה.`;window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:e,type:"error",durationMs:5e3}}))}else window.dispatchEvent(new CustomEvent("excel:drop-on-node",{detail:{targetNode:t,field:n.field}}))}catch(r){}w(!1),j.current=0,S.current&&(window.clearTimeout(S.current),S.current=null)},onDragLeave:()=>{j.current=Math.max(0,j.current-1),0===j.current&&(w(!1),S.current&&(window.clearTimeout(S.current),S.current=null))},onClick:()=>{var e;if(k){const t=void 0!==(null==(e=z.current)?void 0:e.dataset.forceSide);h(e=>{const r=!!t||!e;return r&&(A(),L(6),t&&z.current&&delete z.current.dataset.forceSide),r})}else f(e=>!e)},onContextMenu:e=>{e.preventDefault(),f(e=>!e)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||f(e=>!e)},style:T,"data-node-id":t.id,"data-dragover":v?"1":"0","data-mapped":t.excelMeta&&Object.keys(t.excelMeta).length>0?"1":"0","data-all-mandatory-mapped":E?"1":"0","data-required":t.requiredState||void 0,children:[u.jsx("div",{className:"node-indicator",role:"button",tabIndex:0,"aria-label":k?g?"Collapse":"Expand":"No children",onClick:e=>{var t;if(e.stopPropagation(),k){const e=void 0!==(null==(t=z.current)?void 0:t.dataset.forceSide);h(t=>{const r=!!e||!t;return r&&(A(),L(6),e&&z.current&&delete z.current.dataset.forceSide),r})}else f(e=>!e)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.stopPropagation(),e.preventDefault(),e.currentTarget.click())},"data-openable":k?"1":"0","data-dir":k?"left"===y?"left":"right":"none","data-open":g?"1":"0"}),u.jsx("div",{className:"node-name",children:t.name}),u.jsx("div",{className:`node-type under t-${t.type}`,children:t.type})]})}),u.jsx("div",{className:"desc-panel "+(m?"open":""),"data-node-id":`${t.id}-desc`,children:u.jsxs("div",{className:"desc-content",children:[u.jsx("div",{className:"desc-title",children:"Description"}),u.jsx("div",{className:"desc-text",children:t.description||"No description available."}),t.rules&&t.rules.length>0&&u.jsxs("div",{className:"desc-preview",children:[u.jsx("span",{className:"label",children:"Rules:"}),u.jsx("div",{style:{display:"grid",gap:4},children:t.rules.map((e,t)=>u.jsx("code",{children:e},t))})]}),t.valuePreview&&u.jsxs("div",{className:"desc-preview",children:[u.jsx("span",{className:"label",children:"Preview"}),u.jsx("code",{children:t.valuePreview})]})]})})]}),k&&!n&&u.jsx("div",{className:"binary-children "+(g?"open":""),"data-parent-id":t.id,style:{overflow:g?"visible":void 0,transform:`translateX(${"left"===(null!=a?a:y)?"-140px":"140px"})`},children:D.map((t,n)=>u.jsxs("div",{className:"branch-row",ref:e=>N.current[n]=e,style:{zIndex:10+n},children:[t.left?u.jsx("div",{className:"branch-cell left",children:u.jsx(e,{node:t.left,depth:r+1,forcePreferredSide:y})},t.left.id):u.jsx("div",{className:"branch-cell placeholder"}),t.right?u.jsx("div",{className:"branch-cell right",children:u.jsx(e,{node:t.right,depth:r+1,forcePreferredSide:y})},t.right.id):u.jsx("div",{className:"branch-cell placeholder"})]},n))}),k&&n&&u.jsxs("div",{className:"root-split",children:[u.jsx("div",{className:"root-col left",children:u.jsx("div",{className:"binary-children "+(g?"open":""),"data-parent-id":t.id,style:{overflow:g?"visible":void 0},children:(null!=(c=t.children)?c:[]).filter((e,t)=>t%2==0).map((t,n)=>u.jsxs("div",{className:"branch-row",ref:e=>N.current[N.current.length]=e,style:{zIndex:10+n},children:[u.jsx("div",{className:"branch-cell left",children:u.jsx(e,{node:t,depth:r+1,forcePreferredSide:"left"})}),u.jsx("div",{className:"branch-cell placeholder"})]},`L-${t.id}-${n}`))})}),u.jsx("div",{className:"root-col right",children:u.jsx("div",{className:"binary-children "+(g?"open":""),"data-parent-id":t.id,style:{overflow:g?"visible":void 0},children:(null!=(p=t.children)?p:[]).filter((e,t)=>t%2==1).map((t,n)=>u.jsxs("div",{className:"branch-row",ref:e=>N.current[N.current.length]=e,style:{zIndex:10+n},children:[u.jsx("div",{className:"branch-cell placeholder"}),u.jsx("div",{className:"branch-cell right",children:u.jsx(e,{node:t,depth:r+1,forcePreferredSide:"right"})})]},`R-${t.id}-${n}`))})})]})]})},(e,t)=>e.node.id===t.node.id&&e.depth===t.depth&&e.isRoot===t.isRoot&&e.defaultOpenChildren===t.defaultOpenChildren&&e.forcePreferredSide===t.forcePreferredSide&&e.node.excelMeta===t.node.excelMeta&&e.node.requiredState===t.node.requiredState&&e.node.children===t.node.children),v=x.memo(function({root:e}){const t=e.children&&e.children.length>0;return u.jsxs("div",{className:"tree-view",children:[u.jsx("div",{className:"tree-canvas",children:u.jsx("ul",{className:"tree-root",role:"tree",children:u.jsx(b,{node:e,depth:0,isRoot:!0,defaultOpenChildren:!0})})}),t?null:u.jsx("div",{className:"placeholder",children:"No nested fields"})]})});function w({containerRef:e}){const[t,r]=x.useState(new Map),n=x.useRef(null),i=x.useRef(null),a=x.useRef(0),o=x.useCallback(()=>{if(!e.current)return;const t=new Map,n=e.current;n.querySelectorAll(".node-tile[data-node-id]").forEach(e=>{const r=e.getAttribute("data-node-id");if(!r)return;const i=e.getBoundingClientRect(),a=n.getBoundingClientRect(),o=window.getComputedStyle(n).transform;let s=1,l=1;if(o&&"none"!==o){const e=o.match(/matrix\(([^)]+)\)/);if(e){const[t,r,n,i]=e[1].split(",").map(e=>parseFloat(e.trim()));s=Math.sqrt(t*t+r*r)||1,l=Math.sqrt(n*n+i*i)||1}}const d=e.closest(".tree-node"),c=null==d?void 0:d.closest(".branch-cell"),p=null==c?void 0:c.closest(".branch-row"),u=null==p?void 0:p.closest(".binary-children"),g=null==u?void 0:u.closest(".tree-li"),x=null==g?void 0:g.querySelector(".node-tile[data-node-id]"),h=null==x?void 0:x.getAttribute("data-node-id");let m=!0,f=e;for(;f&&f!==n;){if(f.classList&&f.classList.contains("binary-children")&&!f.classList.contains("open")){m=!1;break}f=f.parentElement}const y=(i.left-a.left)/s+i.width/2/s,b=(i.top-a.top)/l+i.height/l;t.set(r,{id:r,parentId:null!=h?h:void 0,x:y,y:b,width:i.width/s,height:i.height/l,isVisible:m})}),r(t)},[]);return x.useEffect(()=>{const t=(e=400)=>{const t=performance.now()+e;if(a.current=Math.max(a.current,t),null==i.current){const e=()=>{i.current=null,o(),performance.now()<a.current&&(i.current=requestAnimationFrame(e))};i.current=requestAnimationFrame(e)}};o(),t(300);const r=new MutationObserver(()=>t(500));e.current&&r.observe(e.current,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","style"]});const n=new ResizeObserver(()=>t(200));e.current&&n.observe(e.current);const s=()=>{t(120)};window.addEventListener("scroll",s),window.addEventListener("resize",s);const l=()=>t(400),d=e.current;null==d||d.addEventListener("transitionrun",l,!0),null==d||d.addEventListener("transitionend",l,!0),null==d||d.addEventListener("animationstart",l,!0),null==d||d.addEventListener("animationend",l,!0);const c=new MutationObserver(()=>t(200));return e.current&&c.observe(e.current,{attributes:!0,attributeFilter:["style"]}),()=>{r.disconnect(),n.disconnect(),c.disconnect(),window.removeEventListener("scroll",s),window.removeEventListener("resize",s);const e=d;e&&(e.removeEventListener("transitionrun",l,!0),e.removeEventListener("transitionend",l,!0),e.removeEventListener("animationstart",l,!0),e.removeEventListener("animationend",l,!0)),null!=i.current&&cancelAnimationFrame(i.current),i.current=null,a.current=0}},[e]),e.current?u.jsx("svg",{ref:n,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:100,overflow:"visible"},"data-role":"connectors",children:(()=>{const e=[],r=new Map;return t.forEach(e=>{var n;if(!e.parentId||!e.isVisible)return;const i=t.get(e.parentId);if(!i||!i.isVisible)return;if(Number.isNaN(i.x)||Number.isNaN(i.y)||Number.isNaN(e.x)||Number.isNaN(e.y)||Number.isNaN(e.height)||Number.isNaN(e.width))return;const a=null!=(n=r.get(e.parentId))?n:[];a.push(e),r.set(e.parentId,a)}),r.forEach((r,n)=>{const i=t.get(n);if(!i)return;const a=new Map;r.forEach(e=>{const t=e.y-e.height/2,r=String(Math.round(t)),n=a.get(r);n?(n.items.push(e),n.y=(n.y*(n.items.length-1)+t)/n.items.length):a.set(r,{y:t,items:[e]})});const o=Array.from(a.values()).sort((e,t)=>e.y-t.y);if(o.length>0){const t=i.x,r=i.y,n=o[o.length-1].y;e.push(u.jsx("path",{d:`M ${t.toFixed(2)} ${r.toFixed(2)} L ${t.toFixed(2)} ${n.toFixed(2)}`,stroke:"rgba(124,192,255,0.8)",strokeWidth:2,strokeDasharray:"6 6",fill:"none",strokeLinecap:"butt",strokeLinejoin:"round","data-orientation":"trunk","data-parent-id":i.id,"data-x":t.toFixed(2),"data-y1":r.toFixed(2),"data-y2":n.toFixed(2)},`trunk-${i.id}`)),o.forEach(({y:r,items:n})=>{n.forEach(n=>{const a=n.x,o=a<t?a+n.width/2:a-n.width/2;e.push(u.jsx("path",{d:`M ${t.toFixed(2)} ${r.toFixed(2)} L ${o.toFixed(2)} ${r.toFixed(2)}`,stroke:"rgba(124,192,255,0.8)",strokeWidth:2,strokeDasharray:"6 6",fill:"none",strokeLinecap:"butt",strokeLinejoin:"round","data-orientation":"branch","data-y":r.toFixed(2)},`branch-${i.id}-${n.id}`))})})}}),e})()}):null}function S(e){const t=e.replace("#","");return`FF${t.substring(0,2)}${t.substring(2,4)}${t.substring(4,6)}`}const j={default:{bg:"linear-gradient(180deg, rgba(124,192,255,0.18), rgba(124,192,255,0.08))"},green:{bg:"#2E7D32"},red:{bg:"#F44336"},yellow:{bg:"#E6A700"}},k=x.memo(function(){const e="Segoe UI",t=14,r="#ffffff",n="#2a6bff",i=x.useRef(null),a=x.useRef(null),o=x.useRef(null),[s,c]=x.useState([]),[g,h]=x.useState(null),[f,y]=x.useState(""),[b,v]=x.useState([]),w=x.useCallback(e=>{const t=e.always||"";if(["כן","yes","true","תמיד","always","חובה","required","חיובי","positive"].some(e=>t.toLowerCase().includes(e)))return"green";if(["לא","no","false","אף פעם","never","אופציונלי","optional","שלילי","negative"].some(e=>t.toLowerCase().includes(e)))return"red";const r=e.fieldEssence||"";if(["מזהה","id","שם","name","תאריך","date","סכום","amount","חשוב","important","ראשי","primary"].some(e=>r.toLowerCase().includes(e)))return"green";const n=e.notes||"";return["אזהרה","warning","שים לב","attention","חשוב","important"].some(e=>n.toLowerCase().includes(e))?"yellow":"default"},[]),k=x.useCallback(()=>{h(null),y("")},[]),C=x.useMemo(()=>s.filter(e=>"green"===w({fieldEssence:e.fieldEssence||"",always:e.always||"",notes:e.notes||""})||e.isMapped),[s,w]),E=x.useCallback((e,t,r)=>{try{const n=r.trim();c(r=>r.map(r=>r.id===e?d(l({},r),{[t]:n}):r)),h(null),y("");const i={fieldEssence:"Field Essence",dgh:"DGH",always:"Always Return",notes:"Notes"},a=s.find(t=>t.id===e);if(a){const e=n?`${i[t]} updated for "${a.name}"`:`${i[t]} cleared for "${a.name}"`;window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:e,type:"ok",durationMs:2e3}}))}}catch(n){window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`Failed to update ${t}: ${n}`,type:"error",durationMs:3e3}}))}},[s]),T=x.useCallback(()=>p(this,null,function*(){try{const i=["שם שדה","סוג שדה","מהות השדה",'דג"ח',"האם יחזור תמיד?","הערות"],a=new m.Workbook,o=a.addWorksheet("Template",{views:[{rightToLeft:!0}]});i.forEach((r,n)=>{const i=o.getColumn(n+1);i.width=Math.max(18,r.length+2),i.alignment={horizontal:"center",vertical:"middle",wrapText:!0},i.font={name:e,size:t}}),o.addRow(i);const s=o.getRow(1);s.height=50,s.eachCell(i=>{i.font={name:e,size:t,bold:!0,color:{argb:S(r)}},i.fill={type:"pattern",pattern:"solid",fgColor:{argb:S(n)}},i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},i.alignment={horizontal:"center",vertical:"middle",wrapText:!0}});const l=50;for(let r=2;r<=1+l;r++){const n=o.getRow(r);i.forEach((r,i)=>{const a=n.getCell(i+1);a.font={name:e,size:t},a.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},a.alignment={horizontal:"center",vertical:"middle",wrapText:!0}})}const d=yield a.xlsx.writeBuffer(),c=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=URL.createObjectURL(c),u=document.createElement("a");u.href=p,u.download="PaaS Template.xlsx",document.body.appendChild(u),u.click(),u.remove(),URL.revokeObjectURL(p)}catch(i){alert("Failed to generate template. Check console for details.")}}),[]),D=(e,t=".")=>{try{if(!e)return"";const r=null==e?void 0:e.path;if("string"==typeof r&&r.trim())return r.trim().split(".").join(t);const n=String(e.id||"").trim();if(!n)return e.name||"";const i=n.split(":")[0];return i&&"root"!==i&&i.includes(".")?i.split(".").join(t):e.name||""}catch(r){return(null==e?void 0:e.name)||""}},N=x.useCallback((i,a,o)=>p(this,null,function*(){try{const l=["שם שדה צד ספק","מהות השדה","סוג השדה צד ספק",'דג"ח',"שם השדה בתקן","סוג השדה בתקן","חוקי השדה בתקן","האם יחזור תמיד","פירוט הפרסר","המיפוי יתבצע בOUTPUTS הבאים:","הערות","האם צריך להזרים מהספק?"],d=new m.Workbook,c=d.addWorksheet("mapping",{views:[{rightToLeft:!0}]});l.forEach((r,n)=>{const i=c.getColumn(n+1);i.width=0===n?33:3===n?45:4===n?50:Math.max(18,r.length+2),i.alignment={horizontal:"center",vertical:"middle",wrapText:!0},i.font={name:e,size:t}}),c.addRow(l);const p=c.getRow(1);p.height=50,p.eachCell(i=>{i.font={name:e,size:t,bold:!0,color:{argb:S(r)}},i.fill={type:"pattern",pattern:"solid",fgColor:{argb:S(n)}},i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},i.alignment={horizontal:"center",vertical:"middle",wrapText:!0}});const u=new Map;if(a&&Array.isArray(a)&&a.forEach(e=>{var t,r;const n=`${(null==(t=null==e?void 0:e.field)?void 0:t.name)||""}__${(null==(r=null==e?void 0:e.field)?void 0:r.fieldType)||""}`;u.set(n,e)}),s&&s.length>0)s.filter(e=>"green"===w({fieldEssence:e.fieldEssence||"",always:e.always||"",notes:e.notes||""})||e.isMapped).forEach(r=>{var n,i,a,o;const s=u.get(`${r.name}__${r.fieldType}`),d=!(!s||!((null==(n=null==s?void 0:s.targetNode)?void 0:n.name)&&String(s.targetNode.name).trim()||(null==(i=null==s?void 0:s.targetNode)?void 0:i.path)))||!!r.isMapped,p=[r.name||"",r.fieldEssence||"",r.fieldType||"",r.dgh||"",D(null==s?void 0:s.targetNode,".")||"",(null==(a=null==s?void 0:s.targetNode)?void 0:a.type)||"",(null==(o=null==s?void 0:s.targetNode)?void 0:o.rules)?s.targetNode.rules.join(", "):"",r.always||"",(null==s?void 0:s.mappingDetails)||"",(null==s?void 0:s.outputs)||"",r.notes||"",""],g=c.addRow(p);try{if("yellow"===r.color||"red"===r.color){const e="yellow"===r.color?"#E6A700":"#F44336";g.eachCell(t=>{t.fill={type:"pattern",pattern:"solid",fgColor:{argb:S(e)}}})}}catch(x){}l.forEach((n,i)=>{const a=g.getCell(i+1);if(a.font={name:e,size:t},a.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},a.alignment={horizontal:"center",vertical:"middle",wrapText:!0},i===l.length-1){const e=d?"FF90EE90":"yellow"===r.color?S("#E6A700"):"red"===r.color?S("#F44336"):"FFFFFFFF";a.fill={type:"pattern",pattern:"solid",fgColor:{argb:e}}}})});else if(i&&i.length>0)i.forEach((r,n)=>{const i=c.addRow(r);l.forEach((r,n)=>{const a=i.getCell(n+1);a.font={name:e,size:t},a.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},a.alignment={horizontal:"center",vertical:"middle",wrapText:!0},n===l.length-1&&(a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFFFFF"}})})});else if(a&&a.length>0)a.forEach((r,n)=>{const i=[r.field.name||"",r.field.fieldEssence||"",r.field.fieldType||"",r.field.dgh||"",D(r.targetNode,".")||"",r.targetNode.type||"",r.targetNode.rules?r.targetNode.rules.join(", "):"",r.field.always||"",r.mappingDetails||"",r.outputs||"",r.field&&r.field.notes?r.field.notes:"",""],a=c.addRow(i);try{const e=null==s?void 0:s.find(e=>e.name===r.field.name&&e.fieldType===r.field.fieldType);if(e&&("yellow"===e.color||"red"===e.color)){const t="yellow"===e.color?"#E6A700":"#F44336";a.eachCell(e=>{e.fill={type:"pattern",pattern:"solid",fgColor:{argb:S(t)}}})}}catch(o){}l.forEach((n,i)=>{var o,s;const d=a.getCell(i+1);if(d.font={name:e,size:t},d.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},d.alignment={horizontal:"center",vertical:"middle",wrapText:!0},i===l.length-1){const e=!!((null==(o=null==r?void 0:r.targetNode)?void 0:o.name)&&String(r.targetNode.name).trim()||(null==(s=null==r?void 0:r.targetNode)?void 0:s.path));d.fill={type:"pattern",pattern:"solid",fgColor:{argb:e?"FF90EE90":"FFFFFFFF"}}}})});else{const r=50;for(let n=2;n<=1+r;n++){const r=c.getRow(n);l.forEach((n,i)=>{const a=r.getCell(i+1);a.font={name:e,size:t},a.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},a.alignment={horizontal:"center",vertical:"middle",wrapText:!0}})}}if(b&&b.length>0){const i=d.addWorksheet('דג"ח',{views:[{rightToLeft:!0}]}),a=["שם שדה","סוג שדה","מהות השדה",'דג"ח',"האם יחזור תמיד?","הערות"];a.forEach((r,n)=>{const a=i.getColumn(n+1);a.width=Math.max(18,r.length+2),a.alignment={horizontal:"center",vertical:"middle",wrapText:!0},a.font={name:e,size:t}}),i.addRow(a);const o=i.getRow(1);o.height=50,o.eachCell(i=>{i.font={name:e,size:t,bold:!0,color:{argb:S(r)}},i.fill={type:"pattern",pattern:"solid",fgColor:{argb:S(n)}},i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},i.alignment={horizontal:"center",vertical:"middle",wrapText:!0}}),b.forEach(r=>{const n=i.addRow([r.name||"",r.type||"",r.essence||"",r.dgh||"",r.always||"",r.notes||""]),o=w({fieldEssence:r.essence||"",always:r.always||"",notes:r.notes||""});a.forEach((r,i)=>{const a=n.getCell(i+1);a.font={name:e,size:t},a.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},a.alignment={horizontal:"center",vertical:"middle",wrapText:!0},"default"!==o&&(a.fill={type:"pattern",pattern:"solid",fgColor:{argb:S(j[o].bg)}})})})}if(o){const e=d.addWorksheet("__meta");e.getCell("A1").value="schemaKey",e.getCell("B1").value=o,e.state="veryHidden"}return d}catch(l){throw l}}),[s,b]),z=x.useCallback(()=>p(this,null,function*(){try{let e=[];const t=new CustomEvent("excel:request-mappings",{detail:{callback:t=>{e=t}}});window.dispatchEvent(t),yield new Promise(e=>setTimeout(e,100));let r="";const n=new CustomEvent("excel:request-selected-schema",{detail:{callback:e=>{r=e}}});window.dispatchEvent(n),yield new Promise(e=>setTimeout(e,50));const i=yield N(void 0,e,r),a=yield i.xlsx.writeBuffer(),o=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=URL.createObjectURL(o),l=document.createElement("a");l.href=s,l.download="mapping.xlsx",document.body.appendChild(l),l.click(),l.remove(),URL.revokeObjectURL(s)}catch(e){window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`Failed to download mapping excel: ${e}`,type:"error",durationMs:5e3}}))}}),[N]),I=x.useCallback(e=>p(this,null,function*(){var t,r,n,i,a,o,d,p,u,g,x,h,f,y,b,j,k;try{const E=yield e.arrayBuffer(),T=new m.Workbook;yield T.xlsx.load(E);let N="";try{const e=T.getWorksheet("__meta");if(e){const t=e.getCell("B1"),r=null==t?void 0:t.value;"string"==typeof r&&(N=r.trim()),!N&&"object"==typeof r&&r&&"text"in r&&(N=String(r.text||"").trim())}}catch(C){}const z=T.worksheets[0];if(!z)throw new Error("No worksheet found in uploaded mapping file");const I=z.getRow(1),M={};I.eachCell((e,t)=>{var r;const n=String(null!=(r=e.value)?r:"").trim();n&&(M[n]=t)});const L=e=>{for(const t of e)if(null!=M[t])return M[t];return-1},A=L(["שם שדה צד ספק"]),R=L(["מהות השדה"]),$=L(["סוג השדה צד ספק"]),F=L(['דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח']),_=L(["שם השדה בתקן"]),B=L(["סוג השדה בתקן"]),W=L(["חוקי השדה בתקן"]),O=L(["האם יחזור תמיד"]),U=L(["פירוט הפרסר"]),P=L(["המיפוי יתבצע בOUTPUTS הבאים:"]),q=L(["הערות"]),Y=[],H=new Map;s.forEach(e=>{H.set(`${e.name}__${e.fieldType}`,l({},e))});const V=z.rowCount;for(let e=2;e<=V;e++){const s=z.getRow(e),c=(()=>{try{let e=!1;return s.eachCell(t=>{const r=t&&t.fill||null,n=r&&r.fgColor&&(r.fgColor.argb||r.fgColor.rgb)||"";if("string"==typeof n&&n){const t=n.toUpperCase();t!==S("#E6A700").toUpperCase()&&"FFE6A700"!==t||(e=!0)}}),e}catch(C){return!1}})(),h=(()=>{try{let e=!1;return s.eachCell(t=>{const r=t&&t.fill||null,n=r&&r.fgColor&&(r.fgColor.argb||r.fgColor.rgb)||"";if("string"==typeof n&&n){const t=n.toUpperCase();t!==S("#F44336").toUpperCase()&&"FFF44336"!==t||(e=!0)}}),e}catch(C){return!1}})(),m=A>0?String(null!=(t=s.getCell(A).value)?t:"").trim():"",f=$>0?String(null!=(r=s.getCell($).value)?r:"").trim():"",y=R>0?String(null!=(n=s.getCell(R).value)?n:"").trim():"",b=F>0?String(null!=(i=s.getCell(F).value)?i:"").trim():"",v=_>0?String(null!=(a=s.getCell(_).value)?a:"").trim():"",j=(()=>{try{if(!v)return"";if(v.includes("->")){const e=v.split("->").map(e=>e.trim()).filter(Boolean);return{targetName:e.length?e[e.length-1]:v,targetPath:e.join(".")}}return{targetName:v,targetPath:""}}catch(C){return{targetName:v,targetPath:""}}})(),k="object"==typeof j&&j?j.targetName:"",E="object"==typeof j&&j?j.targetPath:"",T=B>0?String(null!=(o=s.getCell(B).value)?o:"").trim():"",N=W>0?String(null!=(d=s.getCell(W).value)?d:"").trim():"",I=O>0?String(null!=(p=s.getCell(O).value)?p:"").trim():"",M=U>0?String(null!=(u=s.getCell(U).value)?u:"").trim():"",L=P>0?String(null!=(g=s.getCell(P).value)?g:"").trim():"",V=q>0?String(null!=(x=s.getCell(q).value)?x:"").trim():"";if(![m,f,y,b,k,T,N,I,M,L,V].some(Boolean))continue;const J=`${m}__${f}`,X=H.get(J);X?(X.fieldEssence=y||X.fieldEssence||"",X.dgh=b||X.dgh||"",X.always=I||X.always||"",X.notes=V||X.notes||"",k||M||L?(X.isMapped=!0,X.mappedTargetLabel=D({id:"",name:k,path:E})||"",X.color=c||h?c?"yellow":"red":w({fieldEssence:X.fieldEssence||"",always:X.always||"",notes:X.notes||""})):(c||h)&&(X.color=c?"yellow":"red"),H.set(J,X)):H.set(J,{id:`excel-imported-${H.size+1}`,name:m||`Field_${H.size+1}`,fieldType:f||"",fieldEssence:y||"",dgh:b||"",always:I||"",notes:V||"",expanded:!1,isMapped:!!(k||M||L),mappedTargetLabel:k||M||L?D({id:"",name:k,path:E})||"":void 0,color:c?"yellow":h?"red":w({fieldEssence:y||"",always:I||"",notes:V||""})}),Y.push({targetNode:l({id:`import-${e}`,name:k,type:T,rules:N?N.split(",").map(e=>e.trim()).filter(Boolean):[]},E?{path:E}:{}),field:{name:m,fieldType:f,fieldEssence:y,dgh:b,always:I,notes:V},mappingDetails:M,outputs:L,timestamp:Date.now()})}const J=Array.from(H.values());c(J);try{const e=T.getWorksheet('דג"ח');if(e){const t=[],r=e.rowCount;for(let n=2;n<=r;n++){const r=String(null!=(h=e.getRow(n).getCell(1).value)?h:"").trim(),i=String(null!=(f=e.getRow(n).getCell(2).value)?f:"").trim(),a=String(null!=(y=e.getRow(n).getCell(3).value)?y:"").trim(),o=String(null!=(b=e.getRow(n).getCell(4).value)?b:"").trim(),s=String(null!=(j=e.getRow(n).getCell(5).value)?j:"").trim(),l=String(null!=(k=e.getRow(n).getCell(6).value)?k:"").trim();(r||i||a||o||s||l)&&t.push({name:r,type:i,essence:a,dgh:o,always:s,notes:l})}v(t)}}catch(C){}window.dispatchEvent(new CustomEvent("excel:mappings-imported",{detail:{mappings:Y}})),N&&window.dispatchEvent(new CustomEvent("excel:apply-selected-schema",{detail:{key:N}})),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`Mapping file loaded. ${J.length} fields refreshed`,type:"ok",durationMs:4e3}}))}catch(E){window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"Failed to parse mapping Excel",type:"error",durationMs:5e3}}))}}),[s]),M=x.useCallback(e=>p(this,null,function*(){var t,r,n,i,a,o;try{const s=yield e.arrayBuffer(),l=new m.Workbook;yield l.xlsx.load(s);const d=l.worksheets[0];if(!d)throw new Error("No worksheet found in uploaded file");const p=[],u=d.rowCount;for(let e=2;e<=u;e++){const s=String(null!=(t=d.getRow(e).getCell(1).value)?t:"").trim(),l=String(null!=(r=d.getRow(e).getCell(2).value)?r:"").trim(),c=String(null!=(n=d.getRow(e).getCell(3).value)?n:"").trim(),u=String(null!=(i=d.getRow(e).getCell(4).value)?i:"").trim(),g=String(null!=(a=d.getRow(e).getCell(5).value)?a:"").trim(),x=String(null!=(o=d.getRow(e).getCell(6).value)?o:"").trim();(s||l||c||u||g||x)&&p.push({name:s,type:l,essence:c,dgh:u,always:g,notes:x})}v(p);const g=[];p.forEach((e,t)=>{const r={id:`excel-${t+1}`,name:e.name||`Field_${t+1}`,fieldType:e.type||"",fieldEssence:e.essence||"",dgh:e.dgh||"",always:e.always||"",notes:e.notes||"",expanded:!1,color:w({fieldEssence:e.essence||"",always:e.always||"",notes:e.notes||""})};g.push(r)}),c(g);const x=p.length,h=g.length;let f="",y="ok";0===x?(f="האקסל ריק או שלא הצלחתי לקרוא אותו :(",y="error"):h===x?(f=`אקסל הועלה בהצלחה! ${h} שדות חולצו מתוך ${x} שורות באקסל.`,y="ok"):(f=`אקסל הועלה בהצלחה! ${h} שדות חולצו מתוך ${x} שורות באקסל.`,y="warn"),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:f,type:y,durationMs:5e3}})),h>0&&window.dispatchEvent(new CustomEvent("excel:uploaded"))}catch(s){window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"Excel is empty or couldn't read it",type:"error",durationMs:5e3}}))}}),[]),L=x.useCallback(()=>{try{if(c([]),v([]),h(null),y(""),o.current){try{o.current.remove()}catch(e){}o.current=null}window.dispatchEvent(new Event("excel:clear-all-mappings")),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:'נוקה ממשק הדג"ח',type:"ok",durationMs:2500}}))}catch(t){window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`ניקוי נכשל: ${t}`,type:"error",durationMs:4e3}}))}},[]);return x.useEffect(()=>{const e=()=>{T()},t=()=>{z()},r=()=>{var e;null==(e=i.current)||e.click()},n=()=>{var e;null==(e=a.current)||e.click()},o=e=>p(this,null,function*(){try{const{data:t,filename:r="mapping.xlsx"}=e.detail||{};let n="";const i=new CustomEvent("excel:request-selected-schema",{detail:{callback:e=>{n=e}}});window.dispatchEvent(i),yield new Promise(e=>setTimeout(e,50));const a=yield N(t,void 0,n),o=yield a.xlsx.writeBuffer(),s=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=URL.createObjectURL(s),d=document.createElement("a");d.href=l,d.download=r,document.body.appendChild(d),d.click(),d.remove(),URL.revokeObjectURL(l)}catch(t){alert("Failed to save mapping excel. Check console for details.")}}),s=e=>{const{field:t,targetNode:r}=e.detail||{};t&&c(e=>e.map(e=>{if(e.name===t.name&&e.fieldType===t.fieldType){const t=D(r);return d(l({},e),{isMapped:!0,mappedTargetLabel:t||void 0,color:e.color||"default"})}return e}))};return window.addEventListener("excel:download-template-request",e),window.addEventListener("excel:download-mapping-request",t),window.addEventListener("excel:upload-request",r),window.addEventListener("excel:upload-mapping-request",n),window.addEventListener("excel:save-mapping-request",o),window.addEventListener("excel:mapping-saved",s),()=>{window.removeEventListener("excel:download-template-request",e),window.removeEventListener("excel:download-mapping-request",t),window.removeEventListener("excel:upload-request",r),window.removeEventListener("excel:upload-mapping-request",n),window.removeEventListener("excel:save-mapping-request",o),window.removeEventListener("excel:mapping-saved",s)}},[T,z,N]),u.jsx("aside",{className:"fridge-panel",children:u.jsxs("div",{className:"fridge-door",children:[u.jsx("div",{className:"fridge-handle"}),u.jsx("div",{className:"fridge-title",children:'פרק תדג"ח'}),u.jsx("div",{className:"fridge-subtitle",children:'שדות מהדג"ח'}),u.jsx("div",{className:"fridge-divider"}),C.length>0&&u.jsx("div",{className:"excel-fields",onDragOver:e=>{e.preventDefault()},children:u.jsx("div",{className:"excel-fields-list",children:C.map((e,t)=>u.jsxs("div",{"data-field-id":e.id,"data-color":e.color,className:`excel-cube ${e.expanded?"open":""} ${e.isMapped?"mapped":""} ${(null==g?void 0:g.id)===e.id?"editing":""}`,draggable:!0,style:{background:e.isMapped?void 0:e.color?j[e.color].bg:j.default.bg,boxShadow:e.isMapped?void 0:"0 4px 12px rgba(0,0,0,0.2)"},onDragStart:t=>{t.dataTransfer.setData("application/json",JSON.stringify({kind:"excelField",field:e})),t.dataTransfer.setData("application/vnd.excel-field","1"),t.dataTransfer.effectAllowed="copy",window.__excelDragging=!0,window.dispatchEvent(new CustomEvent("excel:drag-start",{detail:e}));try{o.current&&(o.current.remove(),o.current=null);const e=t.currentTarget.cloneNode(!0);e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.pointerEvents="none",e.style.transform="none",e.style.boxShadow="0 10px 28px rgba(0,0,0,0.36)",e.style.color="#ffffff",e.style.filter="saturate(1.1) brightness(1.05)",e.style.opacity="0.95",document.body.appendChild(e),o.current=e;const r=e.getBoundingClientRect(),n=r.width/2,i=r.height/2;t.dataTransfer.setDragImage&&t.dataTransfer.setDragImage(e,n,i)}catch(r){}},onDragEnd:()=>{if(window.__excelDragging=!1,window.dispatchEvent(new Event("excel:drag-end")),o.current){try{o.current.remove()}catch(e){}o.current=null}},onClick:e=>{const r=e.target;r.closest(".editable-field")||r.closest("input")||r.closest("textarea")?e.stopPropagation():c(e=>e.map((e,r)=>r===t?d(l({},e),{expanded:!e.expanded}):e))},children:[u.jsxs("div",{className:"excel-cube-head",style:{position:"relative"},children:[u.jsx("div",{className:"excel-cube-name",children:e.name}),e.fieldType&&u.jsx("div",{className:"excel-cube-sub",children:e.fieldType}),e.isMapped&&u.jsx("div",{className:"mapping-checkmark",title:"Field is mapped",style:{position:"absolute",top:"8px",right:"8px",width:"20px",height:"20px",borderRadius:"50%",backgroundColor:"#4CAF50",border:"2px solid #000",display:"flex",alignItems:"center",justifyContent:"center",color:"#000",fontSize:"12px",fontWeight:"bold",zIndex:1},children:"✓"})]}),u.jsxs("div",{className:"excel-cube-desc",dir:"rtl",style:{display:e.expanded?"grid":"none"},children:[u.jsxs("div",{className:"row",children:[u.jsx("span",{className:"k",children:"מהות השדה:"}),(null==g?void 0:g.id)===e.id&&"fieldEssence"===g.field?u.jsx("textarea",{className:"editable-field",value:f,onChange:e=>{y(e.target.value);const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onFocus:e=>{const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onKeyDown:t=>{var r,n;if("Enter"===t.key&&t.shiftKey){t.preventDefault();const e=t.currentTarget,i=null!=(r=e.selectionStart)?r:f.length,a=null!=(n=e.selectionEnd)?n:f.length,o=f.slice(0,i)+"\n"+f.slice(a);return y(o),void setTimeout(()=>{try{e.selectionStart=e.selectionEnd=i+1}catch(t){}},0)}"Enter"===t.key?E(e.id,"fieldEssence",f):"Escape"===t.key&&k()},onBlur:()=>{f.trim()!==(e.fieldEssence||"")?E(e.id,"fieldEssence",f):k()},autoFocus:!0,style:{border:"1px solid #7cc0ff",borderRadius:"4px",padding:"6px 8px",fontSize:"14px",width:"100%",minHeight:"64px",resize:"none",overflow:"hidden",backgroundColor:"rgba(124, 192, 255, 0.1)",color:"#e6f1ff",outline:"none",boxShadow:"0 0 0 2px rgba(124, 192, 255, 0.2)"}}):u.jsxs("span",{className:"v editable-field",onDoubleClick:t=>{t.stopPropagation(),h({id:e.id,field:"fieldEssence"}),y(e.fieldEssence||"")},style:{cursor:"pointer",whiteSpace:"pre-wrap"},title:"Double-click to edit",children:[e.fieldEssence||"-",u.jsx("span",{className:"edit-icon "+(e.fieldEssence?"":"empty"),children:u.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"18px",height:"18px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.1)",marginLeft:"6px"},children:u.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:u.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#000000"})})})})]})]}),u.jsxs("div",{className:"row",children:[u.jsx("span",{className:"k",children:'דג"ח:'}),(null==g?void 0:g.id)===e.id&&"dgh"===g.field?u.jsx("textarea",{className:"editable-field",value:f,onChange:e=>{y(e.target.value);const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onFocus:e=>{const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onKeyDown:t=>{var r,n;if("Enter"===t.key&&t.shiftKey){t.preventDefault();const e=t.currentTarget,i=null!=(r=e.selectionStart)?r:f.length,a=null!=(n=e.selectionEnd)?n:f.length,o=f.slice(0,i)+"\n"+f.slice(a);return y(o),void setTimeout(()=>{try{e.selectionStart=e.selectionEnd=i+1}catch(t){}},0)}"Enter"===t.key?E(e.id,"dgh",f):"Escape"===t.key&&k()},onBlur:()=>{f.trim()!==(e.dgh||"")?E(e.id,"dgh",f):k()},autoFocus:!0,style:{border:"1px solid #7cc0ff",borderRadius:"4px",padding:"6px 8px",fontSize:"14px",width:"100%",minHeight:"64px",resize:"none",overflow:"hidden",backgroundColor:"rgba(124, 192, 255, 0.1)",color:"#e6f1ff",outline:"none",boxShadow:"0 0 0 2px rgba(124, 192, 255, 0.2)"}}):u.jsxs("span",{className:"v editable-field",onDoubleClick:t=>{t.stopPropagation(),h({id:e.id,field:"dgh"}),y(e.dgh||"")},title:"Double-click to edit",style:{whiteSpace:"pre-wrap"},children:[e.dgh||"-",u.jsx("span",{className:"edit-icon "+(e.dgh?"":"empty"),children:u.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"18px",height:"18px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.1)",marginLeft:"6px"},children:u.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:u.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#000000"})})})})]})]}),u.jsxs("div",{className:"row",children:[u.jsx("span",{className:"k",children:"האם יחזור תמיד?"}),(null==g?void 0:g.id)===e.id&&"always"===g.field?u.jsx("textarea",{className:"editable-field",value:f,onChange:e=>{y(e.target.value);const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onFocus:e=>{const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onKeyDown:t=>{var r,n;if("Enter"===t.key&&t.shiftKey){t.preventDefault();const e=t.currentTarget,i=null!=(r=e.selectionStart)?r:f.length,a=null!=(n=e.selectionEnd)?n:f.length,o=f.slice(0,i)+"\n"+f.slice(a);return y(o),void setTimeout(()=>{try{e.selectionStart=e.selectionEnd=i+1}catch(t){}},0)}"Enter"===t.key?E(e.id,"always",f):"Escape"===t.key&&k()},onBlur:()=>{f.trim()!==(e.always||"")?E(e.id,"always",f):k()},autoFocus:!0,style:{border:"1px solid #7cc0ff",borderRadius:"4px",padding:"6px 8px",fontSize:"14px",width:"100%",minHeight:"64px",resize:"none",overflow:"hidden",backgroundColor:"rgba(124, 192, 255, 0.1)",color:"#e6f1ff",outline:"none",boxShadow:"0 0 0 2px rgba(124, 192, 255, 0.2)"}}):u.jsxs("span",{className:"v editable-field",onDoubleClick:t=>{t.stopPropagation(),h({id:e.id,field:"always"}),y(e.always||"")},title:"Double-click to edit",style:{whiteSpace:"pre-wrap"},children:[e.always||"-",u.jsx("span",{className:"edit-icon "+(e.always?"":"empty"),children:u.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"18px",height:"18px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.1)",marginLeft:"6px"},children:u.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:u.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#000000"})})})})]})]}),u.jsxs("div",{className:"row",children:[u.jsx("span",{className:"k",children:"הערות:"}),(null==g?void 0:g.id)===e.id&&"notes"===g.field?u.jsx("textarea",{className:"editable-field",value:f,onChange:e=>{y(e.target.value);const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onFocus:e=>{const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onKeyDown:t=>{var r,n;if("Enter"===t.key&&t.shiftKey){t.preventDefault();const e=t.currentTarget,i=null!=(r=e.selectionStart)?r:f.length,a=null!=(n=e.selectionEnd)?n:f.length,o=f.slice(0,i)+"\n"+f.slice(a);return y(o),void setTimeout(()=>{try{e.selectionStart=e.selectionEnd=i+1}catch(t){}},0)}"Enter"===t.key?E(e.id,"notes",f):"Escape"===t.key&&k()},onBlur:()=>{f.trim()!==(e.notes||"")?E(e.id,"notes",f):k()},autoFocus:!0,style:{border:"1px solid #7cc0ff",borderRadius:"4px",padding:"6px 8px",fontSize:"14px",width:"100%",minHeight:"64px",resize:"none",overflow:"hidden",backgroundColor:"rgba(124, 192, 255, 0.1)",color:"#e6f1ff",outline:"none",boxShadow:"0 0 0 2px rgba(124, 192, 255, 0.2)"}}):u.jsxs("span",{className:"v editable-field",onDoubleClick:t=>{t.stopPropagation(),h({id:e.id,field:"notes"}),y(e.notes||"")},style:{cursor:"pointer"},title:"Double-click to edit",children:[u.jsx("span",{style:{whiteSpace:"pre-wrap"},children:e.notes||"-"}),u.jsx("span",{className:"edit-icon "+(e.notes?"":"empty"),children:u.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"18px",height:"18px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.1)",marginLeft:"6px"},children:u.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:u.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#000000"})})})})]})]}),e.isMapped&&e.mappedTargetLabel&&u.jsxs("div",{className:"row",children:[u.jsx("span",{className:"k",children:"שדה בתקן:"}),u.jsx("span",{className:"v",style:{fontSize:"8px"},children:e.mappedTargetLabel})]})]})]},e.id))})}),u.jsxs("div",{className:"excel-actions",children:[u.jsx("input",{ref:i,type:"file",accept:".xlsx,.xls",style:{display:"none"},onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&M(r),i.current&&(i.current.value="")}}),u.jsx("input",{ref:a,type:"file",accept:".xlsx,.xls",style:{display:"none"},onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&I(r),a.current&&(a.current.value="")}}),C.filter(e=>e.isMapped).length>0&&u.jsxs("div",{className:"mappings-count",children:[C.filter(e=>e.isMapped).length," mapping",1!==C.filter(e=>e.isMapped).length?"s":""," saved"]})]}),u.jsx("div",{className:"fridge-note",children:0===C.length?s.length>0?"אין שדות ירוקים או ממופים להצגה מתוך השדות שהועלו.":'הורידו את הפורמט, מלאו אותו בדג"ח מהספק והעלו אותו לפירוק!':'גררו שדה מהדג"ח לשדה שמתאים לו מהתקן, הכניסו את הפרסר הרצוי ולחצו שמור. לאחר שסיימתם למפות את כל השדות הרלוונטים - לחצו על כפתור הורדת המאפינג ותיהנו!'}),0===C.length&&0===s.length&&u.jsx("div",{className:"excel-cta"}),u.jsx("div",{className:"fridge-bottom-controls",children:s.length>0&&u.jsx("button",{className:"btn ghost extractor-clear-btn","aria-label":'נקה את הדג"ח',title:'נקה את הדג"ח',onClick:e=>{e.stopPropagation(),L()},children:u.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:u.jsx("path",{d:"M9 3c-.55 0-1 .45-1 1v1H5.5c-.28 0-.5.22-.5.5s.22.5.5.5H6v13c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V6h.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5H16V4c0-.55-.45-1-1-1H9zm1 2V4h4v1h-4zm-2 2h10v12c0 .55-.45 1-1 1H8c-.55 0-1-.45-1-1V7zm3 2c-.28 0-.5.22-.5.5v7c0 .28.22.5.5.5s.5-.22.5-.5v-7c0-.28-.22-.5-.5-.5zm4 0c-.28 0-.5.22-.5.5v7c0 .28.22.5.5.5s.5-.22.5-.5v-7c0-.28-.22-.5-.5-.5z"})})})})]})})}),C="https://your-auth-server.com/api",E=e=>"server"===e?"אימות שרת":"לא ידוע",T={viewer:["view_all","validate_json"],editor:["view_all","chat_message","validate_json"],admin:["view_all","edit_status","create_sagach","delete_sagach","chat_message","manage_users","validate_json"]},D=x.createContext(void 0),N=({children:t})=>{const[r]=x.useState(()=>"server"),n=(()=>{const[t,r]=h.useState({isAuthenticated:!1,user:null,token:null,isLoading:!1,error:null});h.useEffect(()=>{p(e,null,function*(){const e=localStorage.getItem("auth_token"),t=localStorage.getItem("user");if(e&&t)try{const i=JSON.parse(t);r({isAuthenticated:!0,user:i,token:e,isLoading:!1,error:null}),yield n(e)}catch(i){localStorage.removeItem("auth_token"),localStorage.removeItem("user"),r({isAuthenticated:!1,user:null,token:null,isLoading:!1,error:null})}else r({isAuthenticated:!1,user:null,token:null,isLoading:!1,error:null})})},[]);const n=t=>p(e,null,function*(){try{const e=yield fetch(`${C}/validate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(e.ok){const t=yield e.json();if(t.success&&t.user)return!0}return localStorage.removeItem("auth_token"),localStorage.removeItem("user"),r({isAuthenticated:!1,user:null,token:null,isLoading:!1,error:null}),!1}catch(e){return!1}}),i=()=>p(e,null,function*(){const e=t.token;if(!e)return!1;try{const t=yield fetch(`${C}/user`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}),n=yield t.json();return!(!n.success||!n.user||(localStorage.setItem("user",JSON.stringify(n.user)),r(e=>d(l({},e),{user:n.user||null})),0))}catch(n){return!1}});return d(l({},t),{login:(t,n)=>p(e,null,function*(){if(r(e=>d(l({},e),{isLoading:!0,error:null})),"admin"===t&&"admin"===n){const e={id:"admin_user",name:"מנהל מערכת",email:"admin@system.local",role:"admin",lastLogin:(new Date).toISOString()},t="demo_admin_token_"+Date.now();return localStorage.setItem("auth_token",t),localStorage.setItem("user",JSON.stringify(e)),r({isAuthenticated:!0,user:e,token:t,isLoading:!1,error:null}),!0}if("editor"===t&&"editor"===n){const e={id:"editor_user",name:"עורך מערכת",email:"editor@system.local",role:"editor",lastLogin:(new Date).toISOString()},t="demo_editor_token_"+Date.now();return localStorage.setItem("auth_token",t),localStorage.setItem("user",JSON.stringify(e)),r({isAuthenticated:!0,user:e,token:t,isLoading:!1,error:null}),!0}if("viewer"===t&&"viewer"===n){const e={id:"viewer_user",name:"צופה מערכת",email:"viewer@system.local",role:"viewer",lastLogin:(new Date).toISOString()},t="demo_viewer_token_"+Date.now();return localStorage.setItem("auth_token",t),localStorage.setItem("user",JSON.stringify(e)),r({isAuthenticated:!0,user:e,token:t,isLoading:!1,error:null}),!0}try{const e=yield fetch(`${C}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:n})}),i=yield e.json();return i.success&&i.user&&i.token?(localStorage.setItem("auth_token",i.token),localStorage.setItem("user",JSON.stringify(i.user)),r({isAuthenticated:!0,user:i.user,token:i.token,isLoading:!1,error:null}),!0):(r(e=>d(l({},e),{isLoading:!1,error:i.error||"Login failed"})),!1)}catch(e){return r(e=>d(l({},e),{isLoading:!1,error:"Network error during login"})),!1}}),logout:()=>p(e,null,function*(){const e=t.token;try{e&&(yield fetch(`${C}/logout`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}))}catch(n){}localStorage.removeItem("auth_token"),localStorage.removeItem("user"),r({isAuthenticated:!1,user:null,token:null,isLoading:!1,error:null})}),refreshUser:i,getCurrentUser:()=>p(e,null,function*(){return t.isAuthenticated&&t.user?(yield i(),t.user):null})})})();x.useEffect(()=>{if(n.user)try{localStorage.setItem("user",JSON.stringify(n.user))}catch(e){}else localStorage.removeItem("user")},[n.user]);const i=e=>!!n.user&&T[n.user.role].includes(e),a={user:n.user,login:(t,r)=>p(e,null,function*(){return yield n.login(t,r)}),logout:()=>p(e,null,function*(){yield n.logout()}),hasPermission:i,hasRole:e=>{var t;return(null==(t=n.user)?void 0:t.role)===e},canEditStatus:()=>i("edit_status"),canCreateSagach:()=>i("create_sagach"),canDeleteSagach:()=>i("delete_sagach"),canChat:()=>i("chat_message"),canManageUsers:()=>i("manage_users"),canValidateJson:()=>i("validate_json"),isLoading:n.isLoading,authMode:r,canSwitchAuthMode:!1,error:n.error};return u.jsx(D.Provider,{value:a,children:t})},z=()=>{const e=x.useContext(D);if(void 0===e)throw new Error("usePermissions must be used within a PermissionProvider");return e},I=e=>{switch(e){case"viewer":return"צופה";case"editor":return"עורך";case"admin":return"מנהל";default:return"לא ידוע"}};var M={};let L=null,A=null,R=null;try{if("undefined"==typeof window){const e=require("pg");L=e.Client,A=e.Pool,R=e.QueryResult}}catch($e){}const $=(e,t="")=>{var r;return"undefined"==typeof process?(null==(r=window.__ENV__)?void 0:r[e])||t:M[e]||t},F={host:$("DB_HOST","localhost"),port:parseInt($("DB_PORT","5432")),database:$("DB_NAME","thegreentree"),user:$("DB_USER","postgres"),password:$("DB_PASSWORD",""),ssl:"true"===$("DB_SSL","false"),connectionTimeoutMillis:6e4,idleTimeoutMillis:3e4,max:20};class _{constructor(e){c(this,"pool",null),c(this,"client",null),c(this,"config"),c(this,"isConnected",!1),this.config=l(l({},F),e)}initialize(){return p(this,null,function*(){if(!A||!L)throw new Error("PostgreSQL module not available in browser environment. Database features require a Node.js environment.");try{this.pool&&(yield this.pool.end()),this.pool=new A(this.config);const e=yield this.pool.connect();yield e.query("SELECT 1"),e.release(),this.isConnected=!0}catch($e){throw this.isConnected=!1,$e}})}createTables(){return p(this,null,function*(){if(!A||!L)throw new Error("PostgreSQL module not available");if(!this.isConnected||!this.pool)throw new Error("Database not connected");try{yield this.pool.query("\n        CREATE TABLE IF NOT EXISTS sagachim_status (\n          id VARCHAR(255) PRIMARY KEY,\n          name TEXT NOT NULL,\n          description TEXT,\n          provider VARCHAR(255),\n          last_updated TIMESTAMP,\n          arena TEXT[],\n          priority VARCHAR(50),\n          sagach_type TEXT,\n          process_status INTEGER CHECK (process_status >= 1 AND process_status <= 7),\n          process_start_date DATE,\n          estimated_completion DATE,\n          contact_person TEXT,\n          notes TEXT,\n          status_updates JSONB,\n          phase_data JSONB,\n          notifications BOOLEAN DEFAULT false,\n          notification_method VARCHAR(20),\n          notification_frequency VARCHAR(20),\n          completion_date DATE,\n          notification_subscribers JSONB,\n          created_by VARCHAR(255),\n          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n          last_modified_by VARCHAR(255),\n          last_modified_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n        )\n      "),yield this.pool.query("\n        CREATE TABLE IF NOT EXISTS sagachs (\n          id VARCHAR(255) PRIMARY KEY,\n          name TEXT NOT NULL,\n          data JSONB,\n          versions JSONB,\n          current_version VARCHAR(255),\n          created_by VARCHAR(255),\n          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n          last_modified_by VARCHAR(255),\n          last_modified_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n        )\n      "),yield this.pool.query("\n        CREATE TABLE IF NOT EXISTS data_changes (\n          id SERIAL PRIMARY KEY,\n          event_type VARCHAR(50) NOT NULL,\n          event_data JSONB,\n          timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n          user_id VARCHAR(255),\n          user_name VARCHAR(255)\n        )\n      ")}catch($e){throw $e}})}loadSagachimStatus(){return p(this,null,function*(){if(!A||!L)throw new Error("PostgreSQL module not available");if(!this.isConnected||!this.pool)throw new Error("Database not connected");try{return(yield this.pool.query("SELECT * FROM sagachim_status ORDER BY last_modified_at DESC")).rows}catch($e){throw $e}})}loadSagachs(){return p(this,null,function*(){if(!A||!L)throw new Error("PostgreSQL module not available");if(!this.isConnected||!this.pool)throw new Error("Database not connected");try{return(yield this.pool.query("SELECT * FROM sagachs ORDER BY last_modified_at DESC")).rows}catch($e){throw $e}})}saveSagachimStatus(e){return p(this,null,function*(){if(!A||!L)throw new Error("PostgreSQL module not available");if(!this.isConnected||!this.pool)throw new Error("Database not connected");try{const t="\n        INSERT INTO sagachim_status (\n          id, name, description, provider, last_updated, arena, priority, sagach_type,\n          process_status, process_start_date, estimated_completion, contact_person, notes,\n          status_updates, phase_data, notifications, notification_method, notification_frequency,\n          completion_date, notification_subscribers, created_by, created_at, last_modified_by, last_modified_at\n        ) VALUES (\n          $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24\n        )\n        ON CONFLICT (id) DO UPDATE SET\n          name = EXCLUDED.name,\n          description = EXCLUDED.description,\n          provider = EXCLUDED.provider,\n          last_updated = EXCLUDED.last_updated,\n          arena = EXCLUDED.arena,\n          priority = EXCLUDED.priority,\n          sagach_type = EXCLUDED.sagach_type,\n          process_status = EXCLUDED.process_status,\n          process_start_date = EXCLUDED.process_start_date,\n          estimated_completion = EXCLUDED.estimated_completion,\n          contact_person = EXCLUDED.contact_person,\n          notes = EXCLUDED.notes,\n          status_updates = EXCLUDED.status_updates,\n          phase_data = EXCLUDED.phase_data,\n          notifications = EXCLUDED.notifications,\n          notification_method = EXCLUDED.notification_method,\n          notification_frequency = EXCLUDED.notification_frequency,\n          completion_date = EXCLUDED.completion_date,\n          notification_subscribers = EXCLUDED.notification_subscribers,\n          last_modified_by = EXCLUDED.last_modified_by,\n          last_modified_at = EXCLUDED.last_modified_at\n      ",r=[e.id,e.name,e.description,e.provider,e.lastUpdated,e.arena,e.priority,e.sagachType,e.processStatus,e.processStartDate,e.estimatedCompletion,e.contactPerson,e.notes,JSON.stringify(e.statusUpdates||[]),JSON.stringify(e.phaseData||{}),e.notifications||!1,e.notificationMethod,e.notificationFrequency,e.completionDate,JSON.stringify(e.notificationSubscribers||[]),e.createdBy,e.createdAt,e.lastModifiedBy,e.lastModifiedAt];yield this.pool.query(t,r)}catch($e){throw $e}})}saveSagach(e){return p(this,null,function*(){if(!A||!L)throw new Error("PostgreSQL module not available");if(!this.isConnected||!this.pool)throw new Error("Database not connected");try{const t="\n        INSERT INTO sagachs (\n          id, name, data, versions, current_version, created_by, created_at, last_modified_by, last_modified_at\n        ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)\n        ON CONFLICT (id) DO UPDATE SET\n          name = EXCLUDED.name,\n          data = EXCLUDED.data,\n          versions = EXCLUDED.versions,\n          current_version = EXCLUDED.current_version,\n          last_modified_by = EXCLUDED.last_modified_by,\n          last_modified_at = EXCLUDED.last_modified_at\n      ";yield this.pool.query(t,[e.id,e.name,JSON.stringify(e.data),JSON.stringify(e.versions),e.currentVersion,e.createdBy,e.createdAt,e.lastModifiedBy,e.lastModifiedAt])}catch($e){throw $e}})}deleteSagachimStatus(e){return p(this,null,function*(){if(!A||!L)throw new Error("PostgreSQL module not available");if(!this.isConnected||!this.pool)throw new Error("Database not connected");try{yield this.pool.query("DELETE FROM sagachim_status WHERE id = $1",[e])}catch($e){throw $e}})}deleteSagach(e){return p(this,null,function*(){if(!A||!L)throw new Error("PostgreSQL module not available");if(!this.isConnected||!this.pool)throw new Error("Database not connected");try{yield this.pool.query("DELETE FROM sagachs WHERE id = $1",[e])}catch($e){throw $e}})}logDataChange(e,t,r,n){return p(this,null,function*(){if(A&&L&&this.isConnected&&this.pool)try{yield this.pool.query("INSERT INTO data_changes (event_type, event_data, user_id, user_name) VALUES ($1, $2, $3, $4)",[e,JSON.stringify(t),r,n])}catch($e){}})}getRecentChanges(e=100){return p(this,null,function*(){if(!(A&&L&&this.isConnected&&this.pool))return[];try{return(yield this.pool.query("SELECT * FROM data_changes ORDER BY timestamp DESC LIMIT $1",[e])).rows}catch($e){return[]}})}close(){return p(this,null,function*(){try{this.pool&&A&&L&&(yield this.pool.end(),this.pool=null,this.isConnected=!1)}catch($e){}})}isDatabaseConnected(){return this.isConnected&&null!==this.pool&&null!==A&&null!==L}refreshConnectionState(){return p(this,null,function*(){if(!A||!L)return this.isConnected=!1,!1;if(!this.pool)return this.isConnected=!1,!1;try{const e=yield this.pool.connect();return yield e.query("SELECT 1"),e.release(),this.isConnected=!0,!0}catch($e){return this.isConnected=!1,!1}})}updateConfig(e){return p(this,null,function*(){if(!A||!L)throw new Error("PostgreSQL module not available");this.config=l(l({},this.config),e),yield this.close(),yield this.initialize(),yield this.createTables()})}}let B=null;const W=()=>(B||(B=new _),B),O=["110","130","150","160","170","180","190","210",'מוד"ש','פקמ"ז','פצ"ן','פד"ם',"על-זירתי"],U=x.createContext(void 0),P="shared_sagach_data",q="shared_sagachim_status_data",Y="shared_data_changes",H="sagach_manager_data",V="sagachim_data",J=({children:t})=>{const{user:r}=z(),[n,i]=x.useState([]),[a,o]=x.useState([]),[s,c]=x.useState(!0),[g,h]=x.useState(null),[m,f]=x.useState(new Set),[y,b]=x.useState(null),[v,w]=x.useState(!1),[S,j]=x.useState(!1),k=x.useCallback((t,r)=>p(e,null,function*(){try{const n="sagachs"===t?P:q;if(localStorage.setItem(n,JSON.stringify(r)),v&&y&&y.isDatabaseConnected())try{"sagachs"===t?yield Promise.all(r.map(e=>y.saveSagach(e))):yield Promise.all(r.map(e=>y.saveSagachimStatus(e)))}catch(e){}}catch(n){h("Failed to save data")}}),[v,y]),C=x.useCallback(t=>p(e,null,function*(){try{const e=localStorage.getItem(Y),r=e?JSON.parse(e):[];r.push(t),r.length>100&&r.splice(0,r.length-100),localStorage.setItem(Y,JSON.stringify(r))}catch(e){}if(v&&y&&y.isDatabaseConnected()&&r)try{yield y.logDataChange(t.type,t.data,t.userId,t.userName)}catch(e){}m.forEach(r=>{try{r(t)}catch(e){}})}),[m,v,y,r]);x.useEffect(()=>{p(e,null,function*(){try{c(!0),h(null);const r=W();b(r);let n=!1;try{yield r.initialize(),yield r.createTables(),n=!0,w(!0),j(r.isDatabaseConnected())}catch(e){w(!1),j(!1),n=!1}if(n&&r)try{const[e,t]=yield Promise.all([r.loadSagachs(),r.loadSagachimStatus()]);i(e),o(t)}catch(t){w(!1)}if(!n||!v){let e=localStorage.getItem(P);if(e){const t=JSON.parse(e);i(t)}else{const e=localStorage.getItem(H);if(e){const t=JSON.parse(e).map(e=>d(l({},e),{createdBy:e.createdBy||"migrated",createdAt:e.createdAt||(new Date).toISOString(),lastModifiedBy:e.lastModifiedBy||"migrated",lastModifiedAt:e.lastModifiedAt||(new Date).toISOString()}));i(t),localStorage.setItem(P,JSON.stringify(t)),localStorage.removeItem(H)}}let t=localStorage.getItem(q);if(t){const e=JSON.parse(t);o(e)}else{const e=localStorage.getItem(V);if(e){const t=JSON.parse(e).map(e=>d(l({},e),{priority:e.priority||"בינוני",arena:e.arena||[],createdBy:e.createdBy||"migrated",createdAt:e.createdAt||(new Date).toISOString(),lastModifiedBy:e.lastModifiedBy||"migrated",lastModifiedAt:e.lastModifiedAt||(new Date).toISOString()}));o(t),localStorage.setItem(q,JSON.stringify(t)),localStorage.removeItem(V)}}}}catch(r){h("Failed to load data");try{const e=localStorage.getItem(P),t=localStorage.getItem(q);e&&i(JSON.parse(e)),t&&o(JSON.parse(t))}catch(n){}}finally{c(!1)}})},[]),x.useEffect(()=>{if(y){const t=()=>p(e,null,function*(){try{const e=yield y.refreshConnectionState();j(e)}catch(e){j(!1)}});t();const r=setInterval(t,5e3);return()=>clearInterval(r)}j(!1)},[y]),x.useEffect(()=>{const e=e=>{if(e.key===P&&e.newValue)try{const t=JSON.parse(e.newValue);i(t)}catch(t){}else if(e.key===q&&e.newValue)try{const t=JSON.parse(e.newValue);o(t)}catch(t){}};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);const E=x.useCallback(e=>{if(!r)return;const t=(new Date).toISOString(),n=d(l({},e),{createdBy:r.id,createdAt:t,lastModifiedBy:r.id,lastModifiedAt:t});i(e=>{const t=[...e,n];return k("sagachs",t),t}),C({type:"sagach_created",data:n,timestamp:t,userId:r.id,userName:r.name})},[r,k,C]),T=x.useCallback((e,t)=>{if(!r)return;const n=(new Date).toISOString();i(i=>{const a=i.map(i=>i.id===e?d(l(l({},i),t),{lastModifiedBy:r.id,lastModifiedAt:n}):i);return k("sagachs",a),a}),C({type:"sagach_updated",data:{id:e,updates:t},timestamp:n,userId:r.id,userName:r.name})},[r,k,C]),D=x.useCallback(t=>p(e,null,function*(){if(!r)return;const e=(new Date).toISOString();if(i(e=>{const r=e.filter(e=>e.id!==t);return k("sagachs",r),r}),v&&y&&y.isDatabaseConnected())try{yield y.deleteSagach(t)}catch(n){}C({type:"sagach_deleted",data:{id:t},timestamp:e,userId:r.id,userName:r.name})}),[r,k,C,v,y]),N=x.useCallback(e=>{if(!r)return;const t=(new Date).toISOString(),n=d(l({},e),{createdBy:r.id,createdAt:t,lastModifiedBy:r.id,lastModifiedAt:t});o(e=>{const t=[...e,n];return k("sagachimStatus",t),t}),C({type:"status_created",data:n,timestamp:t,userId:r.id,userName:r.name})},[r,k,C]),I=x.useCallback((e,t)=>{if(!r)return;const n=(new Date).toISOString();o(i=>{const a=i.map(i=>i.id===e?d(l(l({},i),t),{lastModifiedBy:r.id,lastModifiedAt:n}):i);return k("sagachimStatus",a),a}),C({type:"status_updated",data:{id:e,updates:t},timestamp:n,userId:r.id,userName:r.name})},[r,k,C]),M=x.useCallback(t=>p(e,null,function*(){if(!r)return;const e=(new Date).toISOString();if(o(e=>{const r=e.filter(e=>e.id!==t);return k("sagachimStatus",r),r}),v&&y&&y.isDatabaseConnected())try{yield y.deleteSagachimStatus(t)}catch(n){}C({type:"status_deleted",data:{id:t},timestamp:e,userId:r.id,userName:r.name})}),[r,k,C,v,y]),L=x.useCallback(()=>{try{localStorage.removeItem(P),localStorage.removeItem(q),localStorage.removeItem(Y),localStorage.removeItem(H),localStorage.removeItem(V),i([]),o([]),h(null)}catch(e){h("Failed to clear data")}},[i,o,h]),A=x.useCallback(e=>(f(t=>new Set([...t,e])),()=>{f(t=>{const r=new Set(t);return r.delete(e),r})}),[f]),R=x.useCallback(()=>p(e,null,function*(){if(y)try{const e=yield y.refreshConnectionState();j(e)}catch(e){j(!1)}}),[y]),$=x.useMemo(()=>({sagachs:n,addSagach:E,updateSagach:T,deleteSagach:D,sagachimStatus:a,addSagachimStatus:N,updateSagachimStatus:I,deleteSagachimStatus:M,clearAllData:L,useDatabase:v,isDatabaseConnected:S,refreshDatabaseConnection:R,subscribeToChanges:A,isLoading:s,error:g}),[n,E,T,D,a,N,I,M,L,v,S,A,s,g]);return x.useEffect(()=>(window.clearAllSagachData=L,()=>{delete window.clearAllSagachData}),[L]),u.jsx(U.Provider,{value:$,children:t})},X=()=>{const e=x.useContext(U);if(void 0===e)throw new Error("useSagachData must be used within a SagachDataProvider");return e},K=()=>{var e,t;const{sagachs:r,addSagach:n,updateSagach:i,deleteSagach:a,isLoading:o,error:s}=X(),[c,p]=x.useState(""),[g,h]=x.useState(""),[m,f]=x.useState(null);x.useEffect(()=>{r.length>0&&!c&&(p(r[0].id),h(r[0].currentVersion))},[r,c]);const[y,b]=x.useState(new Set),[v,w]=x.useState(!1),[S,j]=x.useState(""),[k,C]=x.useState(""),[E,T]=x.useState(""),[D,N]=x.useState(!0),[z,I]=x.useState(!1),[M,L]=x.useState(!1),[A,R]=x.useState(null),[$,F]=x.useState(null),[_,B]=x.useState({}),[W,O]=x.useState(null),[U,P]=x.useState(["Column 1","Column 2","Column 3","Column 4"]),[q,Y]=x.useState(null),[H,V]=x.useState(""),[J,K]=x.useState(""),Z=e=>e.toLocaleDateString("he-IL").replace(/\./g,"/");x.useEffect(()=>{const e={};U.forEach(t=>{_[t]||(e[t]=150)}),Object.keys(e).length>0&&B(t=>l(l({},t),e))},[U]);const ee=()=>r.find(e=>e.id===c);x.useEffect(()=>{const e=ee();e&&(h(e.currentVersion),I(!1))},[c]);const te=()=>{const e=r.find(e=>e.id===c);return e?e.data:[]},re=e=>{if(!z||D)return{type:"modified",fields:[]};const t=ee();if(!t)return{type:"modified",fields:[]};if(!t.versions.find(e=>e.version===g))return{type:"modified",fields:[]};const r=t.versions.findIndex(e=>e.version===g);if(r===t.versions.length-1)return{type:"modified",fields:[]};const n=t.versions[r+1];if(!n)return{type:"modified",fields:[]};const i=n.data.find(t=>t.id===e.id);if(!i)return{type:"new",fields:[]};const a=[];return i.name!==e.name&&a.push("name"),i.type!==e.type&&a.push("type"),i.data!==e.data&&a.push("data"),i.fieldName!==e.fieldName&&a.push("fieldName"),{type:(a.length,"modified"),fields:a}},ne=(e,t)=>{f({rowId:e,field:t})},ie=(e,t,n)=>{r.forEach(r=>{if(r.data.some(t=>t.id===e)){const a=r.data.map(r=>r.id===e?d(l({},r),{[t]:n}):r);i(r.id,{data:a})}}),f(null)},ae=e=>{R(e),L(!0)},oe=(e,t)=>{F({rowId:e,field:t});const r=document.querySelector('[tabindex="0"]');r&&r.focus()},se=(e,t,r)=>{f({rowId:e,field:t}),F(null)},le=()=>{q&&H.trim()&&H!==q&&((e,t)=>{if(t.trim()&&t!==e){const n=t.trim();P(t=>t.map(t=>t===e?n:t)),B(t=>{const r=l({},t);return r[n]=r[e]||150,delete r[e],r}),r.forEach(t=>{const r=t.data.map(t=>{const r=l({},t);return void 0!==r[e]&&(r[n]=r[e],delete r[e]),r}),a=t.versions.map(t=>d(l({},t),{data:t.data.map(t=>{const r=l({},t);return void 0!==r[e]&&(r[n]=r[e],delete r[e]),r})}));i(t.id,{data:r,versions:a})})}})(q,H.trim()),Y(null),V("")},de=e=>{"Enter"===e.key?le():"Escape"===e.key&&(Y(null),V(""))},ce=()=>{const e={id:`row_${Date.now()}`};return U.forEach(t=>{e[t]=""}),e},pe=()=>{if(!J.trim())return r;const e=J.toLowerCase().trim();return r.filter(t=>t.name.toLowerCase().includes(e)||t.data.some(t=>Object.values(t).some(t=>String(t).toLowerCase().includes(e))))};return u.jsxs("div",{className:"sagachim-manager",style:{height:"100vh",background:"radial-gradient(1200px 800px at 80% 20%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 10% 90%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",color:"var(--text)",fontFamily:'"Segoe UI", system-ui, sans-serif',position:"relative",width:"100vw",maxWidth:"100%",boxSizing:"border-box",overflow:"hidden"},children:[u.jsxs("div",{className:"versions-panel",style:{position:"fixed",left:"12px",top:"120px",bottom:"12px",width:D?"60px":"280px",background:"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"var(--radius)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 20px 60px rgba(0,0,0,0.35)",backdropFilter:"blur(8px)",padding:"16px",overflow:"hidden",zIndex:100,transition:"width 0.3s ease"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px",borderBottom:"1px solid rgba(255,255,255,0.12)",paddingBottom:"12px"},children:[!D&&u.jsx("h2",{style:{color:"var(--accent)",fontSize:"20px",fontWeight:"700",letterSpacing:"0.4px",margin:0},children:"Versions"}),u.jsx("button",{onClick:()=>{N(!D),D?(I(!1),h("")):I(!1)},className:"btn ghost",style:{padding:"8px",fontSize:"16px",minWidth:"auto",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},title:D?"הרחב":"כווץ",children:D?"▶":"◀"})]}),!D&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:{padding:"8px 12px",background:"rgba(124,192,255,0.1)",border:"1px solid rgba(124,192,255,0.3)",borderRadius:"8px",textAlign:"center",color:"var(--accent)",fontSize:"14px",fontWeight:"600",direction:"rtl",marginBottom:"12px"},children:(null==(e=ee())?void 0:e.name)||(0===r.length?'אין סג"חים':'בחר סג"ח')}),u.jsx("div",{className:"versions-list",children:(()=>{const e=ee();return e?e.versions:[]})().map(e=>u.jsxs("div",{className:"version-item "+(g===e.version?"selected":""),onClick:()=>(e=>{const t=ee();if(!t)return;const r=t.versions.find(t=>t.version===e);r&&(i(c,{data:[...r.data]}),h(e),I(!0),b(new Set))})(e.version),style:{background:g===e.version?"linear-gradient(180deg, rgba(124,192,255,0.22), rgba(124,192,255,0.1))":"rgba(255,255,255,0.06)",color:(e.version,"var(--text)"),border:g===e.version?"1px solid rgba(124,192,255,0.6)":"1px solid rgba(255,255,255,0.14)",borderRadius:"12px",padding:"12px",marginBottom:"10px",cursor:"pointer",transition:"transform 120ms ease, box-shadow 200ms ease, background 200ms ease",textAlign:"center",position:"relative",boxShadow:g===e.version?"0 6px 22px rgba(124,192,255,0.24)":"0 4px 12px rgba(0,0,0,0.2)",backdropFilter:"blur(6px)"},children:[u.jsxs("div",{style:{fontSize:"20px",fontWeight:"bold",marginBottom:"5px"},children:[e.version,e.changes&&e.changes.length>0&&u.jsx("span",{style:{position:"absolute",top:"6px",right:"6px",backgroundColor:"var(--accent)",color:"#000",borderRadius:"50%",width:"6px",height:"6px",fontSize:"6px",display:"inline-block",boxShadow:"0 0 8px rgba(124,192,255,0.6)"}})]}),u.jsx("div",{style:{fontSize:"12px",color:"var(--muted)"},children:e.date}),u.jsx("div",{style:{fontSize:"12px",color:"var(--muted)"},children:e.time}),e.changes&&e.changes.length>0&&u.jsxs("div",{style:{fontSize:"10px",marginTop:"6px",color:"var(--accent)",fontWeight:"bold"},children:[e.changes.length," שינויים"]})]},e.version))})]})]}),u.jsx("div",{className:"table-panel",style:{position:"fixed",left:D?"84px":"304px",right:"344px",top:"120px",bottom:"12px",background:"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"var(--radius)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 20px 60px rgba(0,0,0,0.35)",backdropFilter:"blur(8px)",padding:"16px",overflow:"auto",display:"flex",flexDirection:"column",zIndex:50},children:c?u.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px",paddingBottom:"12px",borderBottom:"1px solid rgba(255,255,255,0.12)"},children:[u.jsxs("div",{children:[u.jsx("h2",{style:{color:"var(--accent)",fontSize:"20px",fontWeight:"700",direction:"rtl",margin:0},children:null==(t=r.find(e=>e.id===c))?void 0:t.name}),z&&!D&&u.jsxs("div",{style:{display:"flex",gap:"16px",marginTop:"8px",fontSize:"12px",direction:"rtl"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[u.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:"rgba(76,175,80,0.6)",borderRadius:"2px"}}),u.jsx("span",{style:{color:"var(--muted)"},children:"הוספו מהגרסה הקודמת"})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[u.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:"rgba(255,165,0,0.6)",borderRadius:"2px"}}),u.jsx("span",{style:{color:"var(--muted)"},children:"שונו מהגרסה הקודמת"})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[u.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:"rgba(255,80,80,0.6)",borderRadius:"2px"}}),u.jsx("span",{style:{color:"var(--muted)"},children:"הוסרו מהגרסה הקודמת"})]})]})]}),u.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[u.jsx("button",{onClick:()=>{const e=ce(),t=[...te(),e];c&&i(c,{data:t}),U.length>0&&F({rowId:e.id,field:U[0]})},className:"btn primary",style:{padding:"8px 16px",fontSize:"12px",direction:"rtl"},children:"+ הוסף רשומה"}),u.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&r.type,e.target.value=""},style:{display:"none"},id:"excel-upload"}),u.jsx("label",{htmlFor:"excel-upload",className:"btn ghost",style:{padding:"8px 16px",fontSize:"12px",cursor:"pointer",direction:"rtl"},children:"📁 העלה אקסל"})]})]}),u.jsxs("div",{style:{flex:1,overflow:"auto",position:"relative",outline:"none"},onKeyDown:e=>{if(!$)return;const t=te(),r=t.findIndex(e=>e.id===$.rowId),n=U.indexOf($.field);let i=r,a=n;switch(e.key){case"ArrowUp":e.preventDefault(),i=Math.max(0,r-1);break;case"ArrowDown":e.preventDefault(),i=Math.min(t.length-1,r+1);break;case"ArrowLeft":e.preventDefault(),a=Math.max(0,n-1);break;case"ArrowRight":e.preventDefault(),a=Math.min(U.length-1,n+1);break;case"Enter":return e.preventDefault(),void(t[r]&&(t[r][$.field],se($.rowId,$.field)));case"Tab":e.preventDefault(),a=e.shiftKey?Math.max(0,n-1):Math.min(U.length-1,n+1);break;default:return}t[i]&&U[a]&&F({rowId:t[i].id,field:U[a]})},tabIndex:0,onFocus:e=>{e.currentTarget.focus()},children:[u.jsx("style",{children:"\n                  .table-container::-webkit-scrollbar {\n                    width: 12px;\n                    height: 12px;\n                  }\n                  .table-container::-webkit-scrollbar-track {\n                    background: rgba(255,255,255,0.05);\n                    border-radius: 6px;\n                  }\n                  .table-container::-webkit-scrollbar-thumb {\n                    background: linear-gradient(135deg, rgba(124,192,255,0.6), rgba(167,90,255,0.6));\n                    border-radius: 6px;\n                    border: 2px solid rgba(255,255,255,0.1);\n                  }\n                  .table-container::-webkit-scrollbar-thumb:hover {\n                    background: linear-gradient(135deg, rgba(124,192,255,0.8), rgba(167,90,255,0.8));\n                  }\n                  .table-container::-webkit-scrollbar-corner {\n                    background: rgba(255,255,255,0.05);\n                  }\n                "}),u.jsx("div",{className:"table-container",style:{overflow:"auto",height:"100%",position:"relative"},children:u.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:`${Object.values(_).reduce((e,t)=>e+t,0)+100}px`},children:[u.jsx("thead",{children:u.jsxs("tr",{style:{background:"rgba(255,255,255,0.08)"},children:[u.jsx("th",{style:{padding:"12px",textAlign:"center",color:"var(--accent)",fontWeight:"600",borderBottom:"2px solid rgba(124,192,255,0.3)",width:"80px",minWidth:"80px"},children:u.jsx("button",{onClick:()=>{const e=`Column ${U.length+1}`;P(t=>[e,...t]),B(t=>d(l({},t),{[e]:150})),(e=>{r.forEach(t=>{const r=t.data.map(t=>d(l({},t),{[e]:""})),n=t.versions.map(t=>d(l({},t),{data:t.data.map(t=>d(l({},t),{[e]:""}))}));i(t.id,{data:r,versions:n})})})(e);const t=te();if(t.length>0){const r=t[0].id;F({rowId:r,field:e})}},style:{background:"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",border:"1px solid rgba(76,175,80,0.4)",borderRadius:"8px",padding:"6px 8px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 2px 8px rgba(76,175,80,0.3)",minWidth:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(76,175,80,0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="0 2px 8px rgba(76,175,80,0.3)"},title:"הוסף עמודה חדשה",children:"+"})}),U.map((e,t)=>u.jsxs("th",{style:{padding:"12px",textAlign:"center",color:"var(--accent)",fontWeight:"600",direction:"rtl",borderBottom:"2px solid rgba(124,192,255,0.3)",width:`${_[e]||150}px`,minWidth:"80px",position:"relative",userSelect:"none"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[q===e?u.jsx("input",{type:"text",value:H,onChange:e=>V(e.target.value),onBlur:le,onKeyDown:de,autoFocus:!0,style:{background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.6)",borderRadius:"4px",padding:"4px 8px",color:"var(--text)",fontSize:"14px",fontWeight:"600",width:"100%",direction:"rtl",outline:"none"}}):u.jsx("span",{style:{flex:1,cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background 0.2s ease"},onClick:()=>{return Y(t=e),void V(t);var t},onMouseEnter:e=>{e.currentTarget.style.background="rgba(124,192,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},title:"לחץ לעריכה",children:e}),u.jsx("button",{onClick:()=>{return t=e,void(U.length>1&&(P(e=>e.filter(e=>e!==t)),B(e=>{const r=l({},e);return delete r[t],r})));var t},style:{background:"transparent",border:"none",color:"#ff5050",cursor:"pointer",fontSize:"12px",padding:"2px 4px",marginLeft:"8px",opacity:U.length>1?1:.3},disabled:U.length<=1,title:"מחק עמודה",children:"×"})]}),u.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:"4px",cursor:"col-resize",background:W===e?"rgba(124,192,255,0.8)":"transparent",transition:"background 0.2s ease"},onMouseDown:t=>{t.preventDefault(),(e=>{O(e)})(e);const r=t.clientX,n=_[e]||150,i=t=>{const i=n+(t.clientX-r);((e,t)=>{B(r=>d(l({},r),{[e]:Math.max(80,t)}))})(e,i)},a=()=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",a),O(null)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",a)},onMouseEnter:e=>{W||(e.currentTarget.style.background="rgba(124,192,255,0.3)")},onMouseLeave:e=>{W||(e.currentTarget.style.background="transparent")}})]},e))]})}),u.jsxs("tbody",{children:[te().map((e,t)=>u.jsx(G,{item:e,isEven:t%2==0,changes:re(e),editingCell:m,selectedCell:$,columnWidths:_,tableColumns:U,onCellClick:ne,onCellSelect:oe,onCellDoubleClick:se,onCellSave:ie,onDelete:ae},e.id)),(()=>{if(!z||D)return[];const e=ee();if(!e)return[];if(!e.versions.find(e=>e.version===g))return[];const t=e.versions.findIndex(e=>e.version===g);if(t===e.versions.length-1)return[];const r=e.versions[t+1];if(!r)return[];const n=te();return r.data.filter(e=>!n.find(t=>t.id===e.id))})().map((e,t)=>u.jsx(G,{item:e,isEven:(te().length+t)%2==0,changes:{type:"removed",fields:[]},editingCell:m,selectedCell:$,columnWidths:_,tableColumns:U,onCellClick:ne,onCellSelect:oe,onCellDoubleClick:se,onCellSave:ie,onDelete:()=>{}},`removed-${e.id}`))]})]})}),0===te().length&&u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"200px",color:"var(--muted)",fontSize:"16px",direction:"rtl"},children:'אין רשומות בסג"ח זה'})]})]}):u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--muted)",fontSize:"16px",direction:"rtl"},children:u.jsx("div",{children:0===r.length?'אין סג"חים זמינים - צור סג"ח חדש כדי להתחיל':'בחר סג"ח כדי להציג את הנתונים'})})}),u.jsxs("div",{className:"sagach-manager-panel",style:{position:"fixed",right:"12px",top:"120px",bottom:"12px",width:"320px",background:"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"var(--radius)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 20px 60px rgba(0,0,0,0.35)",backdropFilter:"blur(8px)",padding:"16px",display:"flex",flexDirection:"column",gap:"12px",zIndex:100,overflow:"auto"},children:[u.jsx("h2",{style:{color:"var(--accent)",fontSize:"18px",marginBottom:"12px",textAlign:"center",fontWeight:"700",letterSpacing:"0.4px",borderBottom:"1px solid rgba(255,255,255,0.12)",paddingBottom:"10px",direction:"rtl"},children:'מנהל סג"חים'}),u.jsx("div",{style:{marginBottom:"16px"},children:u.jsx("button",{onClick:()=>w(!0),className:"btn primary",style:{width:"100%",padding:"10px",fontSize:"14px",direction:"rtl"},children:'+ צור סג"ח חדש'})}),u.jsx("div",{style:{marginBottom:"16px"},children:u.jsx("input",{type:"text",value:J,onChange:e=>K(e.target.value),placeholder:"חפש סגחים...",style:{width:"100%",padding:"10px 12px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"8px",color:"var(--text)",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 8px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}})}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px",flex:1},children:pe().length>0?pe().map(e=>u.jsx(Q,{sagach:e,isSelected:c===e.id,onSelect:()=>p(e.id)},e.id)):u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px 20px",textAlign:"center",color:"var(--muted)",direction:"rtl"},children:[u.jsx("div",{style:{fontSize:"48px",marginBottom:"16px",opacity:.5},children:"📋"}),u.jsx("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:'אין סג"חים'}),u.jsx("div",{style:{fontSize:"14px",opacity:.8},children:'צור סג"ח חדש כדי להתחיל'})]})}),u.jsxs("div",{style:{marginTop:"16px",display:"flex",flexDirection:"column",gap:"8px"},children:[u.jsx("button",{onClick:()=>(()=>{const e=c,t=r.find(t=>t.id===e);if(!t)return;const n=t.versions[0],a=[];if(t.data.forEach(e=>{const t=n.data.find(t=>t.id===e.id);t?(t.name!==e.name&&a.push(`Name changed: ${t.name} → ${e.name}`),t.type!==e.type&&a.push(`Type changed for ${e.name}: ${t.type} → ${e.type}`),t.data!==e.data&&a.push(`Data changed for ${e.name}: ${t.data} → ${e.data}`),t.fieldName!==e.fieldName&&a.push(`Field name changed for ${e.name}: ${t.fieldName} → ${e.fieldName}`)):a.push(`Added: ${e.name}`)}),n.data.forEach(e=>{t.data.find(t=>t.id===e.id)||a.push(`Removed: ${e.name}`)}),a.length>0){const r=(e=>{const t=e.split("."),r=parseInt(t[2])+1;return`${t[0]}.${t[1]}.${r}`})(t.currentVersion),n=new Date,o={version:r,date:Z(n),time:n.toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"}),data:[...t.data],changes:a};i(e,{currentVersion:r,versions:[o,...t.versions]}),e===c&&h(r)}})(),className:"btn primary",style:{padding:"10px 16px",fontSize:"13px",fontWeight:"600",direction:"rtl",letterSpacing:"0.3px"},children:'שמור שינויים לסג"ח הנוכחי'}),u.jsx("button",{className:"btn ghost",style:{padding:"10px 16px",fontSize:"13px",fontWeight:"600",direction:"rtl",letterSpacing:"0.3px"},children:"פרסם לשותפים"})]})]}),v&&u.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:u.jsxs("div",{style:{background:"radial-gradient(1200px 800px at 50% 50%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 50% 50%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",border:"2px solid rgba(124,192,255,0.3)",borderRadius:"24px",padding:"32px",width:"480px",maxWidth:"90vw",boxShadow:"0 20px 60px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1)",backdropFilter:"blur(12px)"},children:[u.jsx("h2",{style:{color:"var(--text)",fontSize:"24px",fontWeight:"700",textAlign:"center",marginBottom:"24px",direction:"rtl"},children:'צור סג"ח חדש'}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[u.jsx("label",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",direction:"rtl"},children:"שם יחיד לשיתוף"}),u.jsx("input",{type:"text",value:S,onChange:e=>j(e.target.value),style:{background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",padding:"14px 16px",color:"var(--text)",fontSize:"16px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 20px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[u.jsx("label",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",direction:"rtl"},children:'שם הסג"ח'}),u.jsx("input",{type:"text",value:k,onChange:e=>C(e.target.value),style:{background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",padding:"14px 16px",color:"var(--text)",fontSize:"16px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 20px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[u.jsx("label",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",direction:"rtl"},children:"סיפק"}),u.jsx("input",{type:"text",value:E,onChange:e=>T(e.target.value),style:{background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",padding:"14px 16px",color:"var(--text)",fontSize:"16px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 20px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[u.jsx("label",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",direction:"rtl"},children:"העלה קובץ אקסל (אופציונלי)"}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",background:"rgba(255,255,255,0.05)",border:"2px dashed rgba(124,192,255,0.3)",borderRadius:"12px",padding:"20px",transition:"all 0.2s ease"},children:[u.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:e=>{var t;null==(t=e.target.files)||t[0]},style:{display:"none"},id:"excel-upload-popup"}),u.jsx("label",{htmlFor:"excel-upload-popup",style:{background:"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",border:"1px solid rgba(76,175,80,0.4)",borderRadius:"8px",padding:"10px 16px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"8px",direction:"rtl"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(76,175,80,0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="none"},children:"📁 בחר קובץ אקסל"}),u.jsx("span",{style:{color:"var(--muted)",fontSize:"14px",direction:"rtl"},children:"או גרור קובץ לכאן"})]})]})]}),u.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"32px",justifyContent:"center"},children:[u.jsx("button",{onClick:()=>{if(S.trim()){const e=`sagach${Date.now()}`,t=new Date,r=ce(),i={version:"1.0.1",date:Z(t),time:t.toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"}),data:[r],changes:["Initial version"]},a={id:e,name:S.trim(),data:[r],currentVersion:"1.0.1",versions:[i]};n(a),p(e),h("1.0.1"),j(""),C(""),T(""),w(!1)}},style:{background:"linear-gradient(135deg, rgba(124,192,255,0.8), rgba(124,192,255,0.6))",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"12px",padding:"12px 24px",color:"white",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",direction:"rtl",boxShadow:"0 4px 16px rgba(124,192,255,0.3)"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 8px 24px rgba(124,192,255,0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="0 4px 16px rgba(124,192,255,0.3)"},children:"הוסף פורמט להעלאת דגימה"}),u.jsx("button",{onClick:()=>{w(!1),j(""),C(""),T("")},style:{background:"transparent",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"12px",padding:"12px 24px",color:"var(--text)",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",direction:"rtl"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(124,192,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"מעלה דגימה"})]})]})}),M&&u.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:u.jsxs("div",{style:{background:"radial-gradient(1200px 800px at 50% 50%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 50% 50%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",border:"2px solid rgba(255,80,80,0.3)",borderRadius:"24px",padding:"32px",width:"400px",maxWidth:"90vw",boxShadow:"0 20px 60px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1)",backdropFilter:"blur(12px)"},children:[u.jsx("h2",{style:{color:"#ff5050",fontSize:"24px",fontWeight:"700",textAlign:"center",marginBottom:"16px",direction:"rtl"},children:"מחק רשומה"}),u.jsx("p",{style:{color:"var(--text)",fontSize:"16px",textAlign:"center",marginBottom:"24px",direction:"rtl"},children:"האם אתה בטוח שברצונך למחוק את הרשומה הזו? פעולה זו לא ניתנת לביטול."}),u.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[u.jsx("button",{onClick:()=>{L(!1),R(null)},style:{background:"transparent",border:"1px solid rgba(255,255,255,0.4)",borderRadius:"12px",padding:"12px 24px",color:"var(--text)",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",direction:"rtl"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"ביטול"}),u.jsx("button",{onClick:()=>{return A&&(e=A,r.forEach(t=>{if(t.data.some(t=>t.id===e)){const r=t.data.filter(t=>t.id!==e);i(t.id,{data:r})}}),L(!1),void R(null));var e},style:{background:"linear-gradient(135deg, rgba(255,80,80,0.8), rgba(255,80,80,0.6))",border:"1px solid rgba(255,80,80,0.4)",borderRadius:"12px",padding:"12px 24px",color:"white",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",direction:"rtl",boxShadow:"0 4px 16px rgba(255,80,80,0.3)"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 8px 24px rgba(255,80,80,0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="0 4px 16px rgba(255,80,80,0.3)"},children:"מחק"})]})]})})]})},G=x.memo(({item:e,isEven:t,changes:r,editingCell:n,selectedCell:i,columnWidths:a,tableColumns:o,onCellClick:s,onCellSelect:c,onCellDoubleClick:p,onCellSave:g,onDelete:h})=>{const[m,f]=x.useState(""),[y,b]=x.useState(null),[v,w]=x.useState(null),[S,j]=x.useState(0),[k,C]=x.useState(0);x.useEffect(()=>()=>{y&&clearTimeout(y)},[y]),x.useEffect(()=>{if((null==n?void 0:n.rowId)===e.id&&(null==n?void 0:n.field)){const t=e[n.field]||"";f(t)}},[n,e.id]);const E=(t,a)=>{const o=(null==n?void 0:n.rowId)===e.id&&(null==n?void 0:n.field)===t,s=(null==i?void 0:i.rowId)===e.id&&(null==i?void 0:i.field)===t,c=r.fields.includes(t),p="new"===r.type,u="removed"===r.type,g=v===t;let x=a.backgroundColor,h=a.border,m="none",f=1;return o?(x="rgba(124,192,255,0.2)",h="1px solid rgba(124,192,255,0.6)",m="0 0 8px rgba(124,192,255,0.3)"):s?(x="rgba(124,192,255,0.1)",h="1px solid rgba(124,192,255,0.4)",m="0 0 4px rgba(124,192,255,0.2)"):u?(x="rgba(255,80,80,0.15)",h="1px solid rgba(255,80,80,0.4)",m="0 0 8px rgba(255,80,80,0.2)",f=.7):p?(x="rgba(76,175,80,0.15)",h="1px solid rgba(76,175,80,0.4)",m="0 0 8px rgba(76,175,80,0.2)"):c?(x="rgba(255,165,0,0.15)",h="1px solid rgba(255,165,0,0.4)",m="0 0 8px rgba(255,165,0,0.2)"):g&&(x="rgba(124,192,255,0.08)",h="1px solid rgba(124,192,255,0.3)",m="0 0 4px rgba(124,192,255,0.15)"),d(l({},a),{backgroundColor:x,border:h,boxShadow:m,opacity:f,cursor:o?"text":"pointer",transition:"all 0.2s ease"})},T=()=>{p(e.id,"Column 1","test value")};x.useEffect(()=>(window.testEditFunction=T,()=>{delete window.testEditFunction}),[T]);const D=t=>{g(e.id,t,m)},N=(t,r)=>(null==n?void 0:n.rowId)===e.id&&(null==n?void 0:n.field)===t?u.jsx("textarea",{value:m,onChange:e=>f(e.target.value),onBlur:()=>D(t),onKeyDown:r=>((t,r)=>{if("Enter"!==t.key||t.shiftKey)if("Enter"===t.key&&t.shiftKey){const e=t.currentTarget,r=e.selectionStart,n=e.selectionEnd,i=e.value,a=i.substring(0,r)+"\n"+i.substring(n);f(a),setTimeout(()=>{e.selectionStart=e.selectionEnd=r+1},0)}else"Escape"===t.key&&g(e.id,r,m);else D(r)})(r,t),autoFocus:!0,style:{background:"transparent",border:"none",outline:"none",color:"var(--text)",fontSize:"13px",width:"100%",minHeight:"20px",maxHeight:"100px",resize:"none",textAlign:"center",direction:"name"===t?"rtl":"ltr",fontFamily:"inherit",lineHeight:"1.4"}}):u.jsx("div",{onClick:n=>{n.stopPropagation(),((t,r)=>{const n=Date.now();if(y&&(clearTimeout(y),b(null)),n-k<300&&S>0)return j(0),C(0),void p(e.id,t,r||"");j(e=>e+1),C(n);const i=setTimeout(()=>{c(e.id,t),j(0)},300);b(i)})(t,r)},onDoubleClick:n=>{n.stopPropagation(),n.preventDefault(),((t,r)=>{y&&(clearTimeout(y),b(null)),j(0),C(0),p(e.id,t,r||"")})(t,r)},onMouseEnter:()=>w(t),onMouseLeave:()=>w(null),style:{cursor:"pointer",display:"flex",width:"100%",height:"100%",minHeight:"40px",whiteSpace:"pre-wrap",wordBreak:"break-word",userSelect:"none",padding:"8px",margin:"-8px",alignItems:"center",justifyContent:"center",position:"relative"},children:u.jsx("span",{style:{textAlign:"center",width:"100%"},children:r})}),z={padding:"10px 12px",border:"none",textAlign:"center",color:"var(--text)",fontSize:"13px"},I=(()=>{const e="new"===r.type,n="removed"===r.type;let i=t?"rgba(255,255,255,0.04)":"rgba(255,255,255,0.02)",a="1px solid rgba(255,255,255,0.06)",o=1;return e?(i="rgba(76,175,80,0.08)",a="1px solid rgba(76,175,80,0.3)"):n&&(i="rgba(255,80,80,0.08)",a="1px solid rgba(255,80,80,0.3)",o=.7),{background:i,borderBottom:a,opacity:o,transition:"background 0.2s ease, opacity 0.2s ease"}})();return u.jsxs("tr",{style:I,onMouseEnter:e=>{n||"removed"===r.type||(e.currentTarget.style.background="new"===r.type?"rgba(76,175,80,0.12)":"rgba(255,255,255,0.08)")},onMouseLeave:e=>{n||(e.currentTarget.style.background=I.background)},children:[u.jsx("td",{style:{width:"80px",minWidth:"80px",padding:"10px 12px",border:"none",textAlign:"center",color:"var(--text)",fontSize:"13px"}}),o.map((t,n)=>u.jsx("td",{style:d(l({},E(t,d(l({},z),{direction:0===n?"rtl":"ltr"}))),{width:`${a[t]||150}px`,minWidth:"80px"}),children:n===o.length-1?u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[u.jsx("span",{style:{flex:1},children:N(t,e[t]||"")}),"removed"===r.type?u.jsx("span",{style:{color:"#ff5050",fontSize:"12px",fontWeight:"bold",marginLeft:"8px"},children:"הוסר"}):u.jsx("button",{onClick:()=>h(e.id),className:"btn ghost",style:{padding:"2px 4px",fontSize:"10px",borderColor:"rgba(255,80,80,0.4)",color:"#ff5050",marginLeft:"8px",minWidth:"auto",width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center"},title:"מחק רשומה",children:"🗑"})]}):N(t,e[t]||"")},t))]})});G.displayName="TableRow";const Q=({sagach:e,isSelected:t,onSelect:r})=>u.jsxs("div",{style:{background:t?"linear-gradient(180deg, rgba(124,192,255,0.15), rgba(124,192,255,0.08))":"rgba(255,255,255,0.06)",border:t?"1px solid rgba(124,192,255,0.6)":"1px solid rgba(255,255,255,0.14)",borderRadius:"12px",padding:"12px",transition:"all 0.2s ease",boxShadow:t?"0 6px 22px rgba(124,192,255,0.24)":"0 4px 12px rgba(0,0,0,0.2)"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:u.jsx("div",{onClick:r,style:{cursor:"pointer",fontSize:"16px",fontWeight:"600",color:"var(--text)",direction:"rtl",flex:1},children:e.name})}),u.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",marginBottom:"8px",direction:"rtl"},children:[e.data.length," רשומות"]})]}),Z=e=>`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`,ee=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]},te=["נמוך","בינוני","גבוה","TOP"],re={"נמוך":"נמוך","בינוני":"בינוני","גבוה":"גבוה",TOP:"TOP"},ne=["7140","7190","7149","7170","גבעה",'שב"כ','קש"ח','גדס"מ',"הצריף","8153"],ie=["ממתין לבשלות בצד ספק",'ממתין לקבלת דג"ח והתנעה',"בתהליכי אפיון","ממתין לאינטגרציות","אינטגרציות","מבצוע"],ae=["ממתין לבשלות בצד ספק",'ממתין לקבלת דג"ח והתנעה',"בתהליכי אפיון","ממתין לאינטגרציות","אינטגרציות","מבצוע","מובצע"];if("undefined"!=typeof document&&!document.head.querySelector("#spinner-animation")){const e=document.createElement("style");e.id="spinner-animation",e.textContent="\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n",document.head.appendChild(e)}const oe=x.memo(()=>{var t;const{canEditStatus:r,canCreateSagach:n,canDeleteSagach:i,canChat:a,user:o,hasRole:s}=z(),{sagachimStatus:c,addSagachimStatus:g,updateSagachimStatus:h,deleteSagachimStatus:m,clearAllData:f,isLoading:y,error:b}=X(),v=x.useCallback((e,t)=>{var r;return(null==(r=e.notificationSubscribers)?void 0:r.some(e=>e.userId===t))||!1},[]);x.useCallback((e,t)=>{var r;return null==(r=e.notificationSubscribers)?void 0:r.find(e=>e.userId===t)},[]);const w=x.useCallback((e,t,r,n,i)=>{const a={userId:t,userName:r,notificationMethod:n,notificationFrequency:i,subscribedAt:(new Date).toISOString()},o=[...(e.notificationSubscribers||[]).filter(e=>e.userId!==t),a];return d(l({},e),{notificationSubscribers:o,notifications:v(e,t),notificationMethod:n,notificationFrequency:i})},[v]),S=x.useCallback(e=>Array.isArray(e.arena)?e.arena:e.arena&&"string"==typeof e.arena?[e.arena]:[],[]),j=x.useCallback((e,t)=>{const r=(e.notificationSubscribers||[]).filter(e=>e.userId!==t);return d(l({},e),{notificationSubscribers:r,notifications:!1})},[]),k={primary:{appearance:"none",border:"none",borderRadius:"12px",padding:"12px 20px",cursor:"pointer",transition:"all 0.2s ease",fontSize:"14px",fontWeight:"600",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",direction:"rtl",outline:"none"},filter:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"transparent",color:"var(--text)",borderRadius:"12px",padding:"8px 14px",cursor:"pointer",transition:"transform 120ms ease",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"right",boxShadow:"none"},close:{background:"none",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:"14px",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",width:"16px",height:"16px",borderRadius:"50%",transition:"all 0.2s ease"}},[C,E]=x.useState(""),[T,D]=x.useState(""),[N,I]=x.useState(""),[M,L]=x.useState(""),[A,R]=x.useState(""),[$,F]=x.useState("none"),[_,B]=x.useState(null),[W,U]=x.useState(""),[P,q]=x.useState(!1),[Y,H]=x.useState(1),V=x.useRef(null),[J,K]=x.useState(!1),[G,Q]=x.useState(!1),[oe,se]=x.useState(!1),[le,de]=x.useState(!1),[ce,pe]=x.useState(!1),[ue,ge]=x.useState(!1),[xe,he]=x.useState(!1),[me,fe]=x.useState(!1),[ye,be]=x.useState(!1),[ve,we]=x.useState(!1),[Se,je]=x.useState(!1),[ke,Ce]=x.useState("email"),[Ee,Te]=x.useState("status_change"),[De,Ne]=x.useState(!1),[ze,Ie]=x.useState(!1),[Me,Le]=x.useState(!1),[Ae,Re]=x.useState(!1),[$e,Fe]=x.useState({name:"",description:"",provider:"",arena:[],priority:"בינוני",sagachType:""}),[_e,Be]=x.useState({message:"",type:"success",isVisible:!1}),[We,Oe]=x.useState(null),[Ue,Pe]=x.useState(!1),[qe,Ye]=x.useState(!1),[He,Ve]=x.useState(""),[Je,Xe]=x.useState(!1),[Ke,Ge]=x.useState(""),[Qe,Ze]=x.useState(!1),[et,tt]=x.useState({description:"",provider:"",arena:[],priority:"בינוני",sagachType:"",processStatus:1,processStartDate:"",attachments:[]}),[rt,nt]=x.useState(new Date),it=()=>We||new Date,at=e=>{if(!e.trim())return null;const t=e.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(!t)return null;const[,r,n,i]=t,a=parseInt(r,10),o=parseInt(n,10),s=parseInt(i,10);if(a<1||a>31||o<1||o>12||s<1900)return null;const l=new Date(s,o-1,a);return l.getFullYear()!==s||l.getMonth()!==o-1||l.getDate()!==a?null:l.toISOString()},ot=e=>{if(!e.trim())return null;const t=e.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(!t)return"פורמט תאריך לא תקין. השתמש בפורמט DD/MM/YYYY";const[,r,n,i]=t,a=parseInt(r,10),o=parseInt(n,10),s=parseInt(i,10);if(s<1900)return"שנת התאריך חייבת להיות 1900 או מאוחר יותר";if(o<1||o>12)return"חודש התאריך חייב להיות בין 1 ל-12";if(a<1||a>31)return"יום התאריך חייב להיות בין 1 ל-31";const l=new Date(s,o-1,a);if(l.getFullYear()!==s||l.getMonth()!==o-1||l.getDate()!==a){const e=["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],t=new Date(s,o,0).getDate();return`${a} ${e[o-1]} ${s} אינו תאריך תקין. ${e[o-1]} ${s} יש לו רק ${t} ימים`}return null},st=e=>{if(!e)return"לא צוין";try{const t=new Date(e);if(isNaN(t.getTime()))return"לא צוין";const r=t.getDate().toString().padStart(2,"0");return`${r}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`}catch(t){return"לא צוין"}},lt=x.useMemo(()=>{const e=it();return new Date(e.getFullYear(),e.getMonth(),e.getDate())},[rt]),dt=x.useCallback(e=>{if(!(null==e?void 0:e.trim()))return null;try{const t=/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/,r=e.match(t);if(r){const e=parseInt(r[1]),t=parseInt(r[2])-1,n=parseInt(r[3]);return new Date(n,t,e)}const n=new Date(e);return isNaN(n.getTime())?null:n}catch(t){return null}},[]),ct=x.useCallback(e=>{if(7===e.processStatus)return!1;if(!e.estimatedCompletion)return!1;const t=dt(e.estimatedCompletion);return!!t&&new Date(t.getFullYear(),t.getMonth(),t.getDate())<lt},[lt,dt]);x.useEffect(()=>{nt(We||new Date)},[We]),x.useEffect(()=>{const e=setInterval(()=>{We||nt(new Date)},6e4);return()=>clearInterval(e)},[We]);const[,pt]=x.useState(0);x.useEffect(()=>{c.length>0&&c.map(e=>{const t=it(),r=l({},e.phaseData||{});return Object.keys(r).forEach(n=>{var i;const a=parseInt(n),o=r[a];if(o){let n=0;o.entries&&o.entries.forEach(e=>{e.timeSpentDays&&(n+=e.timeSpentDays)});let s=(null==(i=o.currentEntry)?void 0:i.timeSpentDays)||0;if(o.currentEntry&&a===e.processStatus){const e=new Date(o.currentEntry.startDate+"T00:00:00"),r=new Date(t.toISOString().split("T")[0]+"T23:59:59"),n=Math.max(0,r.getTime()-e.getTime());s=Math.max(1,Math.ceil(n/864e5))}const c=n+s;r[a]=d(l({},o),{currentEntry:o.currentEntry?d(l({},o.currentEntry),{timeSpentDays:s}):void 0,totalTimeSpentDays:Math.max(o.totalTimeSpentDays||0,c)})}}),d(l({},e),{phaseData:r})}).forEach(e=>{h(e.id,e)}),pt(e=>e+1)},[We,rt,c.length]);const ut=x.useCallback((e,t=!1)=>{var r,n,i;if(!e)return 0;const a=(e.entries||[]).reduce((e,t)=>"number"!=typeof t.timeSpentDays||Number.isNaN(t.timeSpentDays)?e:e+t.timeSpentDays,0),o="number"!=typeof e.totalTimeSpentDays||Number.isNaN(e.totalTimeSpentDays)?0:e.totalTimeSpentDays,s="number"!=typeof(null==(r=e.currentEntry)?void 0:r.timeSpentDays)||Number.isNaN(null==(n=e.currentEntry)?void 0:n.timeSpentDays)?0:e.currentEntry.timeSpentDays,l=Math.max(a,o),d=Math.max(a,Math.max(0,o-s));if(t&&(null==(i=e.currentEntry)?void 0:i.startDate)){const t=new Date(e.currentEntry.startDate+"T00:00:00"),r=it(),n=new Date(r.toISOString().split("T")[0]+"T00:00:00"),i=Math.max(0,n.getTime()-t.getTime());return d+Math.max(1,Math.floor(i/864e5)+1)}return l},[We,rt]),gt=x.useCallback((e,t=!1)=>{if(!e)return"";const r=[...e.entries||[]];if(e.currentEntry&&r.push(e.currentEntry),0===r.length)return"";const n=r.map(e=>new Date(e.startDate)),i=new Date(Math.min(...n.map(e=>e.getTime())));let a;if(t&&e.currentEntry)a=it();else{const e=r.filter(e=>e.completionDate).map(e=>new Date(e.completionDate));a=e.length>0?new Date(Math.max(...e.map(e=>e.getTime()))):i}const o=Z(i),s=Z(a);return o===s?o:`${o} - ${s}`},[it]);x.useEffect(()=>{const e=e=>{e.target.closest("[data-dropdown-container]")||(K(!1),Q(!1),se(!1),de(!1),pe(!1),ge(!1),he(!1),fe(!1),be(!1),we(!1))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),x.useEffect(()=>{const e=e=>{"Escape"===e.key&&_&&(Ze(!1),B(null))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[_]),x.useEffect(()=>{_&&V.current&&setTimeout(()=>{V.current&&(V.current.scrollTop=V.current.scrollHeight)},100)},[_]),x.useEffect(()=>{_&&V.current&&_.statusUpdates&&setTimeout(()=>{V.current&&(V.current.scrollTop=V.current.scrollHeight)},50)},[null==_?void 0:_.statusUpdates]);const xt=(e,t="success")=>{Be({message:e,type:t,isVisible:!0}),setTimeout(()=>{Be(e=>d(l({},e),{isVisible:!1}))},3e3)},ht=x.useMemo(()=>[...new Set(c.map(e=>e.provider))].sort(),[c]),mt=x.useMemo(()=>{const e=c.flatMap(e=>e.arena);return[...new Set(e)].sort()},[c]),ft=x.useMemo(()=>[...new Set(c.map(e=>e.sagachType).filter(Boolean))].sort(),[c]),yt=x.useMemo(()=>{const e=C.toLowerCase(),t=C.length>0,r=T.length>0,n=N.length>0,i=M.length>0,a=A.length>0,o=it(),s=new Date(o);s.setDate(s.getDate()-7);let l=c.filter(o=>{if(7===o.processStatus&&o.completionDate&&new Date(o.completionDate)<s)return!1;if(t){const t=o.name.toLowerCase().includes(e),r=o.description.toLowerCase().includes(e);if(!t&&!r)return!1}return!(r&&o.provider!==T||n&&N&&!S(o).includes(N)||i&&o.processStatus.toString()!==M||a&&(o.sagachType||"")!==A)});return"none"!==$&&l.sort((e,t)=>"asc"===$?e.processStatus-t.processStatus:"desc"===$?t.processStatus-e.processStatus:0),l},[c,C,T,N,M,A,$]),bt=e=>{switch(e){case 1:return"rgba(128, 128, 128, 0.8)";case 2:return"rgba(33, 150, 243, 0.8)";case 3:return"rgba(255, 152, 0, 0.8)";case 4:return"rgba(233, 30, 99, 0.8)";case 5:return"rgba(156, 39, 176, 0.8)";case 6:return"rgba(46, 125, 50, 0.8)";case 7:return"rgba(27, 94, 32, 0.8)";default:return"rgba(158, 158, 158, 0.8)"}},vt=x.useCallback(e=>{Ze(!1),B(e),U(""),q(!1),H(e.processStatus)},[]),wt=()=>{if(!_||!W.trim())return;if(!a())return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"אין לך הרשאה להוסיף הודעות",type:"error",durationMs:3e3}}));const e={id:Date.now().toString(),message:W.trim(),timestamp:Tt(it().toISOString()),type:"user",processStatus:_.processStatus,author:(null==o?void 0:o.name)||"משתמש"},t=d(l({},_),{statusUpdates:[..._.statusUpdates||[],e],lastUpdated:Z(it())});h(_.id,t),B(t),U(""),xt("הודעה נוספה בהצלחה","success")},St=()=>{if(!_)return;const e=at(He);if(He.trim()&&!e){const e=ot(He);return void xt(e||"פורמט תאריך לא תקין. השתמש בפורמט DD/MM/YYYY","warning")}const t=d(l({},_),{estimatedCompletion:e||void 0});h(_.id,t),B(t),Ye(!1),xt('תאריך התג"ב עודכן בהצלחה',"success")},jt=()=>{Ye(!1),Ve("")},kt=()=>{if(!_)return;const e=at(Ke);if(Ke.trim()&&!e){const e=ot(Ke);return void xt(e||"פורמט תאריך לא תקין. השתמש בפורמט DD/MM/YYYY","warning")}const t=d(l({},_),{processStartDate:e||void 0});h(_.id,t),B(t),Xe(!1),xt("תאריך התחלה עודכן בהצלחה","success")},Ct=()=>{Xe(!1),Ge("")},Et=x.useCallback(()=>{_&&(tt({description:_.description,provider:_.provider,arena:[..._.arena],priority:_.priority,sagachType:_.sagachType||"",processStatus:_.processStatus,processStartDate:_.processStartDate?st(_.processStartDate):"",attachments:_.attachments||[]}),Ze(!0))},[_]),Tt=e=>{if(!e)return"לא צוין";try{const t=new Date(e);if(isNaN(t.getTime()))return e;const r=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0"),i=t.getSeconds().toString().padStart(2,"0"),a=t.getDate().toString().padStart(2,"0");return`${a}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()} ${r}:${n}:${i}`}catch(t){return e}};return u.jsxs(u.Fragment,{children:[u.jsx("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:1e3,background:"rgba(0,0,0,0.8)",borderRadius:"12px",padding:Ue?"16px":"8px",border:"1px solid rgba(255,255,255,0.2)",backdropFilter:"blur(8px)",transition:"all 0.3s ease",cursor:"pointer"},onClick:()=>Pe(!Ue),title:"לחץ לפתיחת פאנל בדיקת תאריכים",children:Ue&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",minWidth:"200px"},onClick:e=>e.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",color:"var(--text)",fontSize:"11px",fontWeight:"600"},children:[u.jsx("span",{children:"בדיקת תאריכים"}),u.jsx("button",{onClick:()=>Pe(!1),style:{background:"none",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:"14px",padding:"0",width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"},title:"סגור פאנל",children:"×"})]}),u.jsx("input",{type:"date",value:(null==We?void 0:We.toISOString().split("T")[0])||"",onChange:e=>{e.target.value?Oe(new Date(e.target.value+"T12:00:00")):Oe(null)},onClick:e=>e.stopPropagation(),style:{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"6px",padding:"6px 8px",color:"var(--text)",fontSize:"12px",fontFamily:"Segoe UI, sans-serif"}}),u.jsx("div",{style:{fontSize:"10px",color:"var(--muted)",textAlign:"center"},children:We?`תאריך מדומה: ${Z(We)}`:`תאריך אמיתי: ${Z(new Date)}`}),u.jsx("button",{onClick:e=>{e.stopPropagation(),Oe(null)},disabled:!We,style:{background:We?"linear-gradient(135deg, rgba(244,67,54,0.8), rgba(244,67,54,0.6))":"rgba(255,255,255,0.1)",border:"none",borderRadius:"6px",padding:"4px 8px",color:We?"white":"var(--muted)",fontSize:"10px",fontWeight:"600",cursor:We?"pointer":"not-allowed"},children:"איפוס לתאריך אמיתי"}),u.jsx("button",{onClick:e=>{e.stopPropagation(),f(),window.location.reload()},style:{background:"linear-gradient(135deg, rgba(255,152,0,0.8), rgba(255,152,0,0.6))",border:"none",borderRadius:"6px",padding:"4px 8px",color:"white",fontSize:"10px",fontWeight:"600",cursor:"pointer"},children:"איפוס נתונים"})]})}),u.jsx("style",{children:"\n          @keyframes pulse-glow {\n            0%, 100% {\n              box-shadow: 0 0 12px rgba(124,192,255,0.6), 0 0 20px rgba(167,90,255,0.4);\n              transform: scale(1);\n            }\n            50% {\n              box-shadow: 0 0 20px rgba(124,192,255,0.8), 0 0 32px rgba(167,90,255,0.6), 0 0 44px rgba(124,192,255,0.4);\n              transform: scale(1.05);\n            }\n          }\n          \n          /* Custom scrollbar styling for left-side positioning */\n          .sagachim-grid-scroll::-webkit-scrollbar {\n            width: 8px;\n          }\n\n          .sagachim-grid-scroll::-webkit-scrollbar-track {\n            background: #2d3748;\n            border-radius: 4px;\n          }\n\n          .sagachim-grid-scroll::-webkit-scrollbar-thumb {\n            background: #7cc0ff;\n            border-radius: 4px;\n            transition: background 0.3s ease;\n          }\n\n          .sagachim-grid-scroll::-webkit-scrollbar-thumb:hover {\n            background: #5da3e6;\n          }\n\n          /* For Firefox */\n          .sagachim-grid-scroll {\n            scrollbar-width: thin;\n            scrollbar-color: #7cc0ff #2d3748;\n          }\n        "}),u.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"radial-gradient(1200px 800px at 80% 20%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 10% 90%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",zIndex:-1}}),u.jsx("div",{className:"sagachim-status",style:{minHeight:"calc(100vh - 80px)",color:"var(--text)",fontFamily:'"Segoe UI", system-ui, sans-serif',width:"100vw",boxSizing:"border-box",padding:"20px",position:"fixed",top:"80px",left:0,display:"flex",justifyContent:"center",alignItems:"flex-start",zIndex:1},children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",maxWidth:"1400px",margin:"0 auto",width:"100%"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"40px",marginTop:"20px",marginLeft:"140px",width:"100%"},children:[u.jsxs("div",{style:{textAlign:"center",flex:1},children:[u.jsx("h1",{style:{fontSize:"42px",fontWeight:"700",color:"var(--accent)",margin:"0 0 16px 0",letterSpacing:"0.5px",direction:"rtl"},children:'סטטוס סג"חים'}),u.jsx("p",{style:{fontSize:"20px",color:"var(--muted)",margin:0,direction:"rtl"},children:'עקוב אחרי מצב הסג"חים בתהליך הכניסה לענק הירוק'})]}),n()&&u.jsx("button",{onClick:()=>Le(!0),style:d(l({},k.primary),{background:"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",color:"white",marginLeft:"20px"}),onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 6px 20px rgba(76,175,80,0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="none"},children:'+ צור סג"ח חדש'})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",marginBottom:"32px",alignItems:"center",width:"100%"},children:[u.jsxs("div",{style:{display:"flex",gap:"16px",justifyContent:"center",flexWrap:"wrap",alignItems:"center",width:"100%"},children:[u.jsxs("div",{style:{position:"relative",minWidth:"280px",maxWidth:"400px",flex:"1 1 300px"},children:[u.jsx("input",{type:"text",placeholder:"חיפוש לפי שם או תיאור...",value:C,onChange:e=>E(e.target.value),style:{width:"100%",padding:"12px 16px 12px 40px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 20px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}}),u.jsx("div",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--muted)",fontSize:"16px"},children:"🔍"})]}),u.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsxs("button",{onClick:()=>K(!J),style:k.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[u.jsx("span",{children:T||"כל הספקים"}),u.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),J&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[u.jsx("div",{onClick:()=>{D(""),K(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הספקים"}),ht.map(e=>u.jsx("div",{onClick:()=>{D(e),K(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),u.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsxs("button",{onClick:()=>Q(!G),style:k.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},onFocus:e=>{const t=e.target;t.style.boxShadow="none",t.style.outline="none"},onBlur:e=>{e.target.style.boxShadow="none"},children:[u.jsx("span",{children:N||"כל הזירות"}),u.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),G&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[u.jsx("div",{onClick:()=>{I(""),Q(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הזירות"}),mt.map(e=>u.jsx("div",{onClick:()=>{I(e),Q(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),u.jsxs("div",{style:{position:"relative",minWidth:"180px",maxWidth:"240px",flex:"0 1 200px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsxs("button",{onClick:()=>se(!oe),style:k.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[u.jsx("span",{children:M?7===parseInt(M)?"מובצע":ie[parseInt(M)-1]:"כל שלבי התהליך"}),u.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),oe&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[u.jsx("div",{onClick:()=>{L(""),se(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל שלבי התהליך"}),ae.map((e,t)=>u.jsx("div",{onClick:()=>{L((t+1).toString()),se(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:t+1===7?"מובצע":e},t+1))]})]}),u.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsxs("button",{onClick:()=>de(!le),style:k.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[u.jsx("span",{children:A||'כל סוגי הסג"ח'}),u.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),le&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[u.jsx("div",{onClick:()=>{R(""),de(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:'כל סוגי הסג"ח'}),ft.map(e=>u.jsx("div",{onClick:()=>{R(e||""),de(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),u.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsxs("button",{onClick:()=>ge(!ue),style:k.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},onFocus:e=>{const t=e.target;t.style.boxShadow="none",t.style.outline="none"},onBlur:e=>{e.target.style.boxShadow="none"},children:[u.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[u.jsx("span",{children:"☰"}),u.jsx("span",{children:"asc"===$?"מההתחלה לסוף":"desc"===$?"מהסוף להתחלה":"סדר לפי"})]}),u.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),ue&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[u.jsxs("div",{onClick:()=>{F("none"),ge(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"none"===$?"var(--accent)":"#ffffff",textAlign:"center",direction:"rtl",background:"none"===$?"rgba(124,192,255,0.1)":"transparent",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseEnter:e=>{"none"!==$&&(e.target.style.background="rgba(255,255,255,0.08)")},onMouseLeave:e=>{e.target.style.background="none"!==$?"transparent":"rgba(124,192,255,0.1)"},children:["none"===$&&u.jsx("span",{style:{fontSize:"12px"},children:"✓"}),u.jsx("span",{children:"ללא מיון"})]}),u.jsxs("div",{onClick:()=>{F("asc"),ge(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"asc"===$?"var(--accent)":"#ffffff",textAlign:"center",direction:"rtl",background:"asc"===$?"rgba(124,192,255,0.1)":"transparent",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseEnter:e=>{"asc"!==$&&(e.target.style.background="rgba(255,255,255,0.08)")},onMouseLeave:e=>{e.target.style.background="asc"!==$?"transparent":"rgba(124,192,255,0.1)"},children:[u.jsx("span",{style:{fontSize:"12px",opacity:.7}}),"asc"===$&&u.jsx("span",{style:{fontSize:"12px"},children:"✓"}),u.jsx("span",{children:" מההתחלה לסוף"})]}),u.jsxs("div",{onClick:()=>{F("desc"),ge(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"desc"===$?"var(--accent)":"#ffffff",textAlign:"center",direction:"rtl",background:"desc"===$?"rgba(124,192,255,0.1)":"transparent",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseEnter:e=>{"desc"!==$&&(e.target.style.background="rgba(255,255,255,0.08)")},onMouseLeave:e=>{e.target.style.background="desc"!==$?"transparent":"rgba(124,192,255,0.1)"},children:[u.jsx("span",{style:{fontSize:"12px",opacity:.7}}),"desc"===$&&u.jsx("span",{style:{fontSize:"12px"},children:"✓"}),u.jsx("span",{children:"מהסוף להתחלה"})]})]})]})]}),(T||N||M||A||C)&&u.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",justifyContent:"center",alignItems:"center",marginBottom:"16px"},children:[C&&u.jsxs("div",{style:{display:"flex",alignItems:"center",background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"20px",padding:"6px 12px",gap:"8px",direction:"rtl"},children:[u.jsxs("span",{style:{color:"var(--text)",fontSize:"12px",fontWeight:"500"},children:['חיפוש: "',C,'"']}),u.jsx("button",{onClick:()=>{E("")},style:k.close,onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.2)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]}),T&&u.jsxs("div",{style:{display:"flex",alignItems:"center",background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"20px",padding:"6px 12px",gap:"8px",direction:"rtl"},children:[u.jsxs("span",{style:{color:"var(--text)",fontSize:"12px",fontWeight:"500"},children:["ספק: ",T]}),u.jsx("button",{onClick:()=>{D("")},style:k.close,onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.2)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]}),N&&u.jsxs("div",{style:{display:"flex",alignItems:"center",background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"20px",padding:"6px 12px",gap:"8px",direction:"rtl"},children:[u.jsxs("span",{style:{color:"var(--text)",fontSize:"12px",fontWeight:"500"},children:["זירה: ",N]}),u.jsx("button",{onClick:()=>{I("")},style:k.close,onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.2)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]}),M&&u.jsxs("div",{style:{display:"flex",alignItems:"center",background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"20px",padding:"6px 12px",gap:"8px",direction:"rtl"},children:[u.jsxs("span",{style:{color:"var(--text)",fontSize:"12px",fontWeight:"500"},children:["שלב: ",7===parseInt(M)?"מובצע":ie[parseInt(M)-1]]}),u.jsx("button",{onClick:()=>{L("")},style:k.close,onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.2)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]}),A&&u.jsxs("div",{style:{display:"flex",alignItems:"center",background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"20px",padding:"6px 12px",gap:"8px",direction:"rtl"},children:[u.jsxs("span",{style:{color:"var(--text)",fontSize:"12px",fontWeight:"500"},children:["סוג: ",A]}),u.jsx("button",{onClick:()=>R(""),style:k.close,onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.2)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]})]}),u.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"24px",width:"100%",maxWidth:"1200px"},children:u.jsx("span",{style:{color:"var(--muted)",fontSize:"14px",direction:"rtl"}})}),u.jsx("div",{className:"sagachim-grid-scroll",style:{display:"flex",flexDirection:"column",gap:"32px",width:"100%",padding:"0 20px 0 20px",maxHeight:"calc(100vh - 400px)",overflowY:"auto",overflowX:"hidden",direction:"rtl"},children:T||N||M||A||C||"none"!==$?("desc"===$?[7,6,5,4,3,2,1]:[1,2,3,4,5,6,7]).map(e=>{const t=yt.filter(t=>t.processStatus===e);return t.forEach(e=>{}),0===t.length?null:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px",padding:"0 8px"},children:[u.jsxs("div",{style:{background:bt(e),color:"white",padding:"8px 16px",borderRadius:"20px",fontSize:"14px",fontWeight:"600",letterSpacing:"0.5px",display:"flex",alignItems:"center",gap:"6px"},children:[7===e&&"✅",7===e?"מובצע":ie[e-1]]}),u.jsx("span",{style:{color:"var(--muted)",fontSize:"12px",fontWeight:"500"}})]}),u.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"24px",justifyItems:"center"},children:t.map(e=>{const t=ct(e),r=7===e.processStatus;return e.name,u.jsxs("div",{onClick:()=>vt(e),style:{background:r?"linear-gradient(180deg, rgba(76,175,80,0.15), rgba(46,125,50,0.10))":t?"linear-gradient(180deg, rgba(255,165,0,0.25), rgba(255,140,0,0.20))":"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:r?"1px solid rgba(76,175,80,0.3)":t?"2px solid rgba(255,165,0,0.6)":"1px solid rgba(255,255,255,0.12)",borderRadius:"16px",padding:"24px",boxShadow:r?"0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)":t?"0 8px 32px rgba(255,165,0,0.4), inset 0 1px 0 rgba(255,165,0,0.2)":"0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)",backdropFilter:"blur(8px)",transition:"all 0.3s ease",cursor:"pointer",position:"relative",overflow:"hidden",width:"100%",maxWidth:"320px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-4px)",e.currentTarget.style.boxShadow=r?"0 0 25px rgba(76,175,80,0.5), 0 0 50px rgba(76,175,80,0.3), inset 0 1px 0 rgba(76,175,80,0.15)":t?"0 12px 40px rgba(255,165,0,0.5), inset 0 1px 0 rgba(255,165,0,0.25)":"0 12px 40px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.15)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow=r?"0 0 20px rgba(76,175,80,0.4), 0 0 40px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)":t?"0 8px 32px rgba(255,165,0,0.2), inset 0 1px 0 rgba(255,165,0,0.1)":"0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)"},children:[u.jsxs("div",{style:{position:"absolute",top:"16px",left:"16px",background:bt(e.processStatus),color:"white",padding:"6px 12px",borderRadius:"20px",fontSize:"11px",fontWeight:"600",letterSpacing:"0.5px",direction:"rtl",textAlign:"center",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"4px"},children:[7===e.processStatus&&"✅",7===e.processStatus?"מובצע":ie[e.processStatus-1]]}),t&&u.jsx("div",{style:{position:"absolute",top:"16px",right:"16px",background:"linear-gradient(135deg, rgba(255, 193, 7, 0.9), rgba(255, 152, 0, 0.8))",color:"#1f1f1f",padding:"6px 12px",borderRadius:"999px",fontSize:"11px",fontWeight:"700",letterSpacing:"0.5px",display:"flex",alignItems:"center",gap:"6px",boxShadow:"0 6px 18px rgba(255, 193, 7, 0.35)",direction:"rtl"},children:'⚠️ לא עומד בתג"ב'}),u.jsxs("div",{style:{marginTop:"40px",direction:"rtl"},children:[u.jsx("h3",{style:{fontSize:"24px",fontWeight:"700",color:"var(--text)",margin:"0 0 12px 0",lineHeight:"1.3"},children:e.name}),u.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0 0 16px 0",lineHeight:"1.5",minHeight:"42px",whiteSpace:"pre-wrap",direction:"rtl",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e.description}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"16px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"ספק:"}),u.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.provider})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"זירה:"}),u.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:S(e).join(", ")})]})]})]}),u.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:r?"linear-gradient(135deg, rgba(76,175,80,0.15), rgba(46,125,50,0.1))":t?"linear-gradient(135deg, rgba(255,165,0,0.15), rgba(255,140,0,0.1))":"linear-gradient(135deg, rgba(124,192,255,0.1), rgba(167,90,255,0.1))",opacity:0,transition:"opacity 0.3s ease",pointerEvents:"none"}})]},e.id)})}),u.jsx("div",{style:{width:"100%",height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent)",margin:"24px 0 8px 0"}})]},e)}):u.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"24px",justifyItems:"center",width:"100%"},children:yt.map(e=>{const t=ct(e),r=7===e.processStatus;return u.jsxs("div",{onClick:()=>vt(e),style:{background:r?"linear-gradient(180deg, rgba(76,175,80,0.15), rgba(46,125,50,0.10))":t?"linear-gradient(180deg, rgba(255,165,0,0.25), rgba(255,140,0,0.20))":"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:r?"1px solid rgba(76,175,80,0.3)":t?"2px solid rgba(255,165,0,0.6)":"1px solid rgba(255,255,255,0.12)",borderRadius:"16px",padding:"24px",boxShadow:r?"0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)":t?"0 8px 32px rgba(255,165,0,0.4), inset 0 1px 0 rgba(255,165,0,0.2)":"0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)",backdropFilter:"blur(8px)",transition:"all 0.3s ease",cursor:"pointer",position:"relative",overflow:"hidden",width:"100%",maxWidth:"320px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-4px)",e.currentTarget.style.boxShadow=r?"0 12px 40px rgba(76,175,80,0.3), inset 0 1px 0 rgba(76,175,80,0.15)":t?"0 12px 40px rgba(255,165,0,0.5), inset 0 1px 0 rgba(255,165,0,0.25)":"0 12px 40px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.15)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow=r?"0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)":t?"0 8px 32px rgba(255,165,0,0.4), inset 0 1px 0 rgba(255,165,0,0.2)":"0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)"},children:[u.jsxs("div",{style:{position:"absolute",top:"16px",left:"16px",background:bt(e.processStatus),color:"white",padding:"6px 12px",borderRadius:"20px",fontSize:"11px",fontWeight:"600",letterSpacing:"0.5px",direction:"rtl",textAlign:"center",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"4px"},children:[7===e.processStatus&&"✅",7===e.processStatus?"מובצע":ie[e.processStatus-1]]}),"TOP"===e.priority&&u.jsx("div",{style:{position:"absolute",top:"16px",right:"16px",background:"linear-gradient(135deg, rgba(146, 23, 23, 0.9), rgba(236, 35, 35, 0.7))",color:"#FFFFFF",padding:"6px 12px",borderRadius:"999px",fontSize:"11px",fontWeight:"700",letterSpacing:"0.5px",display:"flex",alignItems:"center",gap:"6px",boxShadow:"0 6px 18px rgba(255, 0, 0, 0.35)"},children:"🔥 TOP"}),t&&u.jsx("div",{style:{position:"absolute",top:"50px",left:"16px",background:"linear-gradient(135deg, rgba(255, 193, 7, 0.9), rgba(255, 152, 0, 0.8))",color:"#1f1f1f",padding:"6px 12px",borderRadius:"999px",fontSize:"11px",fontWeight:"700",letterSpacing:"0.5px",display:"flex",alignItems:"center",gap:"6px",boxShadow:"0 6px 18px rgba(255, 193, 7, 0.35)",direction:"rtl"},children:'⚠️ לא עומד בתג"ב'}),u.jsxs("div",{style:{marginTop:"40px",direction:"rtl"},children:[u.jsx("h3",{style:{fontSize:"24px",fontWeight:"700",color:"var(--text)",margin:"0 0 12px 0",lineHeight:"1.3"},children:e.name}),u.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0 0 16px 0",lineHeight:"1.5",minHeight:"42px",whiteSpace:"pre-wrap",direction:"rtl",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e.description}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"16px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"ספק:"}),u.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.provider})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"זירה:"}),u.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:S(e).join(", ")})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"תעדוף:"}),u.jsx("span",{style:{fontSize:"12px"},children:re[e.priority]})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"עודכן לאחרונה:"}),u.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:(()=>{const t=new Date(e.lastUpdated);return isNaN(t.getTime())?e.lastUpdated:`${t.getDate().toString().padStart(2,"0")}.${(t.getMonth()+1).toString().padStart(2,"0")}.${t.getFullYear()}`})()})]})]})]}),u.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:7===e.processStatus?"linear-gradient(135deg, rgba(76,175,80,0.15), rgba(46,125,50,0.1))":"linear-gradient(135deg, rgba(124,192,255,0.1), rgba(167,90,255,0.1))",opacity:0,transition:"opacity 0.3s ease",pointerEvents:"none"}})]},e.id)})})}),0===yt.length&&u.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%"},children:[u.jsx("div",{style:{fontSize:"48px",marginBottom:"16px",opacity:.5},children:"📋"}),u.jsx("h3",{style:{fontSize:"20px",color:"var(--muted)",margin:"0 0 8px 0",direction:"rtl"},children:'לא נמצאו סג"חים'}),u.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:0,direction:"rtl"},children:"נסה לשנות את החיפוש או הסינון"})]})]})]})}),_&&u.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)",zIndex:1e3},onClick:()=>{Ze(!1),B(null)},children:u.jsxs("div",{style:{background:"radial-gradient(1200px 800px at 50% 50%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 50% 50%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",border:"none",borderRadius:"0px",padding:"40px",width:"100vw",height:"100vh",overflow:"auto",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.1)",backdropFilter:"blur(12px)",direction:"rtl",position:"fixed",top:0,left:0,boxSizing:"border-box"},onClick:e=>e.stopPropagation(),children:[u.jsx("div",{style:{marginBottom:"32px",borderBottom:"1px solid rgba(255,255,255,0.2)",paddingBottom:"16px"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},children:[u.jsx("div",{style:{width:"200px",display:"flex",justifyContent:"flex-start"},children:i()&&u.jsx("button",{onClick:e=>{e.stopPropagation(),((e,t)=>{if(t.stopPropagation(),!i())return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:'אין לך הרשאה למחוק סג"חים',type:"error",durationMs:3e3}}));const r=c.find(t=>t.id===e);r&&window.confirm(`האם אתה בטוח שברצונך למחוק את הסג"ח "${r.name}"?\nפעולה זו לא ניתנת לביטול.`)&&(m(e),(null==_?void 0:_.id)===e&&(Ze(!1),B(null)),xt(`הסג"ח "${r.name}" נמחק בהצלחה`,"success"))})(_.id,e)},style:d(l({},k.primary),{background:"rgba(137, 37, 30, 0.9)",color:"white",fontSize:"16px"}),onMouseEnter:e=>{e.currentTarget.style.background="rgba(244, 67, 54, 1)",e.currentTarget.style.transform="scale(1.05)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(244, 67, 54, 0.9)",e.currentTarget.style.transform="scale(1)"},title:'מחק סג"ח',children:"🗑️"})}),u.jsx("h2",{style:{color:"var(--accent)",fontSize:"40px",fontWeight:"700",margin:"0",textAlign:"center",flex:1},children:_.name}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",width:"200px",justifyContent:"flex-end"},children:[u.jsxs("button",{onClick:()=>p(e,null,function*(){const e=(null==o?void 0:o.id)||"current_user";v(_,e)?(Ne(!0),yield new Promise(e=>setTimeout(e,500)),(()=>{if(!_||!o)return;const e=o.id||"current_user",t=o.name||"משתמש",r=v(_,e);let n;n=r?j(_,e):w(_,e,t,"email","status_change"),h(_.id,n),B(n),xt(r?"התראות בוטלו בהצלחה":"התראות הופעלו בהצלחה","success")})(),Ne(!1)):je(!0)}),disabled:De,style:d(l({},k.primary),{background:v(_,(null==o?void 0:o.id)||"current_user")?"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))":"rgba(255,255,255,0.1)",border:"1px solid "+(v(_,(null==o?void 0:o.id)||"current_user")?"rgba(76,175,80,0.8)":"rgba(255,255,255,0.2)"),borderRadius:"25px",color:v(_,(null==o?void 0:o.id)||"current_user")?"white":"var(--text)",fontSize:"16px",cursor:De?"not-allowed":"pointer",opacity:De?.7:1}),onMouseEnter:e=>{_.notifications||De||(e.currentTarget.style.background="rgba(124,192,255,0.2)",e.currentTarget.style.borderColor="rgba(124,192,255,0.5)")},onMouseLeave:e=>{_.notifications||De||(e.currentTarget.style.background="rgba(255,255,255,0.1)",e.currentTarget.style.borderColor="rgba(255,255,255,0.2)")},children:[De?u.jsx("div",{style:{width:"18px",height:"18px",border:"2px solid transparent",borderTop:"2px solid currentColor",borderRadius:"50%",animation:"spin 1s linear infinite"}}):v(_,(null==o?void 0:o.id)||"current_user")?"🔔":"🔕",De?"מעדכן...":v(_,(null==o?void 0:o.id)||"current_user")?"מקבל התראות":"הירשם לעדכונים"]}),u.jsx("button",{onClick:()=>{Ze(!1),B(null)},style:d(l({},k.close),{fontSize:"28px",padding:"12px",borderRadius:"12px",width:"auto",height:"auto"}),onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"←"})]})]})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(300px, 35%) minmax(400px, 65%)",gap:"24px",height:"calc(100vh - 120px)",minHeight:"600px",alignItems:"stretch",overflow:"hidden",maxWidth:"100%",boxSizing:"border-box"},children:[u.jsxs("div",{style:{background:"rgba(124,192,255,0.08)",border:"2px solid rgba(124,192,255,0.2)",borderRadius:"20px",padding:"24px",display:"flex",flexDirection:"column",height:"100%",overflowY:"auto"},children:[u.jsx("h4",{style:{color:"white",fontSize:"24px",fontWeight:"600",margin:"0 0 12px 0",textAlign:"center",paddingBottom:"8px",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:'פרטי הסג"ח'}),s("admin")&&u.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"12px",marginBottom:"20px"},children:Qe?u.jsxs(u.Fragment,{children:[u.jsx("button",{onClick:()=>p(e,null,function*(){if(_)try{if(et.processStatus!==_.processStatus){if(!r())return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"אין לך הרשאה לערוך סטטוסים",type:"error",durationMs:3e3}}));yield(t=et.processStatus,p(e,null,function*(){var e,r,n,i,a,s;if(_&&t!==_.processStatus)try{let c=0;if(null==(n=null==(r=null==(e=_.phaseData)?void 0:e[_.processStatus])?void 0:r.currentEntry)?void 0:n.startDate){const e=_.phaseData[_.processStatus];c=ut(e,!0)}const p={id:Date.now().toString(),message:`שונה סטטוס מ-"${7===_.processStatus?"מובצע":ie[_.processStatus-1]}" ל-"${7===t?"מובצע":ie[t-1]}"${c>0?` •בשלב הקודם ${c} ימים`:""}`,timestamp:Tt(it().toISOString()),type:"status_change",oldStatus:_.processStatus,newStatus:t,processStatus:_.processStatus,author:(null==o?void 0:o.name)||"משתמש"},u=it(),g=l({},_.phaseData||{});if(null==(s=null==(a=null==(i=_.phaseData)?void 0:i[_.processStatus])?void 0:a.currentEntry)?void 0:s.startDate){const e=g[_.processStatus]||{},t=new Date(e.currentEntry.startDate+"T00:00:00"),r=new Date(u.toISOString().split("T")[0]+"T23:59:59"),n=Math.abs(r.getTime()-t.getTime()),i=Math.ceil(n/864e5),a={startDate:e.currentEntry.startDate,completionDate:u.toISOString().split("T")[0],timeSpentDays:i};g[_.processStatus]={entries:[...e.entries||[],a],currentEntry:void 0,totalTimeSpentDays:i}}if(t<7){const e=g[t]||{};if(e.currentEntry){const r={startDate:e.currentEntry.startDate,completionDate:u.toISOString().split("T")[0],timeSpentDays:Math.ceil(Math.abs(new Date(u.toISOString().split("T")[0]+"T23:59:59").getTime()-new Date(e.currentEntry.startDate+"T00:00:00").getTime())/864e5)};g[t]=d(l({},e),{entries:[...e.entries||[],r],currentEntry:{startDate:u.toISOString().split("T")[0],timeSpentDays:0},totalTimeSpentDays:Math.max(ut(e,!1)+r.timeSpentDays,e.totalTimeSpentDays||0)})}else{const r={startDate:u.toISOString().split("T")[0],timeSpentDays:0};g[t]=d(l({},e),{currentEntry:r,totalTimeSpentDays:Math.max(ut(e,!1),e.totalTimeSpentDays||0)})}}const x=d(l({},_),{description:et.description.trim(),provider:et.provider.trim(),arena:et.arena,priority:et.priority,sagachType:et.sagachType.trim()||void 0,attachments:et.attachments,processStatus:t,statusUpdates:[..._.statusUpdates||[],p],lastUpdated:Z(u),phaseData:g,completionDate:7===t?u.toISOString():_.completionDate});h(_.id,x),B(x),Ze(!1),xt(`פרטים נשמרו וסטטוס עודכן ל-"${7===t?"מובצע":ie[t-1]}"`,"success")}catch(c){xt("שגיאה בעדכון השלב בתהליך","warning")}}))}else{const e=et.processStartDate.trim()?at(et.processStartDate.trim()):null;if(et.processStartDate.trim()&&!e){const e=ot(et.processStartDate.trim());return void xt(e||"פורמט תאריך התחלה לא תקין. השתמש בפורמט DD/MM/YYYY","warning")}const t=d(l({},_),{description:et.description.trim(),provider:et.provider.trim(),arena:et.arena,priority:et.priority,sagachType:et.sagachType.trim()||void 0,processStartDate:e||void 0,attachments:et.attachments,lastUpdated:Z(it())}),r={description:et.description.trim(),provider:et.provider.trim(),arena:et.arena,priority:et.priority,processStartDate:e||void 0,attachments:et.attachments,lastUpdated:Z(it())};et.sagachType.trim()?r.sagachType=et.sagachType.trim():r.sagachType=void 0,h(_.id,r),B(t),Ze(!1),xt('פרטי הסג"ח עודכנו בהצלחה',"success")}}catch(n){xt('שגיאה בעדכון פרטי הסג"ח',"warning")}var t}),style:{background:"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",border:"none",borderRadius:"12px",color:"white",padding:"10px 20px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 6px 20px rgba(76,175,80,0.3)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:"✅ שמור"}),u.jsx("button",{onClick:()=>{Ze(!1),tt({description:"",provider:"",arena:[],priority:"בינוני",sagachType:"",processStatus:1,processStartDate:"",attachments:[]})},style:{background:"linear-gradient(135deg, rgba(244,67,54,0.8), rgba(244,67,54,0.6))",border:"none",borderRadius:"12px",color:"white",padding:"10px 20px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 6px 20px rgba(244,67,54,0.3)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:"❌ בטל"})]}):u.jsx("button",{onClick:Et,style:{background:"linear-gradient(135deg, rgba(255,193,7,0.8), rgba(255,193,7,0.6))",border:"none",borderRadius:"12px",color:"white",padding:"10px 20px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 6px 20px rgba(255,193,7,0.3)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:"✏️ ערוך פרטים"})}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px",marginBottom:"16px"},children:[u.jsxs("div",{children:[u.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"תיאור"}),Qe?u.jsx("textarea",{value:et.description,onChange:e=>tt(t=>d(l({},t),{description:e.target.value})),style:{width:"100%",minHeight:"80px",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"16px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",resize:"vertical",lineHeight:"1.6",boxSizing:"border-box"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}}):u.jsx("p",{style:{color:"var(--text)",fontSize:"16px",margin:0,lineHeight:"1.6",whiteSpace:"pre-wrap",direction:"rtl"},children:_.description})]}),u.jsxs("div",{children:[u.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"ספק"}),Qe?u.jsx("input",{type:"text",value:et.provider,onChange:e=>tt(t=>d(l({},t),{provider:e.target.value})),style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"18px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",boxSizing:"border-box"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}}):u.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8"},children:_.provider})]}),u.jsxs("div",{children:[u.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"זירה"}),Qe?u.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsxs("button",{type:"button",onClick:()=>fe(e=>!e),style:{appearance:"none",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.08)",borderRadius:"12px",color:"#ffffff",padding:"12px 16px",cursor:"pointer",fontSize:"16px",direction:"rtl",outline:"none",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",fontFamily:"Segoe UI, sans-serif"},children:[u.jsx("span",{style:{textAlign:"right",flex:1},children:0===et.arena.length?"בחר זירות...":et.arena.join(", ")}),u.jsx("span",{style:{marginLeft:"8px",fontSize:"12px"},children:"▼"})]}),me&&u.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",zIndex:1e3,boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",overflow:"hidden",maxHeight:"200px",overflowY:"auto"},children:O.map(e=>u.jsxs("div",{onClick:t=>{t.stopPropagation();const r=et.arena.includes(e);tt(t=>d(l({},t),{arena:r?t.arena.filter(t=>t!==e):[...t.arena,e]}))},style:{padding:"10px 16px",cursor:"pointer",transition:"background 0.2s ease",direction:"rtl",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"space-between",background:et.arena.includes(e)?"rgba(124,192,255,0.15)":"transparent",color:"var(--text)"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(124,192,255,0.15)"},onMouseLeave:t=>{et.arena.includes(e)||(t.currentTarget.style.background="transparent")},children:[u.jsx("span",{children:e}),et.arena.includes(e)&&u.jsx("span",{style:{color:"var(--accent)",fontSize:"12px"},children:"✓"})]},`edit-arena-${e}`))})]}):u.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8"},children:_.arena.join(", ")})]}),u.jsxs("div",{children:[u.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"תעדוף"}),Qe?u.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsxs("button",{type:"button",onClick:()=>he(e=>!e),style:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.06)",borderRadius:"12px",color:"#ffffff",padding:"10px 16px",cursor:"pointer",fontSize:"16px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[u.jsx("span",{children:re[et.priority]}),u.jsx("span",{style:{marginLeft:"8px",fontSize:"12px"},children:"▼"})]}),xe&&u.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",zIndex:1e3,boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",overflow:"hidden"},children:te.map(e=>u.jsxs("div",{onClick:()=>{he(!1),tt(t=>d(l({},t),{priority:e}))},style:{padding:"10px 16px",cursor:"pointer",transition:"background 0.2s ease",direction:"rtl",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"space-between",background:et.priority===e?"rgba(124,192,255,0.15)":"transparent",fontWeight:"TOP"===e?700:500},onMouseEnter:e=>{e.currentTarget.style.background="rgba(124,192,255,0.15)"},onMouseLeave:t=>{et.priority!==e&&(t.currentTarget.style.background="transparent")},children:[u.jsx("span",{children:"TOP"===e?"TOP":e}),e===et.priority&&u.jsx("span",{children:"✓"})]},`edit-priority-${e}`))})]}):u.jsx("p",{style:{fontSize:"18px",margin:0,lineHeight:"1.8"},children:re[_.priority]})]}),(Qe||_.sagachType)&&u.jsxs("div",{children:[u.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:'סוג הסג"ח'}),Qe?u.jsx("input",{type:"text",value:et.sagachType,onChange:e=>tt(t=>d(l({},t),{sagachType:e.target.value})),placeholder:"הכנס סוג הסג'ח (אופציונלי)...",style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"18px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",boxSizing:"border-box"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}}):u.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8"},children:_.sagachType})]}),u.jsxs("div",{children:[u.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"שלב בתהליך"}),Qe?u.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsxs("button",{type:"button",onClick:()=>se(e=>!e),style:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.06)",borderRadius:"12px",color:"#ffffff",padding:"10px 16px",cursor:"pointer",fontSize:"16px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[u.jsx("span",{children:ae[et.processStatus-1]}),u.jsx("span",{style:{marginLeft:"8px",fontSize:"12px"},children:"▼"})]}),oe&&u.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",zIndex:1e3,boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",overflow:"hidden"},children:ae.map((e,t)=>u.jsx("div",{onClick:()=>{tt(e=>d(l({},e),{processStatus:t+1})),se(!1)},style:{padding:"12px 16px",cursor:"pointer",borderBottom:t<ae.length-1?"1px solid rgba(255,255,255,0.08)":"none",transition:"background 0.2s ease",fontSize:"14px",direction:"rtl",color:et.processStatus===t+1?"rgba(124,192,255,1)":"#ffffff"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},t+1))})]}):u.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8"},children:ae[_.processStatus-1]})]}),u.jsxs("div",{children:[u.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"סטטוס נוכחי"}),u.jsx("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"20px",fontSize:"18px",color:"var(--text)",lineHeight:"1.8",direction:"rtl"},children:(()=>{if(!(null==_?void 0:_.statusUpdates)||0===_.statusUpdates.length)return u.jsx("span",{style:{fontStyle:"italic",color:"var(--muted)"},children:"אין עדכוני סטטוס"});const e=[..._.statusUpdates].sort((e,t)=>{const r=e=>{if(e.includes("/")){const[t,r]=e.split(" "),[n,i,a]=t.split("/");return new Date(`${a}-${i}-${n} ${r}`)}return new Date(e)},n=r(e.timestamp),i=r(t.timestamp);if(isNaN(n.getTime())&&isNaN(i.getTime()))return parseInt(t.id)-parseInt(e.id);if(isNaN(n.getTime()))return 1;if(isNaN(i.getTime()))return-1;const a=i.getTime()-n.getTime();return 0!==a?a:parseInt(t.id)-parseInt(e.id)})[0];return(null==e?void 0:e.message)?u.jsxs("div",{children:[u.jsxs("div",{style:{fontSize:"16px",color:"var(--muted)",marginBottom:"10px",display:"flex",alignItems:"center",gap:"4px"},children:["status_change"===e.type&&"🔄","system"===e.type&&"⚙️","user"===e.type&&"👤",u.jsx("span",{children:Tt(e.timestamp)})]}),u.jsx("div",{children:e.message})]}):u.jsx("span",{style:{fontStyle:"italic",color:"var(--muted)"},children:"אין עדכוני סטטוס"})})()},(null==(t=_.statusUpdates)?void 0:t.length)||0)]}),u.jsxs("div",{children:[u.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"תאריך התחלה"}),Je?u.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[u.jsx("input",{type:"text",value:Ke,onChange:e=>{let t=e.target.value.replace(/[^\d\/]/g,"");2!==t.length||t.includes("/")?5===t.length&&2===t.split("/").length&&(t+="/"):t+="/",t.length>10&&(t=t.substring(0,10)),Ge(t)},placeholder:"DD/MM/YYYY",maxLength:10,style:{background:"var(--bg-secondary)",border:"2px solid rgba(124,192,255,0.5)",borderRadius:"8px",padding:"8px 12px",color:"var(--text)",fontSize:"16px",fontFamily:"Segoe UI, system-ui, sans-serif",width:"150px",direction:"ltr",textAlign:"center"},onKeyDown:e=>{"Enter"===e.key?kt():"Escape"===e.key&&Ct()},autoFocus:!0}),u.jsx("button",{onClick:kt,style:{background:"rgba(34,197,94,0.8)",border:"none",borderRadius:"6px",padding:"8px 12px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(34,197,94,1)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(34,197,94,0.8)"},children:"✓"}),u.jsx("button",{onClick:Ct,style:{background:"rgba(239,68,68,0.8)",border:"none",borderRadius:"6px",padding:"8px 12px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(239,68,68,1)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(239,68,68,0.8)"},children:"✕"})]}):Qe&&r()?u.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8",cursor:"pointer",padding:"8px",borderRadius:"8px",border:"2px dashed rgba(124,192,255,0.3)",background:"rgba(124,192,255,0.05)",transition:"all 0.2s ease"},onClick:()=>{if(!_)return;if(!r())return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"אין לך הרשאה לערוך תאריך התחלה",type:"error",durationMs:3e3}}));const e=_.processStartDate?st(_.processStartDate):"";Ge(e),Xe(!0)},onMouseEnter:e=>{e.currentTarget.style.border="2px dashed rgba(124,192,255,0.6)",e.currentTarget.style.background="rgba(124,192,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.border="2px dashed rgba(124,192,255,0.3)",e.currentTarget.style.background="rgba(124,192,255,0.05)"},children:_.processStartDate?st(_.processStartDate):"לא צוין - לחץ לעריכה"}):u.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8"},children:_.processStartDate?st(_.processStartDate):"לא צוין"})]}),u.jsxs("div",{children:[u.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:'תג"ב למעבר לשלב הבא'}),qe?u.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[u.jsx("input",{type:"text",value:He,onChange:e=>{let t=e.target.value.replace(/[^\d\/]/g,"");2!==t.length||t.includes("/")?5===t.length&&2===t.split("/").length&&(t+="/"):t+="/",t.length>10&&(t=t.substring(0,10)),Ve(t)},placeholder:"DD/MM/YYYY",maxLength:10,style:{background:"var(--bg-secondary)",border:"2px solid rgba(124,192,255,0.5)",borderRadius:"8px",padding:"8px 12px",color:"var(--text)",fontSize:"16px",fontFamily:"Segoe UI, system-ui, sans-serif",width:"150px",direction:"ltr",textAlign:"center"},onKeyDown:e=>{"Enter"===e.key?St():"Escape"===e.key&&jt()},autoFocus:!0}),u.jsx("button",{onClick:St,style:{background:"rgba(34,197,94,0.8)",border:"none",borderRadius:"6px",padding:"8px 12px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(34,197,94,1)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(34,197,94,0.8)"},children:"✓"}),u.jsx("button",{onClick:jt,style:{background:"rgba(239,68,68,0.8)",border:"none",borderRadius:"6px",padding:"8px 12px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(239,68,68,1)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(239,68,68,0.8)"},children:"✕"})]}):Qe&&r()?u.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8",cursor:"pointer",padding:"8px",borderRadius:"8px",border:"2px dashed rgba(124,192,255,0.3)",background:"rgba(124,192,255,0.05)",transition:"all 0.2s ease"},onClick:()=>{if(!_)return;if(!r())return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:'אין לך הרשאה לערוך תג"ב למעבר לשלב הבא',type:"error",durationMs:3e3}}));const e=_.estimatedCompletion?st(_.estimatedCompletion):"";Ve(e),Ye(!0)},onMouseEnter:e=>{e.currentTarget.style.border="2px dashed rgba(124,192,255,0.6)",e.currentTarget.style.background="rgba(124,192,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.border="2px dashed rgba(124,192,255,0.3)",e.currentTarget.style.background="rgba(124,192,255,0.05)"},children:_.estimatedCompletion?st(_.estimatedCompletion):"לא צוין - לחץ לעריכה"}):u.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8",direction:"rtl"},children:_.estimatedCompletion?st(_.estimatedCompletion):"לא צוין"})]}),s("admin")&&u.jsxs("div",{children:[u.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"קבצים רלוונטים"}),Qe?u.jsxs("div",{style:{border:"2px dashed rgba(124,192,255,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center",background:"rgba(255,255,255,0.02)",marginBottom:"16px"},children:[u.jsx("input",{type:"file",multiple:!0,onChange:e=>{Array.from(e.target.files||[]).forEach(e=>{if(e.size>10485760)return void xt(`הקובץ "${e.name}" גדול מדי (${ee(e.size)}). מקסימום: 10MB`,"warning");const t=new FileReader;t.onload=t=>{var r;const n={id:Date.now().toString()+Math.random().toString(36),name:e.name,size:e.size,type:e.type||"application/octet-stream",uploadDate:(new Date).toISOString(),data:null==(r=t.target)?void 0:r.result};tt(e=>d(l({},e),{attachments:[...e.attachments,n]})),xt(`הקובץ "${e.name}" הועלה בהצלחה`,"success")},t.readAsDataURL(e)}),e.target.value=""},style:{display:"none"},id:"file-upload-input"}),u.jsxs("label",{htmlFor:"file-upload-input",style:{cursor:"pointer",display:"block"},children:[u.jsx("div",{style:{fontSize:"48px",marginBottom:"12px",color:"rgba(124,192,255,0.6)"},children:"📁"}),u.jsx("div",{style:{fontSize:"16px",color:"rgba(124,192,255,0.8)",marginBottom:"8px"},children:"לחץ כאן או גרור קבצים להעלאה"}),u.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",opacity:.7},children:"תומך בכל סוגי הקבצים • מקסימום 10MB לקובץ"})]})]}):null,u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(Qe?et.attachments:_.attachments||[]).map((e,t)=>u.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px",padding:"12px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.08)",e.currentTarget.style.borderColor="rgba(124,192,255,0.3)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(255,255,255,0.05)",e.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flex:1},children:[u.jsx("div",{style:{fontSize:"20px"},children:e.type.startsWith("image/")?"🖼️":e.type.startsWith("video/")?"🎥":e.type.startsWith("audio/")?"🎵":"application/pdf"===e.type?"📄":e.type.includes("word")?"📝":e.type.includes("excel")||e.type.includes("spreadsheet")?"📊":e.type.includes("powerpoint")||e.type.includes("presentation")?"📈":"📎"}),u.jsxs("div",{style:{flex:1},children:[u.jsx("div",{style:{fontSize:"14px",color:"var(--text)",fontWeight:"500",marginBottom:"2px"},children:e.name}),u.jsxs("div",{style:{fontSize:"11px",color:"var(--muted)",opacity:.7},children:[ee(e.size)," • ",Z(new Date(e.uploadDate))]})]})]}),u.jsxs("div",{style:{display:"flex",gap:"8px"},children:[u.jsx("button",{onClick:()=>{const t=document.createElement("a");t.href=e.data||e.url||"",t.download=e.name,t.click()},style:{background:"rgba(76,175,80,0.2)",border:"1px solid rgba(76,175,80,0.3)",borderRadius:"6px",padding:"6px 10px",color:"rgba(76,175,80,1)",fontSize:"16px",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(76,175,80,0.3)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(76,175,80,0.2)"},title:"הורד קובץ",children:"⬇️"}),Qe&&u.jsx("button",{onClick:()=>{tt(t=>d(l({},t),{attachments:t.attachments.filter(t=>t.id!==e.id)}))},style:{background:"rgba(244,67,54,0.2)",border:"1px solid rgba(244,67,54,0.3)",borderRadius:"6px",padding:"6px 10px",color:"rgba(244,67,54,1)",fontSize:"12px",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(244,67,54,0.3)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(244,67,54,0.2)"},title:"מחק קובץ",children:"🗑️"})]})]},e.id)),0===(Qe?et.attachments:_.attachments||[]).length&&u.jsx("div",{style:{textAlign:"center",color:"var(--muted)",fontSize:"14px",padding:"20px",opacity:.6},children:Qe?"לא הועלו קבצים עדיין":"אין קבצים רלוונטים"})]})]})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px",height:"100%",overflow:"hidden",minWidth:0,boxSizing:"border-box"},children:[u.jsxs("div",{style:{background:"rgba(124,192,255,0.08)",border:"2px solid rgba(124,192,255,0.2)",borderRadius:"20px",padding:"20px",height:"300px",flexShrink:0,overflowY:"hidden",maxWidth:"100%",boxSizing:"border-box"},children:[u.jsx("h3",{style:{color:"white",fontSize:"24px",fontWeight:"600",marginBottom:"4px",marginTop:"0px",textAlign:"center",direction:"rtl"},children:'תהליך הכנסת הסג"ח'}),u.jsx("div",{style:{display:"flex",flexDirection:"row",gap:"20px",overflowX:"auto",direction:"rtl",padding:"12px",justifyContent:"center",marginTop:"0px"},children:ie.map((e,t)=>{var r,n;const i=t+1,a=7!==_.processStatus&&_.processStatus===i,o=7===_.processStatus?i<=6:_.processStatus>i,s=7!==_.processStatus&&_.processStatus<i,l=null==(r=_.phaseData)?void 0:r[i];return u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"130px",maxWidth:"150px",padding:"8px 8px",position:"relative"},children:[u.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:a?(()=>{const e=bt(i),t=e.replace("0.8)","0.6)");return`linear-gradient(135deg, ${e}, ${t})`})():o?"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))":"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"600",fontSize:"18px",flexShrink:0,animation:a?"pulse-glow 2s ease-in-out infinite":"none",marginBottom:"12px"},children:o?"✓":i}),u.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:a?"var(--accent)":"var(--text)",marginBottom:"8px",textAlign:"center",lineHeight:"1.2",direction:"rtl"},children:e}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"2px",fontSize:"12px",color:"var(--muted)",textAlign:"center",direction:"rtl"},children:(a||o)&&l&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"2px"},children:[u.jsxs("div",{children:[u.jsxs("strong",{children:[ut(l,a)," ימים"]}),l.entries&&l.entries.length>1&&u.jsx("span",{style:{fontSize:"10px",color:"var(--accent)",marginRight:"4px"},children:'(סה"כ)'})]}),(l.entries&&l.entries.length>0||l.currentEntry)&&u.jsx("div",{style:{fontSize:"8px",color:"var(--muted)",opacity:.7},children:gt(l,a)}),(null==(n=l.currentEntry)?void 0:n.startDate)&&u.jsxs("div",{style:{fontSize:"9px",color:"var(--muted)",opacity:.8},children:["החל: ",Z(new Date(l.currentEntry.startDate))]})]})}),a&&u.jsx("div",{style:{fontSize:"12px",color:"var(--accent)",fontWeight:"600",marginTop:"8px",textAlign:"center",background:"rgba(124,192,255,0.2)",padding:"6px 12px",borderRadius:"12px",direction:"rtl"},children:"נוכחי"}),o&&u.jsx("div",{style:{fontSize:"12px",color:"rgba(76,175,80,0.9)",fontWeight:"600",marginTop:"8px",textAlign:"center",background:"rgba(76,175,80,0.2)",padding:"6px 12px",borderRadius:"12px",direction:"rtl"},children:7===_.processStatus&&6===i?"הושלם ":"הושלם"}),s&&u.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"500",marginTop:"8px",textAlign:"center",background:"rgba(255,255,255,0.1)",padding:"6px 12px",borderRadius:"12px",direction:"rtl"},children:"ממתין"}),t<5&&u.jsx("div",{style:{position:"absolute",left:"-20px",top:"40px",width:"40px",height:"3px",background:(7===_.processStatus?t<5:o)?"rgba(76,175,80,0.6)":a&&t<_.processStatus-1?"rgba(124,192,255,0.6)":"rgba(255,255,255,0.3)",zIndex:1},children:u.jsx("div",{style:{position:"absolute",left:"-6px",top:"50%",transform:"translateY(-50%)",width:0,height:0,borderTop:"4px solid transparent",borderBottom:"4px solid transparent",borderRight:"8px solid "+((7===_.processStatus?t<5:o)?"rgba(76,175,80,0.6)":a&&t<_.processStatus-1?"rgba(124,192,255,0.6)":"rgba(255,255,255,0.3)")}})})]},`${i}-${_.id}-${_.processStatus}-${_.lastUpdated}-${rt.getTime()}-${pt}`)})})]}),u.jsxs("div",{style:{background:"rgba(124,192,255,0.08)",border:"2px solid rgba(124,192,255,0.2)",borderRadius:"20px",padding:"24px",display:"flex",flexDirection:"column",height:"65%",minHeight:0,overflow:"hidden",maxWidth:"100%",boxSizing:"border-box"},children:[u.jsx("h4",{style:{color:"white",fontSize:"28px",fontWeight:"600",margin:"0 0 16px 0",textAlign:"center"},children:"עדכוני סטטוס"}),u.jsx("div",{ref:V,style:{height:"100%",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px",marginBottom:"16px",overflowY:"auto",direction:"rtl",minHeight:0},children:_.statusUpdates&&_.statusUpdates.length>0?_.statusUpdates.sort((e,t)=>{const r=e=>{if(e.includes("/")){const[t,r]=e.split(" "),[n,i,a]=t.split("/");return new Date(`${a}-${i}-${n} ${r}`)}return new Date(e)},n=r(e.timestamp),i=r(t.timestamp),a=n.getTime()-i.getTime();return 0!==a?a:parseInt(e.id)-parseInt(t.id)}).map(e=>{let t;if("system"===e.type)t="rgba(124,192,255, 0.8)";else{const r="status_change"===e.type&&e.newStatus?e.newStatus:e.processStatus;t=r?bt(r):"rgba(158, 158, 158, 0.8)"}const r=t.replace("0.8)","0.1)"),n=t.replace("0.8)","0.3)");return t.replace("0.8)","0.2)"),u.jsxs("div",{style:{padding:"12px",marginBottom:"8px",background:r,border:`1px solid ${n}`,borderRadius:"8px",position:"relative"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"6px"},children:[u.jsxs("div",{style:{fontSize:"11px",color:"var(--muted)",display:"flex",alignItems:"center",gap:"8px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:["status_change"===e.type&&"🔄","system"===e.type&&"⚙️","user"===e.type&&"👤",Tt(e.timestamp)]}),e.author&&u.jsx("div",{style:{fontSize:"11px",color:"var(--accent)",fontWeight:"600"},children:e.author})]}),u.jsx("div",{style:{fontSize:"10px",color:"white",fontWeight:"600",background:t,padding:"2px 6px",borderRadius:"10px"},children:(()=>{const t="status_change"===e.type&&e.newStatus?e.newStatus:e.processStatus;return t?7===t?"מובצע":ie[t-1]:"לא זמין"})()})]}),u.jsx("div",{style:{fontSize:"14px",color:"var(--text)",lineHeight:"1.4"},children:e.message})]},e.id)}):u.jsx("div",{style:{textAlign:"center",color:"var(--muted)",fontSize:"14px",padding:"20px"},children:"אין עדכונים עדיין"})}),a()&&u.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px"},children:[u.jsx("textarea",{value:W,onChange:e=>U(e.target.value),placeholder:"הכנס עדכון או הערה על התהליך...",style:{width:"100%",minHeight:"60px",background:"transparent",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"8px",padding:"12px",color:"var(--text)",fontSize:"14px",direction:"rtl",fontFamily:"Segoe UI, sans-serif",outline:"none",resize:"vertical",lineHeight:"1.5"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 2px rgba(124,192,255,0.2)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),wt())}}),u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"12px"},children:[u.jsx("div",{style:{fontSize:"12px",color:"var(--muted)"},children:"Enter לשליחה, Shift+Enter לשורה חדשה"}),u.jsx("button",{onClick:wt,disabled:!W.trim(),style:{background:W.trim()?"linear-gradient(135deg, rgba(124,192,255,0.8), rgba(124,192,255,0.6))":"rgba(255,255,255,0.1)",border:"none",borderRadius:"8px",padding:"8px 16px",color:W.trim()?"white":"var(--muted)",fontSize:"14px",fontWeight:"600",cursor:W.trim()?"pointer":"not-allowed",transition:"all 0.2s ease",direction:"rtl"},onMouseEnter:e=>{W.trim()&&(e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(124,192,255,0.4)")},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="none"},children:"שלח עדכון"})]})]})]})]})]})]})}),Se&&u.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)",zIndex:1100,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>je(!1),children:u.jsxs("div",{style:{background:"radial-gradient(1200px 800px at 50% 50%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 50% 50%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"20px",padding:"32px",maxWidth:"500px",width:"90%",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",backdropFilter:"blur(12px)",direction:"rtl"},onClick:e=>e.stopPropagation(),children:[u.jsxs("div",{style:{textAlign:"center",marginBottom:"24px"},children:[u.jsx("h3",{style:{color:"var(--accent)",fontSize:"24px",fontWeight:"600",margin:"0 0 8px 0"},children:"הגדרות התראות"}),u.jsx("p",{style:{color:"var(--muted)",fontSize:"14px",margin:0},children:'בחר איך תרצה לקבל עדכונים על סג"ח זה'})]}),u.jsxs("div",{style:{marginBottom:"24px"},children:[u.jsx("h4",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",margin:"0 0 12px 0"},children:"איך תרצה לקבל עדכונים?"}),u.jsx("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:u.jsx("button",{onClick:()=>Ce("email"),style:{background:"email"===ke?"linear-gradient(135deg, rgba(124,192,255,0.8), rgba(124,192,255,0.6))":"rgba(255,255,255,0.08)",border:"1px solid "+("email"===ke?"rgba(124,192,255,0.8)":"rgba(255,255,255,0.2)"),borderRadius:"12px",padding:"12px 20px",color:"email"===ke?"white":"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",flex:"1",minWidth:"120px"},children:"📧 מייל"})})]}),u.jsxs("div",{style:{marginBottom:"32px"},children:[u.jsx("h4",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",margin:"0 0 12px 0"},children:"באיזו תדירות?"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[u.jsx("button",{onClick:()=>Te("status_change"),style:{background:"status_change"===Ee?"linear-gradient(135deg, rgba(124,192,255,0.8), rgba(124,192,255,0.6))":"rgba(255,255,255,0.08)",border:"1px solid "+("status_change"===Ee?"rgba(124,192,255,0.8)":"rgba(255,255,255,0.2)"),borderRadius:"12px",padding:"12px 16px",color:"status_change"===Ee?"white":"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",textAlign:"right"},children:"🔄 רק כשמשתנה סטטוס"}),u.jsx("button",{onClick:()=>Te("weekly"),style:{background:"weekly"===Ee?"linear-gradient(135deg, rgba(255,152,0,0.8), rgba(255,152,0,0.6))":"rgba(255,255,255,0.08)",border:"1px solid "+("weekly"===Ee?"rgba(255,152,0,0.8)":"rgba(255,255,255,0.2)"),borderRadius:"12px",padding:"12px 16px",color:"weekly"===Ee?"white":"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",textAlign:"right"},children:"📅 שבועי"}),u.jsx("button",{onClick:()=>Te("daily"),style:{background:"daily"===Ee?"linear-gradient(135deg, rgba(233,30,99,0.8), rgba(233,30,99,0.6))":"rgba(255,255,255,0.08)",border:"1px solid "+("daily"===Ee?"rgba(233,30,99,0.8)":"rgba(255,255,255,0.2)"),borderRadius:"12px",padding:"12px 16px",color:"daily"===Ee?"white":"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",textAlign:"right"},children:"🌅 יומי"})]})]}),u.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[u.jsxs("button",{onClick:()=>p(e,null,function*(){if(_){Ne(!0);try{yield new Promise(e=>setTimeout(e,600));const e=(null==o?void 0:o.id)||"current_user",t=(null==o?void 0:o.name)||"משתמש",r=w(_,e,t,ke,Ee);h(_.id,r),B(r),je(!1),xt("התראות הוגדרו בהצלחה דרך "+("email"===ke?"מייל":"וואטסאפ"),"success")}catch(e){xt("שגיאה בהגדרת התראות","warning")}finally{Ne(!1)}}}),disabled:De,style:d(l({},k.primary),{background:De?"linear-gradient(135deg, rgba(76,175,80,0.4), rgba(76,175,80,0.3))":"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",color:"white",cursor:De?"not-allowed":"pointer",opacity:De?.7:1}),children:[De?u.jsx("div",{style:{width:"16px",height:"16px",border:"2px solid transparent",borderTop:"2px solid currentColor",borderRadius:"50%",animation:"spin 1s linear infinite"}}):"✅",De?"מגדיר התראות...":"אשר והפעל התראות"]}),u.jsx("button",{onClick:()=>je(!1),style:d(l({},k.primary),{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"var(--text)"}),children:"ביטול"})]})]})}),Me&&u.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)",zIndex:1200,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>{Ae||(Le(!1),Fe({name:"",description:"",provider:"",arena:[],priority:"בינוני",sagachType:""}))},children:u.jsxs("div",{style:{background:"radial-gradient(1200px 800px at 50% 50%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 50% 50%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"20px",padding:"32px",maxWidth:"600px",width:"90%",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",backdropFilter:"blur(12px)",direction:"rtl"},onClick:e=>e.stopPropagation(),children:[u.jsxs("div",{style:{textAlign:"center",marginBottom:"32px"},children:[u.jsx("h3",{style:{color:"var(--accent)",fontSize:"28px",fontWeight:"700",margin:"0 0 12px 0"},children:'יצירת סג"ח חדש'}),u.jsx("p",{style:{color:"var(--muted)",fontSize:"16px",margin:0},children:'מלא את הפרטים הדרושים ליצירת הסג"ח החדש'})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px",marginBottom:"32px"},children:[u.jsxs("div",{children:[u.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:'שם הסג"ח *'}),u.jsx("input",{type:"text",value:$e.name,onChange:e=>Fe(t=>d(l({},t),{name:e.target.value})),placeholder:"הכנס שם לסג'ח החדש...",disabled:Ae,style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",opacity:Ae?.6:1,cursor:Ae?"not-allowed":"text",boxSizing:"border-box"},onFocus:e=>{Ae||(e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)")},onBlur:e=>{Ae||(e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none")}})]}),u.jsxs("div",{children:[u.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:"תיאור *"}),u.jsx("textarea",{value:$e.description,onChange:e=>Fe(t=>d(l({},t),{description:e.target.value})),placeholder:"הכנס תיאור מפורט לסג'ח...",disabled:Ae,rows:3,style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",resize:"vertical",minHeight:"80px",opacity:Ae?.6:1,cursor:Ae?"not-allowed":"text",boxSizing:"border-box"},onFocus:e=>{Ae||(e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)")},onBlur:e=>{Ae||(e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none")}})]}),u.jsxs("div",{children:[u.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:'סוג הסג"ח'}),u.jsx("input",{type:"text",value:$e.sagachType,onChange:e=>Fe(t=>d(l({},t),{sagachType:e.target.value})),placeholder:"הכנס סוג הסג'ח (אופציונלי)...",disabled:Ae,style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",opacity:Ae?.6:1,cursor:Ae?"not-allowed":"text",boxSizing:"border-box"},onFocus:e=>{Ae||(e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)")},onBlur:e=>{Ae||(e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none")}})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"16px"},children:[u.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),children:[u.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:"ספק *"}),u.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsxs("button",{type:"button",disabled:Ae,onClick:()=>we(e=>!e),style:{appearance:"none",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.08)",borderRadius:"12px",color:Ae?"rgba(255,255,255,0.5)":"#ffffff",padding:"12px 16px",cursor:Ae?"not-allowed":"pointer",fontSize:"14px",direction:"rtl",outline:"none",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",fontFamily:"Segoe UI, sans-serif",opacity:Ae?.6:1,boxSizing:"border-box"},children:[u.jsx("span",{style:{textAlign:"right",flex:1},children:$e.provider||"בחר ספק..."}),u.jsx("span",{style:{marginLeft:"8px",fontSize:"12px"},children:"▼"})]}),ve&&u.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:ne.map(e=>u.jsx("div",{onClick:()=>{Fe(t=>d(l({},t),{provider:e})),we(!1)},style:{padding:"10px 16px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl",background:$e.provider===e?"rgba(124,192,255,0.15)":"transparent"},onMouseEnter:t=>{$e.provider!==e&&(t.target.style.background="rgba(255,255,255,0.08)")},onMouseLeave:t=>{$e.provider!==e&&(t.target.style.background="transparent")},children:e},e))})]})]}),u.jsxs("div",{children:[u.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:"זירה *"}),u.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsxs("button",{type:"button",disabled:Ae,onClick:()=>be(e=>!e),style:{appearance:"none",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.08)",borderRadius:"12px",color:Ae?"rgba(255,255,255,0.5)":"#ffffff",padding:"12px 16px",cursor:Ae?"not-allowed":"pointer",fontSize:"14px",direction:"rtl",outline:"none",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",fontFamily:"Segoe UI, sans-serif",opacity:Ae?.6:1,boxSizing:"border-box"},children:[u.jsx("span",{style:{textAlign:"right",flex:1},children:0===$e.arena.length?"בחר זירות...":$e.arena.join(", ")}),u.jsx("span",{style:{marginLeft:"8px",fontSize:"12px"},children:"▼"})]}),ye&&u.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",zIndex:1e3,boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",overflow:"hidden",maxHeight:"200px",overflowY:"auto"},children:O.map(e=>u.jsxs("div",{onClick:t=>{if(t.stopPropagation(),!Ae){const t=$e.arena.includes(e);Fe(r=>d(l({},r),{arena:t?r.arena.filter(t=>t!==e):[...r.arena,e]}))}},style:{padding:"10px 16px",cursor:Ae?"not-allowed":"pointer",transition:"background 0.2s ease",direction:"rtl",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"space-between",background:$e.arena.includes(e)?"rgba(124,192,255,0.15)":"transparent",color:Ae?"rgba(255,255,255,0.5)":"var(--text)"},onMouseEnter:e=>{Ae||(e.currentTarget.style.background="rgba(124,192,255,0.15)")},onMouseLeave:t=>{Ae||$e.arena.includes(e)||(t.currentTarget.style.background="transparent")},children:[u.jsx("span",{children:e}),$e.arena.includes(e)&&u.jsx("span",{style:{color:"var(--accent)",fontSize:"12px"},children:"✓"})]},`new-arena-${e}`))})]})]}),u.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:"תעדוף *"}),u.jsxs("button",{type:"button",onClick:e=>{e.stopPropagation(),Ae||he(e=>!e)},style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",opacity:Ae?.6:1,cursor:Ae?"not-allowed":"pointer",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"space-between"},disabled:Ae,onMouseEnter:e=>{Ae||(e.currentTarget.style.borderColor="rgba(124,192,255,0.6)",e.currentTarget.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)")},onMouseLeave:e=>{Ae||(e.currentTarget.style.borderColor="rgba(255,255,255,0.2)",e.currentTarget.style.boxShadow="none")},children:[u.jsx("span",{children:$e.priority}),u.jsx("span",{style:{fontSize:"12px",marginLeft:"8px"},children:"▼"})]}),xe&&u.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",zIndex:1e3,boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",overflow:"hidden"},children:te.map(e=>u.jsxs("div",{onClick:t=>{t.stopPropagation(),Fe(t=>d(l({},t),{priority:e})),he(!1)},style:{padding:"10px 16px",cursor:"pointer",transition:"background 0.2s ease",direction:"rtl",color:"var(--text)",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"space-between",background:$e.priority===e?"rgba(124,192,255,0.15)":"transparent"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(124,192,255,0.15)"},onMouseLeave:t=>{$e.priority!==e&&(t.currentTarget.style.background="transparent")},children:[u.jsx("span",{children:e}),"TOP"===e&&u.jsx("span",{style:{fontSize:"12px",color:"var(--accent)"},children:"🔥"})]},e))})]})]})]}),u.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[u.jsxs("button",{onClick:()=>p(e,null,function*(){if(n())if($e.name.trim()&&$e.description.trim()&&$e.provider.trim()&&0!==$e.arena.length&&$e.priority){Re(!0);try{yield new Promise(e=>setTimeout(e,800));const e={id:"sagach"+(c.length+1),name:$e.name.trim(),description:$e.description.trim(),provider:$e.provider.trim(),lastUpdated:Z(it()),arena:$e.arena,priority:$e.priority,sagachType:$e.sagachType.trim()||void 0,attachments:[],processStatus:1,processStartDate:it().toISOString().split("T")[0],estimatedCompletion:"-",contactPerson:"",notes:"",notifications:!1,statusUpdates:[{id:Date.now().toString(),message:`נוצר סג"ח חדש: "${$e.name.trim()}" • ספק: ${$e.provider.trim()} • זירות: ${$e.arena.join(", ")}${$e.sagachType.trim()?` • סוג: ${$e.sagachType.trim()}`:""}`,timestamp:it().toISOString(),type:"system",processStatus:1,author:(null==o?void 0:o.name)||"משתמש"}],phaseData:{1:{currentEntry:{startDate:it().toISOString().split("T")[0],timeSpentDays:0},totalTimeSpentDays:0},2:{},3:{},4:{},5:{},6:{},7:{}}};g(e),Fe({name:"",description:"",provider:"",arena:[],priority:"בינוני",sagachType:""}),Le(!1);const t=c.find(t=>t.name===e.name&&t.description===e.description);B(t||null),xt('סג"ח חדש נוצר בהצלחה',"success")}catch(e){xt('שגיאה ביצירת הסג"ח',"warning")}finally{Re(!1)}}else alert("יש למלא את כל השדות הדרושים");else window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:'אין לך הרשאה ליצור סג"חים חדשים',type:"error",durationMs:3e3}}))}),disabled:Ae,style:d(l({},k.primary),{background:Ae?"linear-gradient(135deg, rgba(76,175,80,0.4), rgba(76,175,80,0.3))":"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",color:"white",fontSize:"16px",padding:"14px 28px",cursor:Ae?"not-allowed":"pointer",opacity:Ae?.7:1}),children:[Ae?u.jsx("div",{style:{width:"18px",height:"18px",border:"2px solid transparent",borderTop:"2px solid currentColor",borderRadius:"50%",animation:"spin 1s linear infinite"}}):"✅",Ae?'יוצר סג"ח...':'צור סג"ח']}),u.jsx("button",{onClick:()=>{Ae||(Le(!1),Fe({name:"",description:"",provider:"",arena:[],priority:"בינוני",sagachType:""}))},disabled:Ae,style:d(l({},k.primary),{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"var(--text)",fontSize:"16px",padding:"14px 28px",cursor:Ae?"not-allowed":"pointer",opacity:Ae?.5:1}),children:"ביטול"})]})]})}),_e.isVisible&&u.jsxs("div",{style:{position:"fixed",bottom:"30px",left:"50%",transform:"translateX(-50%)",background:"success"===_e.type?"linear-gradient(135deg, rgba(76,175,80,0.95), rgba(76,175,80,0.85))":"warning"===_e.type?"linear-gradient(135deg, rgba(255,152,0,0.95), rgba(255,152,0,0.85))":"linear-gradient(135deg, rgba(33,150,243,0.95), rgba(33,150,243,0.85))",border:"1px solid "+("success"===_e.type?"rgba(76,175,80,0.8)":"warning"===_e.type?"rgba(255,152,0,0.8)":"rgba(33,150,243,0.8)"),borderRadius:"25px",padding:"12px 24px",color:"white",fontSize:"14px",fontWeight:"600",fontFamily:"Segoe UI, sans-serif",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",backdropFilter:"blur(12px)",zIndex:2e3,display:"flex",alignItems:"center",gap:"8px",direction:"rtl",minWidth:"200px",justifyContent:"center",animation:_e.isVisible?"slideUpFadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1)":"slideDownFadeOut 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:[u.jsx("span",{style:{fontSize:"16px"},children:"success"===_e.type?"✅":"warning"===_e.type?"⚠️":"ℹ️"}),_e.message]}),u.jsx("style",{children:"\n        @keyframes slideUpFadeIn {\n          0% {\n            opacity: 0;\n            transform: translateX(-50%) translateY(20px);\n          }\n          100% {\n            opacity: 1;\n            transform: translateX(-50%) translateY(0);\n          }\n        }\n        \n        @keyframes slideDownFadeOut {\n          0% {\n            opacity: 1;\n            transform: translateX(-50%) translateY(0);\n          }\n          100% {\n            opacity: 0;\n            transform: translateX(-50%) translateY(20px);\n          }\n        }\n      "})]})});oe.displayName="SagachimStatus";const se=new Map,le=e=>{if(se.has(e))return se.get(e);const t=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9","#F8C471","#82E0AA","#F1948A","#85C1E9","#D7DBDD"];let r=0;for(let i=0;i<e.length;i++)r=(r<<5)-r+e.charCodeAt(i),r&=r;const n=t[Math.abs(r)%t.length];return se.set(e,n),n},de=x.memo(function({schemas:e}){var t,r;const[n,i]=x.useState(""),[a,o]=x.useState(""),[s,l]=x.useState(null),[d,c]=x.useState("all"),[p,g]=x.useState(!1),[h,m]=x.useState(0),[f,y]=x.useState("all"),[b,v]=x.useState(!1),w=x.useRef(null),S=x.useRef(null),j=x.useRef(null);x.useEffect(()=>{const e=setTimeout(()=>o(n),300);return()=>clearTimeout(e)},[n]),x.useEffect(()=>{const e=e=>{const t=e.target;t.closest(".action-dropdown")||t.closest(".schema-dropdown")||(w.current&&!w.current.contains(t)&&g(!1),j.current&&!j.current.contains(t)&&v(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const k=x.useMemo(()=>{const t=[];try{Object.entries(e).forEach(([e,r])=>{t.push(...function(e,t,r){const n=[],i=(r,a,o)=>{try{const s=Array.isArray(null==r?void 0:r.type)?r.type[0]:null==r?void 0:r.type;if("object"===s&&(null==r?void 0:r.properties)&&"object"==typeof r.properties){const e=Array.isArray(null==r?void 0:r.required)?r.required:[],t=new Set(e);for(const[n,o]of Object.entries(r.properties))i(o,[...a,String(n)],t.has(String(n)))}else if("array"===s&&(null==r?void 0:r.items))i(r.items,[...a,"item"],o);else{const i=a[a.length-1]||t,l=a.join(".");if(l){const a=[];o&&a.push("required"),"string"==typeof(null==r?void 0:r.pattern)&&a.push(`pattern: ${r.pattern}`),"string"==typeof(null==r?void 0:r.format)&&a.push(`format: ${r.format}`),"number"==typeof(null==r?void 0:r.minLength)&&a.push(`minLength: ${r.minLength}`),"number"==typeof(null==r?void 0:r.maxLength)&&a.push(`maxLength: ${r.maxLength}`),"number"==typeof(null==r?void 0:r.minimum)&&a.push(`minimum: ${r.minimum}`),"number"==typeof(null==r?void 0:r.maximum)&&a.push(`maximum: ${r.maximum}`),Array.isArray(null==r?void 0:r.enum)&&a.push(`enum: ${r.enum.join(", ")}`),n.push({id:`${e}:${l}`,schemaKey:e,schemaTitle:t,path:l,name:i,type:s||void 0,description:"string"==typeof(null==r?void 0:r.description)?r.description:void 0,rules:a.length?a:void 0})}}}catch(s){}};return i(r,[t],!1),n}(e,r.title||e,r.schema))})}catch(r){}return t.sort((e,t)=>e.schemaTitle.localeCompare(t.schemaTitle)||e.path.localeCompare(t.path))},[e]),C=x.useMemo(()=>{let e=k;f&&"all"!==f&&(e=e.filter(e=>e.schemaKey===f)),"fields"===d?e=e.filter(e=>e.path.split(".").length>2):"hierarchies"===d&&(e=e.filter(e=>e.path.split(".").length<=2));const t=new Map;e.forEach(e=>{const r=e.path.split(".").slice(1,-1).join("."),n=`${e.name}|${r}`;t.has(n)||t.set(n,[]),t.get(n).push(e)}),e=[],t.forEach(t=>{1===t.length?e.push(t[0]):new Set(t.map(e=>e.schemaKey)).size>1?e.push(...t):e.push(t[0])});const r=a.trim().toLowerCase();return r?e.filter(e=>e.path.toLowerCase().includes(r)||e.name.toLowerCase().includes(r)||e.schemaTitle.toLowerCase().includes(r)||!!e.type&&e.type.toLowerCase().includes(r)||!!e.description&&e.description.toLowerCase().includes(r)):e},[k,a,d,f]);return x.useEffect(()=>{const e=e=>{if(0!==C.length)switch(e.key){case"ArrowDown":e.preventDefault(),m(e=>Math.min(e+1,C.length-1));break;case"ArrowUp":e.preventDefault(),m(e=>Math.max(e-1,0));break;case"Home":e.preventDefault(),m(0);break;case"End":e.preventDefault(),m(C.length-1);break;case"Enter":e.preventDefault(),C[h]&&(l(null),setTimeout(()=>{l(C[h]),m(h)},10))}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[C,h]),x.useEffect(()=>{S.current&&S.current.scrollIntoView({behavior:"smooth",block:"nearest"})},[h]),x.useEffect(()=>{},[s]),u.jsxs(u.Fragment,{children:[u.jsx("aside",{className:"value-panel",dir:"rtl",style:{background:"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:"1px solid rgba(255,255,255,0.12)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 20px 60px rgba(0,0,0,0.35)"},children:u.jsxs("div",{className:"value-panel-inner",children:[u.jsxs("div",{className:"value-search",children:[u.jsxs("div",{className:"schema-selector",ref:j,style:{marginBottom:"12px",width:"100%"},children:[u.jsxs("button",{className:"btn ghost "+(f?"":"is-placeholder"),onClick:()=>v(!b),style:{width:"100%"},children:["all"===f?"כל התקנים":f&&e[f]?e[f].title:u.jsx("span",{className:"schema-placeholder",dir:"rtl",children:"בחר תקן"}),u.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),b&&u.jsxs("div",{className:"schema-dropdown",children:[u.jsx("div",{className:"schema-option",onClick:()=>{y("all"),v(!1)},children:"כל התקנים"}),Object.entries(e).map(([e,t])=>u.jsx("div",{className:"schema-option",onClick:()=>{y(e),v(!1)},children:t.title},e))]})]}),u.jsxs("div",{className:"value-search-row",children:[u.jsx("input",{type:"text",placeholder:"חפש לפי שם/תיאור/היררכיה...",value:n,onChange:e=>i(e.target.value),className:"value-search-input"}),u.jsxs("div",{className:"value-filter-dropdown",ref:w,children:[u.jsxs("button",{className:"btn",onClick:()=>g(!p),children:[u.jsx("span",{children:"⏷"}),u.jsx("span",{children:"all"===d?"הכל":"fields"===d?"רק שדות בסיסיים":"רק היררכיות"})]}),p&&u.jsxs("div",{className:"value-filter-options",children:[u.jsx("div",{className:"value-filter-option "+("all"===d?"active":""),onClick:()=>{c("all"),g(!1)},children:"הכל"}),u.jsx("div",{className:"value-filter-option "+("fields"===d?"active":""),onClick:()=>{c("fields"),g(!1)},children:"רק שדות בסיסיים"}),u.jsx("div",{className:"value-filter-option "+("hierarchies"===d?"active":""),onClick:()=>{c("hierarchies"),g(!1)},children:"רק היררכיות"})]})]})]})]}),u.jsx("div",{className:"value-list custom-scrollbar",role:"list",children:C.map((e,t)=>u.jsx("button",{ref:t===h?S:null,className:`value-item ${t===h?"selected":""} ${(null==s?void 0:s.id)===e.id?"clicked":""}`,role:"listitem",title:`${e.schemaTitle} / ${e.path}`,onClick:()=>{l(e),m(-1)},children:u.jsxs("div",{className:"value-row",children:[u.jsx("span",{className:"value-family",style:{color:le(e.schemaTitle),fontWeight:"bold",fontSize:"12px",flex:"0 0 auto",minWidth:"fit-content",marginRight:"8px"},children:e.schemaTitle}),u.jsx("span",{className:"value-hierarchy",style:{flex:"1 1 auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(()=>{const t=e.path.split(".");return t.length<=2?"":t.slice(1,t.length-1).join(".")})()}),u.jsx("span",{className:"value-name",style:{flex:"0 0 auto",minWidth:"fit-content"},children:e.name})]})},e.id))})]})}),u.jsxs("section",{className:"value-detail-panel dictionary-box",dir:"rtl",style:{background:"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:"1px solid rgba(255,255,255,0.12)",overflow:"auto",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 20px 60px rgba(0,0,0,0.35)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",textAlign:"center",zIndex:1},children:[u.jsxs("div",{className:"value-detail-headline",style:{fontSize:"80px !important",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",textAlign:"center"},children:[u.jsx("div",{}),u.jsx("div",{className:"value-detail-path "+(s?"selected":""),style:{fontSize:s?"40px !important":"35px !important",fontWeight:s?"700":"400",color:s?"rgb(19, 124, 223)":"var(--muted)",textDecoration:s?"underline":"none",borderBottom:"none",paddingBottom:"0px"},children:s?(()=>{const e=s.path.split(".");return e.length<=2?s.name:`${e.slice(1,e.length-1).join(".")}.${s.name}`})():"-"})]}),u.jsx("hr",{style:{width:"75%",marginBottom:"20px",height:"0px"}}),u.jsxs("div",{className:"value-detail-body",style:{fontSize:"40px !important",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",textAlign:"center"},children:[u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"k",style:{fontSize:"60px !important",color:"var(--muted) !important"},children:"מהות השדה:"}),u.jsx("span",{className:"v",style:{fontSize:"2px !important",color:"var(--text) !important"},children:(null==s?void 0:s.description)||"-"})]}),u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"k",style:{color:"var(--muted) !important"},children:"סוג השדה:"}),u.jsx("span",{className:"v",style:{fontSize:"26px !important",color:"var(--text) !important"},children:(null==s?void 0:s.type)||"-"})]}),u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"k",style:{fontSize:"26px !important",color:"var(--muted) !important"},children:"האם שדה חובה:"}),u.jsx("span",{className:"v",style:{fontSize:"26px !important",color:"var(--text) !important"},children:(null==(t=null==s?void 0:s.rules)?void 0:t.some(e=>"required"===e))?"כן":"-"})]}),u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"k",style:{fontSize:"26px !important",color:"var(--muted) !important"},children:'דג"ח/רשימה סגורה:'}),u.jsx("span",{className:"v",style:{fontSize:"26px !important",color:"var(--text) !important"},children:(null==(r=null==s?void 0:s.rules)?void 0:r.find(e=>e.startsWith("enum")))?(()=>{const e=s.rules.find(e=>e.startsWith("enum"));if(e){const t=e.replace("enum: ","").split(", ");return u.jsx("div",{className:"enum-values",style:{fontSize:"26px !important"},children:t.map((e,t)=>u.jsx("div",{className:"enum-value",style:{fontSize:"26px !important"},children:e},t))})}return"-"})():"-"})]}),u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"k",style:{fontSize:"26px !important",color:"var(--muted) !important"},children:"חוקים:"}),u.jsx("span",{className:"v",style:{fontSize:"26px !important",color:"var(--text) !important"},children:(null==s?void 0:s.rules)&&s.rules.length?s.rules.join(" | "):"-"})]}),u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"k",style:{fontSize:"26px !important",color:"var(--muted) !important"},children:"בשימוש במשפחות:"}),u.jsx("span",{className:"v",style:{fontSize:"26px !important",color:"var(--text) !important"},children:s?(()=>{const e=new Set;return k.forEach(t=>{t.name===s.name&&t.path.split(".").slice(1,-1).join(".")===s.path.split(".").slice(1,-1).join(".")&&e.add(t.schemaTitle)}),Array.from(e).sort().join(", ")||"-"})():"-"})]})]})]})]})}),ce=["ממתין לבשלות בצד ספק",'ממתין לקבלת דג"ח והתנעה',"בתהליכי אפיון","ממתין לאינטגרציות","אינטגרציות","מבצוע","מובצע"],pe=e=>!e||isNaN(e.getTime())?"תאריך לא זמין":`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`,ue=e=>{if(!e)return"תאריך לא זמין";try{const t=new Date(e);return isNaN(t.getTime())?"תאריך לא זמין":pe(t)}catch(t){return"תאריך לא זמין"}},ge=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]},xe=({isOpen:e,onClose:t,sagach:r})=>{var n;const[i,a]=x.useState("overview"),o=x.useMemo(()=>{if(!(null==r?void 0:r.processStartDate)||!(null==r?void 0:r.completionDate))return 0;const e=new Date(r.processStartDate),t=new Date(r.completionDate);return Math.ceil((t.getTime()-e.getTime())/864e5)},[r]),s=x.useMemo(()=>{if(!r)return[];const e=[];if(r.phaseData&&(Object.entries(r.phaseData).forEach(([t,r])=>{const n=parseInt(t);n>=1&&n<=7&&r.entries&&r.entries.forEach(t=>{t.timeSpentDays>0&&e.push({phase:n,phaseName:ce[n-1],startDate:t.startDate,endDate:t.completionDate||t.startDate,duration:t.timeSpentDays,isBacktrack:!1})})}),e.length>0))return e;if(!r.statusUpdates||0===r.statusUpdates.length){const t=r.processStartDate||r.lastUpdated,n=r.completionDate||r.lastUpdated,i=Math.ceil((new Date(n).getTime()-new Date(t).getTime())/864e5);return i>0&&e.push({phase:r.processStatus,phaseName:ce[r.processStatus-1],startDate:t,endDate:n,duration:i,isBacktrack:!1}),e}const t=[...r.statusUpdates].filter(e=>"status_change"===e.type&&e.oldStatus&&e.newStatus).sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime());let n=1,i=r.processStartDate||r.lastUpdated;for(let r=0;r<t.length;r++){const a=t[r];if(a.oldStatus&&a.newStatus){const t=a.timestamp,r=new Date(i),o=new Date(t),s=Math.ceil((o.getTime()-r.getTime())/864e5);s>0&&e.push({phase:a.oldStatus,phaseName:ce[a.oldStatus-1],startDate:i,endDate:t,duration:s,isBacktrack:a.oldStatus>a.newStatus}),n=a.newStatus,i=t}}const a=r.completionDate||r.lastUpdated,o=new Date(i),s=new Date(a),l=Math.ceil((s.getTime()-o.getTime())/864e5);return l>0&&e.push({phase:n,phaseName:ce[n-1],startDate:i,endDate:a,duration:l,isBacktrack:!1}),e},[r]),l=x.useMemo(()=>{const e={};for(let r=1;r<=7;r++)e[r]={totalDays:0,visits:0,avgDays:0,returns:0};const t={};return s.forEach(r=>{r.phase>=1&&r.phase<=7&&(e[r.phase].totalDays+=r.duration||0,e[r.phase].visits+=1,t[r.phase]=(t[r.phase]||0)+1)}),Object.keys(e).forEach(r=>{const n=parseInt(r),i=t[n]||0;i>0?(e[n].avgDays=e[n].totalDays/e[n].visits,e[n].returns=Math.max(0,i-1)):(e[n].avgDays=0,e[n].returns=0)}),e},[s]),d=x.useMemo(()=>(null==r?void 0:r.statusUpdates)?[...r.statusUpdates].sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()):[],[r]);return e&&r?u.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"20px",fontFamily:"Segoe UI, sans-serif"},children:u.jsxs("div",{style:{background:"var(--panel)",borderRadius:"20px",width:"100%",maxWidth:"1200px",maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",backdropFilter:"blur(20px)"},children:[u.jsxs("div",{style:{padding:"24px 32px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{children:[u.jsxs("h2",{style:{fontSize:"24px",fontWeight:"700",color:"var(--text)",margin:"0 0 8px 0",textAlign:"right"},children:["אנליטיקות: ",r.name]}),u.jsxs("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0",textAlign:"right"},children:[r.provider," • ",r.arena.join(", ")]})]}),u.jsx("button",{onClick:t,style:{background:"none",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:"24px",padding:"8px",borderRadius:"8px",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.1)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]}),u.jsx("div",{style:{display:"flex",borderBottom:"1px solid rgba(255,255,255,0.1)",direction:"rtl"},children:[{id:"overview",label:"סקירה כללית"},{id:"timeline",label:"ציר זמן"},{id:"chat",label:"עדכוני סטטוס"},{id:"files",label:"קבצים"}].map(e=>u.jsx("button",{onClick:()=>a(e.id),style:{padding:"16px 24px",background:"none",border:"none",color:i===e.id?"var(--text)":"var(--muted)",cursor:"pointer",fontSize:"14px",fontWeight:"600",borderBottom:i===e.id?"2px solid #4CAF50":"2px solid transparent",transition:"all 0.2s ease",direction:"rtl"},children:e.label},e.id))}),u.jsxs("div",{style:{flex:1,overflow:"auto",padding:"24px 32px"},children:["overview"===i&&u.jsxs("div",{style:{direction:"rtl"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"20px",marginBottom:"32px"},children:[u.jsxs("div",{style:{background:"rgba(76,175,80,0.1)",border:"1px solid rgba(76,175,80,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[u.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#4CAF50",marginBottom:"8px"},children:o}),u.jsx("div",{style:{fontSize:"14px",color:"var(--muted)"},children:"ימים כוללים"})]}),u.jsxs("div",{style:{background:"rgba(33,150,243,0.1)",border:"1px solid rgba(33,150,243,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[u.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#2196F3",marginBottom:"8px"},children:s.length}),u.jsx("div",{style:{fontSize:"14px",color:"var(--muted)"},children:"שלבים בתהליך"})]}),u.jsxs("div",{style:{background:"rgba(255,152,0,0.1)",border:"1px solid rgba(255,152,0,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[u.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#FF9800",marginBottom:"8px"},children:Object.values(l).reduce((e,t)=>e+t.returns,0)}),u.jsx("div",{style:{fontSize:"14px",color:"var(--muted)"},children:"חזרות לשלבים"})]}),u.jsxs("div",{style:{background:"rgba(156,39,176,0.1)",border:"1px solid rgba(156,39,176,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[u.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#9C27B0",marginBottom:"8px"},children:(null==(n=r.statusUpdates)?void 0:n.length)||0}),u.jsx("div",{style:{fontSize:"14px",color:"var(--muted)"},children:"עדכוני סטטוס"})]})]}),u.jsxs("div",{children:[u.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"var(--text)",margin:"0 0 16px 0",textAlign:"right"},children:"סטטיסטיקות שלבים"}),u.jsxs("div",{style:{display:"grid",gap:"12px"},children:[Object.entries(l).filter(([e,t])=>t.visits>0).map(([e,t])=>u.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{style:{textAlign:"right"},children:[u.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text)",marginBottom:"4px"},children:ce[parseInt(e)-1]}),u.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)"},children:[t.returns," חזרה",t.returns>1?"ות":""]})]}),u.jsxs("div",{style:{textAlign:"left"},children:[u.jsxs("div",{style:{fontSize:"18px",fontWeight:"700",color:"#4CAF50"},children:[t.totalDays," ימים"]}),u.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)"},children:["ממוצע: ",t.avgDays.toFixed(1)," ימים"]})]})]},e)),Object.values(l).every(e=>0===e.visits)&&u.jsx("div",{style:{textAlign:"center",padding:"40px",color:"var(--muted)",fontSize:"14px"},children:"אין נתונים זמינים על שלבי התהליך"})]})]})]}),"timeline"===i&&u.jsxs("div",{style:{direction:"rtl"},children:[u.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"var(--text)",margin:"0 0 24px 0",textAlign:"right"},children:"ציר זמן מפורט"}),u.jsx("div",{style:{position:"relative",paddingRight:"20px"},children:(()=>{const e=s.sort((e,t)=>{const r=new Date(e.endDate||e.startDate),n=new Date(t.endDate||t.startDate),i=r.getTime()-n.getTime();return 0===i?e.phase-t.phase:i}),t=new Set;return e.map((r,n)=>{const i=!t.has(r.phase);return i&&t.add(r.phase),u.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px",position:"relative"},children:[!i&&u.jsx("div",{style:{marginLeft:"8px",fontSize:"16px",color:"#FF9800",zIndex:3,position:"relative"},children:"↶"}),u.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",background:i?"#4CAF50":"#FF9800",marginLeft:i?"16px":"8px",flexShrink:0,position:"relative",zIndex:2}}),n<e.length-1&&u.jsx("div",{style:{position:"absolute",right:"5px",top:"12px",width:"2px",height:"16px",background:"rgba(255,255,255,0.2)",zIndex:1}}),u.jsxs("div",{style:{flex:1,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px",marginRight:"8px"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[u.jsxs("div",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text)"},children:[r.phaseName,!i&&u.jsx("span",{style:{fontSize:"12px",color:"#FF9800",marginRight:"8px"},children:"(חזרה)"})]}),u.jsxs("div",{style:{fontSize:"14px",fontWeight:"700",color:"#4CAF50"},children:[r.duration," ימים"]})]}),u.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",display:"flex",gap:"16px"},children:[u.jsxs("span",{children:["התחלה: ",pe(new Date(r.startDate))]}),r.endDate&&u.jsxs("span",{children:["סיום: ",pe(new Date(r.endDate))]})]})]})]},n)})})()})]}),"chat"===i&&u.jsxs("div",{style:{direction:"rtl"},children:[u.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"var(--text)",margin:"0 0 24px 0",textAlign:"right"},children:"עדכוני סטטוס"}),u.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"12px"},children:d.map((e,t)=>u.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[u.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"var(--text)"},children:e.author||"מערכת"}),u.jsx("div",{style:{fontSize:"12px",color:"var(--muted)"},children:ue(e.timestamp)})]}),u.jsx("div",{style:{fontSize:"14px",color:"var(--text)",lineHeight:"1.5",marginBottom:"8px"},children:e.message}),"status_change"===e.type&&e.oldStatus&&e.newStatus&&u.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",background:"rgba(255,255,255,0.05)",padding:"8px 12px",borderRadius:"8px",display:"inline-block"},children:[ce[e.oldStatus-1]," → ",ce[e.newStatus-1]]})]},e.id||t))})]}),"files"===i&&u.jsxs("div",{style:{direction:"rtl"},children:[u.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"var(--text)",margin:"0 0 24px 0",textAlign:"right"},children:"קבצים רלוונטיים"}),r.attachments&&r.attachments.length>0?u.jsx("div",{style:{display:"grid",gap:"12px"},children:r.attachments.map(e=>u.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{children:[u.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"var(--text)",marginBottom:"4px"},children:e.name}),u.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)"},children:[ge(e.size)," • ",pe(new Date(e.uploadDate))]})]}),u.jsx("button",{style:{padding:"8px 16px",background:"rgba(76,175,80,0.8)",border:"none",borderRadius:"8px",color:"white",fontSize:"12px",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(76,175,80,1)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(76,175,80,0.8)"},children:"הורד"})]},e.id))}):u.jsx("div",{style:{textAlign:"center",padding:"40px",color:"var(--muted)"},children:"אין קבצים רלוונטיים"})]})]})]})}):null},he=e=>{switch(e){case 1:return"rgba(128, 128, 128, 0.8)";case 2:return"rgba(33, 150, 243, 0.8)";case 3:return"rgba(255, 152, 0, 0.8)";case 4:return"rgba(233, 30, 99, 0.8)";case 5:return"rgba(156, 39, 176, 0.8)";case 6:return"rgba(46, 125, 50, 0.8)";case 7:return"rgba(27, 94, 32, 0.8)";default:return"rgba(158, 158, 158, 0.8)"}},me=e=>{if(!e.processStartDate||!e.completionDate)return 0;const t=new Date(e.processStartDate),r=new Date(e.completionDate);return Math.ceil((r.getTime()-t.getTime())/864e5)},fe=({onBack:e})=>{const{user:t}=z(),{sagachimStatus:r,isLoading:n,error:i}=X(),[a,o]=x.useState(""),[s,l]=x.useState(""),[d,c]=x.useState(""),[p,g]=x.useState("preset"),[h,m]=x.useState(""),[f,y]=x.useState("days"),[b,v]=x.useState(""),[w,S]=x.useState(!1),[j,k]=x.useState(!1),[C,E]=x.useState(!1),[T,D]=x.useState(!1),[N,I]=x.useState(null);x.useEffect(()=>{const e=e=>{e.target.closest("[data-dropdown-container]")||(S(!1),k(!1),E(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const M={filter:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"transparent",color:"var(--text)",borderRadius:"12px",padding:"8px 14px",cursor:"pointer",transition:"transform 120ms ease",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"right",boxShadow:"none"}},L=x.useMemo(()=>r?r.filter(e=>7===e.processStatus):[],[r]),A=x.useMemo(()=>{let e=L;if(a){const t=a.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t))}if(s&&(e=e.filter(e=>e.provider===s)),d&&(e=e.filter(e=>e.arena.includes(d))),"preset"===p&&b){const t=new Date;let r=new Date;switch(b){case"last7days":r.setDate(t.getDate()-7);break;case"last30days":r.setDate(t.getDate()-30);break;case"last3months":r.setMonth(t.getMonth()-3);break;case"last6months":r.setMonth(t.getMonth()-6);break;case"lastyear":r.setFullYear(t.getFullYear()-1)}e=e.filter(e=>{const t=e.completionDate?new Date(e.completionDate):new Date(e.lastUpdated);return t>=r&&t<=new Date&&!isNaN(t.getTime())})}else if("custom"===p&&h){const t=parseInt(h);if(!isNaN(t)){const r=new Date;let n=new Date;switch(f){case"days":n.setDate(r.getDate()-t);break;case"months":n.setMonth(r.getMonth()-t);break;case"years":n.setFullYear(r.getFullYear()-t)}e=e.filter(e=>{const t=e.completionDate?new Date(e.completionDate):new Date(e.lastUpdated);return t>=n&&t<=new Date&&!isNaN(t.getTime())})}}return e.sort((e,t)=>me(t)-me(e)),e},[L,a,s,d,p,b,h,f]),R=x.useMemo(()=>{if(!r)return[];const e=new Set;return r.forEach(t=>{t.provider&&e.add(t.provider)}),Array.from(e).sort()},[r]),$=x.useMemo(()=>{if(!r)return[];const e=new Set;return r.forEach(t=>{t.arena.forEach(t=>e.add(t))}),Array.from(e).sort()},[r]);return n?u.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"18px",color:"var(--text)",fontFamily:"Segoe UI, sans-serif"},children:"טוען ארכיון..."}):i?u.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"18px",color:"var(--error)",fontFamily:"Segoe UI, sans-serif"},children:["שגיאה בטעינת הארכיון: ",i]}):u.jsx("div",{style:{position:"fixed",top:"80px",left:0,display:"flex",justifyContent:"center",alignItems:"flex-start",zIndex:1,height:"calc(100vh - 80px)",width:"100%",overflow:"hidden"},children:u.jsxs("main",{className:"app-main",style:{display:"flex",flexDirection:"column",alignItems:"center",maxWidth:"1400px",margin:"0 auto",width:"100%",height:"100%",direction:"rtl",fontFamily:"Segoe UI, sans-serif",overflow:"hidden"},children:[u.jsx("style",{children:"\n            .archive-scroll::-webkit-scrollbar {\n              width: 8px;\n            }\n\n            .archive-scroll::-webkit-scrollbar-track {\n              background: rgba(255, 255, 255, 0.1);\n              border-radius: 4px;\n            }\n\n            .archive-scroll::-webkit-scrollbar-thumb {\n              background: rgba(76, 175, 80, 0.6);\n              border-radius: 4px;\n              transition: background 0.3s ease;\n            }\n\n            .archive-scroll::-webkit-scrollbar-thumb:hover {\n              background: rgba(76, 175, 80, 0.8);\n            }\n\n            /* For Firefox */\n            .archive-scroll {\n              scrollbar-width: thin;\n              scrollbar-color: rgba(76, 175, 80, 0.6) rgba(255, 255, 255, 0.1);\n            }\n          "}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:"32px",marginTop:"20px",padding:"16px 0",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[u.jsx("span",{style:{fontSize:"42px",fontWeight:"700",color:"rgb(61, 194, 43)",margin:"0 0 14px 0",textAlign:"center"},children:'ארכיון - סג"חים מובצעים'}),u.jsx("span",{style:{fontSize:"20px",color:"var(--muted)",margin:"0 0 20px 0",textAlign:"center"},children:'עיינו בסטטיסטיקות של תהליכי ההכנסה של סג"חים שמובצעו'}),u.jsxs("span",{style:{fontSize:"16px",color:"var(--muted)",margin:"0 0 12px 0",textAlign:"center"},children:["מוצגים ",A.length," מתוך ",L.length,' סג"חים']})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px",marginBottom:"32px",alignItems:"center",width:"100%"},children:u.jsxs("div",{style:{display:"flex",gap:"16px",justifyContent:"center",flexWrap:"wrap",alignItems:"center",width:"100%"},children:[u.jsxs("div",{style:{position:"relative",minWidth:"280px",maxWidth:"400px",flex:"1 1 300px"},children:[u.jsx("input",{type:"text",placeholder:"חיפוש לפי שם...",value:a,onChange:e=>o(e.target.value),style:{width:"100%",padding:"12px 16px 12px 40px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 20px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}}),u.jsx("div",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--muted)",fontSize:"16px"},children:"🔍"})]}),u.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsxs("button",{onClick:()=>S(!w),style:M.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[u.jsx("span",{children:s||"כל הספקים"}),u.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),w&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[u.jsx("div",{onClick:()=>{l(""),S(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הספקים"}),R.map(e=>u.jsx("div",{onClick:()=>{l(e),S(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),u.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsxs("button",{onClick:()=>k(!j),style:M.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[u.jsx("span",{children:d||"כל הזירות"}),u.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),j&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[u.jsx("div",{onClick:()=>{c(""),k(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הזירות"}),$.map(e=>u.jsx("div",{onClick:()=>{c(e),k(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),u.jsxs("div",{style:{position:"relative",minWidth:"200px",maxWidth:"280px",flex:"0 1 200px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsxs("button",{onClick:()=>E(!C),style:M.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[u.jsx("span",{children:"preset"===p?b?"last7days"===b?"7 ימים אחרונים":"last30days"===b?"30 ימים אחרונים":"last3months"===b?"3 חודשים אחרונים":"last6months"===b?"6 חודשים אחרונים":"lastyear"===b?"שנה אחרונה":"טווח זמנים":"טווח זמנים":h?`${h} ${"days"===f?"ימים":"months"===f?"חודשים":"שנים"}`:"טווח זמנים"}),u.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),C&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"300px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",padding:"8px"},children:[u.jsxs("div",{style:{marginBottom:"8px"},children:[u.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",marginBottom:"4px",textAlign:"right"},children:"טווחים מוגדרים:"}),[{value:"last7days",label:"7 ימים אחרונים"},{value:"last30days",label:"30 ימים אחרונים"},{value:"last3months",label:"3 חודשים אחרונים"},{value:"last6months",label:"6 חודשים אחרונים"},{value:"lastyear",label:"שנה אחרונה"}].map(e=>u.jsx("div",{onClick:()=>{g("preset"),v(e.value),E(!1)},style:{padding:"6px 8px",cursor:"pointer",borderRadius:"6px",transition:"background 0.2s ease",fontSize:"13px",color:"#ffffff",textAlign:"right",direction:"rtl",marginBottom:"2px"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e.label},e.value))]}),u.jsxs("div",{style:{borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:"8px"},children:[u.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",marginBottom:"4px",textAlign:"right"},children:"טווח מותאם אישית:"}),u.jsxs("div",{style:{display:"flex",gap:"4px",alignItems:"center",marginBottom:"8px"},children:[u.jsx("input",{type:"number",placeholder:"מספר",value:h,onChange:e=>m(e.target.value),style:{width:"60px",padding:"4px 6px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"6px",color:"var(--text)",fontSize:"12px",direction:"rtl",outline:"none"}}),u.jsxs("select",{value:f,onChange:e=>y(e.target.value),style:{padding:"4px 6px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"6px",color:"var(--text)",fontSize:"12px",direction:"rtl",outline:"none"},children:[u.jsx("option",{value:"days",children:"ימים"}),u.jsx("option",{value:"months",children:"חודשים"}),u.jsx("option",{value:"years",children:"שנים"})]}),u.jsx("button",{onClick:()=>{g("custom"),E(!1)},style:{padding:"4px 8px",background:"rgba(76,175,80,0.8)",border:"none",borderRadius:"6px",color:"white",fontSize:"12px",cursor:"pointer"},children:"החל"})]})]}),u.jsx("div",{onClick:()=>{v(""),m(""),g("preset"),E(!1)},style:{padding:"6px 8px",cursor:"pointer",borderRadius:"6px",transition:"background 0.2s ease",fontSize:"13px",color:"#ffffff",textAlign:"right",direction:"rtl",borderTop:"1px solid rgba(255,255,255,0.1)",marginTop:"8px",paddingTop:"8px"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"נקה סינון"})]})]})]})}),u.jsxs("div",{className:"archive-scroll",style:{display:"flex",flexDirection:"column",gap:"32px",width:"100%",padding:"0 20px 0 20px",maxHeight:"calc(100vh - 400px)",overflowY:"auto",overflowX:"hidden",direction:"rtl"},children:[u.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:"24px",justifyItems:"center",width:"100%"},children:A.map(e=>{return u.jsxs("div",{onClick:()=>(I(e),void D(!0)),style:{background:"linear-gradient(180deg, rgba(76,175,80,0.15), rgba(46,125,50,0.10))",border:"1px solid rgba(76,175,80,0.3)",borderRadius:"16px",padding:"24px",boxShadow:"0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)",backdropFilter:"blur(8px)",transition:"all 0.3s ease",cursor:"pointer",position:"relative",overflow:"hidden",width:"100%",maxWidth:"320px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-4px)",e.currentTarget.style.boxShadow="0 12px 40px rgba(76,175,80,0.3), inset 0 1px 0 rgba(76,175,80,0.15)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)"},children:[u.jsx("div",{style:{position:"absolute",top:"16px",left:"16px",background:he(e.processStatus),color:"white",padding:"6px 12px",borderRadius:"20px",fontSize:"11px",fontWeight:"600",letterSpacing:"0.5px",direction:"rtl",textAlign:"center",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"4px"},children:"✅ מובצע"}),(()=>{const t=me(e);return t>0?u.jsxs("div",{style:{position:"absolute",top:"16px",right:"16px",background:(r=t,r<=14?"#4CAF50":r<=30?"#FF9800":"#F44336"),color:"white",padding:"6px 12px",borderRadius:"20px",fontSize:"11px",fontWeight:"600",letterSpacing:"0.5px",direction:"rtl",textAlign:"center",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[t," ימים"]}):null;var r})(),u.jsxs("div",{style:{marginTop:"40px",direction:"rtl"},children:[u.jsx("h3",{style:{fontSize:"24px",fontWeight:"700",color:"var(--text)",margin:"0 0 12px 0",lineHeight:"1.3"},children:e.name}),u.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0 0 16px 0",lineHeight:"1.5",minHeight:"42px",whiteSpace:"pre-wrap",direction:"rtl",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e.description}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"16px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"ספק:"}),u.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.provider})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"זירה:"}),u.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.arena.join(", ")})]}),e.completionDate&&u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"הושלם:"}),u.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:(t=new Date(e.completionDate),`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`)})]}),e.contactPerson&&u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"איש קשר:"}),u.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.contactPerson})]})]})]}),u.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(135deg, rgba(76,175,80,0.15), rgba(46,125,50,0.1))",opacity:0,transition:"opacity 0.3s ease",pointerEvents:"none"}})]},e.id);var t})}),u.jsx("div",{style:{height:"150px",width:"100%"}}),0===A.length&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",textAlign:"center"},children:[u.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"currentColor",style:{color:"var(--muted)",marginBottom:"16px"},children:u.jsx("path",{d:"M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 9.5l4 4h-2.5V16h-3v-2.5H8l4-4z"})}),u.jsx("h3",{style:{fontSize:"18px",color:"var(--text)",margin:"0 0 8px 0"},children:"לא נמצאו סגחים מובצעים"}),u.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0"},children:a||s||d?"נסה לשנות את הפילטרים או החיפוש":"עדיין לא הושלמו סגחים במערכת"})]})]}),u.jsx(xe,{isOpen:T,onClose:()=>{D(!1),I(null)},sagach:N})]})})},ye=["ממתין לבשלות בצד ספק",'ממתין לקבלת דג"ח והתנעה',"בתהליכי אפיון","ממתין לאינטגרציות","אינטגרציות","מבצוע","מובצע"],be=()=>{const{user:e}=z(),{sagachimStatus:t,isLoading:r,error:n}=X(),[i,a]=x.useState(""),[o,s]=x.useState(""),[l,d]=x.useState(!1),[c,p]=x.useState(!1);x.useEffect(()=>{const e=e=>{e.target.closest("[data-dropdown-container]")||(d(!1),p(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const g=x.useMemo(()=>{if(!t)return[];const e=t.filter(e=>7===e.processStatus),r=new Set;return e.forEach(e=>{e.provider&&r.add(e.provider)}),Array.from(r).sort()},[t]),h=x.useMemo(()=>{if(!t)return[];const e=t.filter(e=>7===e.processStatus),r=new Set;return e.forEach(e=>{e.arena.forEach(e=>r.add(e))}),Array.from(r).sort()},[t]),m={filter:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"transparent",color:"var(--text)",borderRadius:"12px",padding:"8px 14px",cursor:"pointer",transition:"transform 120ms ease",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"right",boxShadow:"none"}},f=(e,t)=>isNaN(e)||isNaN(t)?"#9E9E9E":Math.abs(e-t)<=.5?"#FF9800":e<t?"#4CAF50":"#F44336";if(r)return u.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"18px",color:"var(--text)",fontFamily:"Segoe UI, sans-serif"},children:"טוען אנליטיקות..."});if(n)return u.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"18px",color:"var(--error)",fontFamily:"Segoe UI, sans-serif"},children:["שגיאה בטעינת האנליטיקות: ",n]});const y=(()=>{if(!t)return{averageDaysPerPhase:{},averageImplementationDays:0,totalCompleted:0,overallAverageImplementationDays:0,overallAverageDaysPerPhase:{},overallTotalCompleted:0};const e=t.filter(e=>7===e.processStatus);e.forEach((e,t)=>{}),e.filter(e=>{if(!e.processStartDate||!e.completionDate)return!1;const t=new Date(e.processStartDate),r=new Date(e.completionDate);return!isNaN(t.getTime())&&!isNaN(r.getTime())&&t<r});const r=t.filter(e=>7===e.processStatus),n=r.filter(e=>e.phaseData&&Object.keys(e.phaseData).length>0);let a=r;i&&(a=a.filter(e=>e.provider===i)),o&&(a=a.filter(e=>e.arena.includes(o)));const s=a.filter(e=>e.phaseData&&Object.keys(e.phaseData).length>0),l={},d={};n.forEach(e=>{e.phaseData&&Object.entries(e.phaseData).forEach(([t,r])=>{const n=parseInt(t);if(r&&r.entries){const t=r.entries.reduce((t,r)=>{if(r.completionDate){const n=r.startDate?new Date(r.startDate):new Date(e.processStartDate||e.lastUpdated),i=new Date(r.completionDate);return t+Math.ceil((i.getTime()-n.getTime())/864e5)}return t},0);l[n]=(l[n]||0)+t,d[n]=(d[n]||0)+1}})});const c={};Object.keys(l).forEach(e=>{const t=parseInt(e);c[t]=d[t]>0?Math.round(l[t]/d[t]*10)/10:0});const p=r.reduce((e,t)=>{if(t.processStartDate&&t.completionDate){const r=new Date(t.processStartDate),n=new Date(t.completionDate);if(isNaN(r.getTime())||isNaN(n.getTime()))return e;const i=Math.ceil((n.getTime()-r.getTime())/864e5);return i<0?e:e+i}return e},0),u=r.length>0?Math.round(p/r.length*10)/10:0;if(0===a.length||0===s.length)return{averageDaysPerPhase:{},averageImplementationDays:0,totalCompleted:0,overallAverageImplementationDays:u,overallAverageDaysPerPhase:c,overallTotalCompleted:r.length};const g={},x={};s.forEach(e=>{e.phaseData&&Object.entries(e.phaseData).forEach(([t,r])=>{const n=parseInt(t);if(r&&r.entries){const t=r.entries.reduce((t,r)=>{if(r.completionDate){const n=r.startDate?new Date(r.startDate):new Date(e.processStartDate||e.lastUpdated),i=new Date(r.completionDate);return t+Math.ceil((i.getTime()-n.getTime())/864e5)}return t},0);g[n]=(g[n]||0)+t,x[n]=(x[n]||0)+1}})});const h={};Object.keys(g).forEach(e=>{const t=parseInt(e);h[t]=x[t]>0?Math.round(g[t]/x[t]*10)/10:0});const m=a.reduce((e,t)=>{if(t.processStartDate&&t.completionDate){const r=new Date(t.processStartDate),n=new Date(t.completionDate);if(isNaN(r.getTime())||isNaN(n.getTime()))return e;const i=Math.ceil((n.getTime()-r.getTime())/864e5);return i<0?e:e+i}return e},0),f=a.length>0?Math.round(m/a.length*10)/10:0;return{averageDaysPerPhase:h,averageImplementationDays:f,totalCompleted:a.length,overallAverageImplementationDays:u,overallAverageDaysPerPhase:c,overallTotalCompleted:r.length}})();return u.jsx("div",{style:{position:"fixed",top:"80px",left:0,display:"flex",justifyContent:"center",alignItems:"flex-start",zIndex:1,height:"calc(100vh - 80px)",width:"100%",overflow:"auto",direction:"rtl"},children:u.jsxs("main",{className:"app-main",style:{display:"flex",flexDirection:"column",alignItems:"center",maxWidth:"1400px",margin:"0 auto",width:"100%",height:"auto",direction:"rtl",fontFamily:"Segoe UI, sans-serif",overflow:"auto"},children:[u.jsx("style",{children:"\n          .app-main::-webkit-scrollbar {\n            width: 8px;\n          }\n\n          .app-main::-webkit-scrollbar-track {\n            background: rgba(255, 255, 255, 0.1);\n            border-radius: 4px;\n          }\n\n          .app-main::-webkit-scrollbar-thumb {\n            background: rgba(76, 175, 80, 0.6);\n            border-radius: 4px;\n            transition: background 0.3s ease;\n          }\n\n          .app-main::-webkit-scrollbar-thumb:hover {\n            background: rgba(76, 175, 80, 0.8);\n          }\n\n          /* For Firefox */\n          .app-main {\n            scrollbar-width: thin;\n            scrollbar-color: rgba(76, 175, 80, 0.6) rgba(255, 255, 255, 0.1);\n          }\n\n          /* Ensure proper RTL layout for scrollbar positioning */\n          .app-main {\n            direction: rtl;\n          }\n        "}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:"32px",marginTop:"20px",padding:"16px 0",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[u.jsx("span",{style:{fontSize:"40px",fontWeight:"700",color:"rgb(233, 159, 49)",margin:"0 0 14px 0",textAlign:"center"},children:'אנליטיקות - הכנסות סג"חים'}),u.jsx("span",{style:{fontSize:"20px",color:"var(--muted)",margin:"0 0 16px 0",textAlign:"center"},children:' ניתוח מפורט של תהליכי הכנסת סג"חים עד היום'}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",width:"100%",maxWidth:"800px",marginTop:"16px"},children:[u.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(76,175,80,0.15), rgba(46,125,50,0.10))",border:"1px solid rgba(76,175,80,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[u.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#4CAF50",marginBottom:"8px"},children:isNaN(y.overallAverageImplementationDays)?"אין נתונים":y.overallAverageImplementationDays}),u.jsx("div",{style:{fontSize:"20px",color:"var(--muted)",marginBottom:"4px"},children:'ממוצע ימים למבצוע סג"ח'})]}),u.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(33,150,243,0.15), rgba(21,101,192,0.10))",border:"1px solid rgba(33,150,243,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[u.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#2196F3",marginBottom:"8px"},children:y.overallTotalCompleted}),u.jsx("div",{style:{fontSize:"20px",color:"var(--muted)",marginBottom:"4px"},children:'סה"כ סג"חים שמובצעו'})]})]}),u.jsxs("div",{style:{display:"flex",gap:"16px",justifyContent:"center",flexWrap:"wrap",alignItems:"center",width:"100%",marginTop:"24px"},children:[u.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsxs("button",{onClick:()=>d(!l),style:m.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[u.jsx("span",{children:i||"כל הספקים"}),u.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),l&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[u.jsx("div",{onClick:()=>{a(""),d(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הספקים"}),g.map(e=>u.jsx("div",{onClick:()=>{a(e),d(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),u.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsxs("button",{onClick:()=>p(!c),style:m.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[u.jsx("span",{children:o||"כל הזירות"}),u.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),c&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[u.jsx("div",{onClick:()=>{s(""),p(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הזירות"}),h.map(e=>u.jsx("div",{onClick:()=>{s(e),p(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]})]})]}),u.jsxs("div",{className:"analytics-scroll",style:{display:"flex",justifyContent:"center",gap:"24px",width:"100%",padding:"0 20px"},children:[(i||o)&&u.jsx("div",{style:{minWidth:"280px",maxWidth:"320px",height:"fit-content",textAlign:"right",direction:"rtl"},children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",fontSize:"24px",fontWeight:"700",color:"var(--text)"},children:[u.jsx("span",{style:{fontSize:"26px",fontWeight:"700",color:"var(--text)",marginBottom:"20px",textAlign:"center",borderBottom:"2px solid rgba(255,255,255,0.1)",padding:"8px 0"},children:"פלטורים פעילים"}),i&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[u.jsx("span",{style:{color:"white",fontWeight:"600",fontSize:"26px"},children:"ספק"}),u.jsx("div",{style:{color:"rgb(33, 150, 243)",fontWeight:"600",fontSize:"40px",marginTop:"16px"},children:i})]}),o&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"16px"},children:[u.jsx("span",{style:{color:"white",fontWeight:"600",fontSize:"26px"},children:"זירה"}),u.jsx("div",{style:{color:"rgb(33, 150, 243)",fontWeight:"600",fontSize:"40px",marginTop:"16px"},children:o})]}),u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"16px"},children:[u.jsx("span",{style:{color:"white",fontWeight:"600",fontSize:"26px"},children:'סג"חים שמובצעו'}),u.jsx("div",{style:{color:"rgb(76, 175, 80)",fontWeight:"600",fontSize:"40px",marginTop:"16px"},children:y.totalCompleted}),u.jsxs("div",{style:{color:"rgba(255,255,255,0.7)",fontWeight:"400",fontSize:"18px",marginTop:"8px"},children:[t?Math.round(y.totalCompleted/t.filter(e=>7===e.processStatus).length*100):0,'% מכלל הסג"חים']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"16px"},children:[u.jsx("span",{style:{color:"white",fontWeight:"600",fontSize:"26px"},children:"ממוצע ימים למבצוע"}),u.jsx("div",{style:{color:f(y.averageImplementationDays,y.overallAverageImplementationDays),fontWeight:"600",fontSize:"40px",marginTop:"16px"},children:isNaN(y.averageImplementationDays)?"אין נתונים":y.averageImplementationDays}),u.jsxs("div",{style:{color:"rgba(255,255,255,0.7)",fontWeight:"400",fontSize:"18px",marginTop:"8px"},children:["ממוצע כולל: ",isNaN(y.overallAverageImplementationDays)?"אין נתונים":y.overallAverageImplementationDays," ימים"]})]})]})]})}),Object.keys(y.averageDaysPerPhase).length>0&&u.jsxs("div",{style:{minWidth:"400px",maxWidth:"500px",height:"fit-content",textAlign:"right",direction:"rtl"},children:[u.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:"var(--text)",marginBottom:"20px",textAlign:"center",borderBottom:"2px solid rgba(255,255,255,0.1)",padding:"8px 0"},children:"ממוצע ימים בפילוח לשלבים"}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",fontSize:"16px",color:"var(--text)"},children:Object.entries(y.averageDaysPerPhase).sort(([e],[t])=>parseInt(e)-parseInt(t)).map(([e,t])=>{const r=parseInt(e),n=y.overallAverageDaysPerPhase[r]||0,a=f(t,n);return u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[u.jsxs("div",{style:{textAlign:"right"},children:[u.jsxs("div",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"4px"},children:["שלב ",e,": ",ye[parseInt(e)-1]]}),(i||o)&&u.jsxs("div",{style:{fontSize:"14px",color:"var(--muted)"},children:["ממוצע כולל: ",n," ימים"]})]}),u.jsxs("div",{style:{color:a,fontWeight:"700",fontSize:"20px"},children:[t," ימים"]})]},e)})})]})]}),u.jsx("div",{style:{marginTop:"24px",padding:"16px",background:"rgba(255,255,255,0.05)",borderRadius:"12px",textAlign:"center",margin:"24px 20px 0 20px"},children:u.jsx("div",{style:{fontSize:"14px",color:"var(--muted)"},children:0===y.overallTotalCompleted?'אין סג"חים מובצעים במערכת - האנליטיקות יופיעו לאחר הכנסת סג"חים וסימונם כמובצעים':'האנליטיקות מבוססות על סג"חים שהוכנסו למערכת ומובצעו'})})]})})},ve={person:{title:"Person",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"Person",type:"object",required:["firstName","lastName","address"],properties:{firstName:{type:"string",description:"Given name of the person",minLength:1},lastName:{type:"string",description:"Family name of the person",minLength:1},email:{type:"string",format:"email",description:"Primary contact email address"},phone:{type:"string",pattern:"^\\+?[0-9\n\r-s]{7,15}$",description:"Phone number with optional country code"},account:{type:"object",description:"User account settings and preferences",properties:{username:{type:"string",description:"Unique username for login",minLength:3,maxLength:16},password:{type:"string",description:"Secure password for account access",minLength:8},preferences:{type:"object",description:"User interface and notification preferences",properties:{notifications:{type:"boolean",description:"Enable push notifications"},theme:{type:"string",description:"Visual theme preference",enum:["light","dark","system"]},shortcuts:{type:"array",description:"Custom keyboard shortcuts",items:{type:"object",required:["name","keys"],properties:{name:{type:"string",description:"Shortcut action name"},keys:{type:"string",description:"Keyboard combination",pattern:"^[A-Z]+\\+[A-Z]+$"}}}}}}}},address:{type:"object",description:"Primary residential address",required:["street","city"],properties:{street:{type:"string",description:"Street name and number",minLength:1},city:{type:"string",description:"City name",minLength:1},state:{type:"string",description:"State or province"},zip:{type:"string",description:"Postal code",pattern:"^[0-9]{5}(?:-[0-9]{4})?$"}}},secondary_residence:{type:"object",description:"Optional secondary residence; if present, street and city are required",required:["street","city"],properties:{street:{type:"string",description:"Street name and number"},city:{type:"string",description:"City name"},coordinates:{type:"object",description:"Geographic coordinates of the residence",properties:{lat:{type:"number",description:"Latitude coordinate",minimum:-90,maximum:90},lng:{type:"number",description:"Longitude coordinate",minimum:-180,maximum:180}}}}},documents:{type:"array",description:"Collection of uploaded documents",items:{type:"object",required:["fileName","mimeType"],properties:{fileName:{type:"string",description:"Original filename of the document"},mimeType:{type:"string",description:"MIME type of the document",pattern:"^[-w.]+/[-w.]+$"},sizeKb:{type:"integer",description:"File size in kilobytes",minimum:1,maximum:10240}}}},age:{type:"integer",description:"Age in years",minimum:0,maximum:120},tags:{type:"array",description:"User-defined tags for categorization",items:{type:"string",maxLength:20}}}}},gps_location:{title:"GPS Location Device",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"GPSLocationDevice",type:"object",required:["deviceId","location","timestamp"],properties:{deviceId:{type:"string",description:"Unique identifier for the GPS device",minLength:1},deviceInfo:{type:"object",description:"Device hardware and software information",required:["model","firmwareVersion"],properties:{model:{type:"string",description:"Device model name",minLength:1},manufacturer:{type:"string",description:"Device manufacturer",minLength:1},firmwareVersion:{type:"string",description:"Current firmware version",pattern:"^\\d+\\.\\d+\\.\\d+$"},serialNumber:{type:"string",description:"Device serial number",pattern:"^[A-Z0-9]{8,16}$"},batteryLevel:{type:"number",description:"Battery level percentage",minimum:0,maximum:100},lastMaintenance:{type:"string",description:"Last maintenance date",format:"date"}}},location:{type:"object",description:"Current GPS location data",required:["latitude","longitude","accuracy"],properties:{latitude:{type:"number",description:"Latitude coordinate in decimal degrees",minimum:-90,maximum:90},longitude:{type:"number",description:"Longitude coordinate in decimal degrees",minimum:-180,maximum:180},accuracy:{type:"number",description:"GPS accuracy in meters",minimum:0,maximum:1e3},altitude:{type:"number",description:"Altitude above sea level in meters",minimum:-1e3,maximum:1e4},heading:{type:"number",description:"Direction of movement in degrees",minimum:0,maximum:360},speed:{type:"number",description:"Speed in meters per second",minimum:0,maximum:100},satellites:{type:"integer",description:"Number of GPS satellites in view",minimum:0,maximum:32}}},timestamp:{type:"string",description:"ISO 8601 timestamp of location reading",format:"date-time"},environmental:{type:"object",description:"Environmental sensor data if available",properties:{temperature:{type:"number",description:"Ambient temperature in Celsius",minimum:-50,maximum:80},humidity:{type:"number",description:"Relative humidity percentage",minimum:0,maximum:100},pressure:{type:"number",description:"Atmospheric pressure in hPa",minimum:800,maximum:1200}}},connectivity:{type:"object",description:"Communication and connectivity status",required:["status"],properties:{status:{type:"string",description:"Connection status",enum:["online","offline","error","maintenance"]},signalStrength:{type:"number",description:"Signal strength in dBm",minimum:-120,maximum:-30},lastSync:{type:"string",description:"Last successful data sync timestamp",format:"date-time"},protocol:{type:"string",description:"Communication protocol used",enum:["4G","5G","WiFi","Satellite"]}}},alerts:{type:"array",description:"Active alerts and notifications",items:{type:"object",required:["type","message","severity"],properties:{type:{type:"string",description:"Alert type",enum:["low_battery","out_of_range","maintenance_due","error"]},message:{type:"string",description:"Alert description",minLength:1},severity:{type:"string",description:"Alert severity level",enum:["low","medium","high","critical"]},timestamp:{type:"string",description:"When the alert was generated",format:"date-time"}}}}}}},cellular_tracking:{title:"Cellular Mobile Tracking",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"CellularMobileTracking",type:"object",required:["mobileNumber","trackingData","timestamp"],properties:{mobileNumber:{type:"string",description:"Mobile phone number being tracked",pattern:"^\\+[1-9]\\d{1,14}$"},subscriberInfo:{type:"object",description:"Mobile subscriber identification and details",required:["imsi","msisdn"],properties:{imsi:{type:"string",description:"International Mobile Subscriber Identity",pattern:"^[0-9]{14,15}$"},msisdn:{type:"string",description:"Mobile Station International Subscriber Directory Number",pattern:"^[0-9]{12,15}$"},iccid:{type:"string",description:"Integrated Circuit Card Identifier",pattern:"^[0-9]{19,20}$"},carrier:{type:"string",description:"Mobile network operator name",minLength:1},planType:{type:"string",description:"Subscription plan type",enum:["prepaid","postpaid","corporate"]}}},trackingData:{type:"object",description:"Real-time location and movement tracking information",required:["cellTower","signalStrength"],properties:{cellTower:{type:"object",description:"Current serving cell tower information",required:["cellId","lac","mcc","mnc"],properties:{cellId:{type:"integer",description:"Cell tower identifier",minimum:1,maximum:65535},lac:{type:"integer",description:"Location Area Code",minimum:1,maximum:65535},mcc:{type:"integer",description:"Mobile Country Code",minimum:100,maximum:999},mnc:{type:"integer",description:"Mobile Network Code",minimum:0,maximum:999},coordinates:{type:"object",description:"Cell tower geographic coordinates",properties:{latitude:{type:"number",description:"Tower latitude",minimum:-90,maximum:90},longitude:{type:"number",description:"Tower longitude",minimum:-180,maximum:180}}}}},signalStrength:{type:"number",description:"Signal strength in dBm",minimum:-120,maximum:-30},networkType:{type:"string",description:"Current network technology",enum:["2G","3G","4G","5G"]},roaming:{type:"boolean",description:"Whether device is roaming"},estimatedLocation:{type:"object",description:"Estimated device location based on cell tower triangulation",properties:{latitude:{type:"number",description:"Estimated latitude",minimum:-90,maximum:90},longitude:{type:"number",description:"Estimated longitude",minimum:-180,maximum:180},accuracy:{type:"number",description:"Location accuracy in meters",minimum:100,maximum:5e4}}}}},timestamp:{type:"string",description:"Tracking data timestamp",format:"date-time"},movement:{type:"object",description:"Movement and velocity information",properties:{speed:{type:"number",description:"Movement speed in km/h",minimum:0,maximum:500},direction:{type:"number",description:"Movement direction in degrees",minimum:0,maximum:360},acceleration:{type:"number",description:"Acceleration in m/s²",minimum:-50,maximum:50},stationary:{type:"boolean",description:"Whether device is currently stationary"}}},callLog:{type:"array",description:"Recent call activity log",items:{type:"object",required:["type","timestamp","duration"],properties:{type:{type:"string",description:"Call type",enum:["incoming","outgoing","missed"]},timestamp:{type:"string",description:"Call timestamp",format:"date-time"},duration:{type:"integer",description:"Call duration in seconds",minimum:0},number:{type:"string",description:"Phone number involved in call",pattern:"^\\+[1-9]\\d{1,14}$"}}}},dataUsage:{type:"object",description:"Mobile data consumption statistics",properties:{currentPeriod:{type:"integer",description:"Data used in current billing period (MB)",minimum:0},totalLimit:{type:"integer",description:"Total data limit for period (MB)",minimum:0},lastReset:{type:"string",description:"Last data reset date",format:"date"}}}}}},license_plate:{title:"License Plate Identification",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"LicensePlateIdentification",type:"object",required:["plateNumber","detectionData","timestamp"],properties:{plateNumber:{type:"string",description:"Identified license plate number",pattern:"^[A-Z0-9\\-\\s]{2,12}$"},vehicleInfo:{type:"object",description:"Vehicle information associated with the license plate",required:["make","model"],properties:{make:{type:"string",description:"Vehicle manufacturer brand",minLength:1},model:{type:"string",description:"Vehicle model name",minLength:1},year:{type:"integer",description:"Vehicle manufacturing year",minimum:1900,maximum:2030},color:{type:"string",description:"Primary vehicle color",minLength:1},bodyType:{type:"string",description:"Vehicle body style",enum:["sedan","suv","truck","motorcycle","bus","van"]},fuelType:{type:"string",description:"Vehicle fuel type",enum:["gasoline","diesel","electric","hybrid","hydrogen"]}}},detectionData:{type:"object",description:"License plate detection and recognition details",required:["confidence","imageQuality"],properties:{confidence:{type:"number",description:"Recognition confidence score (0-100)",minimum:0,maximum:100},imageQuality:{type:"string",description:"Image quality assessment",enum:["excellent","good","fair","poor"]},processingTime:{type:"number",description:"Processing time in milliseconds",minimum:0,maximum:1e4},algorithm:{type:"string",description:"Recognition algorithm used",minLength:1},ocrVersion:{type:"string",description:"OCR software version",pattern:"^\\d+\\.\\d+\\.\\d+$"}}},timestamp:{type:"string",description:"Detection timestamp",format:"date-time"},location:{type:"object",description:"Location where the license plate was detected",required:["cameraId","coordinates"],properties:{cameraId:{type:"string",description:"Unique camera identifier",minLength:1},coordinates:{type:"object",description:"Geographic coordinates of detection point",required:["latitude","longitude"],properties:{latitude:{type:"number",description:"Detection latitude",minimum:-90,maximum:90},longitude:{type:"number",description:"Detection longitude",minimum:-180,maximum:180},altitude:{type:"number",description:"Detection altitude in meters",minimum:-1e3,maximum:1e4}}},address:{type:"string",description:"Human-readable address of detection point"},zone:{type:"string",description:"Traffic zone or area designation"}}},imageData:{type:"object",description:"Captured image and processing information",required:["imageUrl"],properties:{imageUrl:{type:"string",description:"URL to captured image",format:"uri"},thumbnailUrl:{type:"string",description:"URL to thumbnail version",format:"uri"},imageFormat:{type:"string",description:"Image file format",enum:["JPEG","PNG","BMP","TIFF"]},resolution:{type:"string",description:"Image resolution (width x height)",pattern:"^\\d+x\\d+$"},fileSize:{type:"integer",description:"Image file size in bytes",minimum:1}}},trafficViolations:{type:"array",description:"Traffic violations associated with this vehicle",items:{type:"object",required:["type","timestamp","location"],properties:{type:{type:"string",description:"Violation type",enum:["speeding","red_light","parking","toll_evasion","other"]},timestamp:{type:"string",description:"Violation timestamp",format:"date-time"},location:{type:"string",description:"Violation location description"},fine:{type:"number",description:"Fine amount in local currency",minimum:0},status:{type:"string",description:"Violation status",enum:["pending","paid","disputed","dismissed"]}}}},registration:{type:"object",description:"Vehicle registration and ownership information",properties:{ownerName:{type:"string",description:"Registered owner name",minLength:1},registrationDate:{type:"string",description:"Registration date",format:"date"},expiryDate:{type:"string",description:"Registration expiry date",format:"date"},insurance:{type:"object",description:"Insurance policy details",properties:{provider:{type:"string",description:"Insurance company name"},policyNumber:{type:"string",description:"Insurance policy number"},expiryDate:{type:"string",description:"Insurance expiry date",format:"date"}}}}}}}},product:{title:"Product",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"Product",type:"object",required:["name","price","category"],properties:{name:{type:"string",description:"Product name",minLength:1},price:{type:"number",minimum:0,description:"Product price"},category:{type:"string",description:"Product category"},description:{type:"string",description:"Product description"},inStock:{type:"boolean",description:"Product availability"},tags:{type:"array",items:{type:"string"}}}}},order:{title:"Order",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"Order",type:"object",required:["orderId","customer","items"],properties:{orderId:{type:"string",description:"Unique order identifier"},customer:{type:"object",properties:{name:{type:"string"},email:{type:"string",format:"email"}}},items:{type:"array",items:{type:"object",properties:{productId:{type:"string"},quantity:{type:"integer",minimum:1},price:{type:"number",minimum:0}}}}}}},optional_hierarchy_demo:{title:"Optional hierarchy demo",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"OptionalHierarchyDemo",type:"object",required:["userId"],properties:{userId:{type:"string",description:"Unique user identifier",minLength:1},profile:{type:"object",description:"Optional profile. If present, name and email are mandatory",required:["name","email"],properties:{name:{type:"string",description:"Full name",minLength:1},email:{type:"string",description:"Email",format:"email"},bio:{type:"string",description:"Short biography",maxLength:200},address:{type:"object",description:"Optional address. If present, street and city are mandatory",required:["street","city"],properties:{street:{type:"string",minLength:1},city:{type:"string",minLength:1},country:{type:"string"},zip:{type:"string",pattern:"^[0-9]{5}(?:-[0-9]{4})?$"}}}}},attachments:{type:"array",description:"Optional attachments. If used, fileName is mandatory",items:{type:"object",required:["fileName"],properties:{fileName:{type:"string",minLength:1},mimeType:{type:"string",pattern:"^[-w.]+/[-w.]+$"},sizeKb:{type:"integer",minimum:1}}}}}}},user_management:{title:"User Management System",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"UserManagement",type:"object",required:["userId","profile","account"],properties:{userId:{type:"string",description:"Unique identifier for the user",minLength:1},profile:{type:"object",description:"User profile information",required:["firstName","lastName","email","gender","preferredLanguage"],properties:{firstName:{type:"string",description:"User first name",minLength:1},lastName:{type:"string",description:"User last name",minLength:1},email:{type:"string",description:"User email address",format:"email"},phoneNumber:{type:"string",description:"User phone number",pattern:"^\\+[1-9]\\d{1,14}$"},dateOfBirth:{type:"string",description:"User date of birth",format:"date"},gender:{type:"string",description:"User gender identity",enum:["male","female","non-binary","prefer-not-to-say","other"]},preferredLanguage:{type:"string",description:"User preferred language for communication",enum:["hebrew","english","arabic","russian","french","spanish"]},nationality:{type:"string",description:"User nationality",minLength:1},timezone:{type:"string",description:"User preferred timezone",enum:["Asia/Jerusalem","America/New_York","Europe/London","Asia/Tokyo","Australia/Sydney"]}}},account:{type:"object",description:"User account settings and status",required:["username","status","role","registrationDate"],properties:{username:{type:"string",description:"Unique username",pattern:"^[a-zA-Z0-9_]{3,20}$"},status:{type:"string",description:"Current account status",enum:["active","inactive","suspended","pending_verification","blocked"]},role:{type:"string",description:"User role in the system",enum:["admin","moderator","user","premium_user","guest"]},registrationDate:{type:"string",description:"Account creation date",format:"date-time"},lastLogin:{type:"string",description:"Last login timestamp",format:"date-time"},emailVerified:{type:"boolean",description:"Whether email address is verified"},twoFactorEnabled:{type:"boolean",description:"Whether two-factor authentication is enabled"},subscriptionType:{type:"string",description:"User subscription plan",enum:["free","basic","premium","enterprise"]},subscriptionStatus:{type:"string",description:"Current subscription status",enum:["trial","active","expired","cancelled","past_due"]}}},preferences:{type:"object",description:"User preferences and settings",properties:{theme:{type:"string",description:"Preferred UI theme",enum:["light","dark","auto","high_contrast"]},notificationSettings:{type:"object",description:"Notification preferences",properties:{emailNotifications:{type:"boolean",description:"Receive email notifications"},pushNotifications:{type:"boolean",description:"Receive push notifications"},smsNotifications:{type:"boolean",description:"Receive SMS notifications"},marketingEmails:{type:"boolean",description:"Receive marketing emails"},notificationFrequency:{type:"string",description:"How often to receive notifications",enum:["real-time","daily_digest","weekly_summary","never"]}}},privacySettings:{type:"object",description:"Privacy and data sharing preferences",properties:{profileVisibility:{type:"string",description:"Who can see user profile",enum:["public","friends_only","private"]},dataSharing:{type:"string",description:"Data sharing preferences",enum:["share_all","share_necessary","share_none"]},cookieConsent:{type:"string",description:"Cookie usage consent",enum:["all_cookies","essential_only","no_cookies"]}}},languageAndRegion:{type:"object",description:"Language and regional preferences",properties:{displayLanguage:{type:"string",description:"Language for UI display",enum:["he","en","ar","ru","fr","es"]},dateFormat:{type:"string",description:"Preferred date format",enum:["DD/MM/YYYY","MM/DD/YYYY","YYYY-MM-DD"]},timeFormat:{type:"string",description:"Preferred time format",enum:["12h","24h"]},currency:{type:"string",description:"Preferred currency",enum:["ILS","USD","EUR","GBP","JPY"]}}}}},security:{type:"object",description:"Security-related information",properties:{passwordLastChanged:{type:"string",description:"When password was last changed",format:"date-time"},failedLoginAttempts:{type:"integer",description:"Number of failed login attempts",minimum:0},accountLocked:{type:"boolean",description:"Whether account is currently locked"},securityQuestions:{type:"array",description:"Security questions for account recovery",items:{type:"object",required:["question","answer"],properties:{question:{type:"string",description:"Security question",enum:["What was your first pet's name?","What is your mother's maiden name?","What was the name of your elementary school?","What is your favorite childhood memory?","What city were you born in?"]},answer:{type:"string",description:"Answer to security question",minLength:1}}}},loginDevices:{type:"array",description:"Authorized devices for login",items:{type:"object",required:["deviceId","deviceType","lastAccess"],properties:{deviceId:{type:"string",description:"Unique device identifier",minLength:1},deviceType:{type:"string",description:"Type of device",enum:["desktop","laptop","tablet","mobile","smart_tv","gaming_console"]},lastAccess:{type:"string",description:"Last access timestamp",format:"date-time"},trustedDevice:{type:"boolean",description:"Whether this is a trusted device"}}}}}},activity:{type:"object",description:"User activity and engagement data",properties:{totalLogins:{type:"integer",description:"Total number of logins",minimum:0},lastActivityDate:{type:"string",description:"Date of last activity",format:"date"},sessionDuration:{type:"integer",description:"Average session duration in minutes",minimum:0},featuresUsed:{type:"array",description:"List of features used by the user",items:{type:"string",enum:["dashboard","profile_management","data_export","reports","settings","support","notifications","search","file_upload","data_analysis"]}},engagementLevel:{type:"string",description:"User engagement level",enum:["very_low","low","medium","high","very_high"]}}}}}}},we=({onBack:e})=>{var t;const{isLoading:r}=(()=>{try{return X()}catch(e){return{isLoading:!1}}})(),[n,i]=x.useState(""),[a,o]=x.useState(""),[s,d]=x.useState(null),[c,p]=x.useState(""),[g,h]=x.useState(!1),[m,f]=x.useState(!1),y=e=>{i(e),e.trim()||(d(null),p(""))};return u.jsxs("div",{style:{width:"100vw",minHeight:"100vh",height:"100vh",overflow:"auto",background:"transparent",color:"var(--text)",fontFamily:"Segoe UI, sans-serif",padding:"40px 60px 80px 60px",position:"fixed",top:"80px",left:0,direction:"rtl",scrollbarWidth:"thin",scrollbarColor:"var(--accent) var(--panel)",boxSizing:"border-box",display:"flex",flexDirection:"column",gap:"32px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"20px",position:"relative",width:"100%"},children:[e&&u.jsx("button",{onClick:e,style:{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",padding:"12px 20px",cursor:"pointer",fontSize:"14px",fontFamily:"Segoe UI, sans-serif",position:"absolute",left:0,zIndex:1},children:"← חזור"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[u.jsx("h1",{style:{fontSize:"40px",fontWeight:"700",color:"var(--accent)",margin:"0 0 8px 0",textAlign:"center"},children:"בודק תקינות JSON"}),u.jsx("p",{style:{fontSize:"16px",color:"var(--muted)",margin:0,textAlign:"center"},children:'בדוק אם הדג"ח שלך עומד בתקן הענק'})]})]}),u.jsxs("div",{style:{display:"flex",gap:"24px",alignItems:"end",justifyContent:"flex-start",width:"100%",margin:"0"},children:[u.jsxs("div",{style:{position:"relative"},children:[u.jsx("label",{style:{display:"block",fontSize:"16px",fontWeight:"400",marginBottom:"8px",color:"var(--text)"},children:'בחר תקן, הכנס דג"ח JSON ולחץ על כפתור "בדוק תקינות" בשביל לבדוק האם הדג"ח שלך עומד בסכמה'}),u.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[u.jsxs("button",{onClick:()=>f(!m),style:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"transparent",color:"var(--text)",borderRadius:"12px",padding:"8px 14px",cursor:"pointer",transition:"transform 120ms ease",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",width:"100%",minWidth:"500px",display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"center",alignSelf:"center",boxShadow:"none",justifySelf:"center"},onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[u.jsx("span",{children:a?null==(t=ve[a])?void 0:t.title:"בחר תקן..."}),u.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),m&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[u.jsx("div",{onClick:()=>{o(""),d(null),p(""),f(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl",justifyContent:"right",display:"absolute"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"בחר תקן..."}),Object.entries(ve).map(([e,t])=>u.jsx("div",{onClick:()=>{o(e),d(null),p(""),f(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl",background:a===e?"rgba(124,192,255,0.15)":"transparent"},onMouseEnter:t=>{a!==e&&(t.target.style.background="rgba(255,255,255,0.08)")},onMouseLeave:t=>{a!==e&&(t.target.style.background="transparent")},children:t.title},e))]})]})]}),u.jsx("button",{onClick:()=>{var e;if(!a||!n.trim())return d(null),void p("");h(!0);try{const t=JSON.parse(n),r=null==(e=ve[a])?void 0:e.schema;if(!r)return d({isValid:!1,errors:[{path:"schema",message:"סכמה לא נמצאה"}],warnings:[]}),void p("");const i=((e,t)=>{const r=[],n=((e,t="")=>{const r=new Map,n=(e,t)=>{if(e&&"object"==typeof e&&e.properties)for(const[i,a]of Object.entries(e.properties)){const e=t?`${t}.${i}`:i;r.has(i)||r.set(i,[]),r.get(i).push(e),a&&"object"==typeof a&&"properties"in a&&n(a,e),a&&"object"==typeof a&&"items"in a&&a.items&&"object"==typeof a.items&&"properties"in a.items&&n(a.items,`${e}[*]`)}};return n(e,t),r})(t),i=(e,t,n="",a,o)=>{if(a&&t.type){if("object"===t.type&&"object"!=typeof e)return void r.push({path:n,message:`שדה "${n}" צריך להיות אובייקט אבל קיבלנו ${typeof e}`,value:e,suggestion:`שדה "${n}" צריך להיות אובייקט עם מאפיינים, לא ${typeof e}`});if("array"===t.type&&!Array.isArray(e))return void r.push({path:n,message:`שדה "${n}" צריך להיות מערך אבל קיבלנו ${typeof e}`,value:e,suggestion:`שדה "${n}" צריך להיות מערך של פריטים, לא ${typeof e}`})}if(t.required&&Array.isArray(t.required))for(const i of t.required)if(!(i in e)){const t=n?`${n}.${i}`:i,o=a?` תחת "${a}"`:"";r.push({path:t,message:`שדה חובה חסר: ${i}${o}`,value:e[i],suggestion:`הוסף את השדה "${i}" עם ערך מתאים${o}`})}if(t.properties&&"object"==typeof t.properties){for(const[a,s]of Object.entries(t.properties)){const l=n?`${n}.${a}`:a,d=e[a];if(void 0!==d){if(s&&"object"==typeof s&&"type"in s){const e=s.type,t=Array.isArray(d)?"array":typeof d;if(e!==t){const n={string:"מחרוזת",number:"מספר",integer:"מספר שלם",boolean:"בוליאני",object:"אובייקט",array:"מערך"};r.push({path:l,message:`סוג שגוי בשדה "${a}": מצופה ${n[e]||e}, התקבל ${n[t]||t}`,value:d,suggestion:`שנה את "${l}" ל${n[e]||e}`})}}s&&"object"==typeof s&&"minLength"in s&&"string"==typeof d&&d.length<s.minLength&&r.push({path:l,message:`אורך מחרוזת קצר מדי בשדה "${a}": מינימום ${s.minLength} תווים, התקבל ${d.length}`,value:d,suggestion:`הוסף עוד ${s.minLength-d.length} תווים לשדה "${a}"`}),s&&"object"==typeof s&&"pattern"in s&&"string"==typeof d&&(new RegExp(s.pattern).test(d)||r.push({path:l,message:`פורמט לא תקין בשדה "${a}": לא תואם לתבנית ${s.pattern}`,value:d,suggestion:`שנה את "${a}" כך שיתאים לתבנית ${s.pattern}`})),s&&"object"==typeof s&&"minimum"in s&&"number"==typeof d&&d<s.minimum&&r.push({path:l,message:`ערך נמוך מדי בשדה "${a}": מינימום ${s.minimum}, התקבל ${d}`,value:d,suggestion:`הגדל את "${a}" ל${s.minimum} או יותר`}),s&&"object"==typeof s&&"maximum"in s&&"number"==typeof d&&d>s.maximum&&r.push({path:l,message:`ערך גבוה מדי בשדה "${a}": מקסימום ${s.maximum}, התקבל ${d}`,value:d,suggestion:`הקטן את "${a}" ל${s.maximum} או פחות`}),s&&"object"==typeof s&&"enum"in s&&Array.isArray(s.enum)&&(s.enum.includes(d)||r.push({path:l,message:`ערך לא חוקי בשדה "${a}": "${d}" לא נמצא ברשימת הערכים המותרים`,value:d,suggestion:`בחר ערך מתוך: ${s.enum.join(", ")} עבור "${a}"`})),s&&"object"==typeof s&&"properties"in s&&"object"==typeof d&&null!==d&&i(d,s,l,a,o),s&&"object"==typeof s&&"items"in s&&Array.isArray(d)&&d.forEach((e,t)=>{"object"==typeof e&&null!==e&&i(e,s.items,`${l}[${t}]`,`${a}[${t}]`,o)})}else if(t.properties&&!(a in t.properties)){const e=Object.keys(t.properties).join(", ");r.push({path:l,message:`שדה לא צפוי "${a}" מחוץ למבנה התקין`,value:d,suggestion:`הסר את "${a}" או הזז אותו למקום הנכון. שדות זמינים: ${e}`})}}for(const i of Object.keys(e))if(!(i in t.properties)){const a=n?`${n}.${i}`:i,s=Object.keys(t.properties).join(", "),l=null==o?void 0:o.get(i);let d=`הסר את "${i}" או הוסף אותו לתקן. שדות זמינים: ${s}`;if(l&&l.length>0){const e=l.filter(e=>e!==a);if(e.length>0){const t=e[0],r=t.split(".");r[r.length-1],d=`שדה "${i}" נמצא במקום שגוי. השדה צריך להיות תחת "${r.slice(0,-1).join(" → ")}" ולא תחת "${n||"השורש"}". השדה צריך להיות בנתיב: ${t}`}}r.push({path:a,message:`שדה לא צפוי "${i}" - אינו מוגדר בתקן`,value:e[i],suggestion:d})}}};try{i(e,t,"",void 0,n)}catch($e){r.push({path:"root",message:`שגיאה קריטית במהלך בדיקת התקינות: ${$e instanceof Error?$e.message:"שגיאה לא ידועה"}`,value:e,suggestion:"בדוק שה-JSON תקין מבחינה תחבירית"})}return{isValid:0===r.length,errors:r,warnings:[]}})(t,r);d(i),p(n)}catch($e){d({isValid:!1,errors:[{path:"json",message:`JSON לא תקין: ${$e instanceof Error?$e.message:"שגיאה לא ידועה"}`}],warnings:[]}),p("")}finally{h(!1)}},disabled:!a||!n.trim()||g,style:{padding:"12px 24px",background:a&&n.trim()&&!g?"linear-gradient(135deg, #4CAF50, #45a049)":"rgba(255,255,255,0.05)",border:a&&n.trim()&&!g?"1px solid #4CAF50":"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",color:a&&n.trim()&&!g?"white":"rgba(255,255,255,0.4)",fontSize:"14px",fontWeight:"600",cursor:a&&n.trim()&&!g?"pointer":"not-allowed",fontFamily:"Segoe UI, sans-serif",width:"160px",height:"44.89px",marginRight:"auto",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s ease",opacity:a&&n.trim()&&!g?1:.6},children:g?"בודק...":"בדוק תקינות"}),u.jsx("button",{onClick:()=>{i(""),o(""),d(null),p("")},style:{padding:"12px 24px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",fontFamily:"Segoe UI, sans-serif",width:"120px",height:"44.89px",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center"},children:"נקה הכל"})]}),u.jsxs("div",{style:{display:"flex",gap:"24px",width:"100%",paddingBottom:"20px",margin:"0"},children:[u.jsx("div",{style:{width:"30%",margin:"0"},children:u.jsx("textarea",{value:n,onChange:e=>y(e.target.value),onPaste:e=>{const t=e.clipboardData.getData("text");try{const r=JSON.parse(t),n=JSON.stringify(r,null,2);e.preventDefault(),y(n)}catch($e){try{let r=t.replace(/,\s*}/g,"}").replace(/,\s*]/g,"]").replace(/^,\s*{/g,"{").replace(/^,\s*\[/g,"[").replace(/"(\d+(?:\.\d+)?)"/g,"$1").replace(/}\s*:\s*"/g,',"').replace(/}\s*:\s*{/g,",{").replace(/,,+/g,",").replace(/^\s*,/gm,"").trim();r.startsWith("{")||r.startsWith("[")||(r="{"+r+"}");const n=JSON.parse(r),i=JSON.stringify(n,null,2);e.preventDefault(),y(i)}catch(r){}}},onKeyDown:e=>{if((e.ctrlKey||e.metaKey)&&"Enter"===e.key){e.preventDefault();try{const e=JSON.parse(n),t=JSON.stringify(e,null,2);y(t)}catch($e){}}},placeholder:"הדבק כאן את קובץ ה-JSON שברצונך לבדוק...",style:{width:"100%",minHeight:"400px",padding:"16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontFamily:'Monaco, Menlo, "DejaVu Sans Mono", monospace',outline:"none",resize:"none",lineHeight:"1.5",height:"800px",direction:"ltr",textAlign:"left"}})}),u.jsx("div",{style:{width:"40%"},children:s?u.jsxs("div",{style:{background:"rgba(255,255,255,0.08)",border:"1px solid "+(s.isValid?"rgba(76,175,80,0.4)":"rgba(244,67,54,0.4)"),borderRadius:"12px",width:"100%",margin:"0",padding:"32px",height:"800px",overflow:"auto",direction:"ltr",textAlign:"left",willChange:"transform",contain:"layout style paint",transform:"translateZ(0)",isolation:"isolate",backfaceVisibility:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",marginBottom:"16px",paddingBottom:"12px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[u.jsx("span",{style:{fontSize:"24px",color:(b=s.isValid,b?"#4caf50":"#f44336")},children:(e=>e?"✅":"❌")(s.isValid)}),u.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",color:"var(--text)",margin:0},children:"תוצאת בדיקת תקינות"})]}),s&&n.trim()&&u.jsxs("div",{style:{marginBottom:"20px"},children:[u.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text)",margin:"0 0 12px 0"}}),u.jsx("div",{style:{background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px",padding:"16px",fontFamily:'Monaco, Menlo, "DejaVu Sans Mono", monospace',fontSize:"13px",lineHeight:"1.6",height:"600px",overflowY:"auto",willChange:"transform",contain:"layout style paint",transform:"translateZ(0)",isolation:"isolate",backfaceVisibility:"hidden"},children:u.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:'Monaco, Menlo, "DejaVu Sans Mono", monospace',fontSize:"13px",lineHeight:"1.6"},children:s?(()=>{var e;try{const t=JSON.parse(c),r=null==(e=ve[a])?void 0:e.schema,n=((e,t,r,n="")=>{try{const t=(e,r,n="")=>{if("object"!=typeof e||null===e||Array.isArray(e))return e;const i=l({},e),a=(null==r?void 0:r.required)||[],o=(null==r?void 0:r.properties)||{};return a.forEach(e=>{if(e in i){if("object"==typeof i[e]&&null!==i[e]&&!Array.isArray(i[e])){const r=n?`${n}.${e}`:e,a=o[e];a&&(i[e]=t(i[e],a,r))}}else i[e]="[שדה חסר]"}),i},i=t(e,r,n);return JSON.stringify(i,null,2)}catch($e){return JSON.stringify(e,null,2)}})(t,null==s||s.errors,r),i=(e,t)=>{const r=new Map;let n=[],i=[],a=[];return t.forEach((e,t)=>{const o=e.trim();o.endsWith("{")&&i.push("{"),o.endsWith("[")&&a.push("["),("}"===o||o.endsWith("},"))&&(i.length>0&&i.pop(),n.length>0&&n.pop()),("]"===o||o.endsWith("],"))&&(a.length>0&&a.pop(),n.length>0&&n.pop());const s=o.match(/^"([^"]+)":/);if(s){const e=s[1],i=n.length>0?[...n,e].join("."):e;r.set(t,i),(o.endsWith("{")||o.endsWith("["))&&n.push(e)}if(a.length>0&&o.match(/^\d+:/)){const e=o.match(/^(\d+):/);if(e){const i=e[1],a=n.length>0?[...n,`[${i}]`].join("."):`[${i}]`;r.set(t,a)}}}),r},o=(e,t,r,n)=>{const i=n.get(r);return!!i&&i===t},d=n.split("\n"),p=i(t,d),g=1e3;return d.slice(0,g).map((e,t)=>{var r;let n=e;if(e.includes("[שדה חסר]")){const e=/("[^"]+"\s*:\s*"[^"]*\[שדה חסר\][^"]*")/g;e.test(n)&&(n=n.replace(e,'<span style="background: rgba(255,235,59,0.6); color: #333; padding: 2px 4px; border-radius: 4px; border: 1px solid rgba(255,235,59,0.8); font-weight: 500;">$1</span>'))}return null==(r=null==s?void 0:s.errors)||r.forEach(r=>{if(o(e,r.path,t,p)&&!e.includes("[שדה חסר]")){const e=r.path.split(".").pop();if(e){const t=new RegExp(`("${e}"\\s*:\\s*[^,}\\]]*[",}])`,"g");n=n.replace(t,'<span style="background: rgba(244,67,54,0.4); color: white; padding: 2px 4px; border-radius: 4px; border: 1px solid rgba(244,67,54,0.6); font-weight: 500;">$1</span>')}}}),u.jsx("div",{dangerouslySetInnerHTML:{__html:n}},t)}).concat(d.length>g?[u.jsxs("div",{style:{padding:"8px",background:"rgba(255,165,0,0.2)",border:"1px solid rgba(255,165,0,0.4)",borderRadius:"4px",marginTop:"8px",fontSize:"12px",color:"#ff9800"},children:["⚠️ JSON גדול מדי - מוצגות רק ",g," שורות ראשונות מתוך ",d.length]},"truncated")]:[])}catch($e){return u.jsxs("span",{style:{color:"#f44336"},children:["JSON לא תקין: ",$e instanceof Error?$e.message:"שגיאה לא ידועה"]})}})():u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center",opacity:.6},children:[u.jsx("div",{style:{fontSize:"48px",marginBottom:"20px",opacity:.6},children:"🔍"}),u.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",color:"var(--text)",margin:"0 0 12px 0"},children:"תוצאת בדיקת תקינות"}),u.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0",lineHeight:"1.5",direction:"rtl"},children:'לחץ על "בדוק תקינות" כדי לראות את תוצאות הבדיקה עם סימון השדות'})]})},"json-display-"+(c?"snapshot":"empty"))}),u.jsxs("div",{style:{marginTop:"18px",fontSize:"12px",color:"var(--muted)",display:"flex",gap:"16px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[u.jsx("div",{style:{width:"12px",height:"12px",background:"rgba(244,67,54,0.4)",borderRadius:"2px"}}),u.jsx("span",{children:"שדות עם שגיאות"})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[u.jsx("div",{style:{width:"12px",height:"12px",background:"rgba(255,235,59,0.6)",borderRadius:"2px"}}),u.jsx("span",{children:"שדות חסרים"})]})]})]}),s.isValid&&u.jsxs("div",{style:{background:"rgba(76,175,80,0.1)",border:"1px solid rgba(76,175,80,0.3)",borderRadius:"8px",padding:"16px",textAlign:"center"},children:[u.jsx("div",{style:{fontSize:"18px",fontWeight:"600",color:"#4caf50",marginBottom:"8px"},children:"✅ JSON תקין!"}),u.jsx("div",{style:{color:"var(--text)",fontSize:"14px"},children:"כל השדות הנדרשים קיימים והערכים תקינים לפי התקן שנבחר."})]})]}):u.jsxs("div",{style:{background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",width:"100%",margin:"0",padding:"32px",height:"700px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",direction:"ltr"},children:[u.jsx("div",{style:{fontSize:"48px",marginBottom:"20px",opacity:.6},children:"📋"}),u.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",color:"var(--text)",margin:"0 0 12px 0"},children:"תוצאות הבדיקה"}),u.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0 0 20px 0",lineHeight:"1.5",direction:"rtl"},children:'הדבק קובץ JSON ולחץ על "בדוק תקינות" כדי לבדוק האם הדג"ח עומד בסכמה שנבחרה'})]})}),u.jsx("div",{style:{width:"30%"},children:s&&s.errors.length>0?u.jsxs("div",{style:{background:"rgba(255,255,255,0.08)",border:"1px solid rgba(244,67,54,0.4)",borderRadius:"12px",width:"100%",margin:"0",marginTop:"0",padding:"32px",height:"800px",overflow:"auto",willChange:"transform",contain:"layout style paint",transform:"translateZ(0)",isolation:"isolate",backfaceVisibility:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px",paddingBottom:"12px",borderBottom:"1px solid rgba(255,255,255,0.1)",justifyContent:"center"},children:[u.jsxs("h3",{style:{fontSize:"20px",fontWeight:"600",color:"var(--text)",justifyContent:"center",margin:0},children:["שגיאות (",s.errors.length,")"]}),u.jsx("span",{style:{fontSize:"24px",color:"#f44336"},children:"❌"})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[s.errors.slice(0,50).map((e,t)=>{const r=e.message.includes("שדה חובה חסר"),n=r?"rgba(255,235,59,0.1)":"rgba(244,67,54,0.1)",i=r?"rgba(255,235,59,0.3)":"rgba(244,67,54,0.3)",a=r?"#ffc107":"#f44336";return u.jsxs("div",{style:{background:n,border:`1px solid ${i}`,borderRadius:"8px",padding:"12px",fontSize:"13px"},children:[u.jsx("div",{style:{fontWeight:"600",color:a,marginBottom:"4px",fontSize:"14px"},children:e.path}),u.jsx("div",{style:{color:a,fontSize:"12px",lineHeight:"1.4"},children:r?"missing required field":e.message.replace(/^[^:]+:\s*/,"")})]},t)}),s.errors.length>50&&u.jsxs("div",{style:{padding:"12px",background:"rgba(255,165,0,0.1)",border:"1px solid rgba(255,165,0,0.3)",borderRadius:"8px",fontSize:"12px",color:"#ff9800",textAlign:"center"},children:["⚠️ מוצגות רק 50 שגיאות ראשונות מתוך ",s.errors.length]})]})]}):u.jsxs("div",{style:{background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",width:"100%",margin:"0",marginTop:"0",padding:"32px",height:"700px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center"},children:[u.jsx("div",{style:{fontSize:"48px",marginBottom:"20px",opacity:.6},children:"✅"}),u.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",color:"var(--text)",margin:"0 0 12px 0"},children:"שגיאות"}),u.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0",lineHeight:"1.5"},children:s?"אין שגיאות":"בצע בדיקה כדי לראות שגיאות"})]})})]}),u.jsx("style",{children:"\n          /* Webkit scrollbar styling */\n          ::-webkit-scrollbar {\n            width: 8px;\n          }\n\n          ::-webkit-scrollbar-track {\n            background: #2d3748;\n            border-radius: 4px;\n          }\n\n          ::-webkit-scrollbar-thumb {\n            background: #7cc0ff;\n            border-radius: 4px;\n          }\n\n          ::-webkit-scrollbar-thumb:hover {\n            background: #5da3e6;\n          }\n        "})]});var b},Se=({isOpen:t,onClose:r})=>{const{login:n,isLoading:i,authMode:a,error:o}=z(),[s,c]=x.useState({username:"",password:""}),g=e=>{const{name:t,value:r}=e.target;c(e=>d(l({},e),{[t]:r}))};return t?u.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,fontFamily:"Segoe UI, Arial, sans-serif"},children:u.jsxs("div",{style:{backgroundColor:"var(--panel)",borderRadius:"12px",padding:"32px",maxWidth:"400px",width:"90%",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",border:"1px solid var(--border)"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[u.jsxs("div",{style:{direction:"rtl"},children:[u.jsx("h2",{style:{margin:0,color:"var(--text)",fontSize:"24px",fontWeight:"600"},children:"התחברות למערכת"}),u.jsxs("div",{style:{fontSize:"14px",color:"var(--muted)",marginTop:"4px"},children:["מצב אימות: ",E(a)]})]}),u.jsx("button",{onClick:r,style:{background:"none",border:"none",color:"var(--muted)",fontSize:"24px",cursor:"pointer",padding:"4px",borderRadius:"4px",transition:"color 0.2s"},onMouseOver:e=>e.currentTarget.style.color="var(--text)",onMouseOut:e=>e.currentTarget.style.color="var(--muted)",children:"×"})]}),u.jsxs("form",{onSubmit:t=>p(e,null,function*(){if(t.preventDefault(),s.username.trim())if(s.password.trim())try{(yield n(s.username,s.password))?(r(),c({username:"",password:""})):o&&window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:o,type:"error",durationMs:3e3}}))}catch(e){window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"שגיאה בהתחברות לשרת",type:"error",durationMs:3e3}}))}else window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"אנא הזן סיסמה",type:"error",durationMs:3e3}}));else window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"אנא הזן שם משתמש",type:"error",durationMs:3e3}}))}),style:{direction:"rtl"},children:[u.jsxs("div",{style:{marginBottom:"20px"},children:[u.jsx("label",{style:{display:"block",marginBottom:"8px",color:"var(--text)",fontWeight:"500",fontSize:"14px"},children:"שם משתמש *"}),u.jsx("input",{type:"text",name:"username",value:s.username,onChange:g,placeholder:"הזן שם משתמש",required:!0,style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid var(--border)",backgroundColor:"var(--bg)",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:e=>e.currentTarget.style.borderColor="var(--accent)",onBlur:e=>e.currentTarget.style.borderColor="var(--border)"})]}),u.jsxs("div",{style:{marginBottom:"24px"},children:[u.jsx("label",{style:{display:"block",marginBottom:"8px",color:"var(--text)",fontWeight:"500",fontSize:"14px"},children:"סיסמה *"}),u.jsx("input",{type:"password",name:"password",value:s.password,onChange:g,placeholder:"הזן סיסמה",required:!0,style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid var(--border)",backgroundColor:"var(--bg)",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:e=>e.currentTarget.style.borderColor="var(--accent)",onBlur:e=>e.currentTarget.style.borderColor="var(--border)"})]}),u.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[u.jsx("button",{type:"button",onClick:r,style:{padding:"12px 24px",borderRadius:"8px",border:"2px solid var(--border)",backgroundColor:"transparent",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",transition:"all 0.2s",direction:"rtl"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="var(--border)",e.currentTarget.style.color="var(--text)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="var(--text)"},children:"ביטול"}),u.jsx("button",{type:"submit",disabled:i,style:{padding:"12px 24px",borderRadius:"8px",border:"none",backgroundColor:i?"var(--muted)":"var(--accent)",color:"white",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:i?"not-allowed":"pointer",transition:"background-color 0.2s",direction:"rtl"},children:i?"מתחבר...":"התחבר"})]})]}),u.jsxs("div",{style:{marginTop:"20px",padding:"16px",backgroundColor:"rgba(124, 192, 255, 0.1)",borderRadius:"8px",border:"1px solid rgba(124, 192, 255, 0.2)",direction:"rtl"},children:[u.jsx("h4",{style:{margin:"0 0 8px 0",color:"var(--text)",fontSize:"14px",fontWeight:"600"},children:"אימות שרת:"}),u.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",lineHeight:"1.4"},children:[u.jsx("div",{children:"ההתחברות מתבצעת לשרת האימות המרכזי ברשת הסגורה"}),u.jsx("div",{children:"ההרשאות נקבעות אוטומטית על בסיס פרטי המשתמש בשרת"}),u.jsxs("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(124, 192, 255, 0.3)"},children:[u.jsx("div",{style:{color:"var(--accent)",fontWeight:"600"},children:"חשבונות דמו לבדיקה:"}),u.jsxs("div",{children:[u.jsx("strong",{children:"מנהל:"})," admin / admin"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"עורך:"})," editor / editor"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"צופה:"})," viewer / viewer"]}),u.jsx("div",{style:{marginTop:"8px",fontSize:"11px",color:"var(--muted)"},children:"או השתמש בשם המשתמש והסיסמה שקיבלת מהמנהל המערכת"})]})]})]})]})}):null},je=()=>{const{user:e,logout:t,canManageUsers:r,authMode:n}=z(),[i,a]=x.useState(!1);return e?u.jsxs("div",{style:{position:"relative",direction:"rtl"},children:[u.jsxs("button",{onClick:()=>a(!i),style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 14px",maxHeight:"35px",backgroundColor:"var(--panel)",border:"1px solid var(--border)",borderRadius:"12px",color:"var(--text)",fontSize:"10px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",transition:"all 0.2s",direction:"rtl"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="var(--border)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="var(--panel)"},children:[u.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",backgroundColor:"var(--accent)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"14px",fontWeight:"600"},children:e.name.charAt(0).toUpperCase()}),u.jsxs("div",{style:{textAlign:"right"},children:[u.jsx("div",{style:{fontWeight:"600",fontSize:"12px"},children:e.name}),u.jsx("div",{style:{fontSize:"10px",color:"var(--muted)",marginTop:"2px"},children:I(e.role)})]}),u.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",transform:i?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},children:"▼"})]}),i&&u.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"4px",backgroundColor:"var(--panel)",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:1e3,minWidth:"200px",direction:"rtl"},children:[u.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--border)"},children:[u.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"var(--text)",marginBottom:"4px"},children:e.name}),u.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",marginBottom:"2px"},children:e.email}),u.jsx("div",{style:{fontSize:"12px",color:"var(--accent)",fontWeight:"500"},children:I(e.role)}),u.jsx("div",{style:{fontSize:"10px",color:"var(--muted)",marginTop:"2px"},children:E(n)})]}),u.jsxs("div",{style:{padding:"8px"},children:[r()&&u.jsx("button",{onClick:()=>{window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"פונקציונליות ניהול משתמשים תהיה זמינה בקרוב",type:"info",durationMs:3e3}})),a(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",color:"var(--accent)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",borderRadius:"8px",transition:"background-color 0.2s",textAlign:"right",direction:"rtl",marginBottom:"8px"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="rgba(124, 192, 255, 0.1)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent"},children:"👥 ניהול משתמשים"}),u.jsx("button",{onClick:()=>{t(),a(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",borderRadius:"8px",transition:"background-color 0.2s",textAlign:"right",direction:"rtl"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="rgba(255, 0, 0, 0.1)",e.currentTarget.style.color="#ff4444"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="var(--text)"},children:"התנתק"})]})]}),i&&u.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:999},onClick:()=>a(!1)})]}):null};function ke({isOpen:e,onClose:t}){const{user:r,canManageUsers:n}=z(),[i,a]=x.useState([]),[o,s]=x.useState(null),[c,p]=x.useState(!1),[g,h]=x.useState(!1),[m,f]=x.useState(null),[y,b]=x.useState({name:"",email:"",role:"viewer"});x.useEffect(()=>{e&&v()},[e]),x.useEffect(()=>{const e=e=>{g&&h(!1),m&&f(null)};return(g||m)&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[g,m]);const v=()=>{try{const e=localStorage.getItem("admin_users");if(e){const t=JSON.parse(e);a(t)}else r&&a([r])}catch($e){a([])}},w=e=>{try{localStorage.setItem("admin_users",JSON.stringify(e)),a(e)}catch($e){window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"שגיאה בשמירת משתמשים",type:"error",durationMs:3e3}}))}},S=()=>{if(!o)return;const e=i.map(e=>e.id===o.id?o:e);w(e),s(null),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`משתמש ${o.name} עודכן בהצלחה`,type:"ok",durationMs:3e3}}))};return e&&n()?u.jsx("div",{className:"permission-manager-overlay",onClick:t,children:u.jsxs("div",{className:"permission-manager-modal",onClick:e=>e.stopPropagation(),children:[u.jsxs("div",{className:"permission-manager-header",children:[u.jsx("h2",{style:{margin:0,color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif"},children:"ניהול הרשאות משתמשים"}),u.jsx("button",{className:"close-button",onClick:t,style:{background:"none",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:"4px 8px"},children:"×"})]}),u.jsxs("div",{className:"permission-manager-content",children:[u.jsxs("div",{className:"add-user-section",children:[u.jsx("button",{className:"btn primary",onClick:()=>p(!c),style:{marginBottom:"16px"},children:c?"ביטול":"הוסף משתמש חדש"}),c&&u.jsx("div",{className:"add-user-form",style:{background:"rgba(255,255,255,0.1)",padding:"16px",borderRadius:"8px",marginBottom:"20px",border:"1px solid rgba(255,255,255,0.2)"},children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[u.jsx("input",{type:"text",placeholder:"שם משתמש",value:y.name||"",onChange:e=>b(d(l({},y),{name:e.target.value})),style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.1)",color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl"}}),u.jsx("input",{type:"email",placeholder:"אימייל",value:y.email||"",onChange:e=>b(d(l({},y),{email:e.target.value})),style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.1)",color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl"}}),u.jsxs("div",{className:"action-dropdown",style:{position:"relative",width:"100%"},children:[u.jsxs("button",{className:"btn ghost",onClick:()=>h(!g),style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.1)",color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl",display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"right"},children:[u.jsx("span",{children:I(y.role||"viewer")}),u.jsx("span",{style:{fontSize:"10px",opacity:.7},children:"▼"})]}),g&&u.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"rgba(0,0,0,0.9)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",zIndex:1e3,marginTop:"4px"},children:["viewer","editor","admin"].map(e=>u.jsx("button",{onClick:()=>{b(d(l({},y),{role:e})),h(!1)},style:{width:"100%",padding:"8px 12px",background:"transparent",border:"none",color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",textAlign:"right",direction:"rtl",borderBottom:"admin"!==e?"1px solid rgba(255,255,255,0.1)":"none"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="rgba(124,192,255,0.1)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent"},children:I(e)},e))})]}),u.jsxs("div",{style:{display:"flex",gap:"8px"},children:[u.jsx("button",{className:"btn primary",onClick:()=>{if(!y.name||!y.email)return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"יש למלא שם ואימייל",type:"warn",durationMs:3e3}}));if(i.some(e=>e.email===y.email))return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"משתמש עם אימייל זה כבר קיים",type:"warn",durationMs:3e3}}));const e={id:`user_${Date.now()}`,name:y.name,email:y.email,role:y.role,lastLogin:(new Date).toISOString()},t=[...i,e];w(t),b({name:"",email:"",role:"viewer"}),p(!1),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`משתמש ${e.name} נוסף בהצלחה`,type:"ok",durationMs:3e3}}))},style:{flex:1},children:"הוסף"}),u.jsx("button",{className:"btn ghost",onClick:()=>{p(!1),b({name:"",email:"",role:"viewer"})},style:{flex:1},children:"ביטול"})]})]})})]}),u.jsxs("div",{className:"users-list",children:[u.jsx("h3",{style:{color:"#fff",marginBottom:"16px",fontFamily:"Segoe UI, Arial, sans-serif"},children:"רשימת משתמשים"}),0===i.length?u.jsx("div",{style:{color:"#ccc",textAlign:"center",padding:"20px"},children:"אין משתמשים רשומים"}):u.jsx("div",{className:"users-table",children:i.map(e=>u.jsxs("div",{className:"user-row",style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px",background:"rgba(255,255,255,0.05)",borderRadius:"6px",marginBottom:"8px",border:"1px solid rgba(255,255,255,0.1)"},children:[u.jsxs("div",{className:"user-info",style:{flex:1},children:[u.jsx("div",{style:{color:"#fff",fontWeight:"bold",fontFamily:"Segoe UI, Arial, sans-serif"},children:e.name}),u.jsx("div",{style:{color:"#ccc",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif"},children:e.email}),e.lastLogin&&u.jsxs("div",{style:{color:"#999",fontSize:"12px",fontFamily:"Segoe UI, Arial, sans-serif"},children:["התחברות אחרונה: ",new Date(e.lastLogin).toLocaleString("he-IL")]})]}),u.jsx("div",{className:"user-actions",style:{display:"flex",alignItems:"center",gap:"8px"},children:(null==o?void 0:o.id)===e.id?u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[u.jsxs("div",{className:"action-dropdown",style:{position:"relative"},children:[u.jsxs("button",{className:"btn ghost",onClick:()=>f(o.id===m?null:o.id),style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.1)",color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl",display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"right",minWidth:"80px"},children:[u.jsx("span",{children:I(o.role)}),u.jsx("span",{style:{fontSize:"8px",opacity:.7},children:"▼"})]}),m===o.id&&u.jsx("div",{style:{position:"absolute",top:"100%",right:0,background:"rgba(0,0,0,0.9)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"4px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",zIndex:1e3,marginTop:"4px",minWidth:"80px"},children:["viewer","editor","admin"].map(e=>u.jsx("button",{onClick:()=>{s(d(l({},o),{role:e})),f(null)},style:{width:"100%",padding:"4px 8px",background:"transparent",border:"none",color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",textAlign:"right",direction:"rtl",borderBottom:"admin"!==e?"1px solid rgba(255,255,255,0.1)":"none",fontSize:"12px"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="rgba(124,192,255,0.1)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent"},children:I(e)},e))})]}),u.jsx("button",{className:"btn primary",onClick:S,style:{padding:"4px 8px",fontSize:"12px"},children:"שמור"}),u.jsx("button",{className:"btn ghost",onClick:()=>s(null),style:{padding:"4px 8px",fontSize:"12px"},children:"ביטול"})]}):u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx("span",{style:{color:"#fff",background:"rgba(124,192,255,0.2)",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontFamily:"Segoe UI, Arial, sans-serif"},children:I(e.role)}),u.jsx("button",{className:"btn ghost",onClick:()=>(e=>{s(e)})(e),style:{padding:"4px 8px",fontSize:"12px"},children:"ערוך"}),e.id!==(null==r?void 0:r.id)&&u.jsx("button",{className:"btn ghost",onClick:()=>(e=>{if(e===(null==r?void 0:r.id))return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"לא ניתן למחוק את המשתמש הנוכחי",type:"warn",durationMs:3e3}}));const t=i.filter(t=>t.id!==e);w(t),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"משתמש נמחק בהצלחה",type:"ok",durationMs:3e3}}))})(e.id),style:{padding:"4px 8px",fontSize:"12px",color:"#ff6b6b"},children:"מחק"})]})})]},e.id))})]})]})]})}):null}class Ce extends x.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?u.jsxs("div",{style:{padding:"20px",backgroundColor:"#ffebee",border:"1px solid #f44336",borderRadius:"8px",margin:"20px",fontFamily:"Segoe UI, sans-serif"},children:[u.jsx("h2",{style:{color:"#d32f2f",margin:"0 0 10px 0"},children:"🚨 Application Error"}),u.jsx("p",{style:{color:"#666",margin:"0 0 10px 0"},children:"Something went wrong. Please check the console for details."}),u.jsxs("details",{style:{marginTop:"10px"},children:[u.jsx("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Error Details"}),u.jsxs("pre",{style:{backgroundColor:"#f5f5f5",padding:"10px",borderRadius:"4px",overflow:"auto",marginTop:"10px",fontSize:"12px"},children:[this.state.error&&this.state.error.toString(),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}),u.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:"10px",padding:"8px 16px",backgroundColor:"#2196f3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Reload Page"})]}):this.props.children}}var Ee={};const Te=(e,t="")=>{var r;return"undefined"==typeof process?(null==(r=window.__ENV__)?void 0:r[e])||t:Ee[e]||t};class De{constructor(e){c(this,"config"),c(this,"accessToken",null),c(this,"tokenExpiry",null),this.config=l({clientId:Te("OUTLOOK_CLIENT_ID",""),clientSecret:Te("OUTLOOK_CLIENT_SECRET",""),tenantId:Te("OUTLOOK_TENANT_ID",""),userPrincipalName:Te("OUTLOOK_USER_EMAIL","")},e)}authenticate(){return p(this,null,function*(){try{if(!this.config.clientId||!this.config.clientSecret||!this.config.tenantId)return!1;const e=yield this.getAccessToken();return!(!e.success||!e.access_token||(this.accessToken=e.access_token,this.tokenExpiry=new Date(Date.now()+1e3*(e.expires_in||3600)),0))}catch($e){return!1}})}getAccessToken(){return p(this,null,function*(){try{const e=`https://login.microsoftonline.com/${this.config.tenantId}/oauth2/v2.0/token`,t=new URLSearchParams({client_id:this.config.clientId,client_secret:this.config.clientSecret,scope:"https://graph.microsoft.com/Mail.Send",grant_type:"client_credentials"}),r=yield fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t.toString()});if(!r.ok)return{success:!1,error:`HTTP ${r.status}: ${r.statusText}`};const n=yield r.json();return{success:!0,access_token:n.access_token,expires_in:n.expires_in}}catch($e){return{success:!1,error:$e instanceof Error?$e.message:"Unknown error"}}})}isTokenValid(){return null!==this.accessToken&&null!==this.tokenExpiry&&this.tokenExpiry>new Date}ensureValidToken(){return p(this,null,function*(){return!!this.isTokenValid()||(yield this.authenticate())})}sendEmail(e){return p(this,null,function*(){try{if(!(yield this.ensureValidToken()))return{success:!1,error:"Failed to authenticate with Outlook API"};const t="https://graph.microsoft.com/v1.0/me/sendMail",r={message:l(l({subject:e.subject,body:{contentType:"HTML",content:e.body},toRecipients:e.to.split(",").map(e=>({emailAddress:{address:e.trim()}}))},e.cc&&e.cc.length>0&&{ccRecipients:e.cc.map(e=>({emailAddress:{address:e.trim()}}))}),e.bcc&&e.bcc.length>0&&{bccRecipients:e.bcc.map(e=>({emailAddress:{address:e.trim()}}))})},n=yield fetch(t,{method:"POST",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok){const e=yield n.text();return{success:!1,error:`HTTP ${n.status}: ${e}`}}return{success:!0,messageId:n.headers.get("Message-ID")||"sent"}}catch($e){return{success:!1,error:$e instanceof Error?$e.message:"Unknown error"}}})}sendSagachNotification(e,t,r,n,i){return p(this,null,function*(){const a=`עדכון סטטוס סג"ח: ${t}`,o=`\n      <html>\n        <head>\n          <meta charset="utf-8">\n          <style>\n            body { font-family: Arial, sans-serif; direction: rtl; text-align: right; }\n            .header { background: #f0f8ff; padding: 15px; border-radius: 5px; margin-bottom: 20px; }\n            .content { margin: 20px 0; }\n            .footer { color: #666; font-size: 12px; margin-top: 30px; }\n          </style>\n        </head>\n        <body>\n          <div class="header">\n            <h2>עדכון סטטוס סג"ח</h2>\n          </div>\n\n          <div class="content">\n            <p><strong>שם הסג"ח:</strong> ${t}</p>\n            <p><strong>סטטוס קודם:</strong> ${r}</p>\n            <p><strong>סטטוס חדש:</strong> ${n}</p>\n            <p><strong>תיאור השינוי:</strong> ${i}</p>\n          </div>\n\n          <div class="footer">\n            <p>הודעה זו נשלחה אוטומטית ממערכת ניהול הסג"חים</p>\n            <p>לשאלות או בעיות, פנה למנהל המערכת</p>\n          </div>\n        </body>\n      </html>\n    `;return yield this.sendEmail({to:e.userId,subject:a,body:o})})}testConnection(){return p(this,null,function*(){try{const e={to:this.config.userPrincipalName||"",subject:"בדיקת חיבור ל-Outlook API",body:"<p>זוהי הודעת בדיקה לחיבור ל-Outlook API</p>"};return(yield this.sendEmail(e)).success}catch($e){return!1}})}updateConfig(e){this.config=l(l({},this.config),e),this.accessToken=null,this.tokenExpiry=null}}let Ne=null;const ze={1:"ממתין לבשלות בצד ספק",2:'ממתין לקבלת דג"ח והתנעה',3:"בתהליכי אפיון",4:"ממתין לאינטגרציות",5:"ממתין לבדיקות",6:"מוכן ל-production",7:"מובצע"};class Ie{constructor(e){c(this,"config"),c(this,"dbService"),c(this,"outlookService"),c(this,"isRunning",!1),c(this,"lastCheckTimestamp",new Date),this.config=l({enabled:!0,checkIntervalMinutes:5,outlookEnabled:!0},e),this.dbService=W(),this.outlookService=(Ne||(Ne=new De(void 0)),Ne)}start(){return p(this,null,function*(){if(!this.isRunning)try{this.config.outlookEnabled&&(yield this.outlookService.testConnection()),this.isRunning=!0,this.startNotificationLoop()}catch($e){this.isRunning=!1}})}stop(){this.isRunning=!1}startNotificationLoop(){const e=()=>p(this,null,function*(){if(this.isRunning){try{yield this.checkAndSendNotifications()}catch($e){}this.isRunning&&setTimeout(e,60*this.config.checkIntervalMinutes*1e3)}});setTimeout(e,1e3)}checkAndSendNotifications(){return p(this,null,function*(){try{const e=yield this.dbService.loadSagachimStatus();for(const t of e)yield this.processSagachNotifications(t);this.lastCheckTimestamp=new Date}catch($e){}})}processSagachNotifications(e){return p(this,null,function*(){if(e.notificationSubscribers&&0!==e.notificationSubscribers.length)for(const t of e.notificationSubscribers)(yield this.shouldSendNotification(e,t))&&(yield this.sendNotification(e,t))})}shouldSendNotification(e,t){return p(this,null,function*(){try{switch(t.notificationFrequency){case"status_change":return yield this.hasStatusChanged(e,t);case"daily":return yield this.isDailyNotificationDue(e,t);case"weekly":return yield this.isWeeklyNotificationDue(e,t);default:return!1}}catch($e){return!1}})}hasStatusChanged(e,t){return p(this,null,function*(){try{const t=(e.statusUpdates||[]).filter(e=>"status_change"===e.type||"user"===e.type).sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime())[0];if(!t)return!1;const r=new Date(t.timestamp);return((new Date).getTime()-r.getTime())/36e5<=1}catch($e){return!1}})}isDailyNotificationDue(e,t){return p(this,null,function*(){try{const e=(new Date).getHours();return e>=9&&e<=10}catch($e){return!1}})}isWeeklyNotificationDue(e,t){return p(this,null,function*(){try{const e=new Date,t=e.getDay(),r=e.getHours();return 1===t&&r>=9&&r<=10}catch($e){return!1}})}sendNotification(e,t){return p(this,null,function*(){try{if(!this.config.outlookEnabled)return;const r=ze[e.processStatus]||`סטטוס ${e.processStatus}`,n=this.getPreviousStatusLabel(e),i=this.generateChangeDescription(e);(yield this.outlookService.sendSagachNotification(t,e.name,n,r,i)).success}catch($e){}})}getPreviousStatusLabel(e){const t=(e.statusUpdates||[]).filter(e=>e.oldStatus&&e.newStatus);if(t.length>0){const e=t.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime())[0];return ze[e.oldStatus]||`סטטוס ${e.oldStatus}`}return"לא ידוע"}generateChangeDescription(e){const t=(e.statusUpdates||[]).filter(e=>{const t=new Date(e.timestamp);return((new Date).getTime()-t.getTime())/36e5<=24}).slice(0,3);return 0===t.length?"עדכון שגרתי במערכת":t.map(e=>e.message).join(" • ")}updateConfig(e){this.config=l(l({},this.config),e)}getStatus(){return{isRunning:this.isRunning,lastCheck:this.lastCheckTimestamp,config:this.config}}}let Me=null;const Le=e=>(Me||(Me=new Ie(e)),Me);function Ae(){const{user:e,isLoading:t,canManageUsers:r,canValidateJson:n}=z(),{sagachimStatus:i}=X(),[a,o]=x.useState(!1),[s,c]=x.useState(!1),[g,h]=x.useState("status"),[m,f]=x.useState(null),[b,S]=x.useState("ok"),[j,C]=x.useState(!1),[E,T]=x.useState(!1),D=x.useRef(null),N=x.useRef(null);x.useEffect(()=>(e&&!t&&(()=>{p(this,null,function*(){try{const e=Le();yield e.start()}catch(e){}})})(),()=>{Le().stop()}),[e,t]);const[I,M]=x.useState(""),[L,A]=x.useState(null),[R,$]=x.useState(null),[F,_]=x.useState(!1),[B,W]=x.useState(1),[O,U]=x.useState({x:0,y:0}),[P,q]=x.useState(!1),[Y,H]=x.useState({x:0,y:0}),[V,J]=x.useState(""),[G,Q]=x.useState([]),[Z,ee]=x.useState(!1),[te,re]=x.useState(!1),[ne,ie]=x.useState(null),[ae,se]=x.useState(""),[le,ce]=x.useState(""),[pe,ue]=x.useState(""),[ge,xe]=x.useState(!1),[he,me]=x.useState(""),[ye,Ce]=x.useState([]),[Ee,Te]=x.useState(""),[De,Ne]=x.useState(!1),[ze,Ie]=x.useState(!1),[Me,Ae]=x.useState(!0),[Re,$e]=x.useState(!1),[Fe,_e]=x.useState(!1),[Be,We]=x.useState(!1),[Oe,Ue]=x.useState(!1),[Pe,qe]=x.useState(!1),[Ye,He]=x.useState(null),[Ve,Je]=x.useState(null),[Xe,Ke]=x.useState(null),Ge=x.useRef(null),Qe=x.useRef(1),Ze=x.useRef({x:0,y:0}),et=x.useRef(null),tt=x.useRef(null),rt=x.useRef(null),nt=x.useRef(null),it=x.useRef(null),at=x.useRef(null),ot=x.useRef([]);x.useEffect(()=>{e&&"admin"!==e.role&&("viz"!==g&&"dictionary"!==g&&"common"!==g||h("status"))},[e,g]);const st=x.useMemo(()=>{try{return typeof JSON.parse(I)}catch(e){return null}},[I]),lt=x.useMemo(()=>{if(!L)return[];const e=[],t=(r,n)=>{var i;const a=null!=(i=r.children)?i:[],o=0===a.length,s=!!(r.excelMeta&&Object.keys(r.excelMeta).length>0),l="required"===r.requiredState,d=[...n,r.name];if(o&&l&&!s){const t=d.slice(1).join(" -> ");e.push({id:r.id,path:t,requiredState:r.requiredState})}a.forEach(e=>t(e,d))};return t(L,[]),e},[L]),dt=x.useMemo(()=>lt,[lt]),ct=x.useCallback(()=>{try{if(!Ee)return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"בחר סכמה לויזואליזציה בעץ",type:"error",durationMs:4e3}}));const e=ve[Ee];if(e){M(JSON.stringify(e.schema,null,2)),$(null);const t=y(e.schema),r=gt(t,ye);A(r)}else $("Selected schema not found")}catch(e){$(e instanceof Error?e.message:"Failed to parse JSON")}},[Ee,ye]),pt=x.useCallback(()=>{M(""),A(null),$(null)},[]);x.useEffect(()=>{const e=e=>{e.ctrlKey&&"f"===e.key&&(e.preventDefault(),re(!0),setTimeout(()=>{const e=document.getElementById("tree-search");null==e||e.focus()},50)),"Escape"===e.key&&(re(!1),J(""),_(!1),ie(null),Ne(!1),_e(!1),We(!1))},t=e=>{const{targetNode:t,field:r}=e.detail;if(ye.find(e=>{var n,i,a,o;const s=(null==(n=null==e?void 0:e.targetNode)?void 0:n.name)===(null==t?void 0:t.name)&&(null==(i=null==e?void 0:e.targetNode)?void 0:i.type)===(null==t?void 0:t.type),l=(null==(a=null==e?void 0:e.field)?void 0:a.name)!==(null==r?void 0:r.name)||(null==(o=null==e?void 0:e.field)?void 0:o.fieldType)!==(null==r?void 0:r.fieldType);return s&&l}))return Je({targetNode:t,field:r}),Ke("drop"),void qe(!0);ie({targetNode:t,field:r}),se(r.name||""),ce(""),ue(t.name||""),xe(!1),me("")},r=e=>{var t;const r=null==(t=e.detail)?void 0:t.callback;r&&"function"==typeof r&&r(ot.current)},n=e=>{var t;const r=null==(t=e.detail)?void 0:t.callback;r&&"function"==typeof r&&r(Ee)},i=e=>{var t;const r=null==(t=e.detail)?void 0:t.key;if(r&&"string"==typeof r){Te(r);const e=ve[r];if(e){M(JSON.stringify(e.schema,null,2)),$(null);const t=y(e.schema),r=at.current&&at.current.length>0?at.current:ye,n=gt(t,r);A(n),at.current=null,window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`נטענה סכמה: ${e.title}`,type:"ok",durationMs:2500}}))}else window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"סכמה שהוטענה מהאקסל לא נמצאה",type:"error",durationMs:4e3}}))}},a=e=>{var t;const r=(null==(t=e.detail)?void 0:t.mappings)||[];r.length&&(at.current=r,Ce(e=>{const t=e=>{var t,r,n,i;return`${null==(t=null==e?void 0:e.targetNode)?void 0:t.name}__${null==(r=null==e?void 0:e.targetNode)?void 0:r.type}__${null==(n=null==e?void 0:e.field)?void 0:n.name}__${null==(i=null==e?void 0:e.field)?void 0:i.fieldType}`},n=new Map;e.forEach(e=>n.set(t(e),e)),r.forEach(e=>n.set(t(e),e));const i=Array.from(n.values());return ot.current=i,i}),L&&A(gt(L,r)))};return window.addEventListener("keydown",e),window.addEventListener("excel:drop-on-node",t),window.addEventListener("excel:request-mappings",r),window.addEventListener("excel:request-selected-schema",n),window.addEventListener("excel:apply-selected-schema",i),window.addEventListener("excel:mappings-imported",a),()=>{window.removeEventListener("keydown",e),window.removeEventListener("excel:drop-on-node",t),window.removeEventListener("excel:request-mappings",r),window.removeEventListener("excel:request-selected-schema",n),window.removeEventListener("excel:apply-selected-schema",i),window.removeEventListener("excel:mappings-imported",a)}},[ye,Ee,L]),x.useEffect(()=>{const e=e=>{var t;const r=e.target;rt.current&&!rt.current.contains(r)&&_e(!1),nt.current&&!nt.current.contains(r)&&We(!1);const n=it.current&&it.current.contains(r),i=null==(t=null==r?void 0:r.closest)?void 0:t.call(r,'.schema-dropdown[role="menu"]');n||i||Ue(!1)};return document.addEventListener("mousedown",e,!0),()=>document.removeEventListener("mousedown",e,!0)},[]),x.useEffect(()=>{const e=()=>Ie(!0);return window.addEventListener("excel:uploaded",e),()=>window.removeEventListener("excel:uploaded",e)},[]),x.useEffect(()=>{if(!F)return;const e=e=>{var t,r;const n=e.target,i=null==(t=et.current)?void 0:t.contains(n),a=null==(r=tt.current)?void 0:r.contains(n);i||a||_(!1)};return document.addEventListener("mousedown",e,!0),()=>document.removeEventListener("mousedown",e,!0)},[F]),x.useEffect(()=>{if(!De)return;const e=e=>{var t;const r=e.target;(null==(t=document.querySelector(".schema-selector"))?void 0:t.contains(r))||Ne(!1)};return document.addEventListener("mousedown",e,!0),()=>document.removeEventListener("mousedown",e,!0)},[De]),x.useEffect(()=>{const e=()=>{if(document.querySelectorAll(".search-highlight").forEach(e=>{const t=e.parentNode;t.replaceChild(document.createTextNode(e.textContent||""),e),t.normalize()}),!V.trim())return;const e=document.createTreeWalker(document.querySelector(".tree-view")||document.body,NodeFilter.SHOW_TEXT,{acceptNode:e=>{const t=e.parentElement;return t&&!t.classList.contains("search-highlight")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),t=[];let r;for(;r=e.nextNode();)t.push(r);const n=new RegExp(`(${V.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");t.forEach(e=>{const t=e.textContent||"";if(n.test(t)){const r=e.parentElement,i=t.replace(n,'<span class="search-highlight">$1</span>'),a=document.createElement("div");for(a.innerHTML=i,r.replaceChild(a,e);a.firstChild;)r.insertBefore(a.firstChild,a);r.removeChild(a)}})},t=setTimeout(()=>{"requestIdleCallback"in window?requestIdleCallback(()=>e()):e()},300);return()=>clearTimeout(t)},[V,L]);const ut=(e,t=[],r=[])=>{var n;const i=Array.isArray(e.rules)&&e.rules.length?e.rules.join(" "):void 0,a=[...r,e.name].slice(1).join(" -> ");return t.push({id:e.id,path:a,name:e.name,description:e.description,rulesText:i}),null==(n=e.children)||n.forEach(n=>ut(n,t,[...r,e.name])),t},gt=(e,t)=>{var r,n,i;if(!t||0===t.length)return e;const a=new Map,o=new Map;for(const l of t){const e=((null==(r=null==l?void 0:l.targetNode)?void 0:r.path)||"").trim();e&&a.set(e,l);const t=`${(null==(n=null==l?void 0:l.targetNode)?void 0:n.name)||""}__${(null==(i=null==l?void 0:l.targetNode)?void 0:i.type)||""}`;o.set(t,l)}const s=e=>{const t=(e=>(e.id||"").split(":")[0])(e),r=a.get(t),n=o.get(`${e.name}__${e.type}`),i=r||n,c=i?d(l({},e),{excelMeta:(p=i,{fieldEssence:(null==(u=null==p?void 0:p.field)?void 0:u.fieldEssence)||"",dgh:(null==(g=null==p?void 0:p.field)?void 0:g.dgh)||"",always:(null==(x=null==p?void 0:p.field)?void 0:x.always)||"",mappingDetails:(null==p?void 0:p.mappingDetails)||"",outputs:(null==p?void 0:p.outputs)||""})}):e;var p,u,g,x;return c.children&&c.children.length>0?d(l({},c),{children:c.children.map(e=>s(e))}):c};return s(e)};x.useEffect(()=>{if(!V.trim())return Q([]),ee(!1),void document.querySelectorAll(".search-highlight").forEach(e=>{e.classList.remove("search-highlight")});const e=L?ut(L):[],t=V.trim().toLowerCase(),r=e.reduce((e,r)=>{const n=r.path.toLowerCase().includes(t),i=r.description||"",a=i.toLowerCase().indexOf(t),o=r.rulesText||"",s=o.toLowerCase().indexOf(t);if(n||-1!==a||-1!==s){let n;if(-1!==a){const e=40,r=60,o=Math.max(0,a-e),s=Math.min(i.length,a+t.length+r),l=o>0?"…":"",d=s<i.length?"…":"";n=`${l}${i.slice(o,s)}${d}`}else if(-1!==s){const e=40,r=60,i=Math.max(0,s-e),a=Math.min(o.length,s+t.length+r),l=i>0?"…":"",d=a<o.length?"…":"";n=`${l}${o.slice(i,a)}${d}`}e.push(d(l({},r),{snippet:n}))}return e},[]).slice(0,20);Q(r),ee(r.length>0)},[L,V]);const xt=e=>Math.min(2.5,Math.max(.5,Math.round(100*e)/100));x.useEffect(()=>{const e=e=>{if(!window.__excelDragging)return;const t=Ge.current;if(!t)return;const r=t.getBoundingClientRect();e.preventDefault();const n=e.deltaY>0?-.08:.08,i=Qe.current,a=xt(i+n);if(a===i)return;const o=e.clientX-r.left,s=e.clientY-r.top,l=a/i,d=Ze.current,c=o-(o-d.x)*l,p=s-(s-d.y)*l;W(a),U({x:c,y:p})},t={passive:!1};return window.addEventListener("wheel",e,t),document.addEventListener("wheel",e,t),document.body.addEventListener("wheel",e,t),window.addEventListener("mousewheel",e,t),document.addEventListener("mousewheel",e,t),document.addEventListener("DOMMouseScroll",e,t),()=>{window.removeEventListener("wheel",e),document.removeEventListener("wheel",e),document.body.removeEventListener("wheel",e),window.removeEventListener("mousewheel",e),document.removeEventListener("mousewheel",e),document.removeEventListener("DOMMouseScroll",e)}},[]),x.useEffect(()=>{ot.current=ye},[ye]),x.useEffect(()=>{Qe.current=B},[B]),x.useEffect(()=>{Ze.current=O},[O]);const ht=e=>{try{Ce(t=>{const r=e=>{var t,r;return`${null==(t=null==e?void 0:e.field)?void 0:t.name}__${null==(r=null==e?void 0:e.field)?void 0:r.fieldType}`},n=new Map;t.forEach(e=>n.set(r(e),e)),n.set(r(e),e);const i=Array.from(n.values());return ot.current=i,i});const t=r=>r.id===e.targetNode.id?d(l({},r),{excelMeta:{fieldEssence:e.field.fieldEssence||"",dgh:e.field.dgh||"",always:e.field.always||"",mappingDetails:e.mappingDetails||"",outputs:e.outputs||""}}):r.children?d(l({},r),{children:r.children.map(e=>t(e))}):r;if(L){const e=t(L);A(e)}window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`Mapping saved for ${e.targetNode.name}`,type:"ok",durationMs:3e3}})),window.dispatchEvent(new CustomEvent("excel:mapping-saved",{detail:{field:e.field,targetNode:e.targetNode}})),ie(null)}catch(t){alert("Failed to save mapping. Check console for details.")}},mt=(e,t)=>{e.style.transform=t?"translateY(-1px)":"translateY(0px)",e.style.boxShadow=t?"0 6px 20px rgba(0,0,0,0.35)":"none"},ft=(e,t,r)=>{if(e.dataset.baseBg||(e.dataset.baseBg=e.style.background||""),e.classList.contains("opt-orange")){if(t)return void(e.style.background="rgba(228, 184, 27, 0.55)")}else if(e.classList.contains("opt-green")&&t)return void(e.style.background="rgba(38, 216, 56, 0.55)");const n=e.dataset.baseBg;"string"==typeof n?e.style.background=n:e.style.removeProperty("background")};return x.useEffect(()=>{const e=()=>{D.current&&(window.clearTimeout(D.current),D.current=null),N.current&&(window.clearTimeout(N.current),N.current=null)},t=t=>{const{message:r,type:n,durationMs:i}=t.detail||{};e(),C(!1),T(!1),f(r||""),S(n||"ok"),requestAnimationFrame(()=>T(!0));const a="number"==typeof i?i:5e3;D.current=window.setTimeout(()=>{C(!0),N.current=window.setTimeout(()=>{f(null),C(!1),T(!1)},420)},a)};return window.addEventListener("excel:status",t),()=>{e(),window.removeEventListener("excel:status",t)}},[]),x.useEffect(()=>{const e=()=>{try{if(Ce([]),ot.current=[],L){const e=t=>d(l({},t),{excelMeta:void 0,children:t.children?t.children.map(e):t.children});A(e(L))}window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"נוקו כל המיפויים מהעץ",type:"ok",durationMs:2500}}))}catch(e){window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`ניקוי מיפויים נכשל: ${e}`,type:"error",durationMs:4e3}}))}};return window.addEventListener("excel:clear-all-mappings",e),()=>window.removeEventListener("excel:clear-all-mappings",e)},[L]),u.jsxs("div",{className:"page-root",children:[u.jsxs("div",{className:"app-shell",children:[u.jsxs("header",{className:"app-header floating",children:[u.jsxs("div",{className:"brand",children:[u.jsx("img",{src:"./images/logo.png",alt:"העץ הירוק",style:{height:"80px",width:"80px",objectFit:"contain",marginRight:"8px",marginTop:"-12px",marginBottom:"-12px"}}),"archive"===g&&u.jsx("div",{className:"archive-back",style:{marginRight:"16px"},children:u.jsxs("button",{className:"btn glow-blue",onClick:()=>h("status"),style:{padding:"12px 16px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl",fontFamily:"Segoe UI, sans-serif"},title:"חזור לסטטוס סגחים",children:[u.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",style:{marginLeft:"8px"},children:u.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})}),"חזרה"]})}),"analytics"===g&&u.jsx("div",{className:"analytics-back",style:{marginRight:"16px"},children:u.jsxs("button",{className:"btn glow-blue",onClick:()=>h("status"),style:{padding:"12px 16px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl",fontFamily:"Segoe UI, sans-serif"},title:"חזור לסטטוס סגחים",children:[u.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",style:{marginLeft:"8px"},children:u.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})}),"חזרה"]})}),"status"===g&&u.jsxs("div",{className:"status-controls",style:{display:"flex",alignItems:"center",gap:"12px",marginRight:"16px"},children:[u.jsxs("button",{className:"btn glow-green",onClick:()=>h("archive"),style:{padding:"12px 16px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl",fontFamily:"Segoe UI, sans-serif"},title:"ארכיון סגחים מובצעים",children:[u.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",style:{marginLeft:"8px"},children:u.jsx("path",{d:"M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 9.5l4 4h-2.5V16h-3v-2.5H8l4-4z"})}),"ארכיון"]}),u.jsxs("button",{className:"btn glow-orange",onClick:()=>h("analytics"),style:{padding:"12px 16px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl",fontFamily:"Segoe UI, sans-serif"},title:"אנליטיקות סגחים",children:[u.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",style:{marginLeft:"8px"},children:u.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"})}),"אנליטיקות"]})]}),"viz"===g&&"admin"===(null==e?void 0:e.role)&&u.jsxs("div",{className:"excel-header-actions",style:{display:"flex",alignItems:"center",gap:8},children:[u.jsxs("div",{className:"action-dropdown",ref:rt,style:{position:"relative",width:240},children:[u.jsxs("button",{className:"btn glow-orange",style:{width:"100%",padding:"12px 14px",minHeight:"35px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl"},onClick:()=>{_e(!Fe),We(!1)},onMouseEnter:e=>mt(e.currentTarget,!0),onMouseLeave:e=>mt(e.currentTarget,!1),children:[u.jsx("span",{style:{marginLeft:5,marginTop:"2px",fontSize:"10px"},children:"▲"}),u.jsx("span",{style:{display:"flex",alignItems:"center",gap:6},children:u.jsx("span",{children:"העלאה"})})]}),Fe&&u.jsxs("div",{className:"schema-dropdown",style:{right:0,left:"auto",width:"100%",minWidth:"100%",border:"1px solid rgba(201, 168, 25, 0.17)",borderRadius:"12px",marginTop:"4px",maxHeight:"200px",overflowY:"auto",background:"rgba(182, 130, 32, 0.93)",boxShadow:"0 18px 44px rgba(0,0,0,0.7)",backdropFilter:"blur(48px)",overflow:"hidden"},children:[u.jsx("div",{className:"schema-option opt-orange",onClick:()=>{window.dispatchEvent(new Event("excel:upload-mapping-request")),_e(!1)},dir:"rtl",style:{padding:"10px 12px",borderBottom:"1px solid rgba(255,255,255,0.08)",textAlign:"center",background:"rgba(10,24,45,0.98)",color:"#ffffff"},onMouseEnter:e=>ft(e.currentTarget,!0),onMouseLeave:e=>ft(e.currentTarget,!1),children:"העלה Mapping"}),u.jsx("div",{className:"schema-option opt-orange",onClick:()=>{window.dispatchEvent(new Event("excel:upload-request")),_e(!1)},style:{padding:"10px 12px",borderBottom:"none",textAlign:"center",background:"rgba(10,24,45,0.98)",color:"#ffffff"},onMouseEnter:e=>ft(e.currentTarget,!0),onMouseLeave:e=>ft(e.currentTarget,!1),children:'העלה קובץ דג"ח'})]})]}),u.jsxs("div",{className:"action-dropdown",ref:nt,style:{position:"relative",width:240},children:[u.jsxs("button",{className:"btn glow-green",style:{width:"100%",padding:"12px 14px",minHeight:"35px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl"},onClick:()=>{We(!Be),_e(!1)},onMouseEnter:e=>mt(e.currentTarget,!0),onMouseLeave:e=>mt(e.currentTarget,!1),children:[u.jsx("span",{style:{marginLeft:5,marginTop:"2px",fontSize:"10px"},children:"▼"}),u.jsx("span",{style:{display:"flex",alignItems:"center",textAlign:"center",justifyContent:"center",gap:6},children:u.jsx("span",{children:"הורדה"})})]}),Be&&u.jsxs("div",{className:"schema-dropdown",style:{right:0,left:"auto",width:"100%",minWidth:"100%",border:"1px solid rgba(39, 228, 22, 0.76)",borderRadius:"12px",marginTop:"4px",maxHeight:"200px",overflowY:"auto",background:"rgba(10,24,45,0.98)",boxShadow:"0 12px 32px rgba(0,0,0,0.6)",backdropFilter:"blur(40px)",overflow:"hidden"},children:[u.jsx("div",{className:"schema-option opt-green",onClick:()=>0===ye.length?(window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"No mappings to download yet",type:"warn",durationMs:2500}})),void We(!1)):(dt.length,window.dispatchEvent(new Event("excel:download-mapping-request")),void We(!1)),dir:"rtl",style:{padding:"10px 12px",borderBottom:"1px solid rgba(255,255,255,0.08)",textAlign:"center",background:"rgba(10,24,45,0.98)",color:"#ffffff"},onMouseEnter:e=>ft(e.currentTarget,!0),onMouseLeave:e=>ft(e.currentTarget,!1),children:"הורד Mapping"}),u.jsx("div",{className:"schema-option opt-green",onClick:()=>{window.dispatchEvent(new Event("excel:download-template-request")),We(!1)},style:{padding:"10px 12px",borderBottom:"none",textAlign:"center",background:"rgba(10,24,45,0.98)",color:"#ffffff"},onMouseEnter:e=>ft(e.currentTarget,!0),onMouseLeave:e=>ft(e.currentTarget,!1),children:'הורד פורמט דג"ח'})]})]})]})]}),u.jsxs("div",{className:"header-actions",children:[u.jsx("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:e?u.jsxs(u.Fragment,{children:[u.jsx(je,{}),r()&&u.jsxs("button",{onClick:()=>c(!0),style:{padding:"8px 16px",backgroundColor:"rgba(255, 165, 0, 0.2)",color:"#ffa500",border:"1px solid rgba(255, 165, 0, 0.4)",borderRadius:"8px",fontSize:"12px",maxHeight:"35px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",transition:"all 0.2s",direction:"rtl",display:"flex",alignItems:"center",gap:"6px"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="rgba(255, 165, 0, 0.3)",e.currentTarget.style.borderColor="rgba(255, 165, 0, 0.6)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="rgba(255, 165, 0, 0.2)",e.currentTarget.style.borderColor="rgba(255, 165, 0, 0.4)"},children:[u.jsx("span",{children:"⚙️"}),"ניהול הרשאות"]})]}):u.jsx("button",{onClick:()=>o(!0),style:{padding:"8px 16px",backgroundColor:"var(--accent)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",transition:"background-color 0.2s",direction:"rtl"},onMouseOver:e=>e.currentTarget.style.backgroundColor="var(--accent-hover)",onMouseOut:e=>e.currentTarget.style.backgroundColor="var(--accent)",children:"התחבר"})}),"viz"===g&&"admin"===(null==e?void 0:e.role)&&u.jsx("div",{className:"schema-group",style:{display:"flex",alignItems:"center",gap:6},children:u.jsxs("div",{className:"schema-selector",children:[u.jsxs("button",{className:"btn ghost "+(Ee?"":"is-placeholder"),onClick:()=>Ne(!De),children:[Ee&&ve[Ee]?ve[Ee].title:u.jsx("span",{className:"schema-placeholder",dir:"rtl",children:"בחר תקן"}),u.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),De&&u.jsx("div",{className:"schema-dropdown",children:Object.entries(ve).map(([e,t])=>u.jsx("div",{className:"schema-option",onClick:()=>{Te(e),Ne(!1)},children:t.title},e))})]})}),"viz"===g&&"admin"===(null==e?void 0:e.role)&&u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn ghost",onClick:pt,style:{display:"flex",padding:"12px 14px",maxHeight:"35px",justifyContent:"center",alignItems:"center",alignSelf:"center"},children:"נקה"}),u.jsx("button",{className:"btn primary",onClick:ct,style:{display:"flex",padding:"12px 14px",maxHeight:"35px",justifyContent:"center",alignItems:"center",alignSelf:"center"},children:"ויזואליזציה"}),u.jsx("div",{className:"zoom-controls",children:u.jsxs("div",{className:"zoom-readout",children:[Math.round(100*B),"%"]})})]}),"admin"===(null==e?void 0:e.role)&&u.jsx("div",{ref:et,className:"input-dropdown anchored "+(F?"open":""),children:u.jsxs("div",{className:"panel input dropdown",children:[u.jsx("div",{className:"panel-title",children:"קלט JSON"}),u.jsx("textarea",{className:"json-input",spellCheck:!1,placeholder:"הדבק JSON כאן...",value:I,onChange:e=>M(e.target.value)}),u.jsxs("div",{className:"panel-footer",children:[R?u.jsx("div",{className:"notice error",children:R}):u.jsx("div",{className:"notice ok",children:st?`זוהה: ${st}`:"ממתין ל-JSON תקין..."}),u.jsx("div",{style:{display:"flex",gap:8},children:u.jsx("button",{className:"btn primary",onClick:ct,style:{padding:"12px 14px",minHeight:"48px"},children:"ויזואליזציה"})})]})]})}),"common"===g&&"admin"===(null==e?void 0:e.role)&&u.jsx("div",{className:"notification-container",children:u.jsxs("button",{className:"notification-btn",onClick:()=>{},children:[u.jsx("svg",{className:"notification-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:u.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"})}),u.jsx("span",{className:"notification-count",children:"3"})]})}),u.jsxs("div",{className:"action-dropdown",ref:it,style:{position:"relative"},children:[u.jsx("button",{className:"btn ghost","aria-haspopup":"menu","aria-expanded":Oe?"true":"false",onClick:()=>{Ue(!Oe)},title:"ניווט",children:u.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:[u.jsx("rect",{x:"3",y:"6",width:"18",height:"2",rx:"1"}),u.jsx("rect",{x:"3",y:"11",width:"18",height:"2",rx:"1"}),u.jsx("rect",{x:"3",y:"16",width:"18",height:"2",rx:"1"})]})}),Oe&&u.jsxs("div",{className:"schema-dropdown",style:{right:0,left:"auto",minWidth:220,position:"absolute"},role:"menu",dir:"rtl",children:["admin"===(null==e?void 0:e.role)&&u.jsx("div",{className:"schema-option",role:"menuitem",onClick:()=>{h("viz"),Ue(!1),_e(!1),We(!1),Ne(!1)},onMouseEnter:()=>{},onMouseLeave:()=>{},style:{position:"relative",padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",pointerEvents:"auto",zIndex:9999999},children:"ויואליזציה + Mapping"}),"admin"===(null==e?void 0:e.role)&&u.jsx("div",{className:"schema-option",role:"menuitem",onClick:()=>{h("dictionary"),Ue(!1),_e(!1),We(!1),Ne(!1)},onMouseEnter:()=>{},onMouseLeave:()=>{},style:{position:"relative",padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",pointerEvents:"auto",zIndex:9999999},children:"מילון התקן"}),u.jsx("div",{className:"schema-option",role:"menuitem",onClick:()=>{h("status"),Ue(!1),_e(!1),We(!1),Ne(!1)},onMouseEnter:()=>{},onMouseLeave:()=>{},style:{position:"relative",padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",pointerEvents:"auto",zIndex:9999999},children:'סטטוס סג"חים'}),u.jsx("div",{className:"schema-option",role:"menuitem",onClick:()=>{h("validator"),Ue(!1),_e(!1),We(!1),Ne(!1)},onMouseEnter:()=>{},onMouseLeave:()=>{},style:{position:"relative",padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",pointerEvents:"auto",zIndex:9999999},children:"בודק תקינות JSON"})]})]})]})]}),"viz"===g&&"admin"===(null==e?void 0:e.role)?u.jsxs("main",{className:"app-main full-screen has-extractor",children:[u.jsx(k,{}),te&&u.jsxs("div",{className:"search-overlay",children:[u.jsxs("div",{className:"search-box",children:[u.jsx("input",{id:"tree-search",type:"text",placeholder:"Search cubes and descriptions...",value:V,onChange:e=>J(e.target.value),className:"search-input"}),u.jsx("button",{onClick:()=>{re(!1),J("")},className:"search-close",children:"×"})]}),Z&&u.jsx("div",{className:"search-results",children:G.map(e=>u.jsxs("div",{className:"search-result-item",onClick:()=>{(e=>{document.querySelectorAll(".search-highlight").forEach(e=>{e.classList.remove("search-highlight")});const t=e.split(":")[0].split(".");(()=>{const e=document.querySelector(".tree-root .node-tile"),r=null==e?void 0:e.getBoundingClientRect(),n=r?r.left+r.width/2:window.innerWidth/2;for(let i=1;i<=t.length;i++){const e=t.slice(0,i).join("."),r=document.querySelector(`[data-node-id^="${e}:"]`);if(r){const e=r.closest(".tree-li"),t=null==e?void 0:e.querySelector(".node-tile"),i=null==e?void 0:e.querySelector(".binary-children");if(t&&i&&(!i.classList.contains("open")||!("hidden"!==i.style.overflow||i.offsetHeight>0))){const r=t.getBoundingClientRect(),i=r.left+r.width/2<n?"left":"right";e&&(e.dataset.forceSide=i),t.click(),requestAnimationFrame(()=>{const e=new CustomEvent("search:layout-update",{detail:{forceSide:i}});t.dispatchEvent(e)})}}}})();const r=document.querySelector(`[data-node-id="${e}"]`);r&&setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{r.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),r.classList.add("search-highlight"),setTimeout(()=>r.classList.remove("search-highlight"),3e3)})})},100)})(e.id),ee(!1)},children:[u.jsx("div",{className:"search-result-path",children:e.path}),e.snippet&&u.jsx("div",{className:"search-snippet",dangerouslySetInnerHTML:{__html:(e=>{const t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=new RegExp(`(${n=V,n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");var n;return t.replace(r,'<span class="search-snippet-highlight">$1</span>')})(e.snippet)}})]},e.id))})]}),u.jsx("section",{className:"viz-section",onWheel:e=>{var t;if(window.__excelDragging)return;e.preventDefault();const r=e.deltaY>0?-.08:.08,n=xt(B+r);if(n!==B){const r=(null!=(t=Ge.current)?t:e.currentTarget).getBoundingClientRect(),i=e.clientX-r.left,a=e.clientY-r.top,o=O.x,s=O.y,l=n/B,d=i-(i-o)*l,c=a-(a-s)*l;W(n),U({x:d,y:c})}},children:u.jsx("div",{className:"full-viz",onMouseDown:e=>{0===e.button&&(q(!0),H({x:e.clientX-O.x,y:e.clientY-O.y}))},onMouseMove:e=>{P&&U({x:e.clientX-Y.x,y:e.clientY-Y.y})},onMouseUp:()=>q(!1),onMouseLeave:()=>q(!1),children:u.jsxs("div",{className:"viz-wrapper",ref:Ge,style:{transform:`translate(${O.x}px, ${O.y}px) scale(${B})`},children:[L?u.jsx(v,{root:L}):u.jsx("div",{className:"placeholder",children:"בחר סכמה ולחץ על ויזואליזציה"}),L&&u.jsx(w,{containerRef:Ge})]})})})]}):"dictionary"===g&&"admin"===(null==e?void 0:e.role)?u.jsx(de,{schemas:ve}):"common"===g&&"admin"===(null==e?void 0:e.role)?u.jsx(K,{}):"status"===g?u.jsx(oe,{}):"archive"===g?u.jsx(fe,{onBack:()=>h("status")}):"analytics"===g?u.jsx(be,{}):"validator"===g?u.jsx(we,{onBack:()=>h("status")}):e&&"admin"!==e.role?u.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",padding:"40px",textAlign:"center",direction:"rtl"},children:u.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(255,165,0,0.1), rgba(255,165,0,0.05))",border:"1px solid rgba(255,165,0,0.3)",borderRadius:"16px",padding:"40px",maxWidth:"600px",boxShadow:"0 8px 32px rgba(0,0,0,0.1)"},children:[u.jsx("div",{style:{fontSize:"48px",marginBottom:"20px",color:"var(--accent)"},children:"🔒"}),u.jsx("h2",{style:{color:"var(--text)",fontSize:"24px",fontWeight:"600",marginBottom:"16px"},children:"גישה מוגבלת"}),u.jsxs("p",{style:{color:"var(--muted)",fontSize:"16px",lineHeight:"1.6",marginBottom:"24px"},children:["רק מנהלים יכולים לגשת למסכי העץ, הבנק והמרחב המשותף.",u.jsx("br",{}),'אתה יכול לגשת למסך סטטוס הסג"חים בלבד.']}),u.jsx("div",{style:{display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap"},children:u.jsxs("div",{style:{background:"rgba(124,192,255,0.1)",border:"1px solid rgba(124,192,255,0.3)",borderRadius:"8px",padding:"12px 16px",fontSize:"14px",color:"var(--accent)"},children:[u.jsx("strong",{children:"תפקיד נוכחי:"})," ","viewer"===e.role?"צופה":"editor"===e.role?"עורך":"מנהל"]})})]})}):null,"viz"===g&&L&&"admin"===(null==e?void 0:e.role)&&u.jsxs("div",{className:"required-panel "+(Me?"open":"collapsed"),children:[u.jsxs("div",{className:"required-header",dir:"rtl",onClick:()=>Ae(e=>!e),children:[u.jsx("div",{className:"required-title",children:"שדות חובה בתקן:"}),u.jsx("button",{className:"required-toggle","aria-label":Me?"סגור":"פתח",children:Me?"▲":"▼"})]}),Me&&u.jsx("div",{className:"required-body",dir:"rtl",children:0===dt.length?u.jsx("div",{className:"required-empty",children:"אין שדות חובה חסרים"}):u.jsx("ul",{className:"required-list",children:dt.map(e=>u.jsxs("li",{className:"req-item","data-state":"required",title:e.path,children:[u.jsx("span",{className:"req-dot","aria-hidden":"true"}),u.jsx("span",{className:"req-text",children:e.path})]},e.id))})})]}),m&&u.jsx("div",{className:`toast-bottom ${b} ${j?"leaving":""} ${E?"show":""}`,dir:"rtl",children:m}),ne&&u.jsx("div",{className:"modal-overlay",onClick:()=>ie(null),children:u.jsx("div",{className:"modal",onClick:e=>e.stopPropagation(),children:u.jsxs("div",{style:{padding:"24px"},children:[u.jsx("h2",{style:{margin:"0 0 20px 0",fontSize:"18px",fontWeight:"600"},children:"Field Mapping"}),u.jsxs("div",{className:"mapping-grid",style:{gridTemplateColumns:ge?"1fr auto 1fr auto 1fr auto 1fr":"1fr auto 1fr auto 1fr",alignItems:"center"},children:[u.jsxs("div",{className:"map-col",children:[u.jsx("div",{className:"small-h",dir:"rtl",style:{textAlign:"center"},children:"שדה בתקן"}),u.jsxs("div",{className:"map-card",style:{textAlign:"center"},children:[u.jsx("div",{className:"map-main",children:ne.targetNode.name}),u.jsx("div",{className:"map-sub",children:ne.targetNode.type}),u.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",marginTop:"8px"},children:[u.jsxs("div",{children:[u.jsx("strong",{children:"Description:"})," ",ne.targetNode.description||"No description"]}),ne.targetNode.rules&&ne.targetNode.rules.length>0&&u.jsxs("div",{children:[u.jsx("strong",{children:"Rules:"})," ",ne.targetNode.rules.join(", ")]}),ne.targetNode.valuePreview&&u.jsxs("div",{children:[u.jsx("strong",{children:"Preview:"})," ",ne.targetNode.valuePreview]})]})]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"0 8px"},children:u.jsx("span",{style:{fontSize:"24px",color:"var(--muted)"},children:"←"})}),ge&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"map-col",children:[u.jsx("div",{className:"small-h",dir:"rtl",style:{textAlign:"center"},children:"רק בOUTPUTS"}),u.jsx("div",{className:"map-card",children:u.jsx("textarea",{className:"map-notes",placeholder:"Specify outputs...",value:he,onChange:e=>me(e.target.value),style:{minHeight:"120px",textAlign:"center"}})})]}),u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"0 8px"},children:u.jsx("span",{style:{fontSize:"24px",color:"var(--muted)"},children:"←"})})]}),u.jsxs("div",{className:"map-col",children:[u.jsx("div",{className:"small-h",dir:"rtl",style:{textAlign:"center"},children:"פירוט הפרסר"}),u.jsx("div",{className:"map-card",children:u.jsx("textarea",{className:"map-notes",placeholder:"Define mapping logic...",value:le,onChange:e=>ce(e.target.value),style:{minHeight:"120px",textAlign:"center"}})})]}),u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"0 8px"},children:u.jsx("span",{style:{fontSize:"24px",color:"var(--muted)"},children:"←"})}),u.jsxs("div",{className:"map-col",children:[u.jsx("div",{className:"small-h",dir:"rtl",style:{textAlign:"center"},children:'שדה מהדג"ח'}),u.jsxs("div",{className:"map-card",style:{textAlign:"center"},children:[u.jsx("div",{className:"map-main",children:ne.field.name}),u.jsx("div",{className:"map-sub",children:ne.field.fieldType}),u.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",marginTop:"8px"},children:[u.jsxs("div",{children:[u.jsx("strong",{children:"מהות השדה:"})," ",ne.field.fieldEssence||"-"]}),u.jsxs("div",{children:[u.jsx("strong",{children:'דג"ח:'})," ",ne.field.dgh||"-"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"האם יחזור תמיד:"})," ",ne.field.always||"-"]})]})]})]})]}),u.jsx("div",{style:{marginTop:"20px",display:"flex",alignItems:"center",gap:"12px"},children:u.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"14px"},children:[u.jsx("input",{type:"checkbox",checked:ge,onChange:e=>xe(e.target.checked),style:{width:"16px",height:"16px",accentColor:"var(--accent)",cursor:"pointer"}}),u.jsx("span",{dir:"rtl",children:"הפרסור יתבצע רק בoutputs ספציפיים"})]})}),u.jsxs("div",{style:{marginTop:"24px",display:"flex",gap:"12px",justifyContent:"flex-end"},children:[u.jsx("button",{className:"btn ghost",onClick:()=>ie(null),children:"Cancel"}),u.jsx("button",{className:"btn primary",onClick:()=>{try{const e={targetNode:ne.targetNode,field:ne.field,mappingDetails:le,outputs:he,timestamp:Date.now()};ht(e)}catch(e){alert("Failed to save mapping. Check console for details.")}},children:"Save Mapping"})]})]})})}),Pe&&u.jsx("div",{className:"modal-overlay",onClick:()=>{qe(!1),He(null)},children:u.jsx("div",{className:"modal",onClick:e=>e.stopPropagation(),children:u.jsxs("div",{style:{padding:"20px"},dir:"rtl",children:[u.jsx("h3",{style:{margin:"0 0 12px 0",textAlign:"center"},children:"זהירות!"}),u.jsx("p",{style:{margin:"0 0 16px 0",textAlign:"center"},children:'אתם משתמשים בשדה בתקן שכבר נמצא בשימוש עם שדה אחר בדג"ח! אתם בטוחים שאתם רוצים להמשיך?'}),u.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[u.jsx("button",{className:"btn ghost",onClick:()=>{qe(!1),He(null),Je(null),Ke(null)},children:"בטל"}),u.jsx("button",{className:"btn primary",onClick:()=>{if("drop"===Xe&&Ve){const{targetNode:e,field:t}=Ve;ie({targetNode:e,field:t}),se(t.name||""),ce(""),ue(e.name||""),xe(!1),me("")}else"save"===Xe&&Ye&&ht(Ye);qe(!1),He(null),Je(null),Ke(null)},children:"המשך"})]})]})})}),Re&&u.jsx("div",{className:"modal-overlay",onClick:()=>$e(!1),children:u.jsx("div",{className:"modal",onClick:e=>e.stopPropagation(),children:u.jsxs("div",{style:{padding:"20px"},dir:"rtl",children:[u.jsx("h3",{style:{margin:"0 0 12px 0",textAlign:"center"},children:"חסרים שדות חובה"}),u.jsxs("p",{style:{margin:"0 0 16px 0",textAlign:"center"},children:["ישנם ",dt.length," שדות חובה שעדיין לא מולאו."]}),u.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[u.jsx("button",{className:"btn ghost",onClick:()=>$e(!1),children:"בטל"}),u.jsx("button",{className:"btn primary",onClick:()=>{window.dispatchEvent(new Event("excel:download-mapping-request")),$e(!1)},children:"הורד בכל זאת"})]})]})})})]}),u.jsx(Se,{isOpen:a,onClose:()=>o(!1)}),u.jsx(ke,{isOpen:s,onClose:()=>c(!1)})]})}function Re(){return u.jsx(Ce,{children:u.jsx(N,{children:u.jsx(J,{children:u.jsx(Ae,{})})})})}t.createRoot(document.getElementById("root")).render(u.jsx(h.StrictMode,{children:u.jsx(Re,{})}))}},function(){return y||(0,f[n(f)[0]])((y={exports:{}}).exports,y),y.exports});export default b();
