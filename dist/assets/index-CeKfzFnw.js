var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertyNames,i=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,s=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,l=(e,t)=>{for(var r in t||(t={}))o.call(t,r)&&s(e,r,t[r]);if(i)for(var r of i(t))a.call(t,r)&&s(e,r,t[r]);return e},d=(e,n)=>t(e,r(n)),c=(e,t,r)=>s(e,"symbol"!=typeof t?t+"":t,r),p=(e,t,r)=>new Promise((n,i)=>{var o=e=>{try{s(r.next(e))}catch(t){i(t)}},a=e=>{try{s(r.throw(e))}catch(t){i(t)}},s=e=>e.done?n(e.value):Promise.resolve(e.value).then(o,a);s((r=r.apply(e,t)).next())});import{r as g,a as u,R as x}from"./vendor-CANkOXcB.js";import{e as m}from"./excel-Dy7BQwje.js";import{P as h,I as f}from"./azure-Dk662cfU.js";var y,b,v=(y={"assets/index-CeKfzFnw.js"(e){!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var t={exports:{}},r={},n=g,i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,y={key:!0,ref:!0,__self:!0,__source:!0};function b(e,t,r){var n,o={},l=null,d=null;for(n in void 0!==r&&(l=""+r),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,n)&&!y.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===o[n]&&(o[n]=t[n]);return{$$typeof:i,type:e,key:l,ref:d,props:o,_owner:s.current}}r.Fragment=o,r.jsx=b,r.jsxs=b,t.exports=r;var v=t.exports,w={},S=u;w.createRoot=S.createRoot,w.hydrateRoot=S.hydrateRoot;let j=0;function k(){return j+=1,String(j)}function C(e){if(null===e)return"null";const t=typeof e;return Array.isArray(e)?"array":"object"===t?"object":"string"===t?"string":"number"===t?Number.isInteger(e)?"integer":"number":"boolean"===t?"boolean":"unknown"}function E(e,t){try{switch(t){case"string":{const t=String(e),r=t.length>64?t.slice(0,61)+"…":t;return{description:`String of length ${t.length}.`,preview:'"'+r+'"'}}case"number":return{description:"Floating-point numeric value."};case"integer":return{description:"Numeric value."};case"boolean":return{description:"Boolean value."};case"null":return{description:"Null value."};case"array":{const t=Array.isArray(e)?e:[],r=t.length,n=r>0?C(t[0]):"unknown",i=t.slice(0,5).map(e=>function(e){const t=C(e);return"string"===t?'"'+String(e).replace(/\s+/g," ").slice(0,24)+(String(e).length>24?"…":"")+'"':"number"===t||"boolean"===t||"null"===t?String(e):"array"===t?"[…]":"object"===t?"{…}":String(e)}(e));return{description:`Array with ${r} item${1===r?"":"s"}${"unknown"!==n?` (e.g., ${n})`:""}.`,preview:`[${i.join(", ")}${r>5?", …":""}]`}}case"object":{const t=e&&"object"==typeof e?e:{};if("preview"in t||"excelMeta"in t){const e="string"==typeof t.preview?t.preview:void 0;return{description:void 0,preview:e,excelMeta:t.excelMeta}}const r=Object.keys(t),n=r.slice(0,5);return{description:`Object with ${r.length} key${1===r.length?"":"s"}.`,preview:`{ ${n.join(", ")}${r.length>5?", …":""} }`}}default:return{}}}catch(r){return{}}}function D(e,t,r=[]){const n=C(t),{description:i,preview:o,excelMeta:a}=E(t,n),s={id:(r.length?r.join("."):"root")+":"+k(),name:e,type:n,description:i,valuePreview:o,excelMeta:a};if("object"===n){const e=t;if(e&&(Object.prototype.hasOwnProperty.call(e,"preview")||Object.prototype.hasOwnProperty.call(e,"excelMeta")))return s.type="string",s;const n=Object.keys(e).sort();s.children=n.map(t=>D(t,e[t],[...r,t]))}else if("array"===n){const e=t;s.children=e.map((e,t)=>D(`[${t}]`,e,[...r,String(t)]))}return s}function T(e){const t=[];return e.enum&&t.push(`enum: ${e.enum.map(e=>JSON.stringify(e)).join(", ")}`),void 0!==e.const&&t.push(`const: ${JSON.stringify(e.const)}`),e.pattern&&t.push(`pattern: ${e.pattern}`),"number"==typeof e.minLength&&t.push(`minLength: ${e.minLength}`),"number"==typeof e.maxLength&&t.push(`maxLength: ${e.maxLength}`),e.format&&t.push(`format: ${e.format}`),"number"==typeof e.minimum&&t.push(`minimum: ${e.minimum}`),"number"==typeof e.maximum&&t.push(`maximum: ${e.maximum}`),"number"==typeof e.exclusiveMinimum&&t.push(`exclusiveMinimum: ${e.exclusiveMinimum}`),"number"==typeof e.exclusiveMaximum&&t.push(`exclusiveMaximum: ${e.exclusiveMaximum}`),"number"==typeof e.multipleOf&&t.push(`multipleOf: ${e.multipleOf}`),t.length?t:void 0}function N(e,t,r=[],n=!0){var i,o,a;const s=function(e){const t=Array.isArray(e.type)?e.type[0]:e.type;return t?"integer"===t?"integer":"number"===t?"number":"string"===t?"string":"boolean"===t?"boolean":"null"===t?"null":"array"===t?"array":"object":"object"}(t),l={id:(r.length?r.join("."):"root")+":"+k(),name:e,type:s,description:t.description,rules:T(t)},d=Array.isArray(t.allOf)&&t.allOf.length>0?t.allOf.map((e,t)=>{var i;const o=e.title||`[allOf ${t+1}]`,a=(null==(i=e.title)?void 0:i.replace(/\s+/g,"_"))||`allOf_${t+1}`;return N(o,e,[...r,a],n)}):[];if("object"===s){const e=null!=(i=t.properties)?i:{},a=Object.keys(e).sort(),s=new Set(null!=(o=t.required)?o:[]),c=a.map(t=>{const i=e[t],o=s.has(t),a=N(t,i,[...r,t],o&&n);return a.requiredState=o?n?"required":"conditional":"optional",a});l.children=[...c,...d]}else if("array"===s){const e=t.items;Array.isArray(e)?l.children=e.map((e,t)=>N(`[${t}]`,e,[...r,String(t)],n)):e&&(l.children=[N("[item]",e,[...r,"item"],n)]),d.length&&(l.children=(null!=(a=l.children)?a:[]).concat(d))}else d.length&&(l.children=d);return l}function z(e){if(function(e){if(!e||"object"!=typeof e)return!1;const t=e;return"$schema"in t||"properties"in t&&"object"==typeof t.properties||"type"in t&&("object"===t.type||"array"===t.type)}(e)){const t=e;return N(t.title||"root",t,[],!0)}return D("root",e)}function I({node:e,depth:t,isRoot:r=!1,defaultOpenChildren:n=!1,forcePreferredSide:i}){var o,a,s,c;const[p,u]=g.useState(n||0===t),[x,m]=g.useState(!1),[h,f]=g.useState(null!=i?i:"right"),[y,b]=g.useState(!1),w=g.useRef(null),S=g.useRef(0),j=(null!=(a=null==(o=e.children)?void 0:o.length)?a:0)>0,k=g.useMemo(()=>{const e=1.8*Math.pow(.85,t);return Math.max(.5,e)},[t]),C=g.useMemo(()=>{if(!j||!e.children)return!1;const t=e.children.filter(e=>"required"===e.requiredState);return 0!==t.length&&t.every(e=>e.excelMeta&&Object.keys(e.excelMeta).length>0)},[j,e.children]),E=g.useMemo(()=>{const t={"--scale":String(k),"--indicator-border":"rgba(255,255,255,0.20)","--indicator-bg":j?"linear-gradient(180deg, rgba(124,192,255,0.22), rgba(124,192,255,0.10))":"linear-gradient(180deg, rgba(255,140,26,0.22), rgba(255,140,26,0.10))","--indicator-shadow":"inset 0 1px 0 rgba(255,255,255,0.14), 0 10px 24px rgba(0,0,0,0.35)"};if(e.excelMeta&&Object.keys(e.excelMeta).length>0||C){const e=d(l({},t),{borderColor:"rgba(76,175,80,0.45)",background:"linear-gradient(180deg, rgba(76,175,80,0.12), rgba(76,175,80,0.06))",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.14), 0 12px 28px rgba(76,175,80,0.24)","--indicator-border":"rgba(76,175,80,0.45)","--indicator-bg":"linear-gradient(180deg, rgba(76,175,80,0.20), rgba(76,175,80,0.10))","--indicator-shadow":"inset 0 1px 0 rgba(255,255,255,0.14), 0 12px 28px rgba(76,175,80,0.24)"});return y&&(e.borderColor="rgba(76,175,80,0.85)",e.boxShadow="inset 0 1px 0 rgba(255,255,255,0.14), 0 0 0 2px rgba(76,175,80,0.85), 0 0 28px rgba(76,175,80,0.46)"),y&&j&&(e.cursor='url("./cursors/circle.cur"), copy'),e}if("required"===e.requiredState){const e=d(l({},t),{borderColor:"rgba(255,80,80,0.45)",background:"linear-gradient(180deg, rgba(255,80,80,0.12), rgba(255,80,80,0.06))",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.14), 0 12px 28px rgba(255,80,80,0.24)","--indicator-border":"rgba(255,80,80,0.45)","--indicator-bg":"linear-gradient(180deg, rgba(255,80,80,0.20), rgba(255,80,80,0.10))","--indicator-shadow":"inset 0 1px 0 rgba(255,255,255,0.14), 0 12px 28px rgba(255,80,80,0.24)"});return y&&(e.borderColor="rgba(255,80,80,0.85)",e.boxShadow="inset 0 1px 0 rgba(255,255,255,0.14), 0 0 0 2px rgba(255,80,80,0.85), 0 0 28px rgba(255,80,80,0.46)"),y&&j&&(e.cursor='url("./cursors/circle.cur"), copy'),e}return y&&j&&(t.cursor='url("./cursors/circle.cur"), copy'),t},[e.requiredState,k,j,y,e.excelMeta,C]),D=g.useMemo(()=>{var t;const r=null!=(t=e.children)?t:[],n=[];for(let e=0;e<r.length;e++)n.push({left:r[e],right:void 0});return n},[e.children]),T=g.useRef([]),N=g.useRef(null),z=e=>{var t;try{if(!0===window.__excelDragging)return!0;const r=null==(t=e.dataTransfer)?void 0:t.types;if(r){const e=Array.from(r);if(e.includes("application/vnd.excel-field"))return!0;if(e.includes("application/json"))return!0}}catch(r){console.debug("Excel drag detection failed",r)}return!1};g.useEffect(()=>{p&&w.current&&(window.clearTimeout(w.current),w.current=null)},[p]);const M=e=>{const{detail:t}=e;(null==t?void 0:t.forceSide)&&(f(t.forceSide),A(),L(6))},L=(t=8)=>{let r=0;const n=()=>{(()=>{var t;let r=null;const n=null==(t=N.current)?void 0:t.querySelector(":scope > .tree-node"),o=null==n?void 0:n.querySelector(".node-tile");if(o){const e=o.getBoundingClientRect();r=e.left+e.width/2}const a=document.querySelector('svg[data-role="connectors"]'),s=[];a&&a.querySelectorAll('path[data-orientation="trunk"]').forEach(e=>{const t=parseFloat(e.getAttribute("data-x")||"NaN"),r=parseFloat(e.getAttribute("data-y1")||"NaN"),n=parseFloat(e.getAttribute("data-y2")||"NaN"),i=e.getAttribute("data-parent-id")||void 0;Number.isNaN(t)||Number.isNaN(r)||Number.isNaN(n)||s.push({x:t,y1:r,y2:n,parentId:i})});let l=0,d=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(T.current.forEach(e=>{if(!e)return;const t=e.getBoundingClientRect();d=Math.min(d,t.top),c=Math.max(c,t.bottom)}),d<c){const t=(d+c)/2;s.forEach(({x:n,y1:i,y2:o,parentId:a})=>{if(a&&a===e.id)return;if(t<i||t>o)return;const s=Math.min(120,Math.min(120,.08*window.innerWidth)),d=n-18,c=n+18,p=(null!=r?r:0)+l-s,g=(null!=r?r:0)+l+s;if(!(g<d||p>c))if(null!=r&&n>=r){const e=Math.max(0,c-p);l-=e}else{const e=Math.max(0,g-d);l+=e}})}const p=Math.min(200,.12*window.innerWidth);l=Math.max(-p,Math.min(p,l));const g=null!=i?i:h;"left"===g&&(l=Math.min(0,l)),"right"===g&&(l=Math.max(0,l)),T.current.forEach(e=>{if(!e)return;const t=Math.min(120,Math.min(120,.08*window.innerWidth));e.style.setProperty("--child-spread",`${t.toFixed(2)}px`),e.style.setProperty("--branch-offset",`${l.toFixed(2)}px`)})})(),r+=1,r<t&&requestAnimationFrame(n)};requestAnimationFrame(n)},A=()=>{var t;if(i)return void f(i);const r=N.current,n=null==r?void 0:r.dataset.forceSide;if(n)return f(n),void delete r.dataset.forceSide;const o=null==(t=N.current)?void 0:t.querySelector(":scope > .tree-node"),a=null==o?void 0:o.querySelector(".node-tile");if(!a)return;const s=a.getBoundingClientRect(),l=s.left+s.width/2,d=s.top+s.height/2,c=document.querySelector('svg[data-role="connectors"]');let p=null;if(c&&c.querySelectorAll('path[data-orientation="trunk"]').forEach(t=>{if(t.getAttribute("data-parent-id")===e.id)return;const r=parseFloat(t.getAttribute("data-x")||"NaN"),n=parseFloat(t.getAttribute("data-y1")||"NaN"),i=parseFloat(t.getAttribute("data-y2")||"NaN");Number.isNaN(r)||Number.isNaN(n)||Number.isNaN(i)||d<n||d>i||(null==p||Math.abs(r-l)<Math.abs(p-l))&&(p=r)}),null!=p)f(l<p?"left":"right");else{const e=384,t=window.innerWidth-e;f(l<e+t/2?"left":"right")}};return v.jsxs("li",{ref:N,className:"tree-li "+(r?"root":""),role:r?"treeitem":"none","aria-expanded":j?p:void 0,children:[v.jsxs("div",{className:"tree-node","data-depth":t,children:[v.jsx("div",{className:"node-row",style:{paddingLeft:0},children:v.jsxs("div",{ref:e=>{e&&e.addEventListener("search:layout-update",M)},className:"node-tile "+(x?"active":""),role:"button",tabIndex:0,onDragEnter:e=>{if(z(e))return S.current+=1,b(!0),void(!j||p||w.current||(w.current=window.setTimeout(()=>{u(!0),A(),L(6)},500)))},onDragOver:e=>{if(z(e))return j?(e.preventDefault(),e.dataTransfer.dropEffect="copy",p||w.current||(w.current=window.setTimeout(()=>{u(!0),A(),L(6)},500))):(e.preventDefault(),e.dataTransfer.dropEffect="copy"),void b(!0);e.preventDefault()},onDrop:t=>{try{const r=t.dataTransfer.getData("application/json");if(!r)return;const n=JSON.parse(r);if("excelField"===(null==n?void 0:n.kind))if(j){const t=`${e.name} אינו שדה בתקן אלא היררכיה, אפשר להכניס שדות מהאקסל רק לשדות בתקן בעלי סממן ⓘ מעל הקובייה.`;window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:t,type:"error",durationMs:5e3}}))}else window.dispatchEvent(new CustomEvent("excel:drop-on-node",{detail:{targetNode:e,field:n.field}}))}catch(r){}b(!1),S.current=0,w.current&&(window.clearTimeout(w.current),w.current=null)},onDragLeave:()=>{S.current=Math.max(0,S.current-1),0===S.current&&(b(!1),w.current&&(window.clearTimeout(w.current),w.current=null))},onClick:()=>{var e;if(j){const t=void 0!==(null==(e=N.current)?void 0:e.dataset.forceSide);u(e=>{const r=!!t||!e;return r&&(A(),L(6),t&&N.current&&delete N.current.dataset.forceSide),r})}else m(e=>!e)},onContextMenu:e=>{e.preventDefault(),m(e=>!e)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||m(e=>!e)},style:E,"data-node-id":e.id,"data-dragover":y?"1":"0","data-mapped":e.excelMeta&&Object.keys(e.excelMeta).length>0?"1":"0","data-all-mandatory-mapped":C?"1":"0","data-required":e.requiredState||void 0,children:[v.jsx("div",{className:"node-indicator",role:"button",tabIndex:0,"aria-label":j?p?"Collapse":"Expand":"No children",onClick:e=>{var t;if(e.stopPropagation(),j){const e=void 0!==(null==(t=N.current)?void 0:t.dataset.forceSide);u(t=>{const r=!!e||!t;return r&&(A(),L(6),e&&N.current&&delete N.current.dataset.forceSide),r})}else m(e=>!e)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.stopPropagation(),e.preventDefault(),e.currentTarget.click())},"data-openable":j?"1":"0","data-dir":j?"left"===h?"left":"right":"none","data-open":p?"1":"0"}),v.jsx("div",{className:"node-name",children:e.name}),v.jsx("div",{className:`node-type under t-${e.type}`,children:e.type})]})}),v.jsx("div",{className:"desc-panel "+(x?"open":""),"data-node-id":`${e.id}-desc`,children:v.jsxs("div",{className:"desc-content",children:[v.jsx("div",{className:"desc-title",children:"Description"}),v.jsx("div",{className:"desc-text",children:e.description||"No description available."}),e.rules&&e.rules.length>0&&v.jsxs("div",{className:"desc-preview",children:[v.jsx("span",{className:"label",children:"Rules:"}),v.jsx("div",{style:{display:"grid",gap:4},children:e.rules.map((e,t)=>v.jsx("code",{children:e},t))})]}),e.valuePreview&&v.jsxs("div",{className:"desc-preview",children:[v.jsx("span",{className:"label",children:"Preview"}),v.jsx("code",{children:e.valuePreview})]})]})})]}),j&&!r&&v.jsx("div",{className:"binary-children "+(p?"open":""),"data-parent-id":e.id,style:{overflow:p?"visible":void 0,transform:`translateX(${"left"===(null!=i?i:h)?"-140px":"140px"})`},children:D.map((e,r)=>v.jsxs("div",{className:"branch-row",ref:e=>T.current[r]=e,style:{zIndex:10+r},children:[e.left?v.jsx("div",{className:"branch-cell left",children:v.jsx(I,{node:e.left,depth:t+1,forcePreferredSide:h})},e.left.id):v.jsx("div",{className:"branch-cell placeholder"}),e.right?v.jsx("div",{className:"branch-cell right",children:v.jsx(I,{node:e.right,depth:t+1,forcePreferredSide:h})},e.right.id):v.jsx("div",{className:"branch-cell placeholder"})]},r))}),j&&r&&v.jsxs("div",{className:"root-split",children:[v.jsx("div",{className:"root-col left",children:v.jsx("div",{className:"binary-children "+(p?"open":""),"data-parent-id":e.id,style:{overflow:p?"visible":void 0},children:(null!=(s=e.children)?s:[]).filter((e,t)=>t%2==0).map((e,r)=>v.jsxs("div",{className:"branch-row",ref:e=>T.current[T.current.length]=e,style:{zIndex:10+r},children:[v.jsx("div",{className:"branch-cell left",children:v.jsx(I,{node:e,depth:t+1,forcePreferredSide:"left"})}),v.jsx("div",{className:"branch-cell placeholder"})]},`L-${e.id}-${r}`))})}),v.jsx("div",{className:"root-col right",children:v.jsx("div",{className:"binary-children "+(p?"open":""),"data-parent-id":e.id,style:{overflow:p?"visible":void 0},children:(null!=(c=e.children)?c:[]).filter((e,t)=>t%2==1).map((e,r)=>v.jsxs("div",{className:"branch-row",ref:e=>T.current[T.current.length]=e,style:{zIndex:10+r},children:[v.jsx("div",{className:"branch-cell placeholder"}),v.jsx("div",{className:"branch-cell right",children:v.jsx(I,{node:e,depth:t+1,forcePreferredSide:"right"})})]},`R-${e.id}-${r}`))})})]})]})}function M({root:e}){const t=e.children&&e.children.length>0;return v.jsxs("div",{className:"tree-view",children:[v.jsx("div",{className:"tree-canvas",children:v.jsx("ul",{className:"tree-root",role:"tree",children:v.jsx(I,{node:e,depth:0,isRoot:!0,defaultOpenChildren:!0})})}),t?null:v.jsx("div",{className:"placeholder",children:"No nested fields"})]})}function L({containerRef:e}){const[t,r]=g.useState(new Map),n=g.useRef(null),i=g.useRef(null),o=g.useRef(0),a=g.useCallback(()=>{if(!e.current)return;const t=new Map,n=e.current;n.querySelectorAll(".node-tile[data-node-id]").forEach(e=>{const r=e.getAttribute("data-node-id");if(!r)return;const i=e.getBoundingClientRect(),o=n.getBoundingClientRect(),a=window.getComputedStyle(n).transform;let s=1,l=1;if(a&&"none"!==a){const e=a.match(/matrix\(([^)]+)\)/);if(e){const[t,r,n,i]=e[1].split(",").map(e=>parseFloat(e.trim()));s=Math.sqrt(t*t+r*r)||1,l=Math.sqrt(n*n+i*i)||1}}const d=e.closest(".tree-node"),c=null==d?void 0:d.closest(".branch-cell"),p=null==c?void 0:c.closest(".branch-row"),g=null==p?void 0:p.closest(".binary-children"),u=null==g?void 0:g.closest(".tree-li"),x=null==u?void 0:u.querySelector(".node-tile[data-node-id]"),m=null==x?void 0:x.getAttribute("data-node-id");let h=!0,f=e;for(;f&&f!==n;){if(f.classList&&f.classList.contains("binary-children")&&!f.classList.contains("open")){h=!1;break}f=f.parentElement}const y=(i.left-o.left)/s+i.width/2/s,b=(i.top-o.top)/l+i.height/l;t.set(r,{id:r,parentId:null!=m?m:void 0,x:y,y:b,width:i.width/s,height:i.height/l,isVisible:h})}),r(t)},[]);return g.useEffect(()=>{const t=(e=400)=>{const t=performance.now()+e;if(o.current=Math.max(o.current,t),null==i.current){const e=()=>{i.current=null,a(),performance.now()<o.current&&(i.current=requestAnimationFrame(e))};i.current=requestAnimationFrame(e)}};a(),t(300);const r=new MutationObserver(()=>t(500));e.current&&r.observe(e.current,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","style"]});const n=new ResizeObserver(()=>t(200));e.current&&n.observe(e.current);const s=()=>{t(120)};window.addEventListener("scroll",s),window.addEventListener("resize",s);const l=()=>t(400),d=e.current;null==d||d.addEventListener("transitionrun",l,!0),null==d||d.addEventListener("transitionend",l,!0),null==d||d.addEventListener("animationstart",l,!0),null==d||d.addEventListener("animationend",l,!0);const c=new MutationObserver(()=>t(200));return e.current&&c.observe(e.current,{attributes:!0,attributeFilter:["style"]}),()=>{r.disconnect(),n.disconnect(),c.disconnect(),window.removeEventListener("scroll",s),window.removeEventListener("resize",s);const e=d;e&&(e.removeEventListener("transitionrun",l,!0),e.removeEventListener("transitionend",l,!0),e.removeEventListener("animationstart",l,!0),e.removeEventListener("animationend",l,!0)),null!=i.current&&cancelAnimationFrame(i.current),i.current=null,o.current=0}},[e]),e.current?v.jsx("svg",{ref:n,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:100,overflow:"visible"},"data-role":"connectors",children:(()=>{const e=[],r=new Map;return t.forEach(e=>{var n;if(!e.parentId||!e.isVisible)return;const i=t.get(e.parentId);if(!i||!i.isVisible)return;if(Number.isNaN(i.x)||Number.isNaN(i.y)||Number.isNaN(e.x)||Number.isNaN(e.y)||Number.isNaN(e.height)||Number.isNaN(e.width))return;const o=null!=(n=r.get(e.parentId))?n:[];o.push(e),r.set(e.parentId,o)}),r.forEach((r,n)=>{const i=t.get(n);if(!i)return;const o=new Map;r.forEach(e=>{const t=e.y-e.height/2,r=String(Math.round(t)),n=o.get(r);n?(n.items.push(e),n.y=(n.y*(n.items.length-1)+t)/n.items.length):o.set(r,{y:t,items:[e]})});const a=Array.from(o.values()).sort((e,t)=>e.y-t.y);if(a.length>0){const t=i.x,r=i.y,n=a[a.length-1].y;e.push(v.jsx("path",{d:`M ${t.toFixed(2)} ${r.toFixed(2)} L ${t.toFixed(2)} ${n.toFixed(2)}`,stroke:"rgba(124,192,255,0.8)",strokeWidth:2,strokeDasharray:"6 6",fill:"none",strokeLinecap:"butt",strokeLinejoin:"round","data-orientation":"trunk","data-parent-id":i.id,"data-x":t.toFixed(2),"data-y1":r.toFixed(2),"data-y2":n.toFixed(2)},`trunk-${i.id}`)),a.forEach(({y:r,items:n})=>{n.forEach(n=>{const o=n.x,a=o<t?o+n.width/2:o-n.width/2;e.push(v.jsx("path",{d:`M ${t.toFixed(2)} ${r.toFixed(2)} L ${a.toFixed(2)} ${r.toFixed(2)}`,stroke:"rgba(124,192,255,0.8)",strokeWidth:2,strokeDasharray:"6 6",fill:"none",strokeLinecap:"butt",strokeLinejoin:"round","data-orientation":"branch","data-y":r.toFixed(2)},`branch-${i.id}-${n.id}`))})})}}),e})()}):null}function A(e){const t=e.replace("#","");return`FF${t.substring(0,2)}${t.substring(2,4)}${t.substring(4,6)}`}const F={default:{bg:"linear-gradient(180deg, rgba(124,192,255,0.18), rgba(124,192,255,0.08))"},green:{bg:"#4CAF50"},red:{bg:"#F44336"},yellow:{bg:"#E6A700"}};function R(){const e="Segoe UI",t=14,r="#ffffff",n="#2a6bff",i=g.useRef(null),o=g.useRef(null),a=g.useRef(null),[s,c]=g.useState([]),[u,x]=g.useState(null),[h,f]=g.useState(""),[y,b]=g.useState([]),w=g.useCallback(e=>{const t=e.always||"";if(["כן","yes","true","תמיד","always","חובה","required","חיובי","positive"].some(e=>t.toLowerCase().includes(e)))return"green";if(["לא","no","false","אף פעם","never","אופציונלי","optional","שלילי","negative"].some(e=>t.toLowerCase().includes(e)))return"red";const r=e.fieldEssence||"";if(["מזהה","id","שם","name","תאריך","date","סכום","amount","חשוב","important","ראשי","primary"].some(e=>r.toLowerCase().includes(e)))return"green";const n=e.notes||"";return["אזהרה","warning","שים לב","attention","חשוב","important"].some(e=>n.toLowerCase().includes(e))?"yellow":"default"},[]),S=g.useCallback(()=>{x(null),f("")},[]),j=g.useMemo(()=>s.filter(e=>"green"===w({fieldEssence:e.fieldEssence||"",always:e.always||"",notes:e.notes||""})||e.isMapped),[s,w]),k=g.useCallback((e,t,r)=>{try{const n=r.trim();c(r=>r.map(r=>r.id===e?d(l({},r),{[t]:n}):r)),x(null),f("");const i={fieldEssence:"Field Essence",dgh:"DGH",always:"Always Return",notes:"Notes"};console.log(`${i[t]} updated for field ${e}:`,n||"(empty)");const o=s.find(t=>t.id===e);if(o){const e=n?`${i[t]} updated for "${o.name}"`:`${i[t]} cleared for "${o.name}"`;window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:e,type:"ok",durationMs:2e3}}))}}catch(n){console.error(`Failed to update ${t}:`,n),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`Failed to update ${t}: ${n}`,type:"error",durationMs:3e3}}))}},[s]),C=g.useCallback(()=>p(this,null,function*(){try{const i=["שם שדה","סוג שדה","מהות השדה",'דג"ח',"האם יחזור תמיד?","הערות"],o=new m.Workbook,a=o.addWorksheet("Template",{views:[{rightToLeft:!0}]});i.forEach((r,n)=>{const i=a.getColumn(n+1);i.width=Math.max(18,r.length+2),i.alignment={horizontal:"center",vertical:"middle",wrapText:!0},i.font={name:e,size:t}}),a.addRow(i);const s=a.getRow(1);s.height=50,s.eachCell(i=>{i.font={name:e,size:t,bold:!0,color:{argb:A(r)}},i.fill={type:"pattern",pattern:"solid",fgColor:{argb:A(n)}},i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},i.alignment={horizontal:"center",vertical:"middle",wrapText:!0}});const l=50;for(let r=2;r<=1+l;r++){const n=a.getRow(r);i.forEach((r,i)=>{const o=n.getCell(i+1);o.font={name:e,size:t},o.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},o.alignment={horizontal:"center",vertical:"middle",wrapText:!0}})}const d=yield o.xlsx.writeBuffer(),c=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=URL.createObjectURL(c),g=document.createElement("a");g.href=p,g.download="PaaS Template.xlsx",document.body.appendChild(g),g.click(),g.remove(),URL.revokeObjectURL(p)}catch(i){console.error("Failed to generate template:",i),alert("Failed to generate template. Check console for details.")}}),[]),E=(e,t=" -> ")=>{try{if(!e)return"";const r=null==e?void 0:e.path;if("string"==typeof r&&r.trim())return r.trim().split(".").join(t);const n=String(e.id||"").trim();if(!n)return e.name||"";const i=n.split(":")[0];return i&&"root"!==i&&i.includes(".")?i.split(".").join(t):e.name||""}catch(r){return console.error("Failed to compute full hierarchy label for targetNode:",r,e),(null==e?void 0:e.name)||""}},D=g.useCallback((i,o,a)=>p(this,null,function*(){try{const l=["שם שדה צד ספק","מהות השדה","סוג השדה צד ספק",'דג"ח',"שם השדה בתקן","סוג השדה בתקן","חוקי השדה בתקן","האם יחזור תמיד","פירוט הפרסר","המיפוי יתבצע בOUTPUTS הבאים:","הערות","האם צריך להזרים מהספק?"],d=new m.Workbook,c=d.addWorksheet("mapping",{views:[{rightToLeft:!0}]});l.forEach((r,n)=>{const i=c.getColumn(n+1);i.width=0===n?33:3===n?45:4===n?50:Math.max(18,r.length+2),i.alignment={horizontal:"center",vertical:"middle",wrapText:!0},i.font={name:e,size:t}}),c.addRow(l);const p=c.getRow(1);p.height=50,p.eachCell(i=>{i.font={name:e,size:t,bold:!0,color:{argb:A(r)}},i.fill={type:"pattern",pattern:"solid",fgColor:{argb:A(n)}},i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},i.alignment={horizontal:"center",vertical:"middle",wrapText:!0}});const g=new Map;if(o&&Array.isArray(o)&&o.forEach(e=>{var t,r;const n=`${(null==(t=null==e?void 0:e.field)?void 0:t.name)||""}__${(null==(r=null==e?void 0:e.field)?void 0:r.fieldType)||""}`;g.set(n,e)}),s&&s.length>0)s.filter(e=>"green"===w({fieldEssence:e.fieldEssence||"",always:e.always||"",notes:e.notes||""})||e.isMapped).forEach(r=>{var n,i,o,a;const s=g.get(`${r.name}__${r.fieldType}`),d=!(!s||!((null==(n=null==s?void 0:s.targetNode)?void 0:n.name)&&String(s.targetNode.name).trim()||(null==(i=null==s?void 0:s.targetNode)?void 0:i.path)))||!!r.isMapped,p=[r.name||"",r.fieldEssence||"",r.fieldType||"",r.dgh||"",E(null==s?void 0:s.targetNode,".")||"",(null==(o=null==s?void 0:s.targetNode)?void 0:o.type)||"",(null==(a=null==s?void 0:s.targetNode)?void 0:a.rules)?s.targetNode.rules.join(", "):"",r.always||"",(null==s?void 0:s.mappingDetails)||"",(null==s?void 0:s.outputs)||"",r.notes||"",""],u=c.addRow(p);try{if("yellow"===r.color||"red"===r.color){const e="yellow"===r.color?"#E6A700":"#F44336";u.eachCell(t=>{t.fill={type:"pattern",pattern:"solid",fgColor:{argb:A(e)}}})}}catch(x){console.warn("Failed to apply colored row background:",x)}l.forEach((n,i)=>{const o=u.getCell(i+1);if(o.font={name:e,size:t},o.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},o.alignment={horizontal:"center",vertical:"middle",wrapText:!0},i===l.length-1){const e=d?"FF90EE90":"yellow"===r.color?A("#E6A700"):"red"===r.color?A("#F44336"):"FFFFFFFF";o.fill={type:"pattern",pattern:"solid",fgColor:{argb:e}}}})});else if(i&&i.length>0)i.forEach((r,n)=>{const i=c.addRow(r);l.forEach((r,n)=>{const o=i.getCell(n+1);o.font={name:e,size:t},o.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},o.alignment={horizontal:"center",vertical:"middle",wrapText:!0},n===l.length-1&&(o.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFFFFF"}})})});else if(o&&o.length>0)console.log("Processing saved mappings for Excel generation:",o),o.forEach((r,n)=>{console.log(`Processing mapping ${n+1}:`,r);const i=[r.field.name||"",r.field.fieldEssence||"",r.field.fieldType||"",r.field.dgh||"",E(r.targetNode,".")||"",r.targetNode.type||"",r.targetNode.rules?r.targetNode.rules.join(", "):"",r.field.always||"",r.mappingDetails||"",r.outputs||"",r.field&&r.field.notes?r.field.notes:"",""];console.log(`Generated Excel row ${n+1}:`,i);const o=c.addRow(i);try{const e=null==s?void 0:s.find(e=>e.name===r.field.name&&e.fieldType===r.field.fieldType);if(e&&("yellow"===e.color||"red"===e.color)){const t="yellow"===e.color?"#E6A700":"#F44336";o.eachCell(e=>{e.fill={type:"pattern",pattern:"solid",fgColor:{argb:A(t)}}})}}catch(a){console.warn("Failed to apply colored row background (savedMappings branch):",a)}l.forEach((n,i)=>{var a,s;const d=o.getCell(i+1);if(d.font={name:e,size:t},d.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},d.alignment={horizontal:"center",vertical:"middle",wrapText:!0},i===l.length-1){const e=!!((null==(a=null==r?void 0:r.targetNode)?void 0:a.name)&&String(r.targetNode.name).trim()||(null==(s=null==r?void 0:r.targetNode)?void 0:s.path));d.fill={type:"pattern",pattern:"solid",fgColor:{argb:e?"FF90EE90":"FFFFFFFF"}}}})}),console.log(`Added ${o.length} rows to Excel worksheet`);else{console.log("No saved mappings found, creating empty template rows");const r=50;for(let n=2;n<=1+r;n++){const r=c.getRow(n);l.forEach((n,i)=>{const o=r.getCell(i+1);o.font={name:e,size:t},o.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},o.alignment={horizontal:"center",vertical:"middle",wrapText:!0}})}}if(y&&y.length>0){const i=d.addWorksheet('דג"ח',{views:[{rightToLeft:!0}]}),o=["שם שדה","סוג שדה","מהות השדה",'דג"ח',"האם יחזור תמיד?","הערות"];o.forEach((r,n)=>{const o=i.getColumn(n+1);o.width=Math.max(18,r.length+2),o.alignment={horizontal:"center",vertical:"middle",wrapText:!0},o.font={name:e,size:t}}),i.addRow(o);const a=i.getRow(1);a.height=50,a.eachCell(i=>{i.font={name:e,size:t,bold:!0,color:{argb:A(r)}},i.fill={type:"pattern",pattern:"solid",fgColor:{argb:A(n)}},i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},i.alignment={horizontal:"center",vertical:"middle",wrapText:!0}}),y.forEach(r=>{const n=i.addRow([r.name||"",r.type||"",r.essence||"",r.dgh||"",r.always||"",r.notes||""]),a=w({fieldEssence:r.essence||"",always:r.always||"",notes:r.notes||""});o.forEach((r,i)=>{const o=n.getCell(i+1);o.font={name:e,size:t},o.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},o.alignment={horizontal:"center",vertical:"middle",wrapText:!0},"default"!==a&&(o.fill={type:"pattern",pattern:"solid",fgColor:{argb:A(F[a].bg)}})})})}if(a){const e=d.addWorksheet("__meta");e.getCell("A1").value="schemaKey",e.getCell("B1").value=a,e.state="veryHidden"}return d}catch(l){throw console.error("Failed to generate mapping workbook:",l),l}}),[s,y]),T=g.useCallback(()=>p(this,null,function*(){try{console.log("Getting saved mappings from global state...");let e=[];const t=new CustomEvent("excel:request-mappings",{detail:{callback:t=>{e=t}}});window.dispatchEvent(t),yield new Promise(e=>setTimeout(e,100));let r="";const n=new CustomEvent("excel:request-selected-schema",{detail:{callback:e=>{r=e}}});window.dispatchEvent(n),yield new Promise(e=>setTimeout(e,50)),console.log("Final saved mappings for Excel generation:",e);const i=yield D(void 0,e,r),o=yield i.xlsx.writeBuffer(),a=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=URL.createObjectURL(a),l=document.createElement("a");l.href=s,l.download="mapping.xlsx",document.body.appendChild(l),l.click(),l.remove(),URL.revokeObjectURL(s)}catch(e){console.error("Failed to download mapping excel:",e),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`Failed to download mapping excel: ${e}`,type:"error",durationMs:5e3}}))}}),[D]),N=g.useCallback(e=>p(this,null,function*(){var t,r,n,i,o,a,d,p,g,u,x;try{const f=yield e.arrayBuffer(),y=new m.Workbook;yield y.xlsx.load(f);let b="";try{const e=y.getWorksheet("__meta");if(e){const t=e.getCell("B1"),r=null==t?void 0:t.value;"string"==typeof r&&(b=r.trim()),!b&&"object"==typeof r&&r&&"text"in r&&(b=String(r.text||"").trim())}}catch(h){console.warn("No __meta sheet found in mapping file or failed to read schema key")}const v=y.worksheets[0];if(!v)throw new Error("No worksheet found in uploaded mapping file");const S=v.getRow(1),j={};S.eachCell((e,t)=>{var r;const n=String(null!=(r=e.value)?r:"").trim();n&&(j[n]=t)});const k=e=>{for(const t of e)if(null!=j[t])return j[t];return-1},C=k(["שם שדה צד ספק"]),D=k(["מהות השדה"]),T=k(["סוג השדה צד ספק"]),N=k(['דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח','דג"ח']),z=k(["שם השדה בתקן"]),I=k(["סוג השדה בתקן"]),M=k(["חוקי השדה בתקן"]),L=k(["האם יחזור תמיד"]),F=k(["פירוט הפרסר"]),R=k(["המיפוי יתבצע בOUTPUTS הבאים:"]),$=k(["הערות"]),_=[],B=new Map;s.forEach(e=>{B.set(`${e.name}__${e.fieldType}`,l({},e))});const W=v.rowCount;for(let e=2;e<=W;e++){const s=v.getRow(e),c=(()=>{try{let e=!1;return s.eachCell(t=>{const r=t&&t.fill||null,n=r&&r.fgColor&&(r.fgColor.argb||r.fgColor.rgb)||"";if("string"==typeof n&&n){const t=n.toUpperCase();t!==A("#E6A700").toUpperCase()&&"FFE6A700"!==t||(e=!0)}}),e}catch(h){return!1}})(),m=(()=>{try{let e=!1;return s.eachCell(t=>{const r=t&&t.fill||null,n=r&&r.fgColor&&(r.fgColor.argb||r.fgColor.rgb)||"";if("string"==typeof n&&n){const t=n.toUpperCase();t!==A("#F44336").toUpperCase()&&"FFF44336"!==t||(e=!0)}}),e}catch(h){return!1}})(),f=C>0?String(null!=(t=s.getCell(C).value)?t:"").trim():"",y=T>0?String(null!=(r=s.getCell(T).value)?r:"").trim():"",b=D>0?String(null!=(n=s.getCell(D).value)?n:"").trim():"",S=N>0?String(null!=(i=s.getCell(N).value)?i:"").trim():"",j=z>0?String(null!=(o=s.getCell(z).value)?o:"").trim():"",k=(()=>{try{if(!j)return"";if(j.includes("->")){const e=j.split("->").map(e=>e.trim()).filter(Boolean),t=e.length?e[e.length-1]:j;return{targetName:t,targetPath:e.join(".")}}return{targetName:j,targetPath:""}}catch(h){return console.error("Failed to parse target name from imported mapping row:",h,j),{targetName:j,targetPath:""}}})(),W="object"==typeof k&&k?k.targetName:"",O="object"==typeof k&&k?k.targetPath:"",U=I>0?String(null!=(a=s.getCell(I).value)?a:"").trim():"",P=M>0?String(null!=(d=s.getCell(M).value)?d:"").trim():"",q=L>0?String(null!=(p=s.getCell(L).value)?p:"").trim():"",Y=F>0?String(null!=(g=s.getCell(F).value)?g:"").trim():"",H=R>0?String(null!=(u=s.getCell(R).value)?u:"").trim():"",V=$>0?String(null!=(x=s.getCell($).value)?x:"").trim():"";if(![f,y,b,S,W,U,P,q,Y,H,V].some(Boolean))continue;const J=`${f}__${y}`,X=B.get(J);X?(X.fieldEssence=b||X.fieldEssence||"",X.dgh=S||X.dgh||"",X.always=q||X.always||"",X.notes=V||X.notes||"",W||Y||H?(X.isMapped=!0,X.mappedTargetLabel=E({id:"",name:W,path:O})||"",X.color=c||m?c?"yellow":"red":w({fieldEssence:X.fieldEssence||"",always:X.always||"",notes:X.notes||""})):(c||m)&&(X.color=c?"yellow":"red"),B.set(J,X)):B.set(J,{id:`excel-imported-${B.size+1}`,name:f||`Field_${B.size+1}`,fieldType:y||"",fieldEssence:b||"",dgh:S||"",always:q||"",notes:V||"",expanded:!1,isMapped:!!(W||Y||H),mappedTargetLabel:W||Y||H?E({id:"",name:W,path:O})||"":void 0,color:c?"yellow":m?"red":w({fieldEssence:b||"",always:q||"",notes:V||""})}),_.push({targetNode:l({id:`import-${e}`,name:W,type:U,rules:P?P.split(",").map(e=>e.trim()).filter(Boolean):[]},O?{path:O}:{}),field:{name:f,fieldType:y,fieldEssence:b,dgh:S,always:q,notes:V},mappingDetails:Y,outputs:H,timestamp:Date.now()})}const O=Array.from(B.values());c(O),window.dispatchEvent(new CustomEvent("excel:mappings-imported",{detail:{mappings:_}})),b&&window.dispatchEvent(new CustomEvent("excel:apply-selected-schema",{detail:{key:b}})),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`Mapping file loaded. ${O.length} fields refreshed`,type:"ok",durationMs:4e3}}))}catch(f){console.error("Failed to parse mapping Excel:",f),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"Failed to parse mapping Excel",type:"error",durationMs:5e3}}))}}),[s]),z=g.useCallback(e=>p(this,null,function*(){var t,r,n,i,o,a;try{const s=yield e.arrayBuffer(),l=new m.Workbook;yield l.xlsx.load(s);const d=l.worksheets[0];if(!d)throw new Error("No worksheet found in uploaded file");const p=[],g=d.rowCount;for(let e=2;e<=g;e++){const s=String(null!=(t=d.getRow(e).getCell(1).value)?t:"").trim(),l=String(null!=(r=d.getRow(e).getCell(2).value)?r:"").trim(),c=String(null!=(n=d.getRow(e).getCell(3).value)?n:"").trim(),g=String(null!=(i=d.getRow(e).getCell(4).value)?i:"").trim(),u=String(null!=(o=d.getRow(e).getCell(5).value)?o:"").trim(),x=String(null!=(a=d.getRow(e).getCell(6).value)?a:"").trim();(s||l||c||g||u||x)&&p.push({name:s,type:l,essence:c,dgh:g,always:u,notes:x})}b(p);const u=[];p.forEach((e,t)=>{const r={id:`excel-${t+1}`,name:e.name||`Field_${t+1}`,fieldType:e.type||"",fieldEssence:e.essence||"",dgh:e.dgh||"",always:e.always||"",notes:e.notes||"",expanded:!1,color:w({fieldEssence:e.essence||"",always:e.always||"",notes:e.notes||""})};u.push(r)}),c(u);const x=p.length,h=u.length;let f="",y="ok";0===x?(f="האקסל ריק או שלא הצלחתי לקרוא אותו :(",y="error"):h===x?(f=`אקסל הועלה בהצלחה! ${h} שדות חולצו מתוך ${x} שורות באקסל.`,y="ok"):(f=`אקסל הועלה בהצלחה! ${h} שדות חולצו מתוך ${x} שורות באקסל.`,y="warn"),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:f,type:y,durationMs:5e3}})),h>0&&window.dispatchEvent(new CustomEvent("excel:uploaded"))}catch(s){console.error("Failed to parse uploaded Excel:",s),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"Excel is empty or couldn't read it",type:"error",durationMs:5e3}}))}}),[]),I=g.useCallback(()=>{try{if(c([]),b([]),x(null),f(""),a.current){try{a.current.remove()}catch(e){}a.current=null}window.dispatchEvent(new Event("excel:clear-all-mappings")),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:'נוקה ממשק הדג"ח',type:"ok",durationMs:2500}}))}catch(t){console.error("Failed to clear Excel extractor:",t),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`ניקוי נכשל: ${t}`,type:"error",durationMs:4e3}}))}},[]);return g.useEffect(()=>{const e=()=>{C()},t=()=>{T()},r=()=>{var e;null==(e=i.current)||e.click()},n=()=>{var e;null==(e=o.current)||e.click()},a=e=>p(this,null,function*(){try{const{data:t,filename:r="mapping.xlsx"}=e.detail||{};let n="";const i=new CustomEvent("excel:request-selected-schema",{detail:{callback:e=>{n=e}}});window.dispatchEvent(i),yield new Promise(e=>setTimeout(e,50));const o=yield D(t,void 0,n),a=yield o.xlsx.writeBuffer(),s=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=URL.createObjectURL(s),d=document.createElement("a");d.href=l,d.download=r,document.body.appendChild(d),d.click(),d.remove(),URL.revokeObjectURL(l)}catch(t){console.error("Failed to save mapping excel:",t),alert("Failed to save mapping excel. Check console for details.")}}),s=e=>{const{field:t,targetNode:r}=e.detail||{};t&&c(e=>e.map(e=>{if(e.name===t.name&&e.fieldType===t.fieldType){const t=E(r);return d(l({},e),{isMapped:!0,mappedTargetLabel:t||void 0,color:e.color||"default"})}return e}))};return window.addEventListener("excel:download-template-request",e),window.addEventListener("excel:download-mapping-request",t),window.addEventListener("excel:upload-request",r),window.addEventListener("excel:upload-mapping-request",n),window.addEventListener("excel:save-mapping-request",a),window.addEventListener("excel:mapping-saved",s),()=>{window.removeEventListener("excel:download-template-request",e),window.removeEventListener("excel:download-mapping-request",t),window.removeEventListener("excel:upload-request",r),window.removeEventListener("excel:upload-mapping-request",n),window.removeEventListener("excel:save-mapping-request",a),window.removeEventListener("excel:mapping-saved",s)}},[C,T,D]),v.jsx("aside",{className:"fridge-panel",children:v.jsxs("div",{className:"fridge-door",children:[v.jsx("div",{className:"fridge-handle"}),v.jsx("div",{className:"fridge-title",children:'פרק תדג"ח'}),v.jsx("div",{className:"fridge-subtitle",children:'שדות מהדג"ח'}),v.jsx("div",{className:"fridge-divider"}),j.length>0&&v.jsx("div",{className:"excel-fields",onDragOver:e=>{e.preventDefault()},children:v.jsx("div",{className:"excel-fields-list",children:j.map((e,t)=>v.jsxs("div",{"data-field-id":e.id,"data-color":e.color,className:`excel-cube ${e.expanded?"open":""} ${e.isMapped?"mapped":""} ${(null==u?void 0:u.id)===e.id?"editing":""}`,draggable:!0,style:{background:e.isMapped?void 0:e.color?F[e.color].bg:F.default.bg,boxShadow:e.isMapped?void 0:"0 4px 12px rgba(0,0,0,0.2)"},onDragStart:t=>{t.dataTransfer.setData("application/json",JSON.stringify({kind:"excelField",field:e})),t.dataTransfer.setData("application/vnd.excel-field","1"),t.dataTransfer.effectAllowed="copy",window.__excelDragging=!0,window.dispatchEvent(new CustomEvent("excel:drag-start",{detail:e}));try{a.current&&(a.current.remove(),a.current=null);const e=t.currentTarget.cloneNode(!0);e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.pointerEvents="none",e.style.transform="none",e.style.boxShadow="0 10px 28px rgba(0,0,0,0.36)",e.style.color="#ffffff",e.style.filter="saturate(1.1) brightness(1.05)",e.style.opacity="0.95",document.body.appendChild(e),a.current=e;const r=e.getBoundingClientRect(),n=r.width/2,i=r.height/2;t.dataTransfer.setDragImage&&t.dataTransfer.setDragImage(e,n,i)}catch(r){console.debug("Failed to set custom drag image",r)}},onDragEnd:()=>{if(window.__excelDragging=!1,window.dispatchEvent(new Event("excel:drag-end")),a.current){try{a.current.remove()}catch(e){}a.current=null}},onClick:e=>{const r=e.target;r.closest(".editable-field")||r.closest("input")||r.closest("textarea")?e.stopPropagation():c(e=>e.map((e,r)=>r===t?d(l({},e),{expanded:!e.expanded}):e))},children:[v.jsxs("div",{className:"excel-cube-head",style:{position:"relative"},children:[v.jsx("div",{className:"excel-cube-name",children:e.name}),e.fieldType&&v.jsx("div",{className:"excel-cube-sub",children:e.fieldType}),e.isMapped&&v.jsx("div",{className:"mapping-checkmark",title:"Field is mapped",style:{position:"absolute",top:"8px",right:"8px",width:"20px",height:"20px",borderRadius:"50%",backgroundColor:"#4CAF50",border:"2px solid #000",display:"flex",alignItems:"center",justifyContent:"center",color:"#000",fontSize:"12px",fontWeight:"bold",zIndex:1},children:"✓"})]}),v.jsxs("div",{className:"excel-cube-desc",dir:"rtl",style:{display:e.expanded?"grid":"none"},children:[v.jsxs("div",{className:"row",children:[v.jsx("span",{className:"k",children:"מהות השדה:"}),(null==u?void 0:u.id)===e.id&&"fieldEssence"===u.field?v.jsx("textarea",{className:"editable-field",value:h,onChange:e=>{f(e.target.value);const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onFocus:e=>{const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onKeyDown:t=>{var r,n;if("Enter"===t.key&&t.shiftKey){t.preventDefault();const e=t.currentTarget,i=null!=(r=e.selectionStart)?r:h.length,o=null!=(n=e.selectionEnd)?n:h.length,a=h.slice(0,i)+"\n"+h.slice(o);return f(a),void setTimeout(()=>{try{e.selectionStart=e.selectionEnd=i+1}catch(t){}},0)}"Enter"===t.key?k(e.id,"fieldEssence",h):"Escape"===t.key&&S()},onBlur:()=>{h.trim()!==(e.fieldEssence||"")?k(e.id,"fieldEssence",h):S()},autoFocus:!0,style:{border:"1px solid #7cc0ff",borderRadius:"4px",padding:"6px 8px",fontSize:"14px",width:"100%",minHeight:"64px",resize:"none",overflow:"hidden",backgroundColor:"rgba(124, 192, 255, 0.1)",color:"#e6f1ff",outline:"none",boxShadow:"0 0 0 2px rgba(124, 192, 255, 0.2)"}}):v.jsxs("span",{className:"v editable-field",onDoubleClick:t=>{t.stopPropagation(),x({id:e.id,field:"fieldEssence"}),f(e.fieldEssence||"")},style:{cursor:"pointer",whiteSpace:"pre-wrap"},title:"Double-click to edit",children:[e.fieldEssence||"-",v.jsx("span",{className:"edit-icon "+(e.fieldEssence?"":"empty"),children:v.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"18px",height:"18px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.1)",marginLeft:"6px"},children:v.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#000000"})})})})]})]}),v.jsxs("div",{className:"row",children:[v.jsx("span",{className:"k",children:'דג"ח:'}),(null==u?void 0:u.id)===e.id&&"dgh"===u.field?v.jsx("textarea",{className:"editable-field",value:h,onChange:e=>{f(e.target.value);const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onFocus:e=>{const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onKeyDown:t=>{var r,n;if("Enter"===t.key&&t.shiftKey){t.preventDefault();const e=t.currentTarget,i=null!=(r=e.selectionStart)?r:h.length,o=null!=(n=e.selectionEnd)?n:h.length,a=h.slice(0,i)+"\n"+h.slice(o);return f(a),void setTimeout(()=>{try{e.selectionStart=e.selectionEnd=i+1}catch(t){}},0)}"Enter"===t.key?k(e.id,"dgh",h):"Escape"===t.key&&S()},onBlur:()=>{h.trim()!==(e.dgh||"")?k(e.id,"dgh",h):S()},autoFocus:!0,style:{border:"1px solid #7cc0ff",borderRadius:"4px",padding:"6px 8px",fontSize:"14px",width:"100%",minHeight:"64px",resize:"none",overflow:"hidden",backgroundColor:"rgba(124, 192, 255, 0.1)",color:"#e6f1ff",outline:"none",boxShadow:"0 0 0 2px rgba(124, 192, 255, 0.2)"}}):v.jsxs("span",{className:"v editable-field",onDoubleClick:t=>{t.stopPropagation(),x({id:e.id,field:"dgh"}),f(e.dgh||"")},title:"Double-click to edit",style:{whiteSpace:"pre-wrap"},children:[e.dgh||"-",v.jsx("span",{className:"edit-icon "+(e.dgh?"":"empty"),children:v.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"18px",height:"18px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.1)",marginLeft:"6px"},children:v.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#000000"})})})})]})]}),v.jsxs("div",{className:"row",children:[v.jsx("span",{className:"k",children:"האם יחזור תמיד?"}),(null==u?void 0:u.id)===e.id&&"always"===u.field?v.jsx("textarea",{className:"editable-field",value:h,onChange:e=>{f(e.target.value);const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onFocus:e=>{const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onKeyDown:t=>{var r,n;if("Enter"===t.key&&t.shiftKey){t.preventDefault();const e=t.currentTarget,i=null!=(r=e.selectionStart)?r:h.length,o=null!=(n=e.selectionEnd)?n:h.length,a=h.slice(0,i)+"\n"+h.slice(o);return f(a),void setTimeout(()=>{try{e.selectionStart=e.selectionEnd=i+1}catch(t){}},0)}"Enter"===t.key?k(e.id,"always",h):"Escape"===t.key&&S()},onBlur:()=>{h.trim()!==(e.always||"")?k(e.id,"always",h):S()},autoFocus:!0,style:{border:"1px solid #7cc0ff",borderRadius:"4px",padding:"6px 8px",fontSize:"14px",width:"100%",minHeight:"64px",resize:"none",overflow:"hidden",backgroundColor:"rgba(124, 192, 255, 0.1)",color:"#e6f1ff",outline:"none",boxShadow:"0 0 0 2px rgba(124, 192, 255, 0.2)"}}):v.jsxs("span",{className:"v editable-field",onDoubleClick:t=>{t.stopPropagation(),x({id:e.id,field:"always"}),f(e.always||"")},title:"Double-click to edit",style:{whiteSpace:"pre-wrap"},children:[e.always||"-",v.jsx("span",{className:"edit-icon "+(e.always?"":"empty"),children:v.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"18px",height:"18px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.1)",marginLeft:"6px"},children:v.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#000000"})})})})]})]}),v.jsxs("div",{className:"row",children:[v.jsx("span",{className:"k",children:"הערות:"}),(null==u?void 0:u.id)===e.id&&"notes"===u.field?v.jsx("textarea",{className:"editable-field",value:h,onChange:e=>{f(e.target.value);const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onFocus:e=>{const t=e.currentTarget;t.style.height="auto",t.style.height=`${t.scrollHeight}px`},onKeyDown:t=>{var r,n;if("Enter"===t.key&&t.shiftKey){t.preventDefault();const e=t.currentTarget,i=null!=(r=e.selectionStart)?r:h.length,o=null!=(n=e.selectionEnd)?n:h.length,a=h.slice(0,i)+"\n"+h.slice(o);return f(a),void setTimeout(()=>{try{e.selectionStart=e.selectionEnd=i+1}catch(t){}},0)}"Enter"===t.key?k(e.id,"notes",h):"Escape"===t.key&&S()},onBlur:()=>{h.trim()!==(e.notes||"")?k(e.id,"notes",h):S()},autoFocus:!0,style:{border:"1px solid #7cc0ff",borderRadius:"4px",padding:"6px 8px",fontSize:"14px",width:"100%",minHeight:"64px",resize:"none",overflow:"hidden",backgroundColor:"rgba(124, 192, 255, 0.1)",color:"#e6f1ff",outline:"none",boxShadow:"0 0 0 2px rgba(124, 192, 255, 0.2)"}}):v.jsxs("span",{className:"v editable-field",onDoubleClick:t=>{t.stopPropagation(),x({id:e.id,field:"notes"}),f(e.notes||"")},style:{cursor:"pointer"},title:"Double-click to edit",children:[v.jsx("span",{style:{whiteSpace:"pre-wrap"},children:e.notes||"-"}),v.jsx("span",{className:"edit-icon "+(e.notes?"":"empty"),children:v.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"18px",height:"18px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.1)",marginLeft:"6px"},children:v.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#000000"})})})})]})]}),e.isMapped&&e.mappedTargetLabel&&v.jsxs("div",{className:"row",children:[v.jsx("span",{className:"k",children:"שדה בתקן:"}),v.jsx("span",{className:"v",style:{fontSize:"8px"},children:e.mappedTargetLabel})]})]})]},e.id))})}),v.jsxs("div",{className:"excel-actions",children:[v.jsx("input",{ref:i,type:"file",accept:".xlsx,.xls",style:{display:"none"},onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&z(r),i.current&&(i.current.value="")}}),v.jsx("input",{ref:o,type:"file",accept:".xlsx,.xls",style:{display:"none"},onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&N(r),o.current&&(o.current.value="")}}),j.filter(e=>e.isMapped).length>0&&v.jsxs("div",{className:"mappings-count",children:[j.filter(e=>e.isMapped).length," mapping",1!==j.filter(e=>e.isMapped).length?"s":""," saved"]})]}),v.jsx("div",{className:"fridge-note",children:0===j.length?s.length>0?"אין שדות ירוקים או ממופים להצגה מתוך השדות שהועלו.":'הורידו את הפורמט, מלאו אותו בדג"ח מהספק והעלו אותו לפירוק!':'גררו שדה מהדג"ח לשדה שמתאים לו מהתקן, הכניסו את הפרסר הרצוי ולחצו שמור. לאחר שסיימתם למפות את כל השדות הרלוונטים - לחצו על כפתור הורדת המאפינג ותיהנו!'}),0===j.length&&0===s.length&&v.jsx("div",{className:"excel-cta"}),v.jsx("div",{className:"fridge-bottom-controls",children:s.length>0&&v.jsx("button",{className:"btn ghost extractor-clear-btn","aria-label":'נקה את הדג"ח',title:'נקה את הדג"ח',onClick:e=>{e.stopPropagation(),I()},children:v.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M9 3c-.55 0-1 .45-1 1v1H5.5c-.28 0-.5.22-.5.5s.22.5.5.5H6v13c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V6h.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5H16V4c0-.55-.45-1-1-1H9zm1 2V4h4v1h-4zm-2 2h10v12c0 .55-.45 1-1 1H8c-.55 0-1-.45-1-1V7zm3 2c-.28 0-.5.22-.5.5v7c0 .28.22.5.5.5s.5-.22.5-.5v-7c0-.28-.22-.5-.5-.5zm4 0c-.28 0-.5.22-.5.5v7c0 .28.22.5.5.5s.5-.22.5-.5v-7c0-.28-.22-.5-.5-.5z"})})})})]})})}const $=e=>{switch(e){case"local":return"אימות מקומי";case"adfs":return"אימות ADFS";default:return"לא ידוע"}},_={auth:{clientId:"00000000-0000-0000-0000-000000000000",authority:"https://your-adfs-host/adfs",redirectUri:window.location.origin,postLogoutRedirectUri:window.location.origin},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!1}};let B=null;const W=()=>(!B&&_.auth.clientId&&_.auth.authority&&(B=new h(_)),B),O={scopes:["openid","profile"]},U=e=>{var t,r;const n=e.idTokenClaims,i=(null==n?void 0:n.groups)||[];return["admin","admins","Administrators","Administrators@thegreentree"].some(e=>i.some(t=>t.toLowerCase().includes(e.toLowerCase())))||"admin"===(null==n?void 0:n.role)||(null==(t=null==n?void 0:n.roles)?void 0:t.includes("admin"))?"admin":["editor","editors","Editor","Writers"].some(e=>i.some(t=>t.toLowerCase().includes(e.toLowerCase())))||"editor"===(null==n?void 0:n.role)||(null==(r=null==n?void 0:n.roles)?void 0:r.includes("editor"))?"editor":"viewer"},P=()=>p(e,null,function*(){const t=W();if(!t)return null;const r=t.getAllAccounts();if(0===r.length)return null;const n=r[0];try{yield p(e,null,function*(){const e=W();if(!e)return null;const t=e.getAllAccounts();if(0===t.length)return null;try{const r=d(l({},O),{account:t[0]});return yield e.acquireTokenSilent(r)}catch(r){if(r instanceof f){const r=d(l({},O),{account:t[0]});return yield e.acquireTokenPopup(r)}throw r}})}catch(i){return console.warn("Unable to acquire token silently:",i),null}return{id:n.localAccountId||n.homeAccountId,name:n.name||n.username,email:n.username,role:U(n),lastLogin:(new Date).toISOString(),adfsAccount:n}}),q={viewer:["view_all"],editor:["view_all","chat_message"],admin:["view_all","edit_status","create_sagach","delete_sagach","chat_message","manage_users"]},Y=g.createContext(void 0),H=({children:t})=>{const[r,n]=g.useState(null),[i,o]=g.useState(!0),[a]=g.useState(()=>(()=>{const e=localStorage.getItem("auth_mode");return!e||"local"!==e&&"adfs"!==e?"adfs":e})());g.useEffect(()=>{p(e,null,function*(){o(!0);try{if("adfs"===a){const t=yield p(e,null,function*(){const e=W();if(!e)return null;try{return yield e.initialize(),yield P()}catch(t){return console.error("ADFS initialization failed:",t),null}});if(t)return void n(t)}const t=localStorage.getItem("user");if(t){const e=JSON.parse(t);e.authMode=a,n(e)}}catch(t){console.error("Failed to initialize authentication:",t),localStorage.removeItem("user")}finally{o(!1)}})},[a]),g.useEffect(()=>{if(r)try{localStorage.setItem("user",JSON.stringify(r))}catch(e){console.error("Failed to save user to localStorage:",e)}else localStorage.removeItem("user")},[r]);const s=e=>!!r&&q[r.role].includes(e),l={user:r,login:t=>p(e,null,function*(){o(!0);try{yield new Promise(e=>setTimeout(e,500));const r={id:t.id||`user_${Date.now()}`,name:t.name||"משתמש",email:t.email||"user@example.com",role:t.role||"viewer",lastLogin:(new Date).toISOString(),authMode:"local"};if(n(r),"admin"===r.role)try{const e=localStorage.getItem("admin_users"),t=e?JSON.parse(e):[];t.some(e=>e.id===r.id||e.email===r.email)||(t.push(r),localStorage.setItem("admin_users",JSON.stringify(t)))}catch(e){console.error("Failed to add admin user to list:",e)}window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`ברוך הבא, ${r.name}!`,type:"ok",durationMs:3e3}}))}catch(e){console.error("Local login failed:",e),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"שגיאה בהתחברות מקומית",type:"error",durationMs:3e3}}))}finally{o(!1)}}),loginWithAdfs:()=>p(e,null,function*(){o(!0);try{yield p(e,null,function*(){const e=W();if(!e)throw new Error("ADFS is not configured. Please set VITE_ADFS_CLIENT_ID and VITE_ADFS_AUTHORITY in .env.local");try{return yield e.loginPopup(O)}catch(t){throw console.error("ADFS login failed:",t),t}});const t=yield P();if(!t)throw new Error("Failed to get user information from ADFS");n(t),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`ברוך הבא, ${t.name}!`,type:"ok",durationMs:3e3}}))}catch(t){console.error("ADFS login failed:",t),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"שגיאה בהתחברות ADFS",type:"error",durationMs:3e3}}))}finally{o(!1)}}),logout:()=>p(e,null,function*(){try{"adfs"===(null==r?void 0:r.authMode)&&(yield p(e,null,function*(){const e=W();if(!e)return;const t=e.getAllAccounts();if(0!==t.length)try{yield e.logoutPopup({account:t[0],postLogoutRedirectUri:window.location.origin})}catch(r){console.error("ADFS logout failed:",r),e.clearCache()}})),n(null),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"התנתקת בהצלחה",type:"ok",durationMs:2e3}}))}catch(t){console.error("Logout failed:",t),n(null),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"התנתקת (עם שגיאות)",type:"warn",durationMs:3e3}}))}}),hasPermission:s,hasRole:e=>(null==r?void 0:r.role)===e,canEditStatus:()=>s("edit_status"),canCreateSagach:()=>s("create_sagach"),canDeleteSagach:()=>s("delete_sagach"),canChat:()=>s("chat_message"),canManageUsers:()=>s("manage_users"),isLoading:i,authMode:a,canSwitchAuthMode:!0};return v.jsx(Y.Provider,{value:l,children:t})},V=()=>{const e=g.useContext(Y);if(void 0===e)throw new Error("usePermissions must be used within a PermissionProvider");return e},J=e=>{switch(e){case"viewer":return"צופה";case"editor":return"עורך";case"admin":return"מנהל";default:return"לא ידוע"}};var X={};let G=null,K=null,Q=null;try{if("undefined"==typeof window){const e=require("pg");G=e.Client,K=e.Pool,Q=e.QueryResult}}catch(Oe){console.warn("PostgreSQL module not available in browser environment")}const Z=(e,t="")=>{var r;return"undefined"==typeof process?(null==(r=window.__ENV__)?void 0:r[e])||t:X[e]||t},ee={host:Z("DB_HOST","localhost"),port:parseInt(Z("DB_PORT","5432")),database:Z("DB_NAME","thegreentree"),user:Z("DB_USER","postgres"),password:Z("DB_PASSWORD",""),ssl:"true"===Z("DB_SSL","false"),connectionTimeoutMillis:6e4,idleTimeoutMillis:3e4,max:20};class te{constructor(e){c(this,"pool",null),c(this,"client",null),c(this,"config"),c(this,"isConnected",!1),this.config=l(l({},ee),e)}initialize(){return p(this,null,function*(){if(!K||!G)throw new Error("PostgreSQL module not available in browser environment. Database features require a Node.js environment.");try{this.pool&&(yield this.pool.end()),this.pool=new K(this.config);const e=yield this.pool.connect();yield e.query("SELECT 1"),e.release(),this.isConnected=!0,console.log("✅ PostgreSQL connected successfully")}catch(Oe){throw console.error("❌ PostgreSQL connection failed:",Oe),this.isConnected=!1,Oe}})}createTables(){return p(this,null,function*(){if(!K||!G)throw new Error("PostgreSQL module not available");if(!this.isConnected||!this.pool)throw new Error("Database not connected");try{yield this.pool.query("\n        CREATE TABLE IF NOT EXISTS sagachim_status (\n          id VARCHAR(255) PRIMARY KEY,\n          name TEXT NOT NULL,\n          description TEXT,\n          provider VARCHAR(255),\n          last_updated TIMESTAMP,\n          arena TEXT[],\n          priority VARCHAR(50),\n          sagach_type TEXT,\n          process_status INTEGER CHECK (process_status >= 1 AND process_status <= 7),\n          process_start_date DATE,\n          estimated_completion DATE,\n          contact_person TEXT,\n          notes TEXT,\n          status_updates JSONB,\n          phase_data JSONB,\n          notifications BOOLEAN DEFAULT false,\n          notification_method VARCHAR(20),\n          notification_frequency VARCHAR(20),\n          completion_date DATE,\n          notification_subscribers JSONB,\n          created_by VARCHAR(255),\n          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n          last_modified_by VARCHAR(255),\n          last_modified_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n        )\n      "),yield this.pool.query("\n        CREATE TABLE IF NOT EXISTS sagachs (\n          id VARCHAR(255) PRIMARY KEY,\n          name TEXT NOT NULL,\n          data JSONB,\n          versions JSONB,\n          current_version VARCHAR(255),\n          created_by VARCHAR(255),\n          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n          last_modified_by VARCHAR(255),\n          last_modified_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n        )\n      "),yield this.pool.query("\n        CREATE TABLE IF NOT EXISTS data_changes (\n          id SERIAL PRIMARY KEY,\n          event_type VARCHAR(50) NOT NULL,\n          event_data JSONB,\n          timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n          user_id VARCHAR(255),\n          user_name VARCHAR(255)\n        )\n      "),console.log("✅ Database tables created/verified")}catch(Oe){throw console.error("❌ Failed to create tables:",Oe),Oe}})}loadSagachimStatus(){return p(this,null,function*(){if(!K||!G)throw new Error("PostgreSQL module not available");if(!this.isConnected||!this.pool)throw new Error("Database not connected");try{return(yield this.pool.query("SELECT * FROM sagachim_status ORDER BY last_modified_at DESC")).rows}catch(Oe){throw console.error("❌ Failed to load sagachim status:",Oe),Oe}})}loadSagachs(){return p(this,null,function*(){if(!K||!G)throw new Error("PostgreSQL module not available");if(!this.isConnected||!this.pool)throw new Error("Database not connected");try{return(yield this.pool.query("SELECT * FROM sagachs ORDER BY last_modified_at DESC")).rows}catch(Oe){throw console.error("❌ Failed to load sagachs:",Oe),Oe}})}saveSagachimStatus(e){return p(this,null,function*(){if(!K||!G)throw new Error("PostgreSQL module not available");if(!this.isConnected||!this.pool)throw new Error("Database not connected");try{const t="\n        INSERT INTO sagachim_status (\n          id, name, description, provider, last_updated, arena, priority, sagach_type,\n          process_status, process_start_date, estimated_completion, contact_person, notes,\n          status_updates, phase_data, notifications, notification_method, notification_frequency,\n          completion_date, notification_subscribers, created_by, created_at, last_modified_by, last_modified_at\n        ) VALUES (\n          $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24\n        )\n        ON CONFLICT (id) DO UPDATE SET\n          name = EXCLUDED.name,\n          description = EXCLUDED.description,\n          provider = EXCLUDED.provider,\n          last_updated = EXCLUDED.last_updated,\n          arena = EXCLUDED.arena,\n          priority = EXCLUDED.priority,\n          sagach_type = EXCLUDED.sagach_type,\n          process_status = EXCLUDED.process_status,\n          process_start_date = EXCLUDED.process_start_date,\n          estimated_completion = EXCLUDED.estimated_completion,\n          contact_person = EXCLUDED.contact_person,\n          notes = EXCLUDED.notes,\n          status_updates = EXCLUDED.status_updates,\n          phase_data = EXCLUDED.phase_data,\n          notifications = EXCLUDED.notifications,\n          notification_method = EXCLUDED.notification_method,\n          notification_frequency = EXCLUDED.notification_frequency,\n          completion_date = EXCLUDED.completion_date,\n          notification_subscribers = EXCLUDED.notification_subscribers,\n          last_modified_by = EXCLUDED.last_modified_by,\n          last_modified_at = EXCLUDED.last_modified_at\n      ",r=[e.id,e.name,e.description,e.provider,e.lastUpdated,e.arena,e.priority,e.sagachType,e.processStatus,e.processStartDate,e.estimatedCompletion,e.contactPerson,e.notes,JSON.stringify(e.statusUpdates||[]),JSON.stringify(e.phaseData||{}),e.notifications||!1,e.notificationMethod,e.notificationFrequency,e.completionDate,JSON.stringify(e.notificationSubscribers||[]),e.createdBy,e.createdAt,e.lastModifiedBy,e.lastModifiedAt];yield this.pool.query(t,r)}catch(Oe){throw console.error("❌ Failed to save sagachim status:",Oe),Oe}})}saveSagach(e){return p(this,null,function*(){if(!K||!G)throw new Error("PostgreSQL module not available");if(!this.isConnected||!this.pool)throw new Error("Database not connected");try{const t="\n        INSERT INTO sagachs (\n          id, name, data, versions, current_version, created_by, created_at, last_modified_by, last_modified_at\n        ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)\n        ON CONFLICT (id) DO UPDATE SET\n          name = EXCLUDED.name,\n          data = EXCLUDED.data,\n          versions = EXCLUDED.versions,\n          current_version = EXCLUDED.current_version,\n          last_modified_by = EXCLUDED.last_modified_by,\n          last_modified_at = EXCLUDED.last_modified_at\n      ";yield this.pool.query(t,[e.id,e.name,JSON.stringify(e.data),JSON.stringify(e.versions),e.currentVersion,e.createdBy,e.createdAt,e.lastModifiedBy,e.lastModifiedAt])}catch(Oe){throw console.error("❌ Failed to save sagach:",Oe),Oe}})}deleteSagachimStatus(e){return p(this,null,function*(){if(!K||!G)throw new Error("PostgreSQL module not available");if(!this.isConnected||!this.pool)throw new Error("Database not connected");try{yield this.pool.query("DELETE FROM sagachim_status WHERE id = $1",[e])}catch(Oe){throw console.error("❌ Failed to delete sagachim status:",Oe),Oe}})}deleteSagach(e){return p(this,null,function*(){if(!K||!G)throw new Error("PostgreSQL module not available");if(!this.isConnected||!this.pool)throw new Error("Database not connected");try{yield this.pool.query("DELETE FROM sagachs WHERE id = $1",[e])}catch(Oe){throw console.error("❌ Failed to delete sagach:",Oe),Oe}})}logDataChange(e,t,r,n){return p(this,null,function*(){if(K&&G&&this.isConnected&&this.pool)try{yield this.pool.query("INSERT INTO data_changes (event_type, event_data, user_id, user_name) VALUES ($1, $2, $3, $4)",[e,JSON.stringify(t),r,n])}catch(Oe){console.error("❌ Failed to log data change:",Oe)}})}getRecentChanges(e=100){return p(this,null,function*(){if(!(K&&G&&this.isConnected&&this.pool))return[];try{return(yield this.pool.query("SELECT * FROM data_changes ORDER BY timestamp DESC LIMIT $1",[e])).rows}catch(Oe){return console.error("❌ Failed to get recent changes:",Oe),[]}})}close(){return p(this,null,function*(){try{this.pool&&K&&G&&(yield this.pool.end(),this.pool=null,this.isConnected=!1,console.log("🔒 Database connection closed"))}catch(Oe){console.error("❌ Error closing database connection:",Oe)}})}isDatabaseConnected(){return this.isConnected&&null!==this.pool&&null!==K&&null!==G}updateConfig(e){return p(this,null,function*(){if(!K||!G)throw new Error("PostgreSQL module not available");this.config=l(l({},this.config),e),yield this.close(),yield this.initialize(),yield this.createTables()})}}let re=null;const ne=["110","130","150","160","170","180","190","210",'מוד"ש','פקמ"ז','פצ"ן','פד"ם',"על-זירתי"],ie=g.createContext(void 0),oe="shared_sagach_data",ae="shared_sagachim_status_data",se="shared_data_changes",le="sagach_manager_data",de="sagachim_data",ce=({children:t})=>{const{user:r}=V(),[n,i]=g.useState([]),[o,a]=g.useState([]),[s,c]=g.useState(!0),[u,x]=g.useState(null),[m,h]=g.useState(new Set),[f,y]=g.useState(null),[b,w]=g.useState(!1),S=g.useCallback((t,r)=>p(e,null,function*(){try{const n="sagachs"===t?oe:ae;if(localStorage.setItem(n,JSON.stringify(r)),b&&f&&f.isDatabaseConnected())try{"sagachs"===t?yield Promise.all(r.map(e=>f.saveSagach(e))):yield Promise.all(r.map(e=>f.saveSagachimStatus(e))),console.log("💾 Data saved to PostgreSQL database")}catch(e){console.error("❌ Failed to save to database, but localStorage saved successfully:",e)}}catch(n){console.error("Failed to save shared data:",n),x("Failed to save data")}}),[b,f]),j=g.useCallback(t=>p(e,null,function*(){try{const e=localStorage.getItem(se),r=e?JSON.parse(e):[];r.push(t),r.length>100&&r.splice(0,r.length-100),localStorage.setItem(se,JSON.stringify(r))}catch(e){console.error("Failed to store change event:",e)}if(b&&f&&f.isDatabaseConnected()&&r)try{yield f.logDataChange(t.type,t.data,t.userId,t.userName)}catch(e){console.error("Failed to log change to database:",e)}m.forEach(r=>{try{r(t)}catch(e){console.error("Error in change listener:",e)}})}),[m,b,f,r]);g.useEffect(()=>{p(e,null,function*(){try{c(!0),x(null);const r=(re||(re=new te),re);y(r);let n=!1;try{yield r.initialize(),yield r.createTables(),n=!0,w(!0),console.log("💾 Using PostgreSQL database for data storage")}catch(e){console.warn("⚠️ PostgreSQL not available, falling back to localStorage:",e),w(!1),n=!1}if(n&&r)try{const[e,t]=yield Promise.all([r.loadSagachs(),r.loadSagachimStatus()]);i(e),a(t),console.log("✅ Data loaded from PostgreSQL database")}catch(t){console.error("❌ Failed to load from database, falling back to localStorage:",t),w(!1)}if(!n||!b){let e=localStorage.getItem(oe);if(e){const t=JSON.parse(e);i(t)}else{const e=localStorage.getItem(le);if(e){console.log("🔄 Migrating sagach data from old key...");const t=JSON.parse(e),r=t.map(e=>d(l({},e),{createdBy:e.createdBy||"migrated",createdAt:e.createdAt||(new Date).toISOString(),lastModifiedBy:e.lastModifiedBy||"migrated",lastModifiedAt:e.lastModifiedAt||(new Date).toISOString()}));i(r),localStorage.setItem(oe,JSON.stringify(r)),localStorage.removeItem(le),console.log("✅ Sagach data migration completed")}}let t=localStorage.getItem(ae);if(t){const e=JSON.parse(t);a(e)}else{const e=localStorage.getItem(de);if(e){console.log("🔄 Migrating status data from old key...");const t=(e=>e.map(e=>d(l({},e),{priority:e.priority||"בינוני",arena:e.arena||[],createdBy:e.createdBy||"migrated",createdAt:e.createdAt||(new Date).toISOString(),lastModifiedBy:e.lastModifiedBy||"migrated",lastModifiedAt:e.lastModifiedAt||(new Date).toISOString()})))(JSON.parse(e));a(t),localStorage.setItem(ae,JSON.stringify(t)),localStorage.removeItem(de),console.log("✅ Status data migration completed")}}n?console.log("💾 Using localStorage as primary storage (database available but loading failed)"):console.log("💾 Using localStorage as primary storage (database not available)")}}catch(r){console.error("Failed to initialize and load data:",r),x("Failed to load data");try{const e=localStorage.getItem(oe),t=localStorage.getItem(ae);e&&i(JSON.parse(e)),t&&a(JSON.parse(t))}catch(n){console.error("Even localStorage fallback failed:",n)}}finally{c(!1)}})},[]),g.useEffect(()=>{const e=e=>{if(e.key===oe&&e.newValue)try{const t=JSON.parse(e.newValue);i(t)}catch(t){console.error("Failed to parse sagach data from storage event:",t)}else if(e.key===ae&&e.newValue)try{const t=JSON.parse(e.newValue);a(t)}catch(t){console.error("Failed to parse status data from storage event:",t)}};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);const k=g.useCallback(e=>{if(!r)return void x("User must be logged in to create sagachs");const t=(new Date).toISOString(),n=d(l({},e),{createdBy:r.id,createdAt:t,lastModifiedBy:r.id,lastModifiedAt:t});i(e=>{const t=[...e,n];return S("sagachs",t),t}),j({type:"sagach_created",data:n,timestamp:t,userId:r.id,userName:r.name})},[r,S,j]),C=g.useCallback((e,t)=>{if(!r)return void x("User must be logged in to update sagachs");const n=(new Date).toISOString();i(i=>{const o=i.map(i=>i.id===e?d(l(l({},i),t),{lastModifiedBy:r.id,lastModifiedAt:n}):i);return S("sagachs",o),o}),j({type:"sagach_updated",data:{id:e,updates:t},timestamp:n,userId:r.id,userName:r.name})},[r,S,j]),E=g.useCallback(t=>p(e,null,function*(){if(!r)return void x("User must be logged in to delete sagachs");const e=(new Date).toISOString();if(i(e=>{const r=e.filter(e=>e.id!==t);return S("sagachs",r),r}),b&&f&&f.isDatabaseConnected())try{yield f.deleteSagach(t)}catch(n){console.error("Failed to delete sagach from database:",n)}j({type:"sagach_deleted",data:{id:t},timestamp:e,userId:r.id,userName:r.name})}),[r,S,j,b,f]),D=g.useCallback(e=>{if(!r)return void x("User must be logged in to create status items");const t=(new Date).toISOString(),n=d(l({},e),{createdBy:r.id,createdAt:t,lastModifiedBy:r.id,lastModifiedAt:t});a(e=>{const t=[...e,n];return S("sagachimStatus",t),t}),j({type:"status_created",data:n,timestamp:t,userId:r.id,userName:r.name})},[r,S,j]),T=g.useCallback((e,t)=>{if(!r)return void x("User must be logged in to update status items");const n=(new Date).toISOString();a(i=>{const o=i.map(i=>i.id===e?d(l(l({},i),t),{lastModifiedBy:r.id,lastModifiedAt:n}):i);return S("sagachimStatus",o),o}),j({type:"status_updated",data:{id:e,updates:t},timestamp:n,userId:r.id,userName:r.name})},[r,S,j]),N=g.useCallback(t=>p(e,null,function*(){if(!r)return void x("User must be logged in to delete status items");const e=(new Date).toISOString();if(a(e=>{const r=e.filter(e=>e.id!==t);return S("sagachimStatus",r),r}),b&&f&&f.isDatabaseConnected())try{yield f.deleteSagachimStatus(t)}catch(n){console.error("Failed to delete status item from database:",n)}j({type:"status_deleted",data:{id:t},timestamp:e,userId:r.id,userName:r.name})}),[r,S,j,b,f]),z=g.useCallback(()=>{try{localStorage.removeItem(oe),localStorage.removeItem(ae),localStorage.removeItem(se),localStorage.removeItem(le),localStorage.removeItem(de),i([]),a([]),x(null),console.log("🗑️ All data cleared successfully")}catch(e){console.error("Failed to clear data:",e),x("Failed to clear data")}},[]),I=g.useCallback(e=>(h(t=>new Set([...t,e])),()=>{h(t=>{const r=new Set(t);return r.delete(e),r})}),[]),M=g.useMemo(()=>({sagachs:n,addSagach:k,updateSagach:C,deleteSagach:E,sagachimStatus:o,addSagachimStatus:D,updateSagachimStatus:T,deleteSagachimStatus:N,clearAllData:z,useDatabase:b,isDatabaseConnected:(null==f?void 0:f.isDatabaseConnected())||!1,subscribeToChanges:I,isLoading:s,error:u}),[n,k,C,E,o,D,T,N,z,b,f,I,s,u]);return g.useEffect(()=>(window.clearAllSagachData=z,()=>{delete window.clearAllSagachData}),[z]),v.jsx(ie.Provider,{value:M,children:t})},pe=()=>{const e=g.useContext(ie);if(void 0===e)throw new Error("useSagachData must be used within a SagachDataProvider");return e},ge=()=>{var e,t;const{sagachs:r,addSagach:n,updateSagach:i,deleteSagach:o,isLoading:a,error:s}=pe(),[c,p]=g.useState(""),[u,x]=g.useState(""),[m,h]=g.useState(null);g.useEffect(()=>{r.length>0&&!c&&(p(r[0].id),x(r[0].currentVersion))},[r,c]);const[f,y]=g.useState(new Set),[b,w]=g.useState(!1),[S,j]=g.useState(""),[k,C]=g.useState(""),[E,D]=g.useState(""),[T,N]=g.useState(!0),[z,I]=g.useState(!1),[M,L]=g.useState(!1),[A,F]=g.useState(null),[R,$]=g.useState(null),[_,B]=g.useState({}),[W,O]=g.useState(null),[U,P]=g.useState(["Column 1","Column 2","Column 3","Column 4"]),[q,Y]=g.useState(null),[H,V]=g.useState(""),[J,X]=g.useState(""),G=e=>e.toLocaleDateString("he-IL").replace(/\./g,"/");g.useEffect(()=>{const e={};U.forEach(t=>{_[t]||(e[t]=150)}),Object.keys(e).length>0&&B(t=>l(l({},t),e))},[U]);const K=()=>r.find(e=>e.id===c);g.useEffect(()=>{const e=K();e&&(x(e.currentVersion),I(!1))},[c]);const Q=()=>{const e=r.find(e=>e.id===c);return e?e.data:[]},Z=e=>{const t=e.split("."),r=parseInt(t[2])+1;return`${t[0]}.${t[1]}.${r}`},ee=e=>{if(!z||T)return{type:"modified",fields:[]};const t=K();if(!t)return{type:"modified",fields:[]};if(!t.versions.find(e=>e.version===u))return{type:"modified",fields:[]};const r=t.versions.findIndex(e=>e.version===u);if(r===t.versions.length-1)return{type:"modified",fields:[]};const n=t.versions[r+1];if(!n)return{type:"modified",fields:[]};const i=n.data.find(t=>t.id===e.id);if(!i)return{type:"new",fields:[]};const o=[];return i.name!==e.name&&o.push("name"),i.type!==e.type&&o.push("type"),i.data!==e.data&&o.push("data"),i.fieldName!==e.fieldName&&o.push("fieldName"),{type:(o.length,"modified"),fields:o}},te=(e,t)=>{h({rowId:e,field:t})},re=(e,t,n)=>{r.forEach(r=>{if(r.data.some(t=>t.id===e)){const o=r.data.map(r=>r.id===e?d(l({},r),{[t]:n}):r);i(r.id,{data:o})}}),h(null)},ne=e=>{F(e),L(!0)},ie=(e,t)=>{$({rowId:e,field:t});const r=document.querySelector('[tabindex="0"]');r&&r.focus()},oe=(e,t,r)=>{console.log("handleCellDoubleClick called with:",{rowId:e,field:t,currentValue:r}),console.log("Setting editingCell to:",{rowId:e,field:t});const n={rowId:e,field:t};console.log("About to set editingCell to:",n),h(n),$(null),console.log("editingCell state should now be:",n)},ae=()=>{q&&H.trim()&&H!==q&&((e,t)=>{if(t.trim()&&t!==e){const n=t.trim();P(t=>t.map(t=>t===e?n:t)),B(t=>{const r=l({},t);return r[n]=r[e]||150,delete r[e],r}),r.forEach(t=>{const r=t.data.map(t=>{const r=l({},t);return void 0!==r[e]&&(r[n]=r[e],delete r[e]),r}),o=t.versions.map(t=>d(l({},t),{data:t.data.map(t=>{const r=l({},t);return void 0!==r[e]&&(r[n]=r[e],delete r[e]),r})}));i(t.id,{data:r,versions:o})})}})(q,H.trim()),Y(null),V("")},se=e=>{"Enter"===e.key?ae():"Escape"===e.key&&(Y(null),V(""))},le=()=>{const e={id:`row_${Date.now()}`};return U.forEach(t=>{e[t]=""}),e},de=e=>{r.forEach(t=>{const r=t.data.map(t=>d(l({},t),{[e]:""})),n=t.versions.map(t=>d(l({},t),{data:t.data.map(t=>d(l({},t),{[e]:""}))}));i(t.id,{data:r,versions:n})})},ce=()=>{if(!J.trim())return r;const e=J.toLowerCase().trim();return r.filter(t=>t.name.toLowerCase().includes(e)||t.data.some(t=>Object.values(t).some(t=>String(t).toLowerCase().includes(e))))};return v.jsxs("div",{className:"sagachim-manager",style:{height:"100vh",background:"radial-gradient(1200px 800px at 80% 20%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 10% 90%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",color:"var(--text)",fontFamily:'"Segoe UI", system-ui, sans-serif',position:"relative",width:"100vw",maxWidth:"100%",boxSizing:"border-box",overflow:"hidden"},children:[v.jsxs("div",{className:"versions-panel",style:{position:"fixed",left:"12px",top:"120px",bottom:"12px",width:T?"60px":"280px",background:"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"var(--radius)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 20px 60px rgba(0,0,0,0.35)",backdropFilter:"blur(8px)",padding:"16px",overflow:"hidden",zIndex:100,transition:"width 0.3s ease"},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px",borderBottom:"1px solid rgba(255,255,255,0.12)",paddingBottom:"12px"},children:[!T&&v.jsx("h2",{style:{color:"var(--accent)",fontSize:"20px",fontWeight:"700",letterSpacing:"0.4px",margin:0},children:"Versions"}),v.jsx("button",{onClick:()=>{N(!T),T?(I(!1),x("")):I(!1)},className:"btn ghost",style:{padding:"8px",fontSize:"16px",minWidth:"auto",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},title:T?"הרחב":"כווץ",children:T?"▶":"◀"})]}),!T&&v.jsxs(v.Fragment,{children:[v.jsx("div",{style:{padding:"8px 12px",background:"rgba(124,192,255,0.1)",border:"1px solid rgba(124,192,255,0.3)",borderRadius:"8px",textAlign:"center",color:"var(--accent)",fontSize:"14px",fontWeight:"600",direction:"rtl",marginBottom:"12px"},children:(null==(e=K())?void 0:e.name)||(0===r.length?'אין סג"חים':'בחר סג"ח')}),v.jsx("div",{className:"versions-list",children:(()=>{const e=K();return e?e.versions:[]})().map(e=>v.jsxs("div",{className:"version-item "+(u===e.version?"selected":""),onClick:()=>(e=>{const t=K();if(!t)return;const r=t.versions.find(t=>t.version===e);r&&(i(c,{data:[...r.data]}),x(e),I(!0),y(new Set))})(e.version),style:{background:u===e.version?"linear-gradient(180deg, rgba(124,192,255,0.22), rgba(124,192,255,0.1))":"rgba(255,255,255,0.06)",color:(e.version,"var(--text)"),border:u===e.version?"1px solid rgba(124,192,255,0.6)":"1px solid rgba(255,255,255,0.14)",borderRadius:"12px",padding:"12px",marginBottom:"10px",cursor:"pointer",transition:"transform 120ms ease, box-shadow 200ms ease, background 200ms ease",textAlign:"center",position:"relative",boxShadow:u===e.version?"0 6px 22px rgba(124,192,255,0.24)":"0 4px 12px rgba(0,0,0,0.2)",backdropFilter:"blur(6px)"},children:[v.jsxs("div",{style:{fontSize:"20px",fontWeight:"bold",marginBottom:"5px"},children:[e.version,e.changes&&e.changes.length>0&&v.jsx("span",{style:{position:"absolute",top:"6px",right:"6px",backgroundColor:"var(--accent)",color:"#000",borderRadius:"50%",width:"6px",height:"6px",fontSize:"6px",display:"inline-block",boxShadow:"0 0 8px rgba(124,192,255,0.6)"}})]}),v.jsx("div",{style:{fontSize:"12px",color:"var(--muted)"},children:e.date}),v.jsx("div",{style:{fontSize:"12px",color:"var(--muted)"},children:e.time}),e.changes&&e.changes.length>0&&v.jsxs("div",{style:{fontSize:"10px",marginTop:"6px",color:"var(--accent)",fontWeight:"bold"},children:[e.changes.length," שינויים"]})]},e.version))})]})]}),v.jsx("div",{className:"table-panel",style:{position:"fixed",left:T?"84px":"304px",right:"344px",top:"120px",bottom:"12px",background:"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"var(--radius)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 20px 60px rgba(0,0,0,0.35)",backdropFilter:"blur(8px)",padding:"16px",overflow:"auto",display:"flex",flexDirection:"column",zIndex:50},children:c?v.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px",paddingBottom:"12px",borderBottom:"1px solid rgba(255,255,255,0.12)"},children:[v.jsxs("div",{children:[v.jsx("h2",{style:{color:"var(--accent)",fontSize:"20px",fontWeight:"700",direction:"rtl",margin:0},children:null==(t=r.find(e=>e.id===c))?void 0:t.name}),z&&!T&&v.jsxs("div",{style:{display:"flex",gap:"16px",marginTop:"8px",fontSize:"12px",direction:"rtl"},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[v.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:"rgba(76,175,80,0.6)",borderRadius:"2px"}}),v.jsx("span",{style:{color:"var(--muted)"},children:"הוספו מהגרסה הקודמת"})]}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[v.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:"rgba(255,165,0,0.6)",borderRadius:"2px"}}),v.jsx("span",{style:{color:"var(--muted)"},children:"שונו מהגרסה הקודמת"})]}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[v.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:"rgba(255,80,80,0.6)",borderRadius:"2px"}}),v.jsx("span",{style:{color:"var(--muted)"},children:"הוסרו מהגרסה הקודמת"})]})]})]}),v.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[v.jsx("button",{onClick:()=>{const e=le(),t=[...Q(),e];var r;r=t,c&&i(c,{data:r}),U.length>0&&$({rowId:e.id,field:U[0]})},className:"btn primary",style:{padding:"8px 16px",fontSize:"12px",direction:"rtl"},children:"+ הוסף רשומה"}),v.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===r.type&&console.log("Excel file uploaded:",r.name),e.target.value=""},style:{display:"none"},id:"excel-upload"}),v.jsx("label",{htmlFor:"excel-upload",className:"btn ghost",style:{padding:"8px 16px",fontSize:"12px",cursor:"pointer",direction:"rtl"},children:"📁 העלה אקסל"})]})]}),v.jsxs("div",{style:{flex:1,overflow:"auto",position:"relative",outline:"none"},onKeyDown:e=>{if(!R)return;const t=Q(),r=t.findIndex(e=>e.id===R.rowId),n=U.indexOf(R.field);let i=r,o=n;switch(e.key){case"ArrowUp":e.preventDefault(),i=Math.max(0,r-1);break;case"ArrowDown":e.preventDefault(),i=Math.min(t.length-1,r+1);break;case"ArrowLeft":e.preventDefault(),o=Math.max(0,n-1);break;case"ArrowRight":e.preventDefault(),o=Math.min(U.length-1,n+1);break;case"Enter":if(e.preventDefault(),t[r]){const e=t[r][R.field]||"";oe(R.rowId,R.field,e)}return;case"Tab":e.preventDefault(),o=e.shiftKey?Math.max(0,n-1):Math.min(U.length-1,n+1);break;default:return}t[i]&&U[o]&&$({rowId:t[i].id,field:U[o]})},tabIndex:0,onFocus:e=>{e.currentTarget.focus()},children:[v.jsx("style",{children:"\n                  .table-container::-webkit-scrollbar {\n                    width: 12px;\n                    height: 12px;\n                  }\n                  .table-container::-webkit-scrollbar-track {\n                    background: rgba(255,255,255,0.05);\n                    border-radius: 6px;\n                  }\n                  .table-container::-webkit-scrollbar-thumb {\n                    background: linear-gradient(135deg, rgba(124,192,255,0.6), rgba(167,90,255,0.6));\n                    border-radius: 6px;\n                    border: 2px solid rgba(255,255,255,0.1);\n                  }\n                  .table-container::-webkit-scrollbar-thumb:hover {\n                    background: linear-gradient(135deg, rgba(124,192,255,0.8), rgba(167,90,255,0.8));\n                  }\n                  .table-container::-webkit-scrollbar-corner {\n                    background: rgba(255,255,255,0.05);\n                  }\n                "}),v.jsx("div",{className:"table-container",style:{overflow:"auto",height:"100%",position:"relative"},children:v.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:`${Object.values(_).reduce((e,t)=>e+t,0)+100}px`},children:[v.jsx("thead",{children:v.jsxs("tr",{style:{background:"rgba(255,255,255,0.08)"},children:[v.jsx("th",{style:{padding:"12px",textAlign:"center",color:"var(--accent)",fontWeight:"600",borderBottom:"2px solid rgba(124,192,255,0.3)",width:"80px",minWidth:"80px"},children:v.jsx("button",{onClick:()=>{const e=`Column ${U.length+1}`;P(t=>[e,...t]),B(t=>d(l({},t),{[e]:150})),de(e);const t=Q();if(t.length>0){const r=t[0].id;$({rowId:r,field:e})}},style:{background:"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",border:"1px solid rgba(76,175,80,0.4)",borderRadius:"8px",padding:"6px 8px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 2px 8px rgba(76,175,80,0.3)",minWidth:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(76,175,80,0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="0 2px 8px rgba(76,175,80,0.3)"},title:"הוסף עמודה חדשה",children:"+"})}),U.map((e,t)=>v.jsxs("th",{style:{padding:"12px",textAlign:"center",color:"var(--accent)",fontWeight:"600",direction:"rtl",borderBottom:"2px solid rgba(124,192,255,0.3)",width:`${_[e]||150}px`,minWidth:"80px",position:"relative",userSelect:"none"},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[q===e?v.jsx("input",{type:"text",value:H,onChange:e=>V(e.target.value),onBlur:ae,onKeyDown:se,autoFocus:!0,style:{background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.6)",borderRadius:"4px",padding:"4px 8px",color:"var(--text)",fontSize:"14px",fontWeight:"600",width:"100%",direction:"rtl",outline:"none"}}):v.jsx("span",{style:{flex:1,cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background 0.2s ease"},onClick:()=>{return Y(t=e),void V(t);var t},onMouseEnter:e=>{e.currentTarget.style.background="rgba(124,192,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},title:"לחץ לעריכה",children:e}),v.jsx("button",{onClick:()=>{return t=e,void(U.length>1&&(P(e=>e.filter(e=>e!==t)),B(e=>{const r=l({},e);return delete r[t],r})));var t},style:{background:"transparent",border:"none",color:"#ff5050",cursor:"pointer",fontSize:"12px",padding:"2px 4px",marginLeft:"8px",opacity:U.length>1?1:.3},disabled:U.length<=1,title:"מחק עמודה",children:"×"})]}),v.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:"4px",cursor:"col-resize",background:W===e?"rgba(124,192,255,0.8)":"transparent",transition:"background 0.2s ease"},onMouseDown:t=>{t.preventDefault(),(e=>{O(e)})(e);const r=t.clientX,n=_[e]||150,i=t=>{const i=n+(t.clientX-r);((e,t)=>{B(r=>d(l({},r),{[e]:Math.max(80,t)}))})(e,i)},o=()=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",o),O(null)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",o)},onMouseEnter:e=>{W||(e.currentTarget.style.background="rgba(124,192,255,0.3)")},onMouseLeave:e=>{W||(e.currentTarget.style.background="transparent")}})]},e))]})}),v.jsxs("tbody",{children:[Q().map((e,t)=>v.jsx(ue,{item:e,isEven:t%2==0,changes:ee(e),editingCell:m,selectedCell:R,columnWidths:_,tableColumns:U,onCellClick:te,onCellSelect:ie,onCellDoubleClick:oe,onCellSave:re,onDelete:ne},e.id)),(()=>{if(!z||T)return[];const e=K();if(!e)return[];if(!e.versions.find(e=>e.version===u))return[];const t=e.versions.findIndex(e=>e.version===u);if(t===e.versions.length-1)return[];const r=e.versions[t+1];if(!r)return[];const n=Q();return r.data.filter(e=>!n.find(t=>t.id===e.id))})().map((e,t)=>v.jsx(ue,{item:e,isEven:(Q().length+t)%2==0,changes:{type:"removed",fields:[]},editingCell:m,selectedCell:R,columnWidths:_,tableColumns:U,onCellClick:te,onCellSelect:ie,onCellDoubleClick:oe,onCellSave:re,onDelete:()=>{}},`removed-${e.id}`))]})]})}),0===Q().length&&v.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"200px",color:"var(--muted)",fontSize:"16px",direction:"rtl"},children:'אין רשומות בסג"ח זה'})]})]}):v.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--muted)",fontSize:"16px",direction:"rtl"},children:v.jsx("div",{children:0===r.length?'אין סג"חים זמינים - צור סג"ח חדש כדי להתחיל':'בחר סג"ח כדי להציג את הנתונים'})})}),v.jsxs("div",{className:"sagach-manager-panel",style:{position:"fixed",right:"12px",top:"120px",bottom:"12px",width:"320px",background:"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"var(--radius)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 20px 60px rgba(0,0,0,0.35)",backdropFilter:"blur(8px)",padding:"16px",display:"flex",flexDirection:"column",gap:"12px",zIndex:100,overflow:"auto"},children:[v.jsx("h2",{style:{color:"var(--accent)",fontSize:"18px",marginBottom:"12px",textAlign:"center",fontWeight:"700",letterSpacing:"0.4px",borderBottom:"1px solid rgba(255,255,255,0.12)",paddingBottom:"10px",direction:"rtl"},children:'מנהל סג"חים'}),v.jsx("div",{style:{marginBottom:"16px"},children:v.jsx("button",{onClick:()=>w(!0),className:"btn primary",style:{width:"100%",padding:"10px",fontSize:"14px",direction:"rtl"},children:'+ צור סג"ח חדש'})}),v.jsx("div",{style:{marginBottom:"16px"},children:v.jsx("input",{type:"text",value:J,onChange:e=>X(e.target.value),placeholder:"חפש סגחים...",style:{width:"100%",padding:"10px 12px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"8px",color:"var(--text)",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 8px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}})}),v.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px",flex:1},children:ce().length>0?ce().map(e=>v.jsx(xe,{sagach:e,isSelected:c===e.id,onSelect:()=>p(e.id)},e.id)):v.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px 20px",textAlign:"center",color:"var(--muted)",direction:"rtl"},children:[v.jsx("div",{style:{fontSize:"48px",marginBottom:"16px",opacity:.5},children:"📋"}),v.jsx("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:'אין סג"חים'}),v.jsx("div",{style:{fontSize:"14px",opacity:.8},children:'צור סג"ח חדש כדי להתחיל'})]})}),v.jsxs("div",{style:{marginTop:"16px",display:"flex",flexDirection:"column",gap:"8px"},children:[v.jsx("button",{onClick:()=>(()=>{const e=c,t=r.find(t=>t.id===e);if(!t)return;const n=t.versions[0],o=[];if(t.data.forEach(e=>{const t=n.data.find(t=>t.id===e.id);t?(t.name!==e.name&&o.push(`Name changed: ${t.name} → ${e.name}`),t.type!==e.type&&o.push(`Type changed for ${e.name}: ${t.type} → ${e.type}`),t.data!==e.data&&o.push(`Data changed for ${e.name}: ${t.data} → ${e.data}`),t.fieldName!==e.fieldName&&o.push(`Field name changed for ${e.name}: ${t.fieldName} → ${e.fieldName}`)):o.push(`Added: ${e.name}`)}),n.data.forEach(e=>{t.data.find(t=>t.id===e.id)||o.push(`Removed: ${e.name}`)}),o.length>0){const r=Z(t.currentVersion),n=new Date,a={version:r,date:G(n),time:n.toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"}),data:[...t.data],changes:o};i(e,{currentVersion:r,versions:[a,...t.versions]}),e===c&&x(r)}})(),className:"btn primary",style:{padding:"10px 16px",fontSize:"13px",fontWeight:"600",direction:"rtl",letterSpacing:"0.3px"},children:'שמור שינויים לסג"ח הנוכחי'}),v.jsx("button",{className:"btn ghost",style:{padding:"10px 16px",fontSize:"13px",fontWeight:"600",direction:"rtl",letterSpacing:"0.3px"},children:"פרסם לשותפים"})]})]}),b&&v.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:v.jsxs("div",{style:{background:"radial-gradient(1200px 800px at 50% 50%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 50% 50%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",border:"2px solid rgba(124,192,255,0.3)",borderRadius:"24px",padding:"32px",width:"480px",maxWidth:"90vw",boxShadow:"0 20px 60px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1)",backdropFilter:"blur(12px)"},children:[v.jsx("h2",{style:{color:"var(--text)",fontSize:"24px",fontWeight:"700",textAlign:"center",marginBottom:"24px",direction:"rtl"},children:'צור סג"ח חדש'}),v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[v.jsx("label",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",direction:"rtl"},children:"שם יחיד לשיתוף"}),v.jsx("input",{type:"text",value:S,onChange:e=>j(e.target.value),style:{background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",padding:"14px 16px",color:"var(--text)",fontSize:"16px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 20px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}})]}),v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[v.jsx("label",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",direction:"rtl"},children:'שם הסג"ח'}),v.jsx("input",{type:"text",value:k,onChange:e=>C(e.target.value),style:{background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",padding:"14px 16px",color:"var(--text)",fontSize:"16px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 20px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}})]}),v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[v.jsx("label",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",direction:"rtl"},children:"סיפק"}),v.jsx("input",{type:"text",value:E,onChange:e=>D(e.target.value),style:{background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",padding:"14px 16px",color:"var(--text)",fontSize:"16px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 20px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}})]}),v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[v.jsx("label",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",direction:"rtl"},children:"העלה קובץ אקסל (אופציונלי)"}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",background:"rgba(255,255,255,0.05)",border:"2px dashed rgba(124,192,255,0.3)",borderRadius:"12px",padding:"20px",transition:"all 0.2s ease"},children:[v.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&console.log("Excel file uploaded:",r.name)},style:{display:"none"},id:"excel-upload-popup"}),v.jsx("label",{htmlFor:"excel-upload-popup",style:{background:"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",border:"1px solid rgba(76,175,80,0.4)",borderRadius:"8px",padding:"10px 16px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"8px",direction:"rtl"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(76,175,80,0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="none"},children:"📁 בחר קובץ אקסל"}),v.jsx("span",{style:{color:"var(--muted)",fontSize:"14px",direction:"rtl"},children:"או גרור קובץ לכאן"})]})]})]}),v.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"32px",justifyContent:"center"},children:[v.jsx("button",{onClick:()=>{if(S.trim()){const e=`sagach${Date.now()}`,t=new Date,r=le(),i={version:"1.0.1",date:G(t),time:t.toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"}),data:[r],changes:["Initial version"]},o={id:e,name:S.trim(),data:[r],currentVersion:"1.0.1",versions:[i]};n(o),p(e),x("1.0.1"),j(""),C(""),D(""),w(!1)}},style:{background:"linear-gradient(135deg, rgba(124,192,255,0.8), rgba(124,192,255,0.6))",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"12px",padding:"12px 24px",color:"white",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",direction:"rtl",boxShadow:"0 4px 16px rgba(124,192,255,0.3)"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 8px 24px rgba(124,192,255,0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="0 4px 16px rgba(124,192,255,0.3)"},children:"הוסף פורמט להעלאת דגימה"}),v.jsx("button",{onClick:()=>{w(!1),j(""),C(""),D("")},style:{background:"transparent",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"12px",padding:"12px 24px",color:"var(--text)",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",direction:"rtl"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(124,192,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"מעלה דגימה"})]})]})}),M&&v.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:v.jsxs("div",{style:{background:"radial-gradient(1200px 800px at 50% 50%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 50% 50%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",border:"2px solid rgba(255,80,80,0.3)",borderRadius:"24px",padding:"32px",width:"400px",maxWidth:"90vw",boxShadow:"0 20px 60px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1)",backdropFilter:"blur(12px)"},children:[v.jsx("h2",{style:{color:"#ff5050",fontSize:"24px",fontWeight:"700",textAlign:"center",marginBottom:"16px",direction:"rtl"},children:"מחק רשומה"}),v.jsx("p",{style:{color:"var(--text)",fontSize:"16px",textAlign:"center",marginBottom:"24px",direction:"rtl"},children:"האם אתה בטוח שברצונך למחוק את הרשומה הזו? פעולה זו לא ניתנת לביטול."}),v.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[v.jsx("button",{onClick:()=>{L(!1),F(null)},style:{background:"transparent",border:"1px solid rgba(255,255,255,0.4)",borderRadius:"12px",padding:"12px 24px",color:"var(--text)",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",direction:"rtl"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"ביטול"}),v.jsx("button",{onClick:()=>{return A&&(e=A,r.forEach(t=>{if(t.data.some(t=>t.id===e)){const r=t.data.filter(t=>t.id!==e);i(t.id,{data:r})}}),L(!1),void F(null));var e},style:{background:"linear-gradient(135deg, rgba(255,80,80,0.8), rgba(255,80,80,0.6))",border:"1px solid rgba(255,80,80,0.4)",borderRadius:"12px",padding:"12px 24px",color:"white",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",direction:"rtl",boxShadow:"0 4px 16px rgba(255,80,80,0.3)"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 8px 24px rgba(255,80,80,0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="0 4px 16px rgba(255,80,80,0.3)"},children:"מחק"})]})]})})]})},ue=g.memo(({item:e,isEven:t,changes:r,editingCell:n,selectedCell:i,columnWidths:o,tableColumns:a,onCellClick:s,onCellSelect:c,onCellDoubleClick:p,onCellSave:u,onDelete:x})=>{const[m,h]=g.useState(""),[f,y]=g.useState(null),[b,w]=g.useState(null),[S,j]=g.useState(0),[k,C]=g.useState(0);g.useEffect(()=>()=>{f&&clearTimeout(f)},[f]),g.useEffect(()=>{if((null==n?void 0:n.rowId)===e.id&&(null==n?void 0:n.field)){const t=e[n.field]||"";h(t)}},[n,e.id]);const E=(t,o)=>{const a=(null==n?void 0:n.rowId)===e.id&&(null==n?void 0:n.field)===t,s=(null==i?void 0:i.rowId)===e.id&&(null==i?void 0:i.field)===t,c=r.fields.includes(t),p="new"===r.type,g="removed"===r.type,u=b===t;let x=o.backgroundColor,m=o.border,h="none",f=1;return a?(x="rgba(124,192,255,0.2)",m="1px solid rgba(124,192,255,0.6)",h="0 0 8px rgba(124,192,255,0.3)"):s?(x="rgba(124,192,255,0.1)",m="1px solid rgba(124,192,255,0.4)",h="0 0 4px rgba(124,192,255,0.2)"):g?(x="rgba(255,80,80,0.15)",m="1px solid rgba(255,80,80,0.4)",h="0 0 8px rgba(255,80,80,0.2)",f=.7):p?(x="rgba(76,175,80,0.15)",m="1px solid rgba(76,175,80,0.4)",h="0 0 8px rgba(76,175,80,0.2)"):c?(x="rgba(255,165,0,0.15)",m="1px solid rgba(255,165,0,0.4)",h="0 0 8px rgba(255,165,0,0.2)"):u&&(x="rgba(124,192,255,0.08)",m="1px solid rgba(124,192,255,0.3)",h="0 0 4px rgba(124,192,255,0.15)"),d(l({},o),{backgroundColor:x,border:m,boxShadow:h,opacity:f,cursor:a?"text":"pointer",transition:"all 0.2s ease"})},D=()=>{console.log("TEST: testEditFunction called"),console.log("TEST: item.id:",e.id,"field:","Column 1"),console.log("TEST: calling onCellDoubleClick directly"),p(e.id,"Column 1","test value"),console.log("TEST: onCellDoubleClick called")};g.useEffect(()=>(window.testEditFunction=D,()=>{delete window.testEditFunction}),[D]);const T=t=>{u(e.id,t,m)},N=(t,r)=>{const i=(null==n?void 0:n.rowId)===e.id&&(null==n?void 0:n.field)===t;return console.log("renderCell called with:",{field:t,value:r,isEditing:i,itemId:e.id,editingCell:n,item:e,itemFieldValue:e[t]}),i?v.jsx("textarea",{value:m,onChange:e=>h(e.target.value),onBlur:()=>T(t),onKeyDown:r=>((t,r)=>{if("Enter"!==t.key||t.shiftKey)if("Enter"===t.key&&t.shiftKey){const e=t.currentTarget,r=e.selectionStart,n=e.selectionEnd,i=e.value,o=i.substring(0,r)+"\n"+i.substring(n);h(o),setTimeout(()=>{e.selectionStart=e.selectionEnd=r+1},0)}else"Escape"===t.key&&u(e.id,r,m);else T(r)})(r,t),autoFocus:!0,style:{background:"transparent",border:"none",outline:"none",color:"var(--text)",fontSize:"13px",width:"100%",minHeight:"20px",maxHeight:"100px",resize:"none",textAlign:"center",direction:"name"===t?"rtl":"ltr",fontFamily:"inherit",lineHeight:"1.4"}}):v.jsx("div",{onClick:n=>{console.log("Click event on field:",t,"value:",r,"item:",e),n.stopPropagation(),((t,r)=>{console.log("Click detected on field:",t,"clickCount:",S,"lastClickTime:",k);const n=Date.now();if(f&&(clearTimeout(f),y(null)),n-k<300&&S>0)return console.log("Double click detected via click counting"),j(0),C(0),void p(e.id,t,r||"");j(e=>(console.log("Incrementing click count from",e,"to",e+1),e+1)),C(n);const i=setTimeout(()=>{console.log("Single click timeout triggered, selecting cell"),c(e.id,t),j(0)},300);y(i)})(t,r)},onDoubleClick:n=>{console.log("Double click event on field:",t,"value:",r),n.stopPropagation(),n.preventDefault(),console.log("Double click event handler triggered"),((t,r)=>{console.log("Double click event detected on field:",t,"value:",r),console.log("About to call onCellDoubleClick with:",{rowId:e.id,field:t,currentValue:r}),f&&(clearTimeout(f),y(null)),j(0),C(0),p(e.id,t,r||""),console.log("onCellDoubleClick called successfully")})(t,r)},onMouseEnter:()=>w(t),onMouseLeave:()=>w(null),style:{cursor:"pointer",display:"flex",width:"100%",height:"100%",minHeight:"40px",whiteSpace:"pre-wrap",wordBreak:"break-word",userSelect:"none",padding:"8px",margin:"-8px",alignItems:"center",justifyContent:"center",position:"relative"},children:v.jsx("span",{style:{textAlign:"center",width:"100%"},children:r})})},z={padding:"10px 12px",border:"none",textAlign:"center",color:"var(--text)",fontSize:"13px"},I=(()=>{const e="new"===r.type,n="removed"===r.type;let i=t?"rgba(255,255,255,0.04)":"rgba(255,255,255,0.02)",o="1px solid rgba(255,255,255,0.06)",a=1;return e?(i="rgba(76,175,80,0.08)",o="1px solid rgba(76,175,80,0.3)"):n&&(i="rgba(255,80,80,0.08)",o="1px solid rgba(255,80,80,0.3)",a=.7),{background:i,borderBottom:o,opacity:a,transition:"background 0.2s ease, opacity 0.2s ease"}})();return v.jsxs("tr",{style:I,onMouseEnter:e=>{n||"removed"===r.type||(e.currentTarget.style.background="new"===r.type?"rgba(76,175,80,0.12)":"rgba(255,255,255,0.08)")},onMouseLeave:e=>{n||(e.currentTarget.style.background=I.background)},children:[v.jsx("td",{style:{width:"80px",minWidth:"80px",padding:"10px 12px",border:"none",textAlign:"center",color:"var(--text)",fontSize:"13px"}}),a.map((t,n)=>v.jsx("td",{style:d(l({},E(t,d(l({},z),{direction:0===n?"rtl":"ltr"}))),{width:`${o[t]||150}px`,minWidth:"80px"}),children:n===a.length-1?v.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[v.jsx("span",{style:{flex:1},children:N(t,e[t]||"")}),"removed"===r.type?v.jsx("span",{style:{color:"#ff5050",fontSize:"12px",fontWeight:"bold",marginLeft:"8px"},children:"הוסר"}):v.jsx("button",{onClick:()=>x(e.id),className:"btn ghost",style:{padding:"2px 4px",fontSize:"10px",borderColor:"rgba(255,80,80,0.4)",color:"#ff5050",marginLeft:"8px",minWidth:"auto",width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center"},title:"מחק רשומה",children:"🗑"})]}):N(t,e[t]||"")},t))]})});ue.displayName="TableRow";const xe=({sagach:e,isSelected:t,onSelect:r})=>v.jsxs("div",{style:{background:t?"linear-gradient(180deg, rgba(124,192,255,0.15), rgba(124,192,255,0.08))":"rgba(255,255,255,0.06)",border:t?"1px solid rgba(124,192,255,0.6)":"1px solid rgba(255,255,255,0.14)",borderRadius:"12px",padding:"12px",transition:"all 0.2s ease",boxShadow:t?"0 6px 22px rgba(124,192,255,0.24)":"0 4px 12px rgba(0,0,0,0.2)"},children:[v.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:v.jsx("div",{onClick:r,style:{cursor:"pointer",fontSize:"16px",fontWeight:"600",color:"var(--text)",direction:"rtl",flex:1},children:e.name})}),v.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",marginBottom:"8px",direction:"rtl"},children:[e.data.length," רשומות"]})]}),me=e=>`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`,he=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]},fe=["נמוך","בינוני","גבוה","TOP"],ye={"נמוך":"נמוך","בינוני":"בינוני","גבוה":"גבוה",TOP:"TOP"},be=["7140","7190","7149","7170","גבעה",'שב"כ','קש"ח','גדס"מ',"הצריף","8153"],ve=["ממתין לבשלות בצד ספק",'ממתין לקבלת דג"ח והתנעה',"בתהליכי אפיון","ממתין לאינטגרציות","אינטגרציות","מבצוע"],we=["ממתין לבשלות בצד ספק",'ממתין לקבלת דג"ח והתנעה',"בתהליכי אפיון","ממתין לאינטגרציות","אינטגרציות","מבצוע","מובצע"];if("undefined"!=typeof document&&!document.head.querySelector("#spinner-animation")){const e=document.createElement("style");e.id="spinner-animation",e.textContent="\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n",document.head.appendChild(e)}const Se=g.memo(()=>{var t;const{canEditStatus:r,canCreateSagach:n,canDeleteSagach:i,canChat:o,user:a,hasRole:s}=V(),{sagachimStatus:c,addSagachimStatus:u,updateSagachimStatus:x,deleteSagachimStatus:m,clearAllData:h,isLoading:f,error:y}=pe(),b=(e,t)=>{var r;return(null==(r=e.notificationSubscribers)?void 0:r.some(e=>e.userId===t))||!1},w=(e,t,r,n,i)=>{const o={userId:t,userName:r,notificationMethod:n,notificationFrequency:i,subscribedAt:(new Date).toISOString()},a=[...(e.notificationSubscribers||[]).filter(e=>e.userId!==t),o];return d(l({},e),{notificationSubscribers:a,notifications:b(e,t),notificationMethod:n,notificationFrequency:i})},S={primary:{appearance:"none",border:"none",borderRadius:"12px",padding:"12px 20px",cursor:"pointer",transition:"all 0.2s ease",fontSize:"14px",fontWeight:"600",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",direction:"rtl",outline:"none"},filter:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"transparent",color:"var(--text)",borderRadius:"12px",padding:"8px 14px",cursor:"pointer",transition:"transform 120ms ease",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"right",boxShadow:"none"},close:{background:"none",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:"14px",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",width:"16px",height:"16px",borderRadius:"50%",transition:"all 0.2s ease"}},[j,k]=g.useState(""),[C,E]=g.useState(""),[D,T]=g.useState(""),[N,z]=g.useState(""),[I,M]=g.useState(""),[L,A]=g.useState("none"),[F,R]=g.useState(null),[$,_]=g.useState(""),[B,W]=g.useState(!1),[O,U]=g.useState(1),P=g.useRef(null),[q,Y]=g.useState(!1),[H,J]=g.useState(!1),[X,G]=g.useState(!1),[K,Q]=g.useState(!1),[Z,ee]=g.useState(!1),[te,re]=g.useState(!1),[ie,oe]=g.useState(!1),[ae,se]=g.useState(!1),[le,de]=g.useState(!1),[ce,ge]=g.useState(!1),[ue,xe]=g.useState(!1),[Se,je]=g.useState("email"),[ke,Ce]=g.useState("status_change"),[Ee,De]=g.useState(!1),[Te,Ne]=g.useState(!1),[ze,Ie]=g.useState(!1),[Me,Le]=g.useState(!1),[Ae,Fe]=g.useState({name:"",description:"",provider:"",arena:[],priority:"בינוני",sagachType:""}),[Re,$e]=g.useState({message:"",type:"success",isVisible:!1}),[_e,Be]=g.useState(null),[We,Oe]=g.useState(!1),[Ue,Pe]=g.useState(!1),[qe,Ye]=g.useState(""),[He,Ve]=g.useState(!1),[Je,Xe]=g.useState(""),[Ge,Ke]=g.useState(!1),[Qe,Ze]=g.useState({description:"",provider:"",arena:[],priority:"בינוני",sagachType:"",processStatus:1,processStartDate:"",attachments:[]}),[et,tt]=g.useState(new Date),rt=()=>_e||new Date,nt=e=>{if(!e.trim())return null;const t=e.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(!t)return null;const[,r,n,i]=t,o=parseInt(r,10),a=parseInt(n,10),s=parseInt(i,10);if(o<1||o>31||a<1||a>12||s<1900)return null;const l=new Date(s,a-1,o);return l.getFullYear()!==s||l.getMonth()!==a-1||l.getDate()!==o?null:l.toISOString()},it=e=>{if(!e.trim())return null;const t=e.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(!t)return"פורמט תאריך לא תקין. השתמש בפורמט DD/MM/YYYY";const[,r,n,i]=t,o=parseInt(r,10),a=parseInt(n,10),s=parseInt(i,10);if(s<1900)return"שנת התאריך חייבת להיות 1900 או מאוחר יותר";if(a<1||a>12)return"חודש התאריך חייב להיות בין 1 ל-12";if(o<1||o>31)return"יום התאריך חייב להיות בין 1 ל-31";const l=new Date(s,a-1,o);if(l.getFullYear()!==s||l.getMonth()!==a-1||l.getDate()!==o){const e=["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],t=new Date(s,a,0).getDate();return`${o} ${e[a-1]} ${s} אינו תאריך תקין. ${e[a-1]} ${s} יש לו רק ${t} ימים`}return null},ot=e=>{if(!e)return"לא צוין";try{const t=new Date(e);if(isNaN(t.getTime()))return"לא צוין";const r=t.getDate().toString().padStart(2,"0"),n=(t.getMonth()+1).toString().padStart(2,"0");return`${r}/${n}/${t.getFullYear()}`}catch(t){return"לא צוין"}},at=e=>{if(7===e.processStatus)return!1;if(!e.estimatedCompletion)return!1;try{let t;const r=rt(),n=e.estimatedCompletion.trim(),i=/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/,o=n.match(i);if(o){const e=parseInt(o[1]),r=parseInt(o[2])-1,n=parseInt(o[3]);t=new Date(n,r,e)}else t=new Date(e.estimatedCompletion);if(isNaN(t.getTime()))return!1;const a=new Date(t.getFullYear(),t.getMonth(),t.getDate()),s=new Date(r.getFullYear(),r.getMonth(),r.getDate()),l=a<s;return"dsa"===e.name&&(console.log(`🔍 OVERDUE CHECK for "${e.name}":`),console.log(`  estimatedCompletion: "${e.estimatedCompletion}"`),console.log(`  processStatus: ${e.processStatus}`),console.log(`  expectedDateOnly: ${a.toISOString()}`),console.log(`  currentDateOnly: ${s.toISOString()}`),console.log(`  isOverdue: ${l}`)),l}catch(t){return console.error("Error checking overdue status:",t),!1}};g.useEffect(()=>{_e?(tt(_e),console.log("🗓️ Mock date changed to:",_e.toISOString())):tt(new Date)},[_e]),g.useEffect(()=>{const e=setInterval(()=>{_e||tt(new Date)},6e4);return()=>clearInterval(e)},[_e]);const[,st]=g.useState(0);g.useEffect(()=>{st(e=>e+1)},[null==F?void 0:F.id,null==F?void 0:F.processStatus,null==F?void 0:F.lastUpdated,_e,et,c.length]);const[,lt]=g.useState(0);g.useEffect(()=>{F&&lt(e=>e+1)},[_e,et]),g.useEffect(()=>{c.length>0&&c.map(e=>{const t=rt(),r=l({},e.phaseData||{});return Object.keys(r).forEach(n=>{var i;const o=parseInt(n),a=r[o];if(a){let n=0;a.entries&&a.entries.forEach(e=>{e.timeSpentDays&&(n+=e.timeSpentDays)});let s=(null==(i=a.currentEntry)?void 0:i.timeSpentDays)||0;if(a.currentEntry&&o===e.processStatus){const e=new Date(a.currentEntry.startDate+"T00:00:00"),r=new Date(t.toISOString().split("T")[0]+"T23:59:59"),n=Math.max(0,r.getTime()-e.getTime());s=Math.max(1,Math.ceil(n/864e5))}const c=n+s;r[o]=d(l({},a),{currentEntry:a.currentEntry?d(l({},a.currentEntry),{timeSpentDays:s}):void 0,totalTimeSpentDays:Math.max(a.totalTimeSpentDays||0,c)})}}),d(l({},e),{phaseData:r})}).forEach(e=>{x(e.id,e)}),st(e=>e+1),lt(e=>e+1)},[_e,et,c.length,st,lt]);const dt=g.useCallback((e,t=!1)=>{var r,n,i;if(!e)return 0;const o=(e.entries||[]).reduce((e,t)=>"number"!=typeof t.timeSpentDays||Number.isNaN(t.timeSpentDays)?e:e+t.timeSpentDays,0),a="number"!=typeof e.totalTimeSpentDays||Number.isNaN(e.totalTimeSpentDays)?0:e.totalTimeSpentDays,s="number"!=typeof(null==(r=e.currentEntry)?void 0:r.timeSpentDays)||Number.isNaN(null==(n=e.currentEntry)?void 0:n.timeSpentDays)?0:e.currentEntry.timeSpentDays,l=Math.max(o,a),d=Math.max(o,Math.max(0,a-s));if(t&&(null==(i=e.currentEntry)?void 0:i.startDate)){const t=new Date(e.currentEntry.startDate+"T00:00:00"),r=rt(),n=new Date(r.toISOString().split("T")[0]+"T00:00:00"),i=Math.max(0,n.getTime()-t.getTime());return d+Math.max(1,Math.floor(i/864e5)+1)}return l},[_e,et]),ct=g.useCallback((e,t=!1)=>{if(!e)return"";const r=[...e.entries||[]];if(e.currentEntry&&r.push(e.currentEntry),0===r.length)return"";const n=r.map(e=>new Date(e.startDate)),i=new Date(Math.min(...n.map(e=>e.getTime())));let o;if(t&&e.currentEntry)o=rt();else{const e=r.filter(e=>e.completionDate).map(e=>new Date(e.completionDate));o=e.length>0?new Date(Math.max(...e.map(e=>e.getTime()))):i}const a=me(i),s=me(o);return a===s?a:`${a} - ${s}`},[rt]);g.useEffect(()=>{const e=e=>{e.target.closest("[data-dropdown-container]")||(Y(!1),J(!1),G(!1),Q(!1),ee(!1),re(!1),oe(!1),se(!1),de(!1),ge(!1))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),g.useEffect(()=>{const e=e=>{"Escape"===e.key&&F&&(Ke(!1),R(null))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[F]),g.useEffect(()=>{F&&P.current&&setTimeout(()=>{P.current&&(P.current.scrollTop=P.current.scrollHeight)},100)},[F]),g.useEffect(()=>{F&&P.current&&F.statusUpdates&&setTimeout(()=>{P.current&&(P.current.scrollTop=P.current.scrollHeight)},50)},[null==F?void 0:F.statusUpdates]);const pt=(e,t="success")=>{$e({message:e,type:t,isVisible:!0}),setTimeout(()=>{$e(e=>d(l({},e),{isVisible:!1}))},3e3)},gt=g.useMemo(()=>[...new Set(c.map(e=>e.provider))].sort(),[c]),ut=g.useMemo(()=>{const e=c.flatMap(e=>e.arena);return[...new Set(e)].sort()},[c]),xt=g.useMemo(()=>[...new Set(c.map(e=>e.sagachType).filter(Boolean))].sort(),[c]),mt=g.useMemo(()=>{console.log("🔍 Filtering sagachim. Total sagachs:",c.length),console.log("🔍 All sagachim data:",c),c.forEach(e=>{const t=at(e);console.log(`🔍 Sagach "${e.name}": estimatedCompletion = "${e.estimatedCompletion}", processStatus = ${e.processStatus}, isOverdue = ${t}`)});let e=c.filter(e=>{if(7===e.processStatus&&e.completionDate){const t=new Date(e.completionDate),r=new Date(rt());if(r.setDate(r.getDate()-7),t<r)return!1}const t=!j||e.name.toLowerCase().includes(j.toLowerCase())||e.description.toLowerCase().includes(j.toLowerCase()),r=!C||e.provider===C,n=!D||e.arena.includes(D),i=!N||e.processStatus.toString()===N,o=!I||(e.sagachType||"")===I;return t&&r&&n&&i&&o});return"none"!==L&&e.sort((e,t)=>"asc"===L?e.processStatus-t.processStatus:"desc"===L?t.processStatus-e.processStatus:0),console.log("🔍 Filtered sagachs result:",e.length,"sagachs"),e.forEach(e=>{console.log(`  - ${e.name} (processStatus: ${e.processStatus})`)}),e},[c,j,C,D,N,I,L]),ht=e=>{switch(e){case 1:return"rgba(128, 128, 128, 0.8)";case 2:return"rgba(33, 150, 243, 0.8)";case 3:return"rgba(255, 152, 0, 0.8)";case 4:return"rgba(233, 30, 99, 0.8)";case 5:return"rgba(156, 39, 176, 0.8)";case 6:return"rgba(46, 125, 50, 0.8)";case 7:return"rgba(27, 94, 32, 0.8)";default:return"rgba(158, 158, 158, 0.8)"}},ft=e=>{Ke(!1),R(e),_(""),W(!1),U(e.processStatus)},yt=()=>{if(!F||!$.trim())return;if(!o())return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"אין לך הרשאה להוסיף הודעות",type:"error",durationMs:3e3}}));const e={id:Date.now().toString(),message:$.trim(),timestamp:kt(rt().toISOString()),type:"user",processStatus:F.processStatus,author:(null==a?void 0:a.name)||"משתמש"},t=d(l({},F),{statusUpdates:[...F.statusUpdates||[],e],lastUpdated:me(rt())});console.log("💬 Adding update to sagach:",F.name),x(F.id,t),R(t),_(""),pt("הודעה נוספה בהצלחה","success")},bt=()=>{if(!F)return;const e=nt(qe);if(qe.trim()&&!e){const e=it(qe);return void pt(e||"פורמט תאריך לא תקין. השתמש בפורמט DD/MM/YYYY","warning")}const t=d(l({},F),{estimatedCompletion:e||void 0});x(F.id,t),R(t),Pe(!1),pt('תאריך התג"ב עודכן בהצלחה',"success")},vt=()=>{Pe(!1),Ye("")},wt=()=>{if(!F)return;const e=nt(Je);if(Je.trim()&&!e){const e=it(Je);return void pt(e||"פורמט תאריך לא תקין. השתמש בפורמט DD/MM/YYYY","warning")}const t=d(l({},F),{processStartDate:e||void 0});x(F.id,t),R(t),Ve(!1),pt("תאריך התחלה עודכן בהצלחה","success")},St=()=>{Ve(!1),Xe("")},jt=t=>p(e,null,function*(){var e,r,n,i,o,s;if(F&&t!==F.processStatus)try{let c=0;if(null==(n=null==(r=null==(e=F.phaseData)?void 0:e[F.processStatus])?void 0:r.currentEntry)?void 0:n.startDate){const e=F.phaseData[F.processStatus];c=dt(e,!0)}const p={id:Date.now().toString(),message:`שונה סטטוס מ-"${7===F.processStatus?"מובצע":ve[F.processStatus-1]}" ל-"${7===t?"מובצע":ve[t-1]}"${c>0?` •בשלב הקודם ${c} ימים`:""}`,timestamp:kt(rt().toISOString()),type:"status_change",oldStatus:F.processStatus,newStatus:t,processStatus:F.processStatus,author:(null==a?void 0:a.name)||"משתמש"},g=rt(),u=l({},F.phaseData||{});if(null==(s=null==(o=null==(i=F.phaseData)?void 0:i[F.processStatus])?void 0:o.currentEntry)?void 0:s.startDate){const e=u[F.processStatus]||{},t=new Date(e.currentEntry.startDate+"T00:00:00"),r=new Date(g.toISOString().split("T")[0]+"T23:59:59"),n=Math.abs(r.getTime()-t.getTime()),i=Math.ceil(n/864e5),o={startDate:e.currentEntry.startDate,completionDate:g.toISOString().split("T")[0],timeSpentDays:i};u[F.processStatus]={entries:[...e.entries||[],o],currentEntry:void 0,totalTimeSpentDays:i}}if(t<7){const e=u[t]||{};if(e.currentEntry){const r={startDate:e.currentEntry.startDate,completionDate:g.toISOString().split("T")[0],timeSpentDays:Math.ceil(Math.abs(new Date(g.toISOString().split("T")[0]+"T23:59:59").getTime()-new Date(e.currentEntry.startDate+"T00:00:00").getTime())/864e5)};u[t]=d(l({},e),{entries:[...e.entries||[],r],currentEntry:{startDate:g.toISOString().split("T")[0],timeSpentDays:0},totalTimeSpentDays:Math.max(dt(e,!1)+r.timeSpentDays,e.totalTimeSpentDays||0)})}else{const r={startDate:g.toISOString().split("T")[0],timeSpentDays:0};u[t]=d(l({},e),{currentEntry:r,totalTimeSpentDays:Math.max(dt(e,!1),e.totalTimeSpentDays||0)})}}const m=d(l({},F),{description:Qe.description.trim(),provider:Qe.provider.trim(),arena:Qe.arena,priority:Qe.priority,sagachType:Qe.sagachType.trim()||void 0,attachments:Qe.attachments,processStatus:t,statusUpdates:[...F.statusUpdates||[],p],lastUpdated:me(g),phaseData:u,completionDate:7===t?g.toISOString():F.completionDate});console.log("🔄 Changing status of sagach:",F.name,"to status",t),x(F.id,m),R(m),Ke(!1),pt(`פרטים נשמרו וסטטוס עודכן ל-"${7===t?"מובצע":ve[t-1]}"`,"success")}catch(c){console.error("Error updating process status:",c),pt("שגיאה בעדכון השלב בתהליך","warning")}}),kt=e=>{if(!e)return"לא צוין";try{const t=new Date(e);if(isNaN(t.getTime()))return e;const r=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0"),i=t.getSeconds().toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0");return`${o}/${a}/${t.getFullYear()} ${r}:${n}:${i}`}catch(t){return e}},Ct=()=>{if(!F||!a)return;const e=a.id||"current_user",t=a.name||"משתמש",r=b(F,e);let n;n=r?((e,t)=>{const r=(e.notificationSubscribers||[]).filter(e=>e.userId!==t);return d(l({},e),{notificationSubscribers:r,notifications:!1})})(F,e):w(F,e,t,"email","status_change"),x(F.id,n),R(n),pt(r?"התראות בוטלו בהצלחה":"התראות הופעלו בהצלחה","success")};return v.jsxs(v.Fragment,{children:[v.jsx("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:1e3,background:"rgba(0,0,0,0.8)",borderRadius:"12px",padding:We?"16px":"8px",border:"1px solid rgba(255,255,255,0.2)",backdropFilter:"blur(8px)",transition:"all 0.3s ease",cursor:"pointer"},onClick:()=>Oe(!We),title:"לחץ לפתיחת פאנל בדיקת תאריכים",children:We&&v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",minWidth:"200px"},onClick:e=>e.stopPropagation(),children:[v.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",color:"var(--text)",fontSize:"11px",fontWeight:"600"},children:[v.jsx("span",{children:"בדיקת תאריכים"}),v.jsx("button",{onClick:()=>Oe(!1),style:{background:"none",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:"14px",padding:"0",width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"},title:"סגור פאנל",children:"×"})]}),v.jsx("input",{type:"date",value:(null==_e?void 0:_e.toISOString().split("T")[0])||"",onChange:e=>{e.target.value?Be(new Date(e.target.value+"T12:00:00")):Be(null)},onClick:e=>e.stopPropagation(),style:{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"6px",padding:"6px 8px",color:"var(--text)",fontSize:"12px",fontFamily:"Segoe UI, sans-serif"}}),v.jsx("div",{style:{fontSize:"10px",color:"var(--muted)",textAlign:"center"},children:_e?`תאריך מדומה: ${me(_e)}`:`תאריך אמיתי: ${me(new Date)}`}),v.jsx("button",{onClick:e=>{e.stopPropagation(),Be(null)},disabled:!_e,style:{background:_e?"linear-gradient(135deg, rgba(244,67,54,0.8), rgba(244,67,54,0.6))":"rgba(255,255,255,0.1)",border:"none",borderRadius:"6px",padding:"4px 8px",color:_e?"white":"var(--muted)",fontSize:"10px",fontWeight:"600",cursor:_e?"pointer":"not-allowed"},children:"איפוס לתאריך אמיתי"}),v.jsx("button",{onClick:e=>{e.stopPropagation(),h(),window.location.reload()},style:{background:"linear-gradient(135deg, rgba(255,152,0,0.8), rgba(255,152,0,0.6))",border:"none",borderRadius:"6px",padding:"4px 8px",color:"white",fontSize:"10px",fontWeight:"600",cursor:"pointer"},children:"איפוס נתונים"})]})}),v.jsx("style",{children:"\n          @keyframes pulse-glow {\n            0%, 100% {\n              box-shadow: 0 0 12px rgba(124,192,255,0.6), 0 0 20px rgba(167,90,255,0.4);\n              transform: scale(1);\n            }\n            50% {\n              box-shadow: 0 0 20px rgba(124,192,255,0.8), 0 0 32px rgba(167,90,255,0.6), 0 0 44px rgba(124,192,255,0.4);\n              transform: scale(1.05);\n            }\n          }\n          \n          /* Custom scrollbar styling for left-side positioning */\n          .sagachim-grid-scroll::-webkit-scrollbar {\n            width: 8px;\n          }\n\n          .sagachim-grid-scroll::-webkit-scrollbar-track {\n            background: #2d3748;\n            border-radius: 4px;\n          }\n\n          .sagachim-grid-scroll::-webkit-scrollbar-thumb {\n            background: #7cc0ff;\n            border-radius: 4px;\n            transition: background 0.3s ease;\n          }\n\n          .sagachim-grid-scroll::-webkit-scrollbar-thumb:hover {\n            background: #5da3e6;\n          }\n\n          /* For Firefox */\n          .sagachim-grid-scroll {\n            scrollbar-width: thin;\n            scrollbar-color: #7cc0ff #2d3748;\n          }\n        "}),v.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"radial-gradient(1200px 800px at 80% 20%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 10% 90%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",zIndex:-1}}),v.jsx("div",{className:"sagachim-status",style:{minHeight:"100vh",color:"var(--text)",fontFamily:'"Segoe UI", system-ui, sans-serif',width:"100%",boxSizing:"border-box",padding:"20px",position:"relative"},children:v.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",maxWidth:"1400px",margin:"0 auto",width:"100%"},children:[v.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"40px",width:"100%"},children:[v.jsxs("div",{style:{textAlign:"center",flex:1},children:[v.jsx("h1",{style:{fontSize:"32px",fontWeight:"700",color:"var(--accent)",margin:"0 0 16px 0",letterSpacing:"0.5px",direction:"rtl"},children:'סטטוס סג"חים'}),v.jsx("p",{style:{fontSize:"16px",color:"var(--muted)",margin:0,direction:"rtl"},children:'מעקב אחר מצב הסג"חים בתהליך הכניסה'})]}),n()&&v.jsx("button",{onClick:()=>Ie(!0),style:d(l({},S.primary),{background:"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",color:"white",marginLeft:"20px"}),onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 6px 20px rgba(76,175,80,0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="none"},children:'+ צור סג"ח חדש'})]}),v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",marginBottom:"32px",alignItems:"center",width:"100%"},children:[v.jsxs("div",{style:{display:"flex",gap:"16px",justifyContent:"center",flexWrap:"wrap",alignItems:"center",width:"100%"},children:[v.jsxs("div",{style:{position:"relative",minWidth:"280px",maxWidth:"400px",flex:"1 1 300px"},children:[v.jsx("input",{type:"text",placeholder:"חיפוש לפי שם או תיאור...",value:j,onChange:e=>k(e.target.value),style:{width:"100%",padding:"12px 16px 12px 40px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 20px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}}),v.jsx("div",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--muted)",fontSize:"16px"},children:"🔍"})]}),v.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsxs("button",{onClick:()=>Y(!q),style:S.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[v.jsx("span",{children:C||"כל הספקים"}),v.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),q&&v.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[v.jsx("div",{onClick:()=>{E(""),Y(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הספקים"}),gt.map(e=>v.jsx("div",{onClick:()=>{E(e),Y(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),v.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsxs("button",{onClick:()=>J(!H),style:S.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},onFocus:e=>{const t=e.target;t.style.boxShadow="none",t.style.outline="none"},onBlur:e=>{e.target.style.boxShadow="none"},children:[v.jsx("span",{children:D||"כל הזירות"}),v.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),H&&v.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[v.jsx("div",{onClick:()=>{T(""),J(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הזירות"}),ut.map(e=>v.jsx("div",{onClick:()=>{T(e),J(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),v.jsxs("div",{style:{position:"relative",minWidth:"180px",maxWidth:"240px",flex:"0 1 200px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsxs("button",{onClick:()=>G(!X),style:S.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[v.jsx("span",{children:N?7===parseInt(N)?"מובצע":ve[parseInt(N)-1]:"כל שלבי התהליך"}),v.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),X&&v.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[v.jsx("div",{onClick:()=>{z(""),G(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל שלבי התהליך"}),we.map((e,t)=>v.jsx("div",{onClick:()=>{z((t+1).toString()),G(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:t+1===7?"מובצע":e},t+1))]})]}),v.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsxs("button",{onClick:()=>Q(!K),style:S.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[v.jsx("span",{children:I||'כל סוגי הסג"ח'}),v.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),K&&v.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[v.jsx("div",{onClick:()=>{M(""),Q(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:'כל סוגי הסג"ח'}),xt.map(e=>v.jsx("div",{onClick:()=>{M(e||""),Q(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),v.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsxs("button",{onClick:()=>re(!te),style:S.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},onFocus:e=>{const t=e.target;t.style.boxShadow="none",t.style.outline="none"},onBlur:e=>{e.target.style.boxShadow="none"},children:[v.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[v.jsx("span",{children:"☰"}),v.jsx("span",{children:"asc"===L?"מההתחלה לסוף":"desc"===L?"מהסוף להתחלה":"סדר לפי"})]}),v.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),te&&v.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[v.jsxs("div",{onClick:()=>{A("none"),re(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"none"===L?"var(--accent)":"#ffffff",textAlign:"center",direction:"rtl",background:"none"===L?"rgba(124,192,255,0.1)":"transparent",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseEnter:e=>{"none"!==L&&(e.target.style.background="rgba(255,255,255,0.08)")},onMouseLeave:e=>{e.target.style.background="none"!==L?"transparent":"rgba(124,192,255,0.1)"},children:["none"===L&&v.jsx("span",{style:{fontSize:"12px"},children:"✓"}),v.jsx("span",{children:"ללא מיון"})]}),v.jsxs("div",{onClick:()=>{A("asc"),re(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"asc"===L?"var(--accent)":"#ffffff",textAlign:"center",direction:"rtl",background:"asc"===L?"rgba(124,192,255,0.1)":"transparent",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseEnter:e=>{"asc"!==L&&(e.target.style.background="rgba(255,255,255,0.08)")},onMouseLeave:e=>{e.target.style.background="asc"!==L?"transparent":"rgba(124,192,255,0.1)"},children:[v.jsx("span",{style:{fontSize:"12px",opacity:.7}}),"asc"===L&&v.jsx("span",{style:{fontSize:"12px"},children:"✓"}),v.jsx("span",{children:" מההתחלה לסוף"})]}),v.jsxs("div",{onClick:()=>{A("desc"),re(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"desc"===L?"var(--accent)":"#ffffff",textAlign:"center",direction:"rtl",background:"desc"===L?"rgba(124,192,255,0.1)":"transparent",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseEnter:e=>{"desc"!==L&&(e.target.style.background="rgba(255,255,255,0.08)")},onMouseLeave:e=>{e.target.style.background="desc"!==L?"transparent":"rgba(124,192,255,0.1)"},children:[v.jsx("span",{style:{fontSize:"12px",opacity:.7}}),"desc"===L&&v.jsx("span",{style:{fontSize:"12px"},children:"✓"}),v.jsx("span",{children:"מהסוף להתחלה"})]})]})]})]}),(C||D||N||I||j)&&v.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",justifyContent:"center",alignItems:"center",marginBottom:"16px"},children:[j&&v.jsxs("div",{style:{display:"flex",alignItems:"center",background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"20px",padding:"6px 12px",gap:"8px",direction:"rtl"},children:[v.jsxs("span",{style:{color:"var(--text)",fontSize:"12px",fontWeight:"500"},children:['חיפוש: "',j,'"']}),v.jsx("button",{onClick:()=>{k("")},style:S.close,onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.2)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]}),C&&v.jsxs("div",{style:{display:"flex",alignItems:"center",background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"20px",padding:"6px 12px",gap:"8px",direction:"rtl"},children:[v.jsxs("span",{style:{color:"var(--text)",fontSize:"12px",fontWeight:"500"},children:["ספק: ",C]}),v.jsx("button",{onClick:()=>{E("")},style:S.close,onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.2)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]}),D&&v.jsxs("div",{style:{display:"flex",alignItems:"center",background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"20px",padding:"6px 12px",gap:"8px",direction:"rtl"},children:[v.jsxs("span",{style:{color:"var(--text)",fontSize:"12px",fontWeight:"500"},children:["זירה: ",D]}),v.jsx("button",{onClick:()=>{T("")},style:S.close,onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.2)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]}),N&&v.jsxs("div",{style:{display:"flex",alignItems:"center",background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"20px",padding:"6px 12px",gap:"8px",direction:"rtl"},children:[v.jsxs("span",{style:{color:"var(--text)",fontSize:"12px",fontWeight:"500"},children:["שלב: ",7===parseInt(N)?"מובצע":ve[parseInt(N)-1]]}),v.jsx("button",{onClick:()=>{z("")},style:S.close,onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.2)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]}),I&&v.jsxs("div",{style:{display:"flex",alignItems:"center",background:"rgba(124,192,255,0.2)",border:"1px solid rgba(124,192,255,0.4)",borderRadius:"20px",padding:"6px 12px",gap:"8px",direction:"rtl"},children:[v.jsxs("span",{style:{color:"var(--text)",fontSize:"12px",fontWeight:"500"},children:["סוג: ",I]}),v.jsx("button",{onClick:()=>M(""),style:S.close,onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.2)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]})]}),v.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"24px",width:"100%",maxWidth:"1200px"},children:v.jsx("span",{style:{color:"var(--muted)",fontSize:"14px",direction:"rtl"}})}),v.jsx("div",{className:"sagachim-grid-scroll",style:{display:"flex",flexDirection:"column",gap:"32px",width:"100%",padding:"0 20px 0 20px",maxHeight:"calc(100vh - 400px)",overflowY:"auto",overflowX:"hidden",direction:"rtl"},children:C||D||N||I||j||"none"!==L?("desc"===L?[7,6,5,4,3,2,1]:[1,2,3,4,5,6,7]).map(e=>{const t=mt.filter(t=>t.processStatus===e);return console.log(`📋 Phase ${e}: ${t.length} sagachs`),t.forEach(e=>{console.log(`  - ${e.name} (processStatus: ${e.processStatus})`)}),0===t.length?null:v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px",padding:"0 8px"},children:[v.jsxs("div",{style:{background:ht(e),color:"white",padding:"8px 16px",borderRadius:"20px",fontSize:"14px",fontWeight:"600",letterSpacing:"0.5px",display:"flex",alignItems:"center",gap:"6px"},children:[7===e&&"✅",7===e?"מובצע":ve[e-1]]}),v.jsx("span",{style:{color:"var(--muted)",fontSize:"12px",fontWeight:"500"}})]}),v.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"24px",justifyItems:"center"},children:t.map(e=>{const t=at(e),r=7===e.processStatus;return"dsa"===e.name&&(console.log(`🎨 RENDERING CARD for "${e.name}":`),console.log(`  estimatedCompletion: "${e.estimatedCompletion}"`),console.log(`  processStatus: ${e.processStatus}`),console.log(`  isOverdue: ${t}`),console.log(`  isCompleted: ${r}`),console.log(`  🎨 WILL APPLY ORANGE STYLING: ${t}`)),v.jsxs("div",{onClick:()=>ft(e),style:{background:r?"linear-gradient(180deg, rgba(76,175,80,0.15), rgba(46,125,50,0.10))":t?"linear-gradient(180deg, rgba(255,165,0,0.25), rgba(255,140,0,0.20))":"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:r?"1px solid rgba(76,175,80,0.3)":t?"2px solid rgba(255,165,0,0.6)":"1px solid rgba(255,255,255,0.12)",borderRadius:"16px",padding:"24px",boxShadow:r?"0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)":t?"0 8px 32px rgba(255,165,0,0.4), inset 0 1px 0 rgba(255,165,0,0.2)":"0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)",backdropFilter:"blur(8px)",transition:"all 0.3s ease",cursor:"pointer",position:"relative",overflow:"hidden",width:"100%",maxWidth:"320px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-4px)",e.currentTarget.style.boxShadow=r?"0 12px 40px rgba(76,175,80,0.3), inset 0 1px 0 rgba(76,175,80,0.15)":t?"0 12px 40px rgba(255,165,0,0.5), inset 0 1px 0 rgba(255,165,0,0.25)":"0 12px 40px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.15)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow=r?"0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)":t?"0 8px 32px rgba(255,165,0,0.2), inset 0 1px 0 rgba(255,165,0,0.1)":"0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)"},children:[v.jsxs("div",{style:{position:"absolute",top:"16px",left:"16px",background:ht(e.processStatus),color:"white",padding:"6px 12px",borderRadius:"20px",fontSize:"11px",fontWeight:"600",letterSpacing:"0.5px",direction:"rtl",textAlign:"center",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"4px"},children:[7===e.processStatus&&"✅",7===e.processStatus?"מובצע":ve[e.processStatus-1]]}),t&&v.jsx("div",{style:{position:"absolute",top:"16px",right:"16px",background:"linear-gradient(135deg, rgba(255, 193, 7, 0.9), rgba(255, 152, 0, 0.8))",color:"#1f1f1f",padding:"6px 12px",borderRadius:"999px",fontSize:"11px",fontWeight:"700",letterSpacing:"0.5px",display:"flex",alignItems:"center",gap:"6px",boxShadow:"0 6px 18px rgba(255, 193, 7, 0.35)",direction:"rtl"},children:'⚠️ לא עומד בתג"ב'}),v.jsxs("div",{style:{marginTop:"40px",direction:"rtl"},children:[v.jsx("h3",{style:{fontSize:"24px",fontWeight:"700",color:"var(--text)",margin:"0 0 12px 0",lineHeight:"1.3"},children:e.name}),v.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0 0 16px 0",lineHeight:"1.5",minHeight:"42px",whiteSpace:"pre-wrap",direction:"rtl",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e.description}),v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"16px"},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"ספק:"}),v.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.provider})]}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"זירה:"}),v.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.arena.join(", ")})]})]})]}),v.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:r?"linear-gradient(135deg, rgba(76,175,80,0.15), rgba(46,125,50,0.1))":t?"linear-gradient(135deg, rgba(255,165,0,0.15), rgba(255,140,0,0.1))":"linear-gradient(135deg, rgba(124,192,255,0.1), rgba(167,90,255,0.1))",opacity:0,transition:"opacity 0.3s ease",pointerEvents:"none"}})]},e.id)})}),v.jsx("div",{style:{width:"100%",height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent)",margin:"24px 0 8px 0"}})]},e)}):v.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"24px",justifyItems:"center",width:"100%"},children:mt.map(e=>{const t=at(e),r=7===e.processStatus;return v.jsxs("div",{onClick:()=>ft(e),style:{background:r?"linear-gradient(180deg, rgba(76,175,80,0.15), rgba(46,125,50,0.10))":t?"linear-gradient(180deg, rgba(255,165,0,0.25), rgba(255,140,0,0.20))":"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:r?"1px solid rgba(76,175,80,0.3)":t?"2px solid rgba(255,165,0,0.6)":"1px solid rgba(255,255,255,0.12)",borderRadius:"16px",padding:"24px",boxShadow:r?"0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)":t?"0 8px 32px rgba(255,165,0,0.4), inset 0 1px 0 rgba(255,165,0,0.2)":"0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)",backdropFilter:"blur(8px)",transition:"all 0.3s ease",cursor:"pointer",position:"relative",overflow:"hidden",width:"100%",maxWidth:"320px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-4px)",e.currentTarget.style.boxShadow=r?"0 12px 40px rgba(76,175,80,0.3), inset 0 1px 0 rgba(76,175,80,0.15)":t?"0 12px 40px rgba(255,165,0,0.5), inset 0 1px 0 rgba(255,165,0,0.25)":"0 12px 40px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.15)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow=r?"0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)":t?"0 8px 32px rgba(255,165,0,0.4), inset 0 1px 0 rgba(255,165,0,0.2)":"0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)"},children:[v.jsxs("div",{style:{position:"absolute",top:"16px",left:"16px",background:ht(e.processStatus),color:"white",padding:"6px 12px",borderRadius:"20px",fontSize:"11px",fontWeight:"600",letterSpacing:"0.5px",direction:"rtl",textAlign:"center",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"4px"},children:[7===e.processStatus&&"✅",7===e.processStatus?"מובצע":ve[e.processStatus-1]]}),"TOP"===e.priority&&v.jsx("div",{style:{position:"absolute",top:"16px",right:"16px",background:"linear-gradient(135deg, rgba(146, 23, 23, 0.9), rgba(236, 35, 35, 0.7))",color:"#FFFFFF",padding:"6px 12px",borderRadius:"999px",fontSize:"11px",fontWeight:"700",letterSpacing:"0.5px",display:"flex",alignItems:"center",gap:"6px",boxShadow:"0 6px 18px rgba(255, 0, 0, 0.35)"},children:"🔥 TOP"}),t&&v.jsx("div",{style:{position:"absolute",top:"50px",left:"16px",background:"linear-gradient(135deg, rgba(255, 193, 7, 0.9), rgba(255, 152, 0, 0.8))",color:"#1f1f1f",padding:"6px 12px",borderRadius:"999px",fontSize:"11px",fontWeight:"700",letterSpacing:"0.5px",display:"flex",alignItems:"center",gap:"6px",boxShadow:"0 6px 18px rgba(255, 193, 7, 0.35)",direction:"rtl"},children:'⚠️ לא עומד בתג"ב'}),v.jsxs("div",{style:{marginTop:"40px",direction:"rtl"},children:[v.jsx("h3",{style:{fontSize:"24px",fontWeight:"700",color:"var(--text)",margin:"0 0 12px 0",lineHeight:"1.3"},children:e.name}),v.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0 0 16px 0",lineHeight:"1.5",minHeight:"42px",whiteSpace:"pre-wrap",direction:"rtl",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e.description}),v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"16px"},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"ספק:"}),v.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.provider})]}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"זירה:"}),v.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.arena.join(", ")})]}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"תעדוף:"}),v.jsx("span",{style:{fontSize:"12px"},children:ye[e.priority]})]}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"עודכן לאחרונה:"}),v.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:(()=>{const t=new Date(e.lastUpdated);return isNaN(t.getTime())?e.lastUpdated:`${t.getDate().toString().padStart(2,"0")}.${(t.getMonth()+1).toString().padStart(2,"0")}.${t.getFullYear()}`})()})]})]})]}),v.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:7===e.processStatus?"linear-gradient(135deg, rgba(76,175,80,0.15), rgba(46,125,50,0.1))":"linear-gradient(135deg, rgba(124,192,255,0.1), rgba(167,90,255,0.1))",opacity:0,transition:"opacity 0.3s ease",pointerEvents:"none"}})]},e.id)})})}),0===mt.length&&v.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%"},children:[v.jsx("div",{style:{fontSize:"48px",marginBottom:"16px",opacity:.5},children:"📋"}),v.jsx("h3",{style:{fontSize:"20px",color:"var(--muted)",margin:"0 0 8px 0",direction:"rtl"},children:'לא נמצאו סג"חים'}),v.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:0,direction:"rtl"},children:"נסה לשנות את החיפוש או הסינון"})]})]})]})}),F&&v.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)",zIndex:1e3},onClick:()=>{Ke(!1),R(null)},children:v.jsxs("div",{style:{background:"radial-gradient(1200px 800px at 50% 50%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 50% 50%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",border:"none",borderRadius:"0px",padding:"40px",width:"100vw",height:"100vh",overflow:"auto",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.1)",backdropFilter:"blur(12px)",direction:"rtl",position:"fixed",top:0,left:0,boxSizing:"border-box"},onClick:e=>e.stopPropagation(),children:[v.jsx("div",{style:{marginBottom:"32px",borderBottom:"1px solid rgba(255,255,255,0.2)",paddingBottom:"16px"},children:v.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},children:[v.jsx("div",{style:{width:"200px",display:"flex",justifyContent:"flex-start"},children:i()&&v.jsx("button",{onClick:e=>{e.stopPropagation(),((e,t)=>{if(t.stopPropagation(),!i())return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:'אין לך הרשאה למחוק סג"חים',type:"error",durationMs:3e3}}));const r=c.find(t=>t.id===e);r&&window.confirm(`האם אתה בטוח שברצונך למחוק את הסג"ח "${r.name}"?\nפעולה זו לא ניתנת לביטול.`)&&(m(e),console.log(`Deleted sagach "${r.name}" (ID: ${e}). Remaining sagachs: ${c.length-1}`),(null==F?void 0:F.id)===e&&(Ke(!1),R(null)),pt(`הסג"ח "${r.name}" נמחק בהצלחה`,"success"))})(F.id,e)},style:d(l({},S.primary),{background:"rgba(137, 37, 30, 0.9)",color:"white",fontSize:"16px"}),onMouseEnter:e=>{e.currentTarget.style.background="rgba(244, 67, 54, 1)",e.currentTarget.style.transform="scale(1.05)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(244, 67, 54, 0.9)",e.currentTarget.style.transform="scale(1)"},title:'מחק סג"ח',children:"🗑️"})}),v.jsx("h2",{style:{color:"var(--accent)",fontSize:"40px",fontWeight:"700",margin:"0",textAlign:"center",flex:1},children:F.name}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",width:"200px",justifyContent:"flex-end"},children:[v.jsxs("button",{onClick:()=>p(e,null,function*(){const e=(null==a?void 0:a.id)||"current_user";b(F,e)?(De(!0),yield new Promise(e=>setTimeout(e,500)),Ct(),De(!1)):xe(!0)}),disabled:Ee,style:d(l({},S.primary),{background:b(F,(null==a?void 0:a.id)||"current_user")?"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))":"rgba(255,255,255,0.1)",border:"1px solid "+(b(F,(null==a?void 0:a.id)||"current_user")?"rgba(76,175,80,0.8)":"rgba(255,255,255,0.2)"),borderRadius:"25px",color:b(F,(null==a?void 0:a.id)||"current_user")?"white":"var(--text)",fontSize:"16px",cursor:Ee?"not-allowed":"pointer",opacity:Ee?.7:1}),onMouseEnter:e=>{F.notifications||Ee||(e.currentTarget.style.background="rgba(124,192,255,0.2)",e.currentTarget.style.borderColor="rgba(124,192,255,0.5)")},onMouseLeave:e=>{F.notifications||Ee||(e.currentTarget.style.background="rgba(255,255,255,0.1)",e.currentTarget.style.borderColor="rgba(255,255,255,0.2)")},children:[Ee?v.jsx("div",{style:{width:"18px",height:"18px",border:"2px solid transparent",borderTop:"2px solid currentColor",borderRadius:"50%",animation:"spin 1s linear infinite"}}):b(F,(null==a?void 0:a.id)||"current_user")?"🔔":"🔕",Ee?"מעדכן...":b(F,(null==a?void 0:a.id)||"current_user")?"מקבל התראות":"הירשם לעדכונים"]}),v.jsx("button",{onClick:()=>{Ke(!1),R(null)},style:d(l({},S.close),{fontSize:"28px",padding:"12px",borderRadius:"12px",width:"auto",height:"auto"}),onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"←"})]})]})}),v.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(300px, 35%) minmax(400px, 65%)",gap:"24px",height:"calc(100vh - 120px)",minHeight:"600px",alignItems:"stretch",overflow:"hidden",maxWidth:"100%",boxSizing:"border-box"},children:[v.jsxs("div",{style:{background:"rgba(124,192,255,0.08)",border:"2px solid rgba(124,192,255,0.2)",borderRadius:"20px",padding:"24px",display:"flex",flexDirection:"column",height:"100%",overflowY:"auto"},children:[v.jsx("h4",{style:{color:"white",fontSize:"24px",fontWeight:"600",margin:"0 0 12px 0",textAlign:"center",paddingBottom:"8px",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:'פרטי הסג"ח'}),s("admin")&&v.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"12px",marginBottom:"20px"},children:Ge?v.jsxs(v.Fragment,{children:[v.jsx("button",{onClick:()=>p(e,null,function*(){if(F)try{if(Qe.processStatus!==F.processStatus){if(!r())return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"אין לך הרשאה לערוך סטטוסים",type:"error",durationMs:3e3}}));yield jt(Qe.processStatus)}else{const e=Qe.processStartDate.trim()?nt(Qe.processStartDate.trim()):null;if(Qe.processStartDate.trim()&&!e){const e=it(Qe.processStartDate.trim());return void pt(e||"פורמט תאריך התחלה לא תקין. השתמש בפורמט DD/MM/YYYY","warning")}const t=d(l({},F),{description:Qe.description.trim(),provider:Qe.provider.trim(),arena:Qe.arena,priority:Qe.priority,sagachType:Qe.sagachType.trim()||void 0,processStartDate:e||void 0,attachments:Qe.attachments,lastUpdated:me(rt())}),r={description:Qe.description.trim(),provider:Qe.provider.trim(),arena:Qe.arena,priority:Qe.priority,processStartDate:e||void 0,attachments:Qe.attachments,lastUpdated:me(rt())};Qe.sagachType.trim()?r.sagachType=Qe.sagachType.trim():r.sagachType=void 0,x(F.id,r),R(t),Ke(!1),pt('פרטי הסג"ח עודכנו בהצלחה',"success")}}catch(e){console.error("Error updating sagach details:",e),pt('שגיאה בעדכון פרטי הסג"ח',"warning")}}),style:{background:"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",border:"none",borderRadius:"12px",color:"white",padding:"10px 20px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 6px 20px rgba(76,175,80,0.3)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:"✅ שמור"}),v.jsx("button",{onClick:()=>{Ke(!1),Ze({description:"",provider:"",arena:[],priority:"בינוני",sagachType:"",processStatus:1,processStartDate:"",attachments:[]})},style:{background:"linear-gradient(135deg, rgba(244,67,54,0.8), rgba(244,67,54,0.6))",border:"none",borderRadius:"12px",color:"white",padding:"10px 20px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 6px 20px rgba(244,67,54,0.3)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:"❌ בטל"})]}):v.jsx("button",{onClick:()=>{F&&(Ze({description:F.description,provider:F.provider,arena:[...F.arena],priority:F.priority,sagachType:F.sagachType||"",processStatus:F.processStatus,processStartDate:F.processStartDate?ot(F.processStartDate):"",attachments:F.attachments||[]}),Ke(!0))},style:{background:"linear-gradient(135deg, rgba(255,193,7,0.8), rgba(255,193,7,0.6))",border:"none",borderRadius:"12px",color:"white",padding:"10px 20px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 6px 20px rgba(255,193,7,0.3)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:"✏️ ערוך פרטים"})}),v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px",marginBottom:"16px"},children:[v.jsxs("div",{children:[v.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"תיאור"}),Ge?v.jsx("textarea",{value:Qe.description,onChange:e=>Ze(t=>d(l({},t),{description:e.target.value})),style:{width:"100%",minHeight:"80px",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"16px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",resize:"vertical",lineHeight:"1.6",boxSizing:"border-box"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}}):v.jsx("p",{style:{color:"var(--text)",fontSize:"16px",margin:0,lineHeight:"1.6",whiteSpace:"pre-wrap",direction:"rtl"},children:F.description})]}),v.jsxs("div",{children:[v.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"ספק"}),Ge?v.jsx("input",{type:"text",value:Qe.provider,onChange:e=>Ze(t=>d(l({},t),{provider:e.target.value})),style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"18px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",boxSizing:"border-box"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}}):v.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8"},children:F.provider})]}),v.jsxs("div",{children:[v.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"זירה"}),Ge?v.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsxs("button",{type:"button",onClick:()=>se(e=>!e),style:{appearance:"none",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.08)",borderRadius:"12px",color:"#ffffff",padding:"12px 16px",cursor:"pointer",fontSize:"16px",direction:"rtl",outline:"none",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",fontFamily:"Segoe UI, sans-serif"},children:[v.jsx("span",{style:{textAlign:"right",flex:1},children:0===Qe.arena.length?"בחר זירות...":Qe.arena.join(", ")}),v.jsx("span",{style:{marginLeft:"8px",fontSize:"12px"},children:"▼"})]}),ae&&v.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",zIndex:1e3,boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",overflow:"hidden",maxHeight:"200px",overflowY:"auto"},children:ne.map(e=>v.jsxs("div",{onClick:t=>{t.stopPropagation();const r=Qe.arena.includes(e);Ze(t=>d(l({},t),{arena:r?t.arena.filter(t=>t!==e):[...t.arena,e]}))},style:{padding:"10px 16px",cursor:"pointer",transition:"background 0.2s ease",direction:"rtl",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"space-between",background:Qe.arena.includes(e)?"rgba(124,192,255,0.15)":"transparent",color:"var(--text)"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(124,192,255,0.15)"},onMouseLeave:t=>{Qe.arena.includes(e)||(t.currentTarget.style.background="transparent")},children:[v.jsx("span",{children:e}),Qe.arena.includes(e)&&v.jsx("span",{style:{color:"var(--accent)",fontSize:"12px"},children:"✓"})]},`edit-arena-${e}`))})]}):v.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8"},children:F.arena.join(", ")})]}),v.jsxs("div",{children:[v.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"תעדוף"}),Ge?v.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsxs("button",{type:"button",onClick:()=>oe(e=>!e),style:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.06)",borderRadius:"12px",color:"#ffffff",padding:"10px 16px",cursor:"pointer",fontSize:"16px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[v.jsx("span",{children:ye[Qe.priority]}),v.jsx("span",{style:{marginLeft:"8px",fontSize:"12px"},children:"▼"})]}),ie&&v.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",zIndex:1e3,boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",overflow:"hidden"},children:fe.map(e=>v.jsxs("div",{onClick:()=>{oe(!1),Ze(t=>d(l({},t),{priority:e}))},style:{padding:"10px 16px",cursor:"pointer",transition:"background 0.2s ease",direction:"rtl",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"space-between",background:Qe.priority===e?"rgba(124,192,255,0.15)":"transparent",fontWeight:"TOP"===e?700:500},onMouseEnter:e=>{e.currentTarget.style.background="rgba(124,192,255,0.15)"},onMouseLeave:t=>{Qe.priority!==e&&(t.currentTarget.style.background="transparent")},children:[v.jsx("span",{children:"TOP"===e?"TOP":e}),e===Qe.priority&&v.jsx("span",{children:"✓"})]},`edit-priority-${e}`))})]}):v.jsx("p",{style:{fontSize:"18px",margin:0,lineHeight:"1.8"},children:ye[F.priority]})]}),(Ge||F.sagachType)&&v.jsxs("div",{children:[v.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:'סוג הסג"ח'}),Ge?v.jsx("input",{type:"text",value:Qe.sagachType,onChange:e=>Ze(t=>d(l({},t),{sagachType:e.target.value})),placeholder:"הכנס סוג הסג'ח (אופציונלי)...",style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"18px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",boxSizing:"border-box"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}}):v.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8"},children:F.sagachType})]}),v.jsxs("div",{children:[v.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"שלב בתהליך"}),Ge?v.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsxs("button",{type:"button",onClick:()=>G(e=>!e),style:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.06)",borderRadius:"12px",color:"#ffffff",padding:"10px 16px",cursor:"pointer",fontSize:"16px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[v.jsx("span",{children:we[Qe.processStatus-1]}),v.jsx("span",{style:{marginLeft:"8px",fontSize:"12px"},children:"▼"})]}),X&&v.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",zIndex:1e3,boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",overflow:"hidden"},children:we.map((e,t)=>v.jsx("div",{onClick:()=>{Ze(e=>d(l({},e),{processStatus:t+1})),G(!1)},style:{padding:"12px 16px",cursor:"pointer",borderBottom:t<we.length-1?"1px solid rgba(255,255,255,0.08)":"none",transition:"background 0.2s ease",fontSize:"14px",direction:"rtl",color:Qe.processStatus===t+1?"rgba(124,192,255,1)":"#ffffff"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},t+1))})]}):v.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8"},children:we[F.processStatus-1]})]}),v.jsxs("div",{children:[v.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"סטטוס נוכחי"}),v.jsx("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"20px",fontSize:"18px",color:"var(--text)",lineHeight:"1.8",direction:"rtl"},children:(()=>{if(!(null==F?void 0:F.statusUpdates)||0===F.statusUpdates.length)return v.jsx("span",{style:{fontStyle:"italic",color:"var(--muted)"},children:"אין עדכוני סטטוס"});const e=[...F.statusUpdates].sort((e,t)=>{const r=e=>{if(e.includes("/")){const[t,r]=e.split(" "),[n,i,o]=t.split("/");return new Date(`${o}-${i}-${n} ${r}`)}return new Date(e)},n=r(e.timestamp),i=r(t.timestamp);if(isNaN(n.getTime())&&isNaN(i.getTime()))return parseInt(t.id)-parseInt(e.id);if(isNaN(n.getTime()))return 1;if(isNaN(i.getTime()))return-1;const o=i.getTime()-n.getTime();return 0!==o?o:parseInt(t.id)-parseInt(e.id)})[0];return(null==e?void 0:e.message)?v.jsxs("div",{children:[v.jsxs("div",{style:{fontSize:"16px",color:"var(--muted)",marginBottom:"10px",display:"flex",alignItems:"center",gap:"4px"},children:["status_change"===e.type&&"🔄","system"===e.type&&"⚙️","user"===e.type&&"👤",v.jsx("span",{children:kt(e.timestamp)})]}),v.jsx("div",{children:e.message})]}):v.jsx("span",{style:{fontStyle:"italic",color:"var(--muted)"},children:"אין עדכוני סטטוס"})})()},(null==(t=F.statusUpdates)?void 0:t.length)||0)]}),v.jsxs("div",{children:[v.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"תאריך התחלה"}),He?v.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[v.jsx("input",{type:"text",value:Je,onChange:e=>{let t=e.target.value.replace(/[^\d\/]/g,"");2!==t.length||t.includes("/")?5===t.length&&2===t.split("/").length&&(t+="/"):t+="/",t.length>10&&(t=t.substring(0,10)),Xe(t)},placeholder:"DD/MM/YYYY",maxLength:10,style:{background:"var(--bg-secondary)",border:"2px solid rgba(124,192,255,0.5)",borderRadius:"8px",padding:"8px 12px",color:"var(--text)",fontSize:"16px",fontFamily:"Segoe UI, system-ui, sans-serif",width:"150px",direction:"ltr",textAlign:"center"},onKeyDown:e=>{"Enter"===e.key?wt():"Escape"===e.key&&St()},autoFocus:!0}),v.jsx("button",{onClick:wt,style:{background:"rgba(34,197,94,0.8)",border:"none",borderRadius:"6px",padding:"8px 12px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(34,197,94,1)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(34,197,94,0.8)"},children:"✓"}),v.jsx("button",{onClick:St,style:{background:"rgba(239,68,68,0.8)",border:"none",borderRadius:"6px",padding:"8px 12px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(239,68,68,1)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(239,68,68,0.8)"},children:"✕"})]}):Ge&&r()?v.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8",cursor:"pointer",padding:"8px",borderRadius:"8px",border:"2px dashed rgba(124,192,255,0.3)",background:"rgba(124,192,255,0.05)",transition:"all 0.2s ease"},onClick:()=>{if(!F)return;if(!r())return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"אין לך הרשאה לערוך תאריך התחלה",type:"error",durationMs:3e3}}));const e=F.processStartDate?ot(F.processStartDate):"";Xe(e),Ve(!0)},onMouseEnter:e=>{e.currentTarget.style.border="2px dashed rgba(124,192,255,0.6)",e.currentTarget.style.background="rgba(124,192,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.border="2px dashed rgba(124,192,255,0.3)",e.currentTarget.style.background="rgba(124,192,255,0.05)"},children:F.processStartDate?ot(F.processStartDate):"לא צוין - לחץ לעריכה"}):v.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8"},children:F.processStartDate?ot(F.processStartDate):"לא צוין"})]}),v.jsxs("div",{children:[v.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:'תג"ב למעבר לשלב הבא'}),Ue?v.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[v.jsx("input",{type:"text",value:qe,onChange:e=>{let t=e.target.value.replace(/[^\d\/]/g,"");2!==t.length||t.includes("/")?5===t.length&&2===t.split("/").length&&(t+="/"):t+="/",t.length>10&&(t=t.substring(0,10)),Ye(t)},placeholder:"DD/MM/YYYY",maxLength:10,style:{background:"var(--bg-secondary)",border:"2px solid rgba(124,192,255,0.5)",borderRadius:"8px",padding:"8px 12px",color:"var(--text)",fontSize:"16px",fontFamily:"Segoe UI, system-ui, sans-serif",width:"150px",direction:"ltr",textAlign:"center"},onKeyDown:e=>{"Enter"===e.key?bt():"Escape"===e.key&&vt()},autoFocus:!0}),v.jsx("button",{onClick:bt,style:{background:"rgba(34,197,94,0.8)",border:"none",borderRadius:"6px",padding:"8px 12px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(34,197,94,1)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(34,197,94,0.8)"},children:"✓"}),v.jsx("button",{onClick:vt,style:{background:"rgba(239,68,68,0.8)",border:"none",borderRadius:"6px",padding:"8px 12px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(239,68,68,1)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(239,68,68,0.8)"},children:"✕"})]}):Ge&&r()?v.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8",cursor:"pointer",padding:"8px",borderRadius:"8px",border:"2px dashed rgba(124,192,255,0.3)",background:"rgba(124,192,255,0.05)",transition:"all 0.2s ease"},onClick:()=>{if(!F)return;if(!r())return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:'אין לך הרשאה לערוך תג"ב למעבר לשלב הבא',type:"error",durationMs:3e3}}));const e=F.estimatedCompletion?ot(F.estimatedCompletion):"";Ye(e),Pe(!0)},onMouseEnter:e=>{e.currentTarget.style.border="2px dashed rgba(124,192,255,0.6)",e.currentTarget.style.background="rgba(124,192,255,0.1)"},onMouseLeave:e=>{e.currentTarget.style.border="2px dashed rgba(124,192,255,0.3)",e.currentTarget.style.background="rgba(124,192,255,0.05)"},children:F.estimatedCompletion?ot(F.estimatedCompletion):"לא צוין - לחץ לעריכה"}):v.jsx("p",{style:{color:"var(--text)",fontSize:"18px",margin:0,lineHeight:"1.8",direction:"rtl"},children:F.estimatedCompletion?ot(F.estimatedCompletion):"לא צוין"})]}),s("admin")&&v.jsxs("div",{children:[v.jsx("h4",{style:{color:"rgba(124,192,255,0.9)",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},children:"קבצים רלוונטים"}),Ge?v.jsxs("div",{style:{border:"2px dashed rgba(124,192,255,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center",background:"rgba(255,255,255,0.02)",marginBottom:"16px"},children:[v.jsx("input",{type:"file",multiple:!0,onChange:e=>{const t=Array.from(e.target.files||[]);t.forEach(e=>{if(e.size>10485760)return void pt(`הקובץ "${e.name}" גדול מדי (${he(e.size)}). מקסימום: 10MB`,"warning");const t=new FileReader;t.onload=t=>{var r;const n={id:Date.now().toString()+Math.random().toString(36),name:e.name,size:e.size,type:e.type||"application/octet-stream",uploadDate:(new Date).toISOString(),data:null==(r=t.target)?void 0:r.result};Ze(e=>d(l({},e),{attachments:[...e.attachments,n]})),pt(`הקובץ "${e.name}" הועלה בהצלחה`,"success")},t.readAsDataURL(e)}),e.target.value=""},style:{display:"none"},id:"file-upload-input"}),v.jsxs("label",{htmlFor:"file-upload-input",style:{cursor:"pointer",display:"block"},children:[v.jsx("div",{style:{fontSize:"48px",marginBottom:"12px",color:"rgba(124,192,255,0.6)"},children:"📁"}),v.jsx("div",{style:{fontSize:"16px",color:"rgba(124,192,255,0.8)",marginBottom:"8px"},children:"לחץ כאן או גרור קבצים להעלאה"}),v.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",opacity:.7},children:"תומך בכל סוגי הקבצים • מקסימום 10MB לקובץ"})]})]}):null,v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(Ge?Qe.attachments:F.attachments||[]).map((e,t)=>v.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px",padding:"12px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.08)",e.currentTarget.style.borderColor="rgba(124,192,255,0.3)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(255,255,255,0.05)",e.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flex:1},children:[v.jsx("div",{style:{fontSize:"20px"},children:e.type.startsWith("image/")?"🖼️":e.type.startsWith("video/")?"🎥":e.type.startsWith("audio/")?"🎵":"application/pdf"===e.type?"📄":e.type.includes("word")?"📝":e.type.includes("excel")||e.type.includes("spreadsheet")?"📊":e.type.includes("powerpoint")||e.type.includes("presentation")?"📈":"📎"}),v.jsxs("div",{style:{flex:1},children:[v.jsx("div",{style:{fontSize:"14px",color:"var(--text)",fontWeight:"500",marginBottom:"2px"},children:e.name}),v.jsxs("div",{style:{fontSize:"11px",color:"var(--muted)",opacity:.7},children:[he(e.size)," • ",me(new Date(e.uploadDate))]})]})]}),v.jsxs("div",{style:{display:"flex",gap:"8px"},children:[v.jsx("button",{onClick:()=>{const t=document.createElement("a");t.href=e.data||e.url||"",t.download=e.name,t.click()},style:{background:"rgba(76,175,80,0.2)",border:"1px solid rgba(76,175,80,0.3)",borderRadius:"6px",padding:"6px 10px",color:"rgba(76,175,80,1)",fontSize:"16px",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(76,175,80,0.3)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(76,175,80,0.2)"},title:"הורד קובץ",children:"⬇️"}),Ge&&v.jsx("button",{onClick:()=>{Ze(t=>d(l({},t),{attachments:t.attachments.filter(t=>t.id!==e.id)}))},style:{background:"rgba(244,67,54,0.2)",border:"1px solid rgba(244,67,54,0.3)",borderRadius:"6px",padding:"6px 10px",color:"rgba(244,67,54,1)",fontSize:"12px",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(244,67,54,0.3)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(244,67,54,0.2)"},title:"מחק קובץ",children:"🗑️"})]})]},e.id)),0===(Ge?Qe.attachments:F.attachments||[]).length&&v.jsx("div",{style:{textAlign:"center",color:"var(--muted)",fontSize:"14px",padding:"20px",opacity:.6},children:Ge?"לא הועלו קבצים עדיין":"אין קבצים רלוונטים"})]})]})]})]}),v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px",height:"100%",overflow:"hidden",minWidth:0,boxSizing:"border-box"},children:[v.jsxs("div",{style:{background:"rgba(124,192,255,0.08)",border:"2px solid rgba(124,192,255,0.2)",borderRadius:"20px",padding:"20px",height:"300px",flexShrink:0,overflowY:"hidden",maxWidth:"100%",boxSizing:"border-box"},children:[v.jsx("h3",{style:{color:"white",fontSize:"24px",fontWeight:"600",marginBottom:"4px",marginTop:"0px",textAlign:"center",direction:"rtl"},children:'תהליך הכנסת הסג"ח'}),v.jsx("div",{style:{display:"flex",flexDirection:"row",gap:"20px",overflowX:"auto",direction:"rtl",padding:"12px",justifyContent:"center",marginTop:"0px"},children:ve.map((e,t)=>{var r,n;const i=t+1,o=7!==F.processStatus&&F.processStatus===i,a=7===F.processStatus?i<=6:F.processStatus>i,s=7!==F.processStatus&&F.processStatus<i,l=null==(r=F.phaseData)?void 0:r[i];return v.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"130px",maxWidth:"150px",padding:"8px 8px",position:"relative"},children:[v.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:o?(()=>{const e=ht(i),t=e.replace("0.8)","0.6)");return`linear-gradient(135deg, ${e}, ${t})`})():a?"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))":"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"600",fontSize:"18px",flexShrink:0,animation:o?"pulse-glow 2s ease-in-out infinite":"none",marginBottom:"12px"},children:a?"✓":i}),v.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:o?"var(--accent)":"var(--text)",marginBottom:"8px",textAlign:"center",lineHeight:"1.2",direction:"rtl"},children:e}),v.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"2px",fontSize:"12px",color:"var(--muted)",textAlign:"center",direction:"rtl"},children:(o||a)&&l&&v.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"2px"},children:[v.jsxs("div",{children:[v.jsxs("strong",{children:[dt(l,o)," ימים"]}),l.entries&&l.entries.length>1&&v.jsx("span",{style:{fontSize:"10px",color:"var(--accent)",marginRight:"4px"},children:'(סה"כ)'})]}),(l.entries&&l.entries.length>0||l.currentEntry)&&v.jsx("div",{style:{fontSize:"8px",color:"var(--muted)",opacity:.7},children:ct(l,o)}),(null==(n=l.currentEntry)?void 0:n.startDate)&&v.jsxs("div",{style:{fontSize:"9px",color:"var(--muted)",opacity:.8},children:["החל: ",me(new Date(l.currentEntry.startDate))]})]})}),o&&v.jsx("div",{style:{fontSize:"12px",color:"var(--accent)",fontWeight:"600",marginTop:"8px",textAlign:"center",background:"rgba(124,192,255,0.2)",padding:"6px 12px",borderRadius:"12px",direction:"rtl"},children:"נוכחי"}),a&&v.jsx("div",{style:{fontSize:"12px",color:"rgba(76,175,80,0.9)",fontWeight:"600",marginTop:"8px",textAlign:"center",background:"rgba(76,175,80,0.2)",padding:"6px 12px",borderRadius:"12px",direction:"rtl"},children:7===F.processStatus&&6===i?"הושלם ":"הושלם"}),s&&v.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"500",marginTop:"8px",textAlign:"center",background:"rgba(255,255,255,0.1)",padding:"6px 12px",borderRadius:"12px",direction:"rtl"},children:"ממתין"}),t<5&&v.jsx("div",{style:{position:"absolute",left:"-20px",top:"40px",width:"40px",height:"3px",background:(7===F.processStatus?t<5:a)?"rgba(76,175,80,0.6)":o&&t<F.processStatus-1?"rgba(124,192,255,0.6)":"rgba(255,255,255,0.3)",zIndex:1},children:v.jsx("div",{style:{position:"absolute",left:"-6px",top:"50%",transform:"translateY(-50%)",width:0,height:0,borderTop:"4px solid transparent",borderBottom:"4px solid transparent",borderRight:"8px solid "+((7===F.processStatus?t<5:a)?"rgba(76,175,80,0.6)":o&&t<F.processStatus-1?"rgba(124,192,255,0.6)":"rgba(255,255,255,0.3)")}})})]},`${i}-${F.id}-${F.processStatus}-${F.lastUpdated}-${et.getTime()}-${st}-${lt}`)})})]}),v.jsxs("div",{style:{background:"rgba(124,192,255,0.08)",border:"2px solid rgba(124,192,255,0.2)",borderRadius:"20px",padding:"24px",display:"flex",flexDirection:"column",height:"65%",minHeight:0,overflow:"hidden",maxWidth:"100%",boxSizing:"border-box"},children:[v.jsx("h4",{style:{color:"white",fontSize:"28px",fontWeight:"600",margin:"0 0 16px 0",textAlign:"center"},children:"עדכוני סטטוס"}),v.jsx("div",{ref:P,style:{height:"100%",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px",marginBottom:"16px",overflowY:"auto",direction:"rtl",minHeight:0},children:F.statusUpdates&&F.statusUpdates.length>0?F.statusUpdates.sort((e,t)=>{const r=e=>{if(e.includes("/")){const[t,r]=e.split(" "),[n,i,o]=t.split("/");return new Date(`${o}-${i}-${n} ${r}`)}return new Date(e)},n=r(e.timestamp),i=r(t.timestamp),o=n.getTime()-i.getTime();return 0!==o?o:parseInt(e.id)-parseInt(t.id)}).map(e=>{let t;if("system"===e.type)t="rgba(124,192,255, 0.8)";else{const r="status_change"===e.type&&e.newStatus?e.newStatus:e.processStatus;t=r?ht(r):"rgba(158, 158, 158, 0.8)"}const r=t.replace("0.8)","0.1)"),n=t.replace("0.8)","0.3)");return t.replace("0.8)","0.2)"),v.jsxs("div",{style:{padding:"12px",marginBottom:"8px",background:r,border:`1px solid ${n}`,borderRadius:"8px",position:"relative"},children:[v.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"6px"},children:[v.jsxs("div",{style:{fontSize:"11px",color:"var(--muted)",display:"flex",alignItems:"center",gap:"8px"},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:["status_change"===e.type&&"🔄","system"===e.type&&"⚙️","user"===e.type&&"👤",kt(e.timestamp)]}),e.author&&v.jsx("div",{style:{fontSize:"11px",color:"var(--accent)",fontWeight:"600"},children:e.author})]}),v.jsx("div",{style:{fontSize:"10px",color:"white",fontWeight:"600",background:t,padding:"2px 6px",borderRadius:"10px"},children:(()=>{const t="status_change"===e.type&&e.newStatus?e.newStatus:e.processStatus;return t?7===t?"מובצע":ve[t-1]:"לא זמין"})()})]}),v.jsx("div",{style:{fontSize:"14px",color:"var(--text)",lineHeight:"1.4"},children:e.message})]},e.id)}):v.jsx("div",{style:{textAlign:"center",color:"var(--muted)",fontSize:"14px",padding:"20px"},children:"אין עדכונים עדיין"})}),o()&&v.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px"},children:[v.jsx("textarea",{value:$,onChange:e=>_(e.target.value),placeholder:"הכנס עדכון או הערה על התהליך...",style:{width:"100%",minHeight:"60px",background:"transparent",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"8px",padding:"12px",color:"var(--text)",fontSize:"14px",direction:"rtl",fontFamily:"Segoe UI, sans-serif",outline:"none",resize:"vertical",lineHeight:"1.5"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 2px rgba(124,192,255,0.2)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),yt())}}),v.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"12px"},children:[v.jsx("div",{style:{fontSize:"12px",color:"var(--muted)"},children:"Enter לשליחה, Shift+Enter לשורה חדשה"}),v.jsx("button",{onClick:yt,disabled:!$.trim(),style:{background:$.trim()?"linear-gradient(135deg, rgba(124,192,255,0.8), rgba(124,192,255,0.6))":"rgba(255,255,255,0.1)",border:"none",borderRadius:"8px",padding:"8px 16px",color:$.trim()?"white":"var(--muted)",fontSize:"14px",fontWeight:"600",cursor:$.trim()?"pointer":"not-allowed",transition:"all 0.2s ease",direction:"rtl"},onMouseEnter:e=>{$.trim()&&(e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(124,192,255,0.4)")},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="none"},children:"שלח עדכון"})]})]})]})]})]})]})}),ue&&v.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)",zIndex:1100,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>xe(!1),children:v.jsxs("div",{style:{background:"radial-gradient(1200px 800px at 50% 50%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 50% 50%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"20px",padding:"32px",maxWidth:"500px",width:"90%",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",backdropFilter:"blur(12px)",direction:"rtl"},onClick:e=>e.stopPropagation(),children:[v.jsxs("div",{style:{textAlign:"center",marginBottom:"24px"},children:[v.jsx("h3",{style:{color:"var(--accent)",fontSize:"24px",fontWeight:"600",margin:"0 0 8px 0"},children:"הגדרות התראות"}),v.jsx("p",{style:{color:"var(--muted)",fontSize:"14px",margin:0},children:'בחר איך תרצה לקבל עדכונים על סג"ח זה'})]}),v.jsxs("div",{style:{marginBottom:"24px"},children:[v.jsx("h4",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",margin:"0 0 12px 0"},children:"איך תרצה לקבל עדכונים?"}),v.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[v.jsx("button",{onClick:()=>je("email"),style:{background:"email"===Se?"linear-gradient(135deg, rgba(124,192,255,0.8), rgba(124,192,255,0.6))":"rgba(255,255,255,0.08)",border:"1px solid "+("email"===Se?"rgba(124,192,255,0.8)":"rgba(255,255,255,0.2)"),borderRadius:"12px",padding:"12px 20px",color:"email"===Se?"white":"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",flex:"1",minWidth:"120px"},children:"📧 מייל"}),v.jsx("button",{onClick:()=>je("whatsapp"),style:{background:"whatsapp"===Se?"linear-gradient(135deg, rgba(49, 10, 244, 0.8), rgba(49, 19, 245, 0.6))":"rgba(255,255,255,0.08)",border:"1px solid "+("whatsapp"===Se?"rgba(13, 27, 224, 0.8)":"rgba(255,255,255,0.2)"),borderRadius:"12px",padding:"12px 20px",color:"whatsapp"===Se?"white":"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",flex:"1",minWidth:"120px"},children:"💬 HiChat"})]})]}),v.jsxs("div",{style:{marginBottom:"32px"},children:[v.jsx("h4",{style:{color:"var(--text)",fontSize:"16px",fontWeight:"600",margin:"0 0 12px 0"},children:"באיזו תדירות?"}),v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[v.jsx("button",{onClick:()=>Ce("status_change"),style:{background:"status_change"===ke?"linear-gradient(135deg, rgba(124,192,255,0.8), rgba(124,192,255,0.6))":"rgba(255,255,255,0.08)",border:"1px solid "+("status_change"===ke?"rgba(124,192,255,0.8)":"rgba(255,255,255,0.2)"),borderRadius:"12px",padding:"12px 16px",color:"status_change"===ke?"white":"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",textAlign:"right"},children:"🔄 רק כשמשתנה סטטוס"}),v.jsx("button",{onClick:()=>Ce("weekly"),style:{background:"weekly"===ke?"linear-gradient(135deg, rgba(255,152,0,0.8), rgba(255,152,0,0.6))":"rgba(255,255,255,0.08)",border:"1px solid "+("weekly"===ke?"rgba(255,152,0,0.8)":"rgba(255,255,255,0.2)"),borderRadius:"12px",padding:"12px 16px",color:"weekly"===ke?"white":"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",textAlign:"right"},children:"📅 שבועי"}),v.jsx("button",{onClick:()=>Ce("daily"),style:{background:"daily"===ke?"linear-gradient(135deg, rgba(233,30,99,0.8), rgba(233,30,99,0.6))":"rgba(255,255,255,0.08)",border:"1px solid "+("daily"===ke?"rgba(233,30,99,0.8)":"rgba(255,255,255,0.2)"),borderRadius:"12px",padding:"12px 16px",color:"daily"===ke?"white":"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",textAlign:"right"},children:"🌅 יומי"})]})]}),v.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[v.jsxs("button",{onClick:()=>p(e,null,function*(){if(F){De(!0);try{yield new Promise(e=>setTimeout(e,600));const e=(null==a?void 0:a.id)||"current_user",t=(null==a?void 0:a.name)||"משתמש",r=w(F,e,t,Se,ke);x(F.id,r),R(r),xe(!1),pt("התראות הוגדרו בהצלחה דרך "+("email"===Se?"מייל":"וואטסאפ"),"success")}catch(e){console.error("Error setting up notifications:",e),pt("שגיאה בהגדרת התראות","warning")}finally{De(!1)}}}),disabled:Ee,style:d(l({},S.primary),{background:Ee?"linear-gradient(135deg, rgba(76,175,80,0.4), rgba(76,175,80,0.3))":"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",color:"white",cursor:Ee?"not-allowed":"pointer",opacity:Ee?.7:1}),children:[Ee?v.jsx("div",{style:{width:"16px",height:"16px",border:"2px solid transparent",borderTop:"2px solid currentColor",borderRadius:"50%",animation:"spin 1s linear infinite"}}):"✅",Ee?"מגדיר התראות...":"אשר והפעל התראות"]}),v.jsx("button",{onClick:()=>xe(!1),style:d(l({},S.primary),{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"var(--text)"}),children:"ביטול"})]})]})}),ze&&v.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)",zIndex:1200,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>{Me||(Ie(!1),Fe({name:"",description:"",provider:"",arena:[],priority:"בינוני",sagachType:""}))},children:v.jsxs("div",{style:{background:"radial-gradient(1200px 800px at 50% 50%, rgba(124,192,255,0.15), transparent 50%), radial-gradient(1000px 700px at 50% 50%, rgba(167, 90, 255, 0.12), transparent 50%), var(--bg)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"20px",padding:"32px",maxWidth:"600px",width:"90%",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",backdropFilter:"blur(12px)",direction:"rtl"},onClick:e=>e.stopPropagation(),children:[v.jsxs("div",{style:{textAlign:"center",marginBottom:"32px"},children:[v.jsx("h3",{style:{color:"var(--accent)",fontSize:"28px",fontWeight:"700",margin:"0 0 12px 0"},children:'יצירת סג"ח חדש'}),v.jsx("p",{style:{color:"var(--muted)",fontSize:"16px",margin:0},children:'מלא את הפרטים הדרושים ליצירת הסג"ח החדש'})]}),v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px",marginBottom:"32px"},children:[v.jsxs("div",{children:[v.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:'שם הסג"ח *'}),v.jsx("input",{type:"text",value:Ae.name,onChange:e=>Fe(t=>d(l({},t),{name:e.target.value})),placeholder:"הכנס שם לסג'ח החדש...",disabled:Me,style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",opacity:Me?.6:1,cursor:Me?"not-allowed":"text",boxSizing:"border-box"},onFocus:e=>{Me||(e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)")},onBlur:e=>{Me||(e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none")}})]}),v.jsxs("div",{children:[v.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:"תיאור *"}),v.jsx("textarea",{value:Ae.description,onChange:e=>Fe(t=>d(l({},t),{description:e.target.value})),placeholder:"הכנס תיאור מפורט לסג'ח...",disabled:Me,rows:3,style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",resize:"vertical",minHeight:"80px",opacity:Me?.6:1,cursor:Me?"not-allowed":"text",boxSizing:"border-box"},onFocus:e=>{Me||(e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)")},onBlur:e=>{Me||(e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none")}})]}),v.jsxs("div",{children:[v.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:'סוג הסג"ח'}),v.jsx("input",{type:"text",value:Ae.sagachType,onChange:e=>Fe(t=>d(l({},t),{sagachType:e.target.value})),placeholder:"הכנס סוג הסג'ח (אופציונלי)...",disabled:Me,style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",opacity:Me?.6:1,cursor:Me?"not-allowed":"text",boxSizing:"border-box"},onFocus:e=>{Me||(e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)")},onBlur:e=>{Me||(e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none")}})]}),v.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"16px"},children:[v.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),children:[v.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:"ספק *"}),v.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsxs("button",{type:"button",disabled:Me,onClick:()=>ge(e=>!e),style:{appearance:"none",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.08)",borderRadius:"12px",color:Me?"rgba(255,255,255,0.5)":"#ffffff",padding:"12px 16px",cursor:Me?"not-allowed":"pointer",fontSize:"14px",direction:"rtl",outline:"none",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",fontFamily:"Segoe UI, sans-serif",opacity:Me?.6:1,boxSizing:"border-box"},children:[v.jsx("span",{style:{textAlign:"right",flex:1},children:Ae.provider||"בחר ספק..."}),v.jsx("span",{style:{marginLeft:"8px",fontSize:"12px"},children:"▼"})]}),ce&&v.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:be.map(e=>v.jsx("div",{onClick:()=>{Fe(t=>d(l({},t),{provider:e})),ge(!1)},style:{padding:"10px 16px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl",background:Ae.provider===e?"rgba(124,192,255,0.15)":"transparent"},onMouseEnter:t=>{Ae.provider!==e&&(t.target.style.background="rgba(255,255,255,0.08)")},onMouseLeave:t=>{Ae.provider!==e&&(t.target.style.background="transparent")},children:e},e))})]})]}),v.jsxs("div",{children:[v.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:"זירה *"}),v.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsxs("button",{type:"button",disabled:Me,onClick:()=>de(e=>!e),style:{appearance:"none",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.08)",borderRadius:"12px",color:Me?"rgba(255,255,255,0.5)":"#ffffff",padding:"12px 16px",cursor:Me?"not-allowed":"pointer",fontSize:"14px",direction:"rtl",outline:"none",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",fontFamily:"Segoe UI, sans-serif",opacity:Me?.6:1,boxSizing:"border-box"},children:[v.jsx("span",{style:{textAlign:"right",flex:1},children:0===Ae.arena.length?"בחר זירות...":Ae.arena.join(", ")}),v.jsx("span",{style:{marginLeft:"8px",fontSize:"12px"},children:"▼"})]}),le&&v.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",zIndex:1e3,boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",overflow:"hidden",maxHeight:"200px",overflowY:"auto"},children:ne.map(e=>v.jsxs("div",{onClick:t=>{if(t.stopPropagation(),!Me){const t=Ae.arena.includes(e);Fe(r=>d(l({},r),{arena:t?r.arena.filter(t=>t!==e):[...r.arena,e]}))}},style:{padding:"10px 16px",cursor:Me?"not-allowed":"pointer",transition:"background 0.2s ease",direction:"rtl",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"space-between",background:Ae.arena.includes(e)?"rgba(124,192,255,0.15)":"transparent",color:Me?"rgba(255,255,255,0.5)":"var(--text)"},onMouseEnter:e=>{Me||(e.currentTarget.style.background="rgba(124,192,255,0.15)")},onMouseLeave:t=>{Me||Ae.arena.includes(e)||(t.currentTarget.style.background="transparent")},children:[v.jsx("span",{children:e}),Ae.arena.includes(e)&&v.jsx("span",{style:{color:"var(--accent)",fontSize:"12px"},children:"✓"})]},`new-arena-${e}`))})]})]}),v.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsx("label",{style:{display:"block",color:"var(--text)",fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:"תעדוף *"}),v.jsxs("button",{type:"button",onClick:e=>{e.stopPropagation(),Me||oe(e=>!e)},style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, sans-serif",outline:"none",transition:"all 0.2s ease",direction:"rtl",opacity:Me?.6:1,cursor:Me?"not-allowed":"pointer",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"space-between"},disabled:Me,onMouseEnter:e=>{Me||(e.currentTarget.style.borderColor="rgba(124,192,255,0.6)",e.currentTarget.style.boxShadow="0 0 0 3px rgba(124,192,255,0.1)")},onMouseLeave:e=>{Me||(e.currentTarget.style.borderColor="rgba(255,255,255,0.2)",e.currentTarget.style.boxShadow="none")},children:[v.jsx("span",{children:Ae.priority}),v.jsx("span",{style:{fontSize:"12px",marginLeft:"8px"},children:"▼"})]}),ie&&v.jsx("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,left:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",zIndex:1e3,boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",overflow:"hidden"},children:fe.map(e=>v.jsxs("div",{onClick:t=>{t.stopPropagation(),Fe(t=>d(l({},t),{priority:e})),oe(!1)},style:{padding:"10px 16px",cursor:"pointer",transition:"background 0.2s ease",direction:"rtl",color:"var(--text)",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"space-between",background:Ae.priority===e?"rgba(124,192,255,0.15)":"transparent"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(124,192,255,0.15)"},onMouseLeave:t=>{Ae.priority!==e&&(t.currentTarget.style.background="transparent")},children:[v.jsx("span",{children:e}),"TOP"===e&&v.jsx("span",{style:{fontSize:"12px",color:"var(--accent)"},children:"🔥"})]},e))})]})]})]}),v.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[v.jsxs("button",{onClick:()=>p(e,null,function*(){if(n())if(Ae.name.trim()&&Ae.description.trim()&&Ae.provider.trim()&&0!==Ae.arena.length&&Ae.priority){Le(!0);try{yield new Promise(e=>setTimeout(e,800));const e={id:"sagach"+(c.length+1),name:Ae.name.trim(),description:Ae.description.trim(),provider:Ae.provider.trim(),lastUpdated:me(rt()),arena:Ae.arena,priority:Ae.priority,sagachType:Ae.sagachType.trim()||void 0,attachments:[],processStatus:1,processStartDate:rt().toISOString().split("T")[0],estimatedCompletion:"-",contactPerson:"",notes:"",notifications:!1,statusUpdates:[{id:Date.now().toString(),message:`נוצר סג"ח חדש: "${Ae.name.trim()}" • ספק: ${Ae.provider.trim()} • זירות: ${Ae.arena.join(", ")}${Ae.sagachType.trim()?` • סוג: ${Ae.sagachType.trim()}`:""}`,timestamp:rt().toISOString(),type:"system",processStatus:1,author:(null==a?void 0:a.name)||"משתמש"}],phaseData:{1:{currentEntry:{startDate:rt().toISOString().split("T")[0],timeSpentDays:0},totalTimeSpentDays:0},2:{},3:{},4:{},5:{},6:{},7:{}}};console.log("🆕 Creating new sagach:",e.name),u(e),Fe({name:"",description:"",provider:"",arena:[],priority:"בינוני",sagachType:""}),Ie(!1),R(e),pt('סג"ח חדש נוצר בהצלחה',"success")}catch(e){console.error("Error creating sagach:",e),pt('שגיאה ביצירת הסג"ח',"warning")}finally{Le(!1)}}else alert("יש למלא את כל השדות הדרושים");else window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:'אין לך הרשאה ליצור סג"חים חדשים',type:"error",durationMs:3e3}}))}),disabled:Me,style:d(l({},S.primary),{background:Me?"linear-gradient(135deg, rgba(76,175,80,0.4), rgba(76,175,80,0.3))":"linear-gradient(135deg, rgba(76,175,80,0.8), rgba(76,175,80,0.6))",color:"white",fontSize:"16px",padding:"14px 28px",cursor:Me?"not-allowed":"pointer",opacity:Me?.7:1}),children:[Me?v.jsx("div",{style:{width:"18px",height:"18px",border:"2px solid transparent",borderTop:"2px solid currentColor",borderRadius:"50%",animation:"spin 1s linear infinite"}}):"✅",Me?'יוצר סג"ח...':'צור סג"ח']}),v.jsx("button",{onClick:()=>{Me||(Ie(!1),Fe({name:"",description:"",provider:"",arena:[],priority:"בינוני",sagachType:""}))},disabled:Me,style:d(l({},S.primary),{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"var(--text)",fontSize:"16px",padding:"14px 28px",cursor:Me?"not-allowed":"pointer",opacity:Me?.5:1}),children:"ביטול"})]})]})}),Re.isVisible&&v.jsxs("div",{style:{position:"fixed",bottom:"30px",left:"50%",transform:"translateX(-50%)",background:"success"===Re.type?"linear-gradient(135deg, rgba(76,175,80,0.95), rgba(76,175,80,0.85))":"warning"===Re.type?"linear-gradient(135deg, rgba(255,152,0,0.95), rgba(255,152,0,0.85))":"linear-gradient(135deg, rgba(33,150,243,0.95), rgba(33,150,243,0.85))",border:"1px solid "+("success"===Re.type?"rgba(76,175,80,0.8)":"warning"===Re.type?"rgba(255,152,0,0.8)":"rgba(33,150,243,0.8)"),borderRadius:"25px",padding:"12px 24px",color:"white",fontSize:"14px",fontWeight:"600",fontFamily:"Segoe UI, sans-serif",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",backdropFilter:"blur(12px)",zIndex:2e3,display:"flex",alignItems:"center",gap:"8px",direction:"rtl",minWidth:"200px",justifyContent:"center",animation:Re.isVisible?"slideUpFadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1)":"slideDownFadeOut 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:[v.jsx("span",{style:{fontSize:"16px"},children:"success"===Re.type?"✅":"warning"===Re.type?"⚠️":"ℹ️"}),Re.message]}),v.jsx("style",{children:"\n        @keyframes slideUpFadeIn {\n          0% {\n            opacity: 0;\n            transform: translateX(-50%) translateY(20px);\n          }\n          100% {\n            opacity: 1;\n            transform: translateX(-50%) translateY(0);\n          }\n        }\n        \n        @keyframes slideDownFadeOut {\n          0% {\n            opacity: 1;\n            transform: translateX(-50%) translateY(0);\n          }\n          100% {\n            opacity: 0;\n            transform: translateX(-50%) translateY(20px);\n          }\n        }\n      "})]})});function je({schemas:e}){var t,r;const[n,i]=g.useState(""),[o,a]=g.useState(null),[s,l]=g.useState("all"),[d,c]=g.useState(!1),[p,u]=g.useState(0),[x,m]=g.useState("all"),[h,f]=g.useState(!1),y=g.useRef(null),b=g.useRef(null),w=g.useRef(null);g.useEffect(()=>{const e=e=>{const t=e.target;t.closest(".action-dropdown")||t.closest(".schema-dropdown")||(y.current&&!y.current.contains(t)&&c(!1),w.current&&!w.current.contains(t)&&f(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const S=g.useMemo(()=>{const t=[];try{Object.entries(e).forEach(([e,r])=>{t.push(...function(e,t,r){const n=[],i=(r,o,a)=>{try{const s=Array.isArray(null==r?void 0:r.type)?r.type[0]:null==r?void 0:r.type;if("object"===s&&(null==r?void 0:r.properties)&&"object"==typeof r.properties){const e=Array.isArray(null==r?void 0:r.required)?r.required:[],t=new Set(e);for(const[n,a]of Object.entries(r.properties))i(a,[...o,String(n)],t.has(String(n)))}else if("array"===s&&(null==r?void 0:r.items))i(r.items,[...o,"item"],a);else{const i=o[o.length-1]||t,l=o.join(".");if(l){const o=[];a&&o.push("required"),"string"==typeof(null==r?void 0:r.pattern)&&o.push(`pattern: ${r.pattern}`),"string"==typeof(null==r?void 0:r.format)&&o.push(`format: ${r.format}`),"number"==typeof(null==r?void 0:r.minLength)&&o.push(`minLength: ${r.minLength}`),"number"==typeof(null==r?void 0:r.maxLength)&&o.push(`maxLength: ${r.maxLength}`),"number"==typeof(null==r?void 0:r.minimum)&&o.push(`minimum: ${r.minimum}`),"number"==typeof(null==r?void 0:r.maximum)&&o.push(`maximum: ${r.maximum}`),Array.isArray(null==r?void 0:r.enum)&&o.push(`enum: ${r.enum.join(", ")}`),n.push({id:`${e}:${l}`,schemaKey:e,schemaTitle:t,path:l,name:i,type:s||void 0,description:"string"==typeof(null==r?void 0:r.description)?r.description:void 0,rules:o.length?o:void 0})}}}catch(s){console.error("Failed to traverse schema at path:",o.join("."),s)}};return i(r,[t],!1),n}(e,r.title||e,r.schema))})}catch(r){console.error("Failed to flatten schemas:",r)}return t.sort((e,t)=>e.schemaTitle.localeCompare(t.schemaTitle)||e.path.localeCompare(t.path))},[e]),j=g.useMemo(()=>{let e=S;x&&"all"!==x&&(e=e.filter(e=>e.schemaKey===x)),"fields"===s?e=e.filter(e=>e.path.split(".").length>2):"hierarchies"===s&&(e=e.filter(e=>e.path.split(".").length<=2));const t=n.trim().toLowerCase();return t?e.filter(e=>e.path.toLowerCase().includes(t)||e.name.toLowerCase().includes(t)||e.schemaTitle.toLowerCase().includes(t)||!!e.type&&e.type.toLowerCase().includes(t)||!!e.description&&e.description.toLowerCase().includes(t)):e},[S,n,s,x]);return g.useEffect(()=>{const e=e=>{if(0!==j.length)switch(e.key){case"ArrowDown":e.preventDefault(),u(e=>Math.min(e+1,j.length-1));break;case"ArrowUp":e.preventDefault(),u(e=>Math.max(e-1,0));break;case"Home":e.preventDefault(),u(0);break;case"End":e.preventDefault(),u(j.length-1);break;case"Enter":e.preventDefault(),j[p]&&(console.log("Enter pressed - clearing old selection and setting new one"),a(null),setTimeout(()=>{a(j[p]),u(p)},10))}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[j,p]),g.useEffect(()=>{b.current&&b.current.scrollIntoView({behavior:"smooth",block:"nearest"})},[p]),g.useEffect(()=>{console.log("Selected state changed to:",(null==o?void 0:o.id)||"null")},[o]),v.jsxs(v.Fragment,{children:[v.jsx("aside",{className:"value-panel",dir:"rtl",style:{background:"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:"1px solid rgba(255,255,255,0.12)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 20px 60px rgba(0,0,0,0.35)"},children:v.jsxs("div",{className:"value-panel-inner",children:[v.jsxs("div",{className:"value-search",children:[v.jsxs("div",{className:"schema-selector",ref:w,style:{marginBottom:"12px",width:"100%"},children:[v.jsxs("button",{className:"btn ghost "+(x?"":"is-placeholder"),onClick:()=>f(!h),style:{width:"100%"},children:["all"===x?"כל התקנים":x&&e[x]?e[x].title:v.jsx("span",{className:"schema-placeholder",dir:"rtl",children:"בחר תקן"}),v.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),h&&v.jsxs("div",{className:"schema-dropdown",children:[v.jsx("div",{className:"schema-option",onClick:()=>{m("all"),f(!1)},children:"כל התקנים"}),Object.entries(e).map(([e,t])=>v.jsx("div",{className:"schema-option",onClick:()=>{m(e),f(!1)},children:t.title},e))]})]}),v.jsxs("div",{className:"value-search-row",children:[v.jsx("input",{type:"text",placeholder:"חפש לפי שם/תיאור/היררכיה...",value:n,onChange:e=>i(e.target.value),className:"value-search-input"}),v.jsxs("div",{className:"value-filter-dropdown",ref:y,children:[v.jsxs("button",{className:"btn",onClick:()=>c(!d),children:[v.jsx("span",{children:"⏷"}),v.jsx("span",{children:"all"===s?"הכל":"fields"===s?"רק שדות בסיסיים":"רק היררכיות"})]}),d&&v.jsxs("div",{className:"value-filter-options",children:[v.jsx("div",{className:"value-filter-option "+("all"===s?"active":""),onClick:()=>{l("all"),c(!1)},children:"הכל"}),v.jsx("div",{className:"value-filter-option "+("fields"===s?"active":""),onClick:()=>{l("fields"),c(!1)},children:"רק שדות בסיסיים"}),v.jsx("div",{className:"value-filter-option "+("hierarchies"===s?"active":""),onClick:()=>{l("hierarchies"),c(!1)},children:"רק היררכיות"})]})]})]})]}),v.jsx("div",{className:"value-list custom-scrollbar",role:"list",children:j.map((e,t)=>v.jsx("button",{ref:t===p?b:null,className:`value-item ${t===p?"selected":""} ${(null==o?void 0:o.id)===e.id?"clicked":""}`,role:"listitem",title:`${e.schemaTitle} / ${e.path}`,onClick:()=>{a(e),u(-1)},children:v.jsxs("div",{className:"value-row",children:[v.jsx("span",{className:"value-hierarchy",children:(()=>{const t=e.path.split(".");return t.length<=2?"":t.slice(1,t.length-1).join(".")})()}),v.jsx("span",{className:"value-name",children:e.name})]})},e.id))})]})}),v.jsxs("section",{className:"value-detail-panel dictionary-box",dir:"rtl",style:{background:"linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06))",border:"1px solid rgba(255,255,255,0.12)",overflow:"auto",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 20px 60px rgba(0,0,0,0.35)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",textAlign:"center"},children:[v.jsxs("div",{className:"value-detail-headline",style:{fontSize:"80px !important",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",textAlign:"center"},children:[v.jsx("div",{}),v.jsx("div",{className:"value-detail-path "+(o?"selected":""),style:{fontSize:o?"40px !important":"35px !important",fontWeight:o?"700":"400",color:o?"rgb(19, 124, 223)":"var(--muted)",textDecoration:o?"underline":"none",borderBottom:"none",paddingBottom:"0px"},children:o?(()=>{const e=o.path.split(".");return e.length<=2?o.name:`${e.slice(1,e.length-1).join(" -> ")} -> ${o.name}`})():"-"})]}),v.jsx("hr",{style:{width:"75%",marginBottom:"20px",height:"0px"}}),v.jsxs("div",{className:"value-detail-body",style:{fontSize:"40px !important",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",textAlign:"center"},children:[v.jsxs("div",{className:"detail-row",children:[v.jsx("span",{className:"k",style:{fontSize:"60px !important",color:"var(--muted) !important"},children:"מהות השדה:"}),v.jsx("span",{className:"v",style:{fontSize:"2px !important",color:"var(--text) !important"},children:(null==o?void 0:o.description)||"-"})]}),v.jsxs("div",{className:"detail-row",children:[v.jsx("span",{className:"k",style:{color:"var(--muted) !important"},children:"סוג השדה:"}),v.jsx("span",{className:"v",style:{fontSize:"26px !important",color:"var(--text) !important"},children:(null==o?void 0:o.type)||"-"})]}),v.jsxs("div",{className:"detail-row",children:[v.jsx("span",{className:"k",style:{fontSize:"26px !important",color:"var(--muted) !important"},children:"האם שדה חובה:"}),v.jsx("span",{className:"v",style:{fontSize:"26px !important",color:"var(--text) !important"},children:(null==(t=null==o?void 0:o.rules)?void 0:t.some(e=>"required"===e))?"כן":"-"})]}),v.jsxs("div",{className:"detail-row",children:[v.jsx("span",{className:"k",style:{fontSize:"26px !important",color:"var(--muted) !important"},children:'דג"ח/רשימה סגורה:'}),v.jsx("span",{className:"v",style:{fontSize:"26px !important",color:"var(--text) !important"},children:(null==(r=null==o?void 0:o.rules)?void 0:r.find(e=>e.startsWith("enum")))?(()=>{const e=o.rules.find(e=>e.startsWith("enum"));if(e){const t=e.replace("enum: ","").split(", ");return v.jsx("div",{className:"enum-values",style:{fontSize:"26px !important"},children:t.map((e,t)=>v.jsx("div",{className:"enum-value",style:{fontSize:"26px !important"},children:e},t))})}return"-"})():"-"})]}),v.jsxs("div",{className:"detail-row",children:[v.jsx("span",{className:"k",style:{fontSize:"26px !important",color:"var(--muted) !important"},children:"חוקים:"}),v.jsx("span",{className:"v",style:{fontSize:"26px !important",color:"var(--text) !important"},children:(null==o?void 0:o.rules)&&o.rules.length?o.rules.join(" | "):"-"})]}),v.jsxs("div",{className:"detail-row",children:[v.jsx("span",{className:"k",style:{fontSize:"26px !important",color:"var(--muted) !important"},children:"בשימוש במשפחות:"}),v.jsx("span",{className:"v",style:{fontSize:"26px !important",color:"var(--text) !important"},children:o?(()=>{const e=new Set;return S.forEach(t=>{t.name===o.name&&t.path.split(".").slice(1,-1).join(".")===o.path.split(".").slice(1,-1).join(".")&&e.add(t.schemaTitle)}),Array.from(e).sort().join(", ")||"-"})():"-"})]})]})]})]})}Se.displayName="SagachimStatus";const ke=["ממתין לבשלות בצד ספק",'ממתין לקבלת דג"ח והתנעה',"בתהליכי אפיון","ממתין לאינטגרציות","אינטגרציות","מבצוע","מובצע"],Ce=e=>!e||isNaN(e.getTime())?"תאריך לא זמין":`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`,Ee=e=>{if(!e)return"תאריך לא זמין";try{const t=new Date(e);return isNaN(t.getTime())?"תאריך לא זמין":Ce(t)}catch(t){return"תאריך לא זמין"}},De=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]},Te=({isOpen:e,onClose:t,sagach:r})=>{var n;const[i,o]=g.useState("overview"),a=g.useMemo(()=>{if(!(null==r?void 0:r.processStartDate)||!(null==r?void 0:r.completionDate))return 0;const e=new Date(r.processStartDate),t=new Date(r.completionDate);return Math.ceil((t.getTime()-e.getTime())/864e5)},[r]),s=g.useMemo(()=>{if(!r)return[];const e=[];if(r.phaseData&&(Object.entries(r.phaseData).forEach(([t,r])=>{const n=parseInt(t);n>=1&&n<=7&&r.entries&&r.entries.forEach(t=>{t.timeSpentDays>0&&e.push({phase:n,phaseName:ke[n-1],startDate:t.startDate,endDate:t.completionDate||t.startDate,duration:t.timeSpentDays,isBacktrack:!1})})}),e.length>0))return e;if(!r.statusUpdates||0===r.statusUpdates.length){const t=r.processStartDate||r.lastUpdated,n=r.completionDate||r.lastUpdated,i=Math.ceil((new Date(n).getTime()-new Date(t).getTime())/864e5);return i>0&&e.push({phase:r.processStatus,phaseName:ke[r.processStatus-1],startDate:t,endDate:n,duration:i,isBacktrack:!1}),e}const t=[...r.statusUpdates].filter(e=>"status_change"===e.type&&e.oldStatus&&e.newStatus).sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime());let n=1,i=r.processStartDate||r.lastUpdated;for(let r=0;r<t.length;r++){const o=t[r];if(o.oldStatus&&o.newStatus){const t=o.timestamp,r=new Date(i),a=new Date(t),s=Math.ceil((a.getTime()-r.getTime())/864e5);s>0&&e.push({phase:o.oldStatus,phaseName:ke[o.oldStatus-1],startDate:i,endDate:t,duration:s,isBacktrack:o.oldStatus>o.newStatus}),n=o.newStatus,i=t}}const o=r.completionDate||r.lastUpdated,a=new Date(i),s=new Date(o),l=Math.ceil((s.getTime()-a.getTime())/864e5);return l>0&&e.push({phase:n,phaseName:ke[n-1],startDate:i,endDate:o,duration:l,isBacktrack:!1}),e},[r]),l=g.useMemo(()=>{const e={};for(let r=1;r<=7;r++)e[r]={totalDays:0,visits:0,avgDays:0,returns:0};const t={};return s.forEach(r=>{r.phase>=1&&r.phase<=7&&(e[r.phase].totalDays+=r.duration||0,e[r.phase].visits+=1,t[r.phase]=(t[r.phase]||0)+1)}),Object.keys(e).forEach(r=>{const n=parseInt(r),i=t[n]||0;i>0?(e[n].avgDays=e[n].totalDays/e[n].visits,e[n].returns=Math.max(0,i-1)):(e[n].avgDays=0,e[n].returns=0)}),e},[s]),d=g.useMemo(()=>(null==r?void 0:r.statusUpdates)?[...r.statusUpdates].sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()):[],[r]);return e&&r?v.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"20px",fontFamily:"Segoe UI, sans-serif"},children:v.jsxs("div",{style:{background:"var(--panel)",borderRadius:"20px",width:"100%",maxWidth:"1200px",maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",backdropFilter:"blur(20px)"},children:[v.jsxs("div",{style:{padding:"24px 32px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[v.jsxs("div",{children:[v.jsxs("h2",{style:{fontSize:"24px",fontWeight:"700",color:"var(--text)",margin:"0 0 8px 0",textAlign:"right"},children:["אנליטיקות: ",r.name]}),v.jsxs("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0",textAlign:"right"},children:[r.provider," • ",r.arena.join(", ")]})]}),v.jsx("button",{onClick:t,style:{background:"none",border:"none",color:"var(--muted)",cursor:"pointer",fontSize:"24px",padding:"8px",borderRadius:"8px",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.1)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="var(--muted)"},children:"×"})]}),v.jsx("div",{style:{display:"flex",borderBottom:"1px solid rgba(255,255,255,0.1)",direction:"rtl"},children:[{id:"overview",label:"סקירה כללית"},{id:"timeline",label:"ציר זמן"},{id:"chat",label:"עדכוני סטטוס"},{id:"files",label:"קבצים"}].map(e=>v.jsx("button",{onClick:()=>o(e.id),style:{padding:"16px 24px",background:"none",border:"none",color:i===e.id?"var(--text)":"var(--muted)",cursor:"pointer",fontSize:"14px",fontWeight:"600",borderBottom:i===e.id?"2px solid #4CAF50":"2px solid transparent",transition:"all 0.2s ease",direction:"rtl"},children:e.label},e.id))}),v.jsxs("div",{style:{flex:1,overflow:"auto",padding:"24px 32px"},children:["overview"===i&&v.jsxs("div",{style:{direction:"rtl"},children:[v.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"20px",marginBottom:"32px"},children:[v.jsxs("div",{style:{background:"rgba(76,175,80,0.1)",border:"1px solid rgba(76,175,80,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[v.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#4CAF50",marginBottom:"8px"},children:a}),v.jsx("div",{style:{fontSize:"14px",color:"var(--muted)"},children:"ימים כוללים"})]}),v.jsxs("div",{style:{background:"rgba(33,150,243,0.1)",border:"1px solid rgba(33,150,243,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[v.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#2196F3",marginBottom:"8px"},children:s.length}),v.jsx("div",{style:{fontSize:"14px",color:"var(--muted)"},children:"שלבים בתהליך"})]}),v.jsxs("div",{style:{background:"rgba(255,152,0,0.1)",border:"1px solid rgba(255,152,0,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[v.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#FF9800",marginBottom:"8px"},children:Object.values(l).reduce((e,t)=>e+t.returns,0)}),v.jsx("div",{style:{fontSize:"14px",color:"var(--muted)"},children:"חזרות לשלבים"})]}),v.jsxs("div",{style:{background:"rgba(156,39,176,0.1)",border:"1px solid rgba(156,39,176,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[v.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#9C27B0",marginBottom:"8px"},children:(null==(n=r.statusUpdates)?void 0:n.length)||0}),v.jsx("div",{style:{fontSize:"14px",color:"var(--muted)"},children:"עדכוני סטטוס"})]})]}),v.jsxs("div",{children:[v.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"var(--text)",margin:"0 0 16px 0",textAlign:"right"},children:"סטטיסטיקות שלבים"}),v.jsxs("div",{style:{display:"grid",gap:"12px"},children:[Object.entries(l).filter(([e,t])=>t.visits>0).map(([e,t])=>v.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[v.jsxs("div",{style:{textAlign:"right"},children:[v.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text)",marginBottom:"4px"},children:ke[parseInt(e)-1]}),v.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)"},children:[t.returns," חזרה",t.returns>1?"ות":""]})]}),v.jsxs("div",{style:{textAlign:"left"},children:[v.jsxs("div",{style:{fontSize:"18px",fontWeight:"700",color:"#4CAF50"},children:[t.totalDays," ימים"]}),v.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)"},children:["ממוצע: ",t.avgDays.toFixed(1)," ימים"]})]})]},e)),Object.values(l).every(e=>0===e.visits)&&v.jsx("div",{style:{textAlign:"center",padding:"40px",color:"var(--muted)",fontSize:"14px"},children:"אין נתונים זמינים על שלבי התהליך"})]})]})]}),"timeline"===i&&v.jsxs("div",{style:{direction:"rtl"},children:[v.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"var(--text)",margin:"0 0 24px 0",textAlign:"right"},children:"ציר זמן מפורט"}),v.jsx("div",{style:{position:"relative",paddingRight:"20px"},children:(()=>{const e=s.sort((e,t)=>{const r=new Date(e.endDate||e.startDate),n=new Date(t.endDate||t.startDate),i=r.getTime()-n.getTime();return 0===i?e.phase-t.phase:i}),t=new Set;return e.map((r,n)=>{const i=!t.has(r.phase);return i&&t.add(r.phase),v.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px",position:"relative"},children:[!i&&v.jsx("div",{style:{marginLeft:"8px",fontSize:"16px",color:"#FF9800",zIndex:3,position:"relative"},children:"↶"}),v.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",background:i?"#4CAF50":"#FF9800",marginLeft:i?"16px":"8px",flexShrink:0,position:"relative",zIndex:2}}),n<e.length-1&&v.jsx("div",{style:{position:"absolute",right:"5px",top:"12px",width:"2px",height:"16px",background:"rgba(255,255,255,0.2)",zIndex:1}}),v.jsxs("div",{style:{flex:1,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px",marginRight:"8px"},children:[v.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[v.jsxs("div",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text)"},children:[r.phaseName,!i&&v.jsx("span",{style:{fontSize:"12px",color:"#FF9800",marginRight:"8px"},children:"(חזרה)"})]}),v.jsxs("div",{style:{fontSize:"14px",fontWeight:"700",color:"#4CAF50"},children:[r.duration," ימים"]})]}),v.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",display:"flex",gap:"16px"},children:[v.jsxs("span",{children:["התחלה: ",Ce(new Date(r.startDate))]}),r.endDate&&v.jsxs("span",{children:["סיום: ",Ce(new Date(r.endDate))]})]})]})]},n)})})()})]}),"chat"===i&&v.jsxs("div",{style:{direction:"rtl"},children:[v.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"var(--text)",margin:"0 0 24px 0",textAlign:"right"},children:"עדכוני סטטוס"}),v.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"12px"},children:d.map((e,t)=>v.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px"},children:[v.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[v.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"var(--text)"},children:e.author||"מערכת"}),v.jsx("div",{style:{fontSize:"12px",color:"var(--muted)"},children:Ee(e.timestamp)})]}),v.jsx("div",{style:{fontSize:"14px",color:"var(--text)",lineHeight:"1.5",marginBottom:"8px"},children:e.message}),"status_change"===e.type&&e.oldStatus&&e.newStatus&&v.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",background:"rgba(255,255,255,0.05)",padding:"8px 12px",borderRadius:"8px",display:"inline-block"},children:[ke[e.oldStatus-1]," → ",ke[e.newStatus-1]]})]},e.id||t))})]}),"files"===i&&v.jsxs("div",{style:{direction:"rtl"},children:[v.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"var(--text)",margin:"0 0 24px 0",textAlign:"right"},children:"קבצים רלוונטיים"}),r.attachments&&r.attachments.length>0?v.jsx("div",{style:{display:"grid",gap:"12px"},children:r.attachments.map(e=>v.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[v.jsxs("div",{children:[v.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"var(--text)",marginBottom:"4px"},children:e.name}),v.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)"},children:[De(e.size)," • ",Ce(new Date(e.uploadDate))]})]}),v.jsx("button",{style:{padding:"8px 16px",background:"rgba(76,175,80,0.8)",border:"none",borderRadius:"8px",color:"white",fontSize:"12px",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(76,175,80,1)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(76,175,80,0.8)"},children:"הורד"})]},e.id))}):v.jsx("div",{style:{textAlign:"center",padding:"40px",color:"var(--muted)"},children:"אין קבצים רלוונטיים"})]})]})]})}):null},Ne=e=>{switch(e){case 1:return"rgba(128, 128, 128, 0.8)";case 2:return"rgba(33, 150, 243, 0.8)";case 3:return"rgba(255, 152, 0, 0.8)";case 4:return"rgba(233, 30, 99, 0.8)";case 5:return"rgba(156, 39, 176, 0.8)";case 6:return"rgba(46, 125, 50, 0.8)";case 7:return"rgba(27, 94, 32, 0.8)";default:return"rgba(158, 158, 158, 0.8)"}},ze=e=>{if(!e.processStartDate||!e.completionDate)return 0;const t=new Date(e.processStartDate),r=new Date(e.completionDate);return Math.ceil((r.getTime()-t.getTime())/864e5)},Ie=({onBack:e})=>{const{user:t}=V(),{sagachimStatus:r,isLoading:n,error:i}=pe(),[o,a]=g.useState(""),[s,l]=g.useState(""),[d,c]=g.useState(""),[p,u]=g.useState("preset"),[x,m]=g.useState(""),[h,f]=g.useState("days"),[y,b]=g.useState(""),[w,S]=g.useState(!1),[j,k]=g.useState(!1),[C,E]=g.useState(!1),[D,T]=g.useState(!1),[N,z]=g.useState(null);g.useEffect(()=>{const e=e=>{e.target.closest("[data-dropdown-container]")||(S(!1),k(!1),E(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const I={filter:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"transparent",color:"var(--text)",borderRadius:"12px",padding:"8px 14px",cursor:"pointer",transition:"transform 120ms ease",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"right",boxShadow:"none"}},M=g.useMemo(()=>r?r.filter(e=>7===e.processStatus):[],[r]),L=g.useMemo(()=>{let e=M;if(o){const t=o.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t))}if(s&&(e=e.filter(e=>e.provider===s)),d&&(e=e.filter(e=>e.arena.includes(d))),"preset"===p&&y){const t=new Date;let r=new Date;switch(y){case"last7days":r.setDate(t.getDate()-7);break;case"last30days":r.setDate(t.getDate()-30);break;case"last3months":r.setMonth(t.getMonth()-3);break;case"last6months":r.setMonth(t.getMonth()-6);break;case"lastyear":r.setFullYear(t.getFullYear()-1)}e=e.filter(e=>{const t=e.completionDate?new Date(e.completionDate):new Date(e.lastUpdated);return t>=r&&t<=new Date&&!isNaN(t.getTime())})}else if("custom"===p&&x){const t=parseInt(x);if(!isNaN(t)){const r=new Date;let n=new Date;switch(h){case"days":n.setDate(r.getDate()-t);break;case"months":n.setMonth(r.getMonth()-t);break;case"years":n.setFullYear(r.getFullYear()-t)}e=e.filter(e=>{const t=e.completionDate?new Date(e.completionDate):new Date(e.lastUpdated);return t>=n&&t<=new Date&&!isNaN(t.getTime())})}}return e.sort((e,t)=>ze(t)-ze(e)),e},[M,o,s,d,p,y,x,h]),A=g.useMemo(()=>{if(!r)return[];const e=new Set;return r.forEach(t=>{t.provider&&e.add(t.provider)}),Array.from(e).sort()},[r]),F=g.useMemo(()=>{if(!r)return[];const e=new Set;return r.forEach(t=>{t.arena.forEach(t=>e.add(t))}),Array.from(e).sort()},[r]);return n?v.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"18px",color:"var(--text)",fontFamily:"Segoe UI, sans-serif"},children:"טוען ארכיון..."}):i?v.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"18px",color:"var(--error)",fontFamily:"Segoe UI, sans-serif"},children:["שגיאה בטעינת הארכיון: ",i]}):v.jsxs("main",{className:"app-main",style:{display:"flex",flexDirection:"column",direction:"rtl",fontFamily:"Segoe UI, sans-serif",height:"100vh",overflow:"hidden",width:"100%"},children:[v.jsx("style",{children:"\n          .archive-scroll::-webkit-scrollbar {\n            width: 8px;\n          }\n          \n          .archive-scroll::-webkit-scrollbar-track {\n            background: rgba(255, 255, 255, 0.1);\n            border-radius: 4px;\n          }\n          \n          .archive-scroll::-webkit-scrollbar-thumb {\n            background: rgba(76, 175, 80, 0.6);\n            border-radius: 4px;\n            transition: background 0.3s ease;\n          }\n          \n          .archive-scroll::-webkit-scrollbar-thumb:hover {\n            background: rgba(76, 175, 80, 0.8);\n          }\n          \n          /* For Firefox */\n          .archive-scroll {\n            scrollbar-width: thin;\n            scrollbar-color: rgba(76, 175, 80, 0.6) rgba(255, 255, 255, 0.1);\n          }\n        "}),v.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:"32px",padding:"16px 0",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[v.jsx("span",{style:{fontSize:"28px",fontWeight:"700",color:"var(--text)",margin:"0 0 8px 0",textAlign:"center"},children:'ארכיון - סג"חים מובצעים'}),v.jsx("span",{style:{fontSize:"16px",color:"var(--muted)",margin:"0 0 20px 0",textAlign:"center"},children:'עיינו בסטטיסטיקות של תהליכי ההכנסה של סג"חים שמובצעו'}),v.jsxs("span",{style:{fontSize:"16px",color:"var(--muted)",margin:"0 0 12px 0",textAlign:"center"},children:["מוצגים ",L.length," מתוך ",M.length," סגחים"]})]}),v.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px",marginBottom:"32px",alignItems:"center",width:"100%"},children:v.jsxs("div",{style:{display:"flex",gap:"16px",justifyContent:"center",flexWrap:"wrap",alignItems:"center",width:"100%"},children:[v.jsxs("div",{style:{position:"relative",minWidth:"280px",maxWidth:"400px",flex:"1 1 300px"},children:[v.jsx("input",{type:"text",placeholder:"חיפוש לפי שם...",value:o,onChange:e=>a(e.target.value),style:{width:"100%",padding:"12px 16px 12px 40px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="rgba(124,192,255,0.6)",e.target.style.boxShadow="0 0 20px rgba(124,192,255,0.3)"},onBlur:e=>{e.target.style.borderColor="rgba(255,255,255,0.2)",e.target.style.boxShadow="none"}}),v.jsx("div",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--muted)",fontSize:"16px"},children:"🔍"})]}),v.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsxs("button",{onClick:()=>S(!w),style:I.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[v.jsx("span",{children:s||"כל הספקים"}),v.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),w&&v.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[v.jsx("div",{onClick:()=>{l(""),S(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הספקים"}),A.map(e=>v.jsx("div",{onClick:()=>{l(e),S(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),v.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsxs("button",{onClick:()=>k(!j),style:I.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[v.jsx("span",{children:d||"כל הזירות"}),v.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),j&&v.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[v.jsx("div",{onClick:()=>{c(""),k(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הזירות"}),F.map(e=>v.jsx("div",{onClick:()=>{c(e),k(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),v.jsxs("div",{style:{position:"relative",minWidth:"200px",maxWidth:"280px",flex:"0 1 200px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsxs("button",{onClick:()=>E(!C),style:I.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[v.jsx("span",{children:"preset"===p?y?"last7days"===y?"7 ימים אחרונים":"last30days"===y?"30 ימים אחרונים":"last3months"===y?"3 חודשים אחרונים":"last6months"===y?"6 חודשים אחרונים":"lastyear"===y?"שנה אחרונה":"טווח זמנים":"טווח זמנים":x?`${x} ${"days"===h?"ימים":"months"===h?"חודשים":"שנים"}`:"טווח זמנים"}),v.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),C&&v.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"300px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",padding:"8px"},children:[v.jsxs("div",{style:{marginBottom:"8px"},children:[v.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",marginBottom:"4px",textAlign:"right"},children:"טווחים מוגדרים:"}),[{value:"last7days",label:"7 ימים אחרונים"},{value:"last30days",label:"30 ימים אחרונים"},{value:"last3months",label:"3 חודשים אחרונים"},{value:"last6months",label:"6 חודשים אחרונים"},{value:"lastyear",label:"שנה אחרונה"}].map(e=>v.jsx("div",{onClick:()=>{u("preset"),b(e.value),E(!1)},style:{padding:"6px 8px",cursor:"pointer",borderRadius:"6px",transition:"background 0.2s ease",fontSize:"13px",color:"#ffffff",textAlign:"right",direction:"rtl",marginBottom:"2px"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e.label},e.value))]}),v.jsxs("div",{style:{borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:"8px"},children:[v.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",marginBottom:"4px",textAlign:"right"},children:"טווח מותאם אישית:"}),v.jsxs("div",{style:{display:"flex",gap:"4px",alignItems:"center",marginBottom:"8px"},children:[v.jsx("input",{type:"number",placeholder:"מספר",value:x,onChange:e=>m(e.target.value),style:{width:"60px",padding:"4px 6px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"6px",color:"var(--text)",fontSize:"12px",direction:"rtl",outline:"none"}}),v.jsxs("select",{value:h,onChange:e=>f(e.target.value),style:{padding:"4px 6px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"6px",color:"var(--text)",fontSize:"12px",direction:"rtl",outline:"none"},children:[v.jsx("option",{value:"days",children:"ימים"}),v.jsx("option",{value:"months",children:"חודשים"}),v.jsx("option",{value:"years",children:"שנים"})]}),v.jsx("button",{onClick:()=>{u("custom"),E(!1)},style:{padding:"4px 8px",background:"rgba(76,175,80,0.8)",border:"none",borderRadius:"6px",color:"white",fontSize:"12px",cursor:"pointer"},children:"החל"})]})]}),v.jsx("div",{onClick:()=>{b(""),m(""),u("preset"),E(!1)},style:{padding:"6px 8px",cursor:"pointer",borderRadius:"6px",transition:"background 0.2s ease",fontSize:"13px",color:"#ffffff",textAlign:"right",direction:"rtl",borderTop:"1px solid rgba(255,255,255,0.1)",marginTop:"8px",paddingTop:"8px"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"נקה סינון"})]})]})]})}),v.jsxs("div",{className:"archive-scroll",style:{display:"flex",flexDirection:"column",gap:"32px",width:"100%",padding:"0 20px 0 20px",maxHeight:"calc(100vh - 400px)",overflowY:"auto",overflowX:"hidden",direction:"rtl"},children:[v.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:"24px",justifyItems:"center",width:"100%"},children:L.map(e=>{return v.jsxs("div",{onClick:()=>(z(e),void T(!0)),style:{background:"linear-gradient(180deg, rgba(76,175,80,0.15), rgba(46,125,50,0.10))",border:"1px solid rgba(76,175,80,0.3)",borderRadius:"16px",padding:"24px",boxShadow:"0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)",backdropFilter:"blur(8px)",transition:"all 0.3s ease",cursor:"pointer",position:"relative",overflow:"hidden",width:"100%",maxWidth:"320px"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-4px)",e.currentTarget.style.boxShadow="0 12px 40px rgba(76,175,80,0.3), inset 0 1px 0 rgba(76,175,80,0.15)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0px)",e.currentTarget.style.boxShadow="0 8px 32px rgba(76,175,80,0.2), inset 0 1px 0 rgba(76,175,80,0.1)"},children:[v.jsx("div",{style:{position:"absolute",top:"16px",left:"16px",background:Ne(e.processStatus),color:"white",padding:"6px 12px",borderRadius:"20px",fontSize:"11px",fontWeight:"600",letterSpacing:"0.5px",direction:"rtl",textAlign:"center",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"4px"},children:"✅ מובצע"}),(()=>{const t=ze(e);return t>0?v.jsxs("div",{style:{position:"absolute",top:"16px",right:"16px",background:(r=t,r<=14?"#4CAF50":r<=30?"#FF9800":"#F44336"),color:"white",padding:"6px 12px",borderRadius:"20px",fontSize:"11px",fontWeight:"600",letterSpacing:"0.5px",direction:"rtl",textAlign:"center",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[t," ימים"]}):null;var r})(),v.jsxs("div",{style:{marginTop:"40px",direction:"rtl"},children:[v.jsx("h3",{style:{fontSize:"24px",fontWeight:"700",color:"var(--text)",margin:"0 0 12px 0",lineHeight:"1.3"},children:e.name}),v.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0 0 16px 0",lineHeight:"1.5",minHeight:"42px",whiteSpace:"pre-wrap",direction:"rtl",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e.description}),v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"16px"},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"ספק:"}),v.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.provider})]}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"זירה:"}),v.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.arena.join(", ")})]}),e.completionDate&&v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"הושלם:"}),v.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:(t=new Date(e.completionDate),`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`)})]}),e.contactPerson&&v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("span",{style:{fontSize:"12px",color:"var(--muted)",fontWeight:"600"},children:"איש קשר:"}),v.jsx("span",{style:{fontSize:"12px",color:"var(--text)"},children:e.contactPerson})]})]})]}),v.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(135deg, rgba(76,175,80,0.15), rgba(46,125,50,0.1))",opacity:0,transition:"opacity 0.3s ease",pointerEvents:"none"}})]},e.id);var t})}),v.jsx("div",{style:{height:"150px",width:"100%"}}),0===L.length&&v.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",textAlign:"center"},children:[v.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"currentColor",style:{color:"var(--muted)",marginBottom:"16px"},children:v.jsx("path",{d:"M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 9.5l4 4h-2.5V16h-3v-2.5H8l4-4z"})}),v.jsx("h3",{style:{fontSize:"18px",color:"var(--text)",margin:"0 0 8px 0"},children:"לא נמצאו סגחים מובצעים"}),v.jsx("p",{style:{fontSize:"14px",color:"var(--muted)",margin:"0"},children:o||s||d?"נסה לשנות את הפילטרים או החיפוש":"עדיין לא הושלמו סגחים במערכת"})]})]}),v.jsx(Te,{isOpen:D,onClose:()=>{T(!1),z(null)},sagach:N})]})},Me=["ממתין לבשלות בצד ספק",'ממתין לקבלת דג"ח והתנעה',"בתהליכי אפיון","ממתין לאינטגרציות","אינטגרציות","מבצוע","מובצע"],Le=()=>{const{user:e}=V(),{sagachimStatus:t,isLoading:r,error:n}=pe(),[i,o]=g.useState(""),[a,s]=g.useState(""),[l,d]=g.useState(!1),[c,p]=g.useState(!1);g.useEffect(()=>{const e=e=>{e.target.closest("[data-dropdown-container]")||(d(!1),p(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const u=g.useMemo(()=>{if(!t)return[];const e=t.filter(e=>7===e.processStatus),r=new Set;return e.forEach(e=>{e.provider&&r.add(e.provider)}),Array.from(r).sort()},[t]),x=g.useMemo(()=>{if(!t)return[];const e=t.filter(e=>7===e.processStatus),r=new Set;return e.forEach(e=>{e.arena.forEach(e=>r.add(e))}),Array.from(r).sort()},[t]),m={filter:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"transparent",color:"var(--text)",borderRadius:"12px",padding:"8px 14px",cursor:"pointer",transition:"transform 120ms ease",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"right",boxShadow:"none"}},h=(e,t)=>isNaN(e)||isNaN(t)?"#9E9E9E":Math.abs(e-t)<=.5?"#FF9800":e<t?"#4CAF50":"#F44336";if(r)return v.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"18px",color:"var(--text)",fontFamily:"Segoe UI, sans-serif"},children:"טוען אנליטיקות..."});if(n)return v.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",fontSize:"18px",color:"var(--error)",fontFamily:"Segoe UI, sans-serif"},children:["שגיאה בטעינת האנליטיקות: ",n]});const f=(()=>{if(!t)return{averageDaysPerPhase:{},averageImplementationDays:0,totalCompleted:0,overallAverageImplementationDays:0,overallAverageDaysPerPhase:{},overallTotalCompleted:0};console.log("🔍 Analytics Debug - Total sagachimStatus items:",t.length);const e=t.filter(e=>7===e.processStatus);console.log("🔍 Completed items:",e.length),e.forEach((e,t)=>{console.log(`🔍 Item ${t+1}:`,{name:e.name,processStartDate:e.processStartDate,completionDate:e.completionDate,processStatus:e.processStatus})});const r=e.filter(e=>{if(!e.processStartDate||!e.completionDate)return!1;const t=new Date(e.processStartDate),r=new Date(e.completionDate);return!isNaN(t.getTime())&&!isNaN(r.getTime())&&t<r});console.log("🔍 Valid completed items with dates:",r.length);const n=t.filter(e=>7===e.processStatus),o=n.filter(e=>e.phaseData&&Object.keys(e.phaseData).length>0);let s=n;i&&(s=s.filter(e=>e.provider===i)),a&&(s=s.filter(e=>e.arena.includes(a)));const l=s.filter(e=>e.phaseData&&Object.keys(e.phaseData).length>0),d={},c={};o.forEach(e=>{e.phaseData&&Object.entries(e.phaseData).forEach(([t,r])=>{const n=parseInt(t);if(r&&r.entries){const t=r.entries.reduce((t,r)=>{if(r.completionDate){const n=r.startDate?new Date(r.startDate):new Date(e.processStartDate||e.lastUpdated),i=new Date(r.completionDate);return t+Math.ceil((i.getTime()-n.getTime())/864e5)}return t},0);d[n]=(d[n]||0)+t,c[n]=(c[n]||0)+1}})});const p={};Object.keys(d).forEach(e=>{const t=parseInt(e);p[t]=c[t]>0?Math.round(d[t]/c[t]*10)/10:0});const g=n.reduce((e,t)=>{if(t.processStartDate&&t.completionDate){const r=new Date(t.processStartDate),n=new Date(t.completionDate);if(isNaN(r.getTime())||isNaN(n.getTime()))return console.warn("Invalid date found in sagach:",t.name,"start:",t.processStartDate,"end:",t.completionDate),e;const i=Math.ceil((n.getTime()-r.getTime())/864e5);return i<0?(console.warn("Negative days difference for sagach:",t.name,"days:",i),e):e+i}return e},0),u=n.length>0?Math.round(g/n.length*10)/10:0;if(console.log("🔍 Overall calculation debug:",{totalOverallImplementationDays:g,allCompletedSagachimLength:n.length,overallAverageImplementationDays:u}),0===s.length||0===l.length)return{averageDaysPerPhase:{},averageImplementationDays:0,totalCompleted:0,overallAverageImplementationDays:u,overallAverageDaysPerPhase:p,overallTotalCompleted:n.length};const x={},m={};l.forEach(e=>{e.phaseData&&Object.entries(e.phaseData).forEach(([t,r])=>{const n=parseInt(t);if(r&&r.entries){const t=r.entries.reduce((t,r)=>{if(r.completionDate){const n=r.startDate?new Date(r.startDate):new Date(e.processStartDate||e.lastUpdated),i=new Date(r.completionDate);return t+Math.ceil((i.getTime()-n.getTime())/864e5)}return t},0);x[n]=(x[n]||0)+t,m[n]=(m[n]||0)+1}})});const h={};Object.keys(x).forEach(e=>{const t=parseInt(e);h[t]=m[t]>0?Math.round(x[t]/m[t]*10)/10:0});const f=s.reduce((e,t)=>{if(t.processStartDate&&t.completionDate){const r=new Date(t.processStartDate),n=new Date(t.completionDate);if(isNaN(r.getTime())||isNaN(n.getTime()))return console.warn("Invalid date found in filtered sagach:",t.name,"start:",t.processStartDate,"end:",t.completionDate),e;const i=Math.ceil((n.getTime()-r.getTime())/864e5);return i<0?(console.warn("Negative days difference for filtered sagach:",t.name,"days:",i),e):e+i}return e},0),y=s.length>0?Math.round(f/s.length*10)/10:0;return console.log("🔍 Filtered calculation debug:",{totalImplementationDays:f,completedSagachimLength:s.length,averageImplementationDays:y,selectedProvider:i,selectedArena:a}),{averageDaysPerPhase:h,averageImplementationDays:y,totalCompleted:s.length,overallAverageImplementationDays:u,overallAverageDaysPerPhase:p,overallTotalCompleted:n.length}})();return v.jsxs("main",{className:"app-main",style:{display:"flex",flexDirection:"column",direction:"rtl",fontFamily:"Segoe UI, sans-serif",height:"100vh",overflow:"auto",width:"100%",padding:"20px"},children:[v.jsx("style",{children:"\n          .analytics-scroll::-webkit-scrollbar {\n            width: 8px;\n          }\n          \n          .analytics-scroll::-webkit-scrollbar-track {\n            background: rgba(255, 255, 255, 0.1);\n            border-radius: 4px;\n          }\n          \n          .analytics-scroll::-webkit-scrollbar-thumb {\n            background: rgba(76, 175, 80, 0.6);\n            border-radius: 4px;\n            transition: background 0.3s ease;\n          }\n          \n          .analytics-scroll::-webkit-scrollbar-thumb:hover {\n            background: rgba(76, 175, 80, 0.8);\n          }\n          \n          /* For Firefox */\n          .analytics-scroll {\n            scrollbar-width: thin;\n            scrollbar-color: rgba(76, 175, 80, 0.6) rgba(255, 255, 255, 0.1);\n          }\n        "}),v.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:"32px",padding:"16px 0",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[v.jsx("span",{style:{fontSize:"32px",fontWeight:"700",color:"var(--text)",margin:"0 0 8px 0",textAlign:"center"},children:'אנליטיקות - הכנסות סג"חים'}),v.jsx("span",{style:{fontSize:"16px",color:"var(--muted)",margin:"0 0 16px 0",textAlign:"center"},children:' ניתוח מפורט של תהליכי הכנסת סג"חים עד היום'}),v.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",width:"100%",maxWidth:"800px",marginTop:"16px"},children:[v.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(76,175,80,0.15), rgba(46,125,50,0.10))",border:"1px solid rgba(76,175,80,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[v.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#4CAF50",marginBottom:"8px"},children:isNaN(f.overallAverageImplementationDays)?"אין נתונים":f.overallAverageImplementationDays}),v.jsx("div",{style:{fontSize:"20px",color:"var(--muted)",marginBottom:"4px"},children:'ממוצע ימים למבצוע סג"ח'})]}),v.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(33,150,243,0.15), rgba(21,101,192,0.10))",border:"1px solid rgba(33,150,243,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[v.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#2196F3",marginBottom:"8px"},children:f.overallTotalCompleted}),v.jsx("div",{style:{fontSize:"20px",color:"var(--muted)",marginBottom:"4px"},children:'סה"כ סג"חים שמובצעו'})]})]}),v.jsxs("div",{style:{display:"flex",gap:"16px",justifyContent:"center",flexWrap:"wrap",alignItems:"center",width:"100%",marginTop:"24px"},children:[v.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsxs("button",{onClick:()=>d(!l),style:m.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[v.jsx("span",{children:i||"כל הספקים"}),v.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),l&&v.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[v.jsx("div",{onClick:()=>{o(""),d(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הספקים"}),u.map(e=>v.jsx("div",{onClick:()=>{o(e),d(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]}),v.jsxs("div",{style:{position:"relative",minWidth:"160px",maxWidth:"220px",flex:"0 1 180px"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsxs("button",{onClick:()=>p(!c),style:m.filter,onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[v.jsx("span",{children:a||"כל הזירות"}),v.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),c&&v.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[v.jsx("div",{onClick:()=>{s(""),p(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"כל הזירות"}),x.map(e=>v.jsx("div",{onClick:()=>{s(e),p(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:e},e))]})]})]})]}),v.jsxs("div",{className:"analytics-scroll",style:{display:"flex",justifyContent:"center",gap:"24px",width:"100%",maxHeight:"calc(100vh - 300px)",overflowY:"auto",padding:"0 20px"},children:[(i||a)&&v.jsx("div",{style:{minWidth:"280px",maxWidth:"320px",height:"fit-content",textAlign:"right",direction:"rtl",marginLeft:"120px"},children:v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",fontSize:"24px",fontWeight:"700",color:"var(--text)"},children:[v.jsx("span",{style:{fontSize:"26px",fontWeight:"700",color:"var(--text)",marginBottom:"20px",textAlign:"center",borderBottom:"2px solid rgba(255,255,255,0.1)",padding:"8px 0"},children:"פלטורים פעילים"}),i&&v.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[v.jsx("span",{style:{color:"white",fontWeight:"600",fontSize:"26px"},children:"ספק"}),v.jsx("div",{style:{color:"rgb(33, 150, 243)",fontWeight:"600",fontSize:"40px",marginTop:"16px"},children:i})]}),a&&v.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"16px"},children:[v.jsx("span",{style:{color:"white",fontWeight:"600",fontSize:"26px"},children:"זירה"}),v.jsx("div",{style:{color:"rgb(33, 150, 243)",fontWeight:"600",fontSize:"40px",marginTop:"16px"},children:a})]}),v.jsxs("div",{children:[v.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"16px"},children:[v.jsx("span",{style:{color:"white",fontWeight:"600",fontSize:"26px"},children:'סג"חים שמובצעו'}),v.jsx("div",{style:{color:"rgb(76, 175, 80)",fontWeight:"600",fontSize:"40px",marginTop:"16px"},children:f.totalCompleted}),v.jsxs("div",{style:{color:"rgba(255,255,255,0.7)",fontWeight:"400",fontSize:"18px",marginTop:"8px"},children:[t?Math.round(f.totalCompleted/t.filter(e=>7===e.processStatus).length*100):0,'% מכלל הסג"חים']})]}),v.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"16px"},children:[v.jsx("span",{style:{color:"white",fontWeight:"600",fontSize:"26px"},children:"ממוצע ימים למבצוע"}),v.jsx("div",{style:{color:h(f.averageImplementationDays,f.overallAverageImplementationDays),fontWeight:"600",fontSize:"40px",marginTop:"16px"},children:isNaN(f.averageImplementationDays)?"אין נתונים":f.averageImplementationDays}),v.jsxs("div",{style:{color:"rgba(255,255,255,0.7)",fontWeight:"400",fontSize:"18px",marginTop:"8px"},children:["ממוצע כולל: ",isNaN(f.overallAverageImplementationDays)?"אין נתונים":f.overallAverageImplementationDays," ימים"]})]})]})]})}),Object.keys(f.averageDaysPerPhase).length>0&&v.jsxs("div",{style:{minWidth:"400px",maxWidth:"500px",height:"fit-content",textAlign:"right",direction:"rtl"},children:[v.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:"var(--text)",marginBottom:"20px",textAlign:"center",borderBottom:"2px solid rgba(255,255,255,0.1)",padding:"8px 0"},children:"ממוצע ימים בפילוח לשלבים"}),v.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",fontSize:"16px",color:"var(--text)"},children:Object.entries(f.averageDaysPerPhase).sort(([e],[t])=>parseInt(e)-parseInt(t)).map(([e,t])=>{const r=parseInt(e),n=f.overallAverageDaysPerPhase[r]||0,o=h(t,n);return v.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[v.jsxs("div",{style:{textAlign:"right"},children:[v.jsxs("div",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"4px"},children:["שלב ",e,": ",Me[parseInt(e)-1]]}),(i||a)&&v.jsxs("div",{style:{fontSize:"14px",color:"var(--muted)"},children:["ממוצע כולל: ",n," ימים"]})]}),v.jsxs("div",{style:{color:o,fontWeight:"700",fontSize:"20px"},children:[t," ימים"]})]},e)})})]})]}),v.jsx("div",{style:{marginTop:"24px",padding:"16px",background:"rgba(255,255,255,0.05)",borderRadius:"12px",textAlign:"center",margin:"24px 20px 0 20px"},children:v.jsx("div",{style:{fontSize:"14px",color:"var(--muted)"},children:0===f.overallTotalCompleted?'אין סג"חים מובצעים במערכת - האנליטיקות יופיעו לאחר הכנסת סג"חים וסימונם כמובצעים':'האנליטיקות מבוססות על סג"חים שהוכנסו למערכת ומובצעו'})})]})},Ae=({onBack:e})=>{var t;const{isLoading:r}=pe(),[n,i]=g.useState(""),[o,a]=g.useState(""),[s,l]=g.useState(null),[d,c]=g.useState(!1),[p,u]=g.useState(!1),x=g.useMemo(()=>({gps_location:{title:"GPS Location Device",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"GPSLocationDevice",type:"object",required:["deviceId","location","timestamp"],properties:{deviceId:{type:"string",description:"Unique identifier for the GPS device",minLength:1},deviceInfo:{type:"object",description:"Device hardware and software information",required:["model","firmwareVersion"],properties:{model:{type:"string",description:"Device model name",minLength:1},manufacturer:{type:"string",description:"Device manufacturer",minLength:1},firmwareVersion:{type:"string",description:"Current firmware version",pattern:"^\\d+\\.\\d+\\.\\d+$"},serialNumber:{type:"string",description:"Device serial number",pattern:"^[A-Z0-9]{8,16}$"},batteryLevel:{type:"number",description:"Battery level percentage",minimum:0,maximum:100},lastMaintenance:{type:"string",description:"Last maintenance date",format:"date"}}},location:{type:"object",description:"Current GPS location data",required:["latitude","longitude","accuracy"],properties:{latitude:{type:"number",description:"Latitude coordinate in decimal degrees",minimum:-90,maximum:90},longitude:{type:"number",description:"Longitude coordinate in decimal degrees",minimum:-180,maximum:180},accuracy:{type:"number",description:"GPS accuracy in meters",minimum:0,maximum:1e3},altitude:{type:"number",description:"Altitude above sea level in meters",minimum:-1e3,maximum:1e4},heading:{type:"number",description:"Direction of movement in degrees",minimum:0,maximum:360},speed:{type:"number",description:"Speed in meters per second",minimum:0,maximum:100},satellites:{type:"integer",description:"Number of GPS satellites in view",minimum:0,maximum:32}}},timestamp:{type:"string",description:"ISO 8601 timestamp of location reading",format:"date-time"},environmental:{type:"object",description:"Environmental sensor data if available",properties:{temperature:{type:"number",description:"Ambient temperature in Celsius",minimum:-50,maximum:80},humidity:{type:"number",description:"Relative humidity percentage",minimum:0,maximum:100},pressure:{type:"number",description:"Atmospheric pressure in hPa",minimum:800,maximum:1200}}},connectivity:{type:"object",description:"Communication and connectivity status",required:["status"],properties:{status:{type:"string",description:"Connection status",enum:["online","offline","error","maintenance"]},signalStrength:{type:"number",description:"Signal strength in dBm",minimum:-120,maximum:-30},lastSync:{type:"string",description:"Last successful data sync timestamp",format:"date-time"},protocol:{type:"string",description:"Communication protocol used",enum:["4G","5G","WiFi","Satellite"]}}},alerts:{type:"array",description:"Active alerts and notifications",items:{type:"object",required:["type","message","severity"],properties:{type:{type:"string",description:"Alert type",enum:["low_battery","out_of_range","maintenance_due","error"]},message:{type:"string",description:"Alert description",minLength:1},severity:{type:"string",description:"Alert severity level",enum:["low","medium","high","critical"]},timestamp:{type:"string",description:"When the alert was generated",format:"date-time"}}}}}}},cellular_tracking:{title:"Cellular Mobile Tracking",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"CellularMobileTracking",type:"object",required:["mobileNumber","trackingData","timestamp"],properties:{mobileNumber:{type:"string",description:"Mobile phone number being tracked",pattern:"^\\+[1-9]\\d{1,14}$"},subscriberInfo:{type:"object",description:"Mobile subscriber identification and details",required:["imsi","msisdn"],properties:{imsi:{type:"string",description:"International Mobile Subscriber Identity",pattern:"^[0-9]{14,15}$"},msisdn:{type:"string",description:"Mobile Station International Subscriber Directory Number",pattern:"^[0-9]{12,15}$"},iccid:{type:"string",description:"Integrated Circuit Card Identifier",pattern:"^[0-9]{19,20}$"},carrier:{type:"string",description:"Mobile network operator name",minLength:1},planType:{type:"string",description:"Subscription plan type",enum:["prepaid","postpaid","corporate"]}}},trackingData:{type:"object",description:"Real-time location and movement tracking information",required:["cellTower","signalStrength"],properties:{cellTower:{type:"object",description:"Current serving cell tower information",required:["cellId","lac","mcc","mnc"],properties:{cellId:{type:"integer",description:"Cell tower identifier",minimum:1,maximum:65535},lac:{type:"integer",description:"Location Area Code",minimum:1,maximum:65535},mcc:{type:"integer",description:"Mobile Country Code",minimum:100,maximum:999},mnc:{type:"integer",description:"Mobile Network Code",minimum:0,maximum:999},coordinates:{type:"object",description:"Cell tower geographic coordinates",properties:{latitude:{type:"number",description:"Tower latitude",minimum:-90,maximum:90},longitude:{type:"number",description:"Tower longitude",minimum:-180,maximum:180}}}}},signalStrength:{type:"number",description:"Signal strength in dBm",minimum:-120,maximum:-30},networkType:{type:"string",description:"Current network technology",enum:["2G","3G","4G","5G"]},roaming:{type:"boolean",description:"Whether device is roaming"},estimatedLocation:{type:"object",description:"Estimated device location based on cell tower triangulation",properties:{latitude:{type:"number",description:"Estimated latitude",minimum:-90,maximum:90},longitude:{type:"number",description:"Estimated longitude",minimum:-180,maximum:180},accuracy:{type:"number",description:"Location accuracy in meters",minimum:100,maximum:5e4}}}}},timestamp:{type:"string",description:"Tracking data timestamp",format:"date-time"},movement:{type:"object",description:"Movement and velocity information",properties:{speed:{type:"number",description:"Movement speed in km/h",minimum:0,maximum:500},direction:{type:"number",description:"Movement direction in degrees",minimum:0,maximum:360},acceleration:{type:"number",description:"Acceleration in m/s²",minimum:-50,maximum:50},stationary:{type:"boolean",description:"Whether device is currently stationary"}}},callLog:{type:"array",description:"Recent call activity log",items:{type:"object",required:["type","timestamp","duration"],properties:{type:{type:"string",description:"Call type",enum:["incoming","outgoing","missed"]},timestamp:{type:"string",description:"Call timestamp",format:"date-time"},duration:{type:"integer",description:"Call duration in seconds",minimum:0},number:{type:"string",description:"Phone number involved in call",pattern:"^\\+[1-9]\\d{1,14}$"}}}},dataUsage:{type:"object",description:"Mobile data consumption statistics",properties:{currentPeriod:{type:"integer",description:"Data used in current billing period (MB)",minimum:0},totalLimit:{type:"integer",description:"Total data limit for period (MB)",minimum:0},lastReset:{type:"string",description:"Last data reset date",format:"date"}}}}}},license_plate:{title:"License Plate Identification",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"LicensePlateIdentification",type:"object",required:["plateNumber","detectionData","timestamp"],properties:{plateNumber:{type:"string",description:"Identified license plate number",pattern:"^[A-Z0-9\\-\\s]{2,12}$"},vehicleInfo:{type:"object",description:"Vehicle information associated with the license plate",required:["make","model"],properties:{make:{type:"string",description:"Vehicle manufacturer brand",minLength:1},model:{type:"string",description:"Vehicle model name",minLength:1},year:{type:"integer",description:"Vehicle manufacturing year",minimum:1900,maximum:2030},color:{type:"string",description:"Primary vehicle color",minLength:1},bodyType:{type:"string",description:"Vehicle body style",enum:["sedan","suv","truck","motorcycle","bus","van"]},fuelType:{type:"string",description:"Vehicle fuel type",enum:["gasoline","diesel","electric","hybrid","hydrogen"]}}},detectionData:{type:"object",description:"License plate detection and recognition details",required:["confidence","imageQuality"],properties:{confidence:{type:"number",description:"Recognition confidence score (0-100)",minimum:0,maximum:100},imageQuality:{type:"string",description:"Image quality assessment",enum:["excellent","good","fair","poor"]},processingTime:{type:"number",description:"Processing time in milliseconds",minimum:0,maximum:1e4},algorithm:{type:"string",description:"Recognition algorithm used",minLength:1},ocrVersion:{type:"string",description:"OCR software version",pattern:"^\\d+\\.\\d+\\.\\d+$"}}},timestamp:{type:"string",description:"Detection timestamp",format:"date-time"},location:{type:"object",description:"Location where the license plate was detected",properties:{latitude:{type:"number",description:"Detection latitude",minimum:-90,maximum:90},longitude:{type:"number",description:"Detection longitude",minimum:-180,maximum:180},address:{type:"string",description:"Approximate address of detection location"}}},cameraInfo:{type:"object",description:"Camera system that captured the image",required:["cameraId","location"],properties:{cameraId:{type:"string",description:"Unique camera identifier",minLength:1},location:{type:"string",description:"Camera installation location",minLength:1},angle:{type:"number",description:"Camera angle in degrees",minimum:0,maximum:360},height:{type:"number",description:"Camera height in meters",minimum:0,maximum:100}}}}}},user_management:{title:"User Management System",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"UserManagement",type:"object",required:["userId","profile","account"],properties:{userId:{type:"string",description:"Unique identifier for the user",minLength:1},profile:{type:"object",description:"User profile information",required:["firstName","lastName","email","gender","preferredLanguage"],properties:{firstName:{type:"string",description:"User first name",minLength:1},lastName:{type:"string",description:"User last name",minLength:1},email:{type:"string",description:"User email address",format:"email"},phoneNumber:{type:"string",description:"User phone number",pattern:"^\\+[1-9]\\d{1,14}$"},dateOfBirth:{type:"string",description:"User date of birth",format:"date"},gender:{type:"string",description:"User gender identity",enum:["male","female","non-binary","prefer-not-to-say","other"]},preferredLanguage:{type:"string",description:"User preferred language for communication",enum:["hebrew","english","arabic","russian","french","spanish"]},nationality:{type:"string",description:"User nationality",minLength:1},timezone:{type:"string",description:"User preferred timezone",enum:["Asia/Jerusalem","America/New_York","Europe/London","Asia/Tokyo","Australia/Sydney"]}}},account:{type:"object",description:"User account settings and status",required:["username","status","role","registrationDate"],properties:{username:{type:"string",description:"Unique username",pattern:"^[a-zA-Z0-9_]{3,20}$"},status:{type:"string",description:"Current account status",enum:["active","inactive","suspended","pending_verification","blocked"]},role:{type:"string",description:"User role in the system",enum:["admin","moderator","user","premium_user","guest"]},registrationDate:{type:"string",description:"Account creation date",format:"date-time"},lastLogin:{type:"string",description:"Last login timestamp",format:"date-time"},emailVerified:{type:"boolean",description:"Whether email address is verified"},twoFactorEnabled:{type:"boolean",description:"Whether two-factor authentication is enabled"},subscriptionType:{type:"string",description:"User subscription plan",enum:["free","basic","premium","enterprise"]},subscriptionStatus:{type:"string",description:"Current subscription status",enum:["trial","active","expired","cancelled","past_due"]}}},preferences:{type:"object",description:"User preferences and settings",properties:{theme:{type:"string",description:"Preferred UI theme",enum:["light","dark","auto","high_contrast"]},notificationSettings:{type:"object",description:"Notification preferences",properties:{emailNotifications:{type:"boolean",description:"Receive email notifications"},pushNotifications:{type:"boolean",description:"Receive push notifications"},smsNotifications:{type:"boolean",description:"Receive SMS notifications"},marketingEmails:{type:"boolean",description:"Receive marketing emails"},notificationFrequency:{type:"string",description:"How often to receive notifications",enum:["real-time","daily_digest","weekly_summary","never"]}}},privacySettings:{type:"object",description:"Privacy and data sharing preferences",properties:{profileVisibility:{type:"string",description:"Who can see user profile",enum:["public","friends_only","private"]},dataSharing:{type:"string",description:"Data sharing preferences",enum:["share_all","share_necessary","share_none"]},cookieConsent:{type:"string",description:"Cookie usage consent",enum:["all_cookies","essential_only","no_cookies"]}}},languageAndRegion:{type:"object",description:"Language and regional preferences",properties:{displayLanguage:{type:"string",description:"Language for UI display",enum:["he","en","ar","ru","fr","es"]},dateFormat:{type:"string",description:"Preferred date format",enum:["DD/MM/YYYY","MM/DD/YYYY","YYYY-MM-DD"]},timeFormat:{type:"string",description:"Preferred time format",enum:["12h","24h"]},currency:{type:"string",description:"Preferred currency",enum:["ILS","USD","EUR","GBP","JPY"]}}}}},security:{type:"object",description:"Security-related information",properties:{passwordLastChanged:{type:"string",description:"When password was last changed",format:"date-time"},failedLoginAttempts:{type:"integer",description:"Number of failed login attempts",minimum:0},accountLocked:{type:"boolean",description:"Whether account is currently locked"},securityQuestions:{type:"array",description:"Security questions for account recovery",items:{type:"object",required:["question","answer"],properties:{question:{type:"string",description:"Security question",enum:["What was your first pet's name?","What is your mother's maiden name?","What was the name of your elementary school?","What is your favorite childhood memory?","What city were you born in?"]},answer:{type:"string",description:"Answer to security question",minLength:1}}}},loginDevices:{type:"array",description:"Authorized devices for login",items:{type:"object",required:["deviceId","deviceType","lastAccess"],properties:{deviceId:{type:"string",description:"Unique device identifier",minLength:1},deviceType:{type:"string",description:"Type of device",enum:["desktop","laptop","tablet","mobile","smart_tv","gaming_console"]},lastAccess:{type:"string",description:"Last access timestamp",format:"date-time"},trustedDevice:{type:"boolean",description:"Whether this is a trusted device"}}}}}},activity:{type:"object",description:"User activity and engagement data",properties:{totalLogins:{type:"integer",description:"Total number of logins",minimum:0},lastActivityDate:{type:"string",description:"Date of last activity",format:"date"},sessionDuration:{type:"integer",description:"Average session duration in minutes",minimum:0},featuresUsed:{type:"array",description:"List of features used by the user",items:{type:"string",enum:["dashboard","profile_management","data_export","reports","settings","support","notifications","search","file_upload","data_analysis"]}},engagementLevel:{type:"string",description:"User engagement level",enum:["very_low","low","medium","high","very_high"]}}}}}}}),[]);return v.jsxs("div",{style:{width:"100vw",minHeight:"100vh",height:"100vh",overflow:"auto",background:"transparent",color:"var(--text)",fontFamily:"Segoe UI, sans-serif",padding:"40px 60px 80px 60px",direction:"rtl",scrollbarWidth:"thin",scrollbarColor:"var(--accent) var(--panel)",boxSizing:"border-box",display:"flex",flexDirection:"column",gap:"32px"},children:[v.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[v.jsxs("div",{children:[v.jsx("h1",{style:{fontSize:"32px",fontWeight:"700",color:"var(--accent)",margin:"0 0 8px 0"},children:"בודק תקינות JSON"}),v.jsx("p",{style:{fontSize:"16px",color:"var(--muted)",margin:0},children:"בדוק אם קובץ ה-JSON שלך תקין לפי התקנים הקיימים"})]}),e&&v.jsx("button",{onClick:e,style:{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",padding:"12px 20px",cursor:"pointer",fontSize:"14px",fontFamily:"Segoe UI, sans-serif"},children:"← חזור"})]}),v.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto auto 1fr",gap:"24px",alignItems:"end",width:"100%",margin:"0"},children:[v.jsxs("div",{style:{position:"relative"},children:[v.jsx("label",{style:{display:"block",fontSize:"16px",fontWeight:"600",marginBottom:"8px",color:"var(--text)"}}),v.jsxs("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),"data-dropdown-container":!0,children:[v.jsxs("button",{onClick:()=>u(!p),style:{appearance:"none",border:"1px solid rgba(255,255,255,0.14)",background:"transparent",color:"var(--text)",borderRadius:"12px",padding:"8px 14px",cursor:"pointer",transition:"transform 120ms ease",fontSize:"14px",direction:"rtl",outline:"none",fontFamily:"Segoe UI, sans-serif",width:"100%",minWidth:"500px",display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"right",boxShadow:"none"},onMouseEnter:e=>{e.target.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.target.style.transform="translateY(0px)"},children:[v.jsx("span",{children:o?null==(t=x[o])?void 0:t.title:"בחר תקן..."}),v.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),p&&v.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--panel)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",marginTop:"4px",zIndex:1e3,maxHeight:"200px",overflowY:"auto",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[v.jsx("div",{onClick:()=>{a(""),u(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl",justifyContent:"right",display:"absolute"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.08)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:"בחר תקן..."}),Object.entries(x).map(([e,t])=>v.jsx("div",{onClick:()=>{a(e),u(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",direction:"rtl",background:o===e?"rgba(124,192,255,0.15)":"transparent"},onMouseEnter:t=>{o!==e&&(t.target.style.background="rgba(255,255,255,0.08)")},onMouseLeave:t=>{o!==e&&(t.target.style.background="transparent")},children:t.title},e))]})]})]}),v.jsx("button",{onClick:()=>{var e;if(o&&n.trim()){c(!0);try{const t=JSON.parse(n),r=null==(e=x[o])?void 0:e.schema;if(!r)return void l({isValid:!1,errors:[{path:"schema",message:"סכמה לא נמצאה"}],warnings:[]});const i=((e,t)=>{const r=[],n=(e,t,i="",o)=>{if(o&&t.type){if("object"===t.type&&"object"!=typeof e)return void r.push({path:i,message:`שדה "${i}" צריך להיות אובייקט אבל קיבלנו ${typeof e}`,value:e,suggestion:`שדה "${i}" צריך להיות אובייקט עם מאפיינים, לא ${typeof e}`});if("array"===t.type&&!Array.isArray(e))return void r.push({path:i,message:`שדה "${i}" צריך להיות מערך אבל קיבלנו ${typeof e}`,value:e,suggestion:`שדה "${i}" צריך להיות מערך של פריטים, לא ${typeof e}`})}if(t.required&&Array.isArray(t.required))for(const n of t.required)if(!(n in e)){const t=i?`${i}.${n}`:n,a=o?` תחת "${o}"`:"";r.push({path:t,message:`שדה חובה חסר: ${n}${a}`,value:e[n],suggestion:`הוסף את השדה "${n}" עם ערך מתאים${a}`})}if(t.properties&&"object"==typeof t.properties){for(const[o,a]of Object.entries(t.properties)){const s=i?`${i}.${o}`:o,l=e[o];if(void 0!==l){if(a&&"object"==typeof a&&"type"in a){const e=a.type,t=Array.isArray(l)?"array":typeof l;if(e!==t){const n={string:"מחרוזת",number:"מספר",integer:"מספר שלם",boolean:"בוליאני",object:"אובייקט",array:"מערך"};r.push({path:s,message:`סוג שגוי בשדה "${o}": מצופה ${n[e]||e}, התקבל ${n[t]||t}`,value:l,suggestion:`שנה את "${s}" ל${n[e]||e}`})}}a&&"object"==typeof a&&"minLength"in a&&"string"==typeof l&&l.length<a.minLength&&r.push({path:s,message:`אורך מחרוזת קצר מדי בשדה "${o}": מינימום ${a.minLength} תווים, התקבל ${l.length}`,value:l,suggestion:`הוסף עוד ${a.minLength-l.length} תווים לשדה "${o}"`}),a&&"object"==typeof a&&"pattern"in a&&"string"==typeof l&&(new RegExp(a.pattern).test(l)||r.push({path:s,message:`פורמט לא תקין בשדה "${o}": לא תואם לתבנית ${a.pattern}`,value:l,suggestion:`שנה את "${o}" כך שיתאים לתבנית ${a.pattern}`})),a&&"object"==typeof a&&"minimum"in a&&"number"==typeof l&&l<a.minimum&&r.push({path:s,message:`ערך נמוך מדי בשדה "${o}": מינימום ${a.minimum}, התקבל ${l}`,value:l,suggestion:`הגדל את "${o}" ל${a.minimum} או יותר`}),a&&"object"==typeof a&&"maximum"in a&&"number"==typeof l&&l>a.maximum&&r.push({path:s,message:`ערך גבוה מדי בשדה "${o}": מקסימום ${a.maximum}, התקבל ${l}`,value:l,suggestion:`הקטן את "${o}" ל${a.maximum} או פחות`}),a&&"object"==typeof a&&"enum"in a&&Array.isArray(a.enum)&&(a.enum.includes(l)||r.push({path:s,message:`ערך לא חוקי בשדה "${o}": "${l}" לא נמצא ברשימת הערכים המותרים`,value:l,suggestion:`בחר ערך מתוך: ${a.enum.join(", ")} עבור "${o}"`})),a&&"object"==typeof a&&"properties"in a&&"object"==typeof l&&null!==l&&n(l,a,s,o),a&&"object"==typeof a&&"items"in a&&Array.isArray(l)&&l.forEach((e,t)=>{"object"==typeof e&&null!==e&&n(e,a.items,`${s}[${t}]`,`${o}[${t}]`)})}else if(t.properties&&!(o in t.properties)){const e=Object.keys(t.properties).join(", ");r.push({path:s,message:`שדה לא צפוי "${o}" מחוץ למבנה התקין`,value:l,suggestion:`הסר את "${o}" או הזז אותו למקום הנכון. שדות זמינים: ${e}`})}}for(const n of Object.keys(e))if(!(n in t.properties)){const o=i?`${i}.${n}`:n,a=Object.keys(t.properties).join(", ");r.push({path:o,message:`שדה לא צפוי "${n}" - אינו מוגדר בתקן`,value:e[n],suggestion:`הסר את "${n}" או הוסף אותו לתקן. שדות זמינים: ${a}`})}}};try{n(e,t)}catch(Oe){r.push({path:"root",message:`שגיאה קריטית במהלך בדיקת התקינות: ${Oe instanceof Error?Oe.message:"שגיאה לא ידועה"}`,value:e,suggestion:"בדוק שה-JSON תקין מבחינה תחבירית"})}return{isValid:0===r.length,errors:r,warnings:[]}})(t,r);l(i)}catch(Oe){l({isValid:!1,errors:[{path:"json",message:`JSON לא תקין: ${Oe instanceof Error?Oe.message:"שגיאה לא ידועה"}`}],warnings:[]})}finally{c(!1)}}else l(null)},disabled:!o||!n.trim()||d,style:{padding:"12px 24px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",fontFamily:"Segoe UI, sans-serif",width:"120px",alignItems:"left",textAlign:"left",display:"flex",justifyContent:"left",justifySelf:"left"},children:d?"בודק...":"בדוק תקינות"}),v.jsx("button",{onClick:()=>{i(""),a(""),l(null)},style:{padding:"12px 24px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontWeight:"600",cursor:"pointer",fontFamily:"Segoe UI, sans-serif",width:"120px",alignItems:"left",textAlign:"left",display:"flex",justifyContent:"left",justifySelf:"left"},children:"נקה הכל"})]}),v.jsxs("div",{style:{width:"100%",margin:"0"},children:[v.jsx("label",{style:{display:"block",fontSize:"16px",fontWeight:"600",marginBottom:"8px",color:"var(--text)"},children:"הדבק JSON כאן"}),v.jsx("textarea",{value:n,onChange:e=>i(e.target.value),placeholder:"הדבק כאן את קובץ ה-JSON שברצונך לבדוק...",style:{width:"100%",minHeight:"400px",padding:"16px",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",color:"var(--text)",fontSize:"14px",fontFamily:'Monaco, Menlo, "DejaVu Sans Mono", monospace',outline:"none",resize:"vertical",lineHeight:"1.5",height:"700px"}})]}),s&&v.jsxs("div",{style:{background:"rgba(255,255,255,0.08)",border:"1px solid "+(s.isValid?"rgba(76,175,80,0.4)":"rgba(244,67,54,0.4)"),borderRadius:"12px",width:"100%",margin:"32px 0 0 0",padding:"32px"},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px",paddingBottom:"12px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[v.jsx("span",{style:{fontSize:"24px",color:(m=s.isValid,m?"#4caf50":"#f44336")},children:(e=>e?"✅":"❌")(s.isValid)}),v.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",color:"var(--text)",margin:0},children:"תוצאת בדיקת תקינות"})]}),s.errors.length>0&&v.jsxs("div",{style:{marginBottom:"20px"},children:[v.jsxs("h4",{style:{fontSize:"16px",fontWeight:"600",color:"#f44336",margin:"0 0 12px 0"},children:["שגיאות (",s.errors.length,")"]}),v.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",maxHeight:"300px",overflowY:"auto"},children:s.errors.map((e,t)=>v.jsxs("div",{style:{background:"rgba(244,67,54,0.1)",border:"1px solid rgba(244,67,54,0.3)",borderRadius:"8px",padding:"12px",fontSize:"14px"},children:[v.jsx("div",{style:{fontWeight:"600",color:"#f44336",marginBottom:"4px"},children:e.path}),v.jsx("div",{style:{color:"var(--text)",marginBottom:"4px"},children:e.message}),e.suggestion&&v.jsxs("div",{style:{fontSize:"13px",color:"#4caf50",background:"rgba(76, 175, 80, 0.1)",border:"1px solid rgba(76, 175, 80, 0.3)",borderRadius:"4px",padding:"6px 8px",marginBottom:"6px",fontFamily:"Segoe UI, sans-serif"},children:["💡 ",e.suggestion]}),void 0!==e.value&&v.jsxs("div",{style:{fontFamily:"Monaco, monospace",fontSize:"12px",color:"var(--muted)",background:"rgba(0,0,0,0.3)",padding:"4px 8px",borderRadius:"4px",marginTop:"4px",wordBreak:"break-all"},children:["ערך: ",JSON.stringify(e.value)]})]},t))})]}),s.isValid&&v.jsxs("div",{style:{background:"rgba(76,175,80,0.1)",border:"1px solid rgba(76,175,80,0.3)",borderRadius:"8px",padding:"16px",textAlign:"center"},children:[v.jsx("div",{style:{fontSize:"18px",fontWeight:"600",color:"#4caf50",marginBottom:"8px"},children:"✅ JSON תקין!"}),v.jsx("div",{style:{color:"var(--text)",fontSize:"14px"},children:"כל השדות הנדרשים קיימים והערכים תקינים לפי התקן שנבחר."})]})]}),v.jsxs("div",{style:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",width:"100%",margin:"32px 0 0 0",padding:"32px"},children:[v.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:"var(--accent)",margin:"0 0 12px 0"},children:"הוראות שימוש"}),v.jsxs("div",{style:{fontSize:"14px",color:"var(--text)",lineHeight:"1.6"},children:[v.jsx("p",{style:{margin:"0 0 8px 0"},children:"1. בחר תקן (סכמה) מהרשימה למעלה"}),v.jsx("p",{style:{margin:"0 0 8px 0"},children:"2. הדבק את קובץ ה-JSON שלך בתיבת הטקסט"}),v.jsx("p",{style:{margin:"0 0 8px 0"},children:'3. לחץ על "בדוק תקינות" כדי לבדוק את הקובץ'}),v.jsx("p",{style:{margin:"0 0 8px 0"},children:"4. אם יש שגיאות, הן יוצגו עם פירוט מדויק של הבעיה ומיקומה"}),v.jsx("p",{style:{margin:"0"},children:"5. אם הכל תקין, תקבל אישור שה-JSON עובר את הבדיקה בהצלחה"})]})]}),v.jsx("style",{children:"\n          /* Webkit scrollbar styling */\n          ::-webkit-scrollbar {\n            width: 8px;\n          }\n\n          ::-webkit-scrollbar-track {\n            background: #2d3748;\n            border-radius: 4px;\n          }\n\n          ::-webkit-scrollbar-thumb {\n            background: #7cc0ff;\n            border-radius: 4px;\n          }\n\n          ::-webkit-scrollbar-thumb:hover {\n            background: #5da3e6;\n          }\n        "})]});var m},Fe=({isOpen:t,onClose:r})=>{const{login:n,loginWithAdfs:i,isLoading:o,authMode:a,canSwitchAuthMode:s}=V(),[c,u]=g.useState({name:"",email:"",password:"",role:"viewer"}),x=()=>{var e;e="local"===a?"adfs":"local",localStorage.setItem("auth_mode",e),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"adfs"===e?"עבר למצב אימות ADFS - נא לרענן את הדף":"עבר למצב אימות מקומי - נא לרענן את הדף",type:"ok",durationMs:4e3}}))},m=e=>{const{name:t,value:r}=e.target;u(e=>d(l({},e),{[t]:r}))};return t?v.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,fontFamily:"Segoe UI, Arial, sans-serif"},children:v.jsxs("div",{style:{backgroundColor:"var(--panel)",borderRadius:"12px",padding:"32px",maxWidth:"400px",width:"90%",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",border:"1px solid var(--border)"},children:[v.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[v.jsxs("div",{style:{direction:"rtl"},children:[v.jsx("h2",{style:{margin:0,color:"var(--text)",fontSize:"24px",fontWeight:"600"},children:"התחברות למערכת"}),v.jsxs("div",{style:{fontSize:"14px",color:"var(--muted)",marginTop:"4px"},children:["מצב אימות: ",$(a)]})]}),v.jsx("button",{onClick:r,style:{background:"none",border:"none",color:"var(--muted)",fontSize:"24px",cursor:"pointer",padding:"4px",borderRadius:"4px",transition:"color 0.2s"},onMouseOver:e=>e.currentTarget.style.color="var(--text)",onMouseOut:e=>e.currentTarget.style.color="var(--muted)",children:"×"})]}),s&&v.jsx("div",{style:{marginBottom:"20px",textAlign:"center",direction:"rtl"},children:v.jsxs("button",{type:"button",onClick:x,style:{padding:"8px 16px",borderRadius:"8px",border:"1px solid var(--accent)",backgroundColor:"transparent",color:"var(--accent)",fontSize:"12px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",transition:"all 0.2s"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="var(--accent)",e.currentTarget.style.color="white"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="var(--accent)"},children:["עבור ל","local"===a?"אימות ADFS":"אימות מקומי"]})}),"adfs"===a&&v.jsxs("div",{style:{direction:"rtl",textAlign:"center",marginBottom:"20px"},children:[v.jsx("button",{type:"button",onClick:()=>p(e,null,function*(){try{yield i(),r()}catch(Oe){console.error("ADFS login failed:",Oe)}}),disabled:o,style:{width:"100%",padding:"16px",borderRadius:"8px",border:"none",backgroundColor:o?"var(--muted)":"#0078d4",color:"white",fontSize:"16px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:o?"not-allowed":"pointer",transition:"background-color 0.2s",fontWeight:"600"},children:o?"מתחבר...":"התחבר עם ADFS"}),v.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",marginTop:"8px"},children:"תועבר לדף ההתחברות של ADFS"}),v.jsxs("div",{style:{marginTop:"16px",padding:"12px",backgroundColor:"rgba(124, 192, 255, 0.1)",borderRadius:"8px",border:"1px solid rgba(124, 192, 255, 0.2)"},children:[v.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",marginBottom:"8px"},children:"או התחבר עם חשבון מקומי:"}),v.jsx("button",{type:"button",onClick:x,style:{padding:"8px 16px",borderRadius:"6px",border:"1px solid var(--accent)",backgroundColor:"transparent",color:"var(--accent)",fontSize:"12px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",transition:"all 0.2s"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="var(--accent)",e.currentTarget.style.color="white"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="var(--accent)"},children:"עבור לאימות מקומי"})]})]}),"local"===a&&v.jsxs("form",{onSubmit:t=>p(e,null,function*(){if(t.preventDefault(),c.name.trim())try{if("admin"===c.name.trim()&&"admin"===c.password)return yield n({name:"מנהל מערכת",email:"admin@system.com",role:"admin"}),r(),void u({name:"",email:"",password:"",role:"viewer"});yield n(c),r(),u({name:"",email:"",password:"",role:"viewer"})}catch(Oe){console.error("Login failed:",Oe)}else window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"אנא הזן שם משתמש",type:"error",durationMs:3e3}}))}),style:{direction:"rtl"},children:[v.jsxs("div",{style:{marginBottom:"20px"},children:[v.jsx("label",{style:{display:"block",marginBottom:"8px",color:"var(--text)",fontWeight:"500",fontSize:"14px"},children:"שם משתמש *"}),v.jsx("input",{type:"text",name:"name",value:c.name,onChange:m,placeholder:"הזן שם משתמש",required:!0,style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid var(--border)",backgroundColor:"var(--bg)",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:e=>e.currentTarget.style.borderColor="var(--accent)",onBlur:e=>e.currentTarget.style.borderColor="var(--border)"})]}),v.jsxs("div",{style:{marginBottom:"20px"},children:[v.jsx("label",{style:{display:"block",marginBottom:"8px",color:"var(--text)",fontWeight:"500",fontSize:"14px"},children:"סיסמה (אופציונלי)"}),v.jsx("input",{type:"password",name:"password",value:c.password,onChange:m,placeholder:"הזן סיסמה",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid var(--border)",backgroundColor:"var(--bg)",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:e=>e.currentTarget.style.borderColor="var(--accent)",onBlur:e=>e.currentTarget.style.borderColor="var(--border)"})]}),v.jsxs("div",{style:{marginBottom:"20px"},children:[v.jsx("label",{style:{display:"block",marginBottom:"8px",color:"var(--text)",fontWeight:"500",fontSize:"14px"},children:"כתובת אימייל (אופציונלי)"}),v.jsx("input",{type:"email",name:"email",value:c.email,onChange:m,placeholder:"הזן כתובת אימייל",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid var(--border)",backgroundColor:"var(--bg)",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:e=>e.currentTarget.style.borderColor="var(--accent)",onBlur:e=>e.currentTarget.style.borderColor="var(--border)"})]}),v.jsxs("div",{style:{marginBottom:"24px"},children:[v.jsx("label",{style:{display:"block",marginBottom:"8px",color:"var(--text)",fontWeight:"500",fontSize:"14px"},children:"הרשאות"}),v.jsxs("select",{name:"role",value:c.role,onChange:m,style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid var(--border)",backgroundColor:"var(--bg)",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:e=>e.currentTarget.style.borderColor="var(--accent)",onBlur:e=>e.currentTarget.style.borderColor="var(--border)",children:[v.jsx("option",{value:"viewer",children:"צופה - צפייה בלבד"}),v.jsx("option",{value:"editor",children:"עורך - הוספת הודעות"}),v.jsx("option",{value:"admin",children:"מנהל - הרשאות מלאות"})]})]}),v.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[v.jsx("button",{type:"button",onClick:r,style:{padding:"12px 24px",borderRadius:"8px",border:"2px solid var(--border)",backgroundColor:"transparent",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",transition:"all 0.2s",direction:"rtl"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="var(--border)",e.currentTarget.style.color="var(--text)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="var(--text)"},children:"ביטול"}),v.jsx("button",{type:"submit",disabled:o,style:{padding:"12px 24px",borderRadius:"8px",border:"none",backgroundColor:o?"var(--muted)":"var(--accent)",color:"white",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:o?"not-allowed":"pointer",transition:"background-color 0.2s",direction:"rtl"},children:o?"מתחבר...":"התחבר"})]})]}),v.jsx("div",{style:{marginTop:"20px",padding:"16px",backgroundColor:"rgba(124, 192, 255, 0.1)",borderRadius:"8px",border:"1px solid rgba(124, 192, 255, 0.2)",direction:"rtl"},children:"local"===a?v.jsxs(v.Fragment,{children:[v.jsx("h4",{style:{margin:"0 0 8px 0",color:"var(--text)",fontSize:"14px",fontWeight:"600"},children:"הסבר על הרשאות:"}),v.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",lineHeight:"1.4"},children:[v.jsxs("div",{children:[v.jsx("strong",{children:"צופה:"}),' צפייה בלבד בסג"חים']}),v.jsxs("div",{children:[v.jsx("strong",{children:"עורך:"})," הוספת הודעות בצ'אט"]}),v.jsxs("div",{children:[v.jsx("strong",{children:"מנהל:"}),' עריכת סטטוסים, יצירת סג"חים, הודעות וניהול משתמשים']}),v.jsxs("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(124, 192, 255, 0.3)"},children:[v.jsx("div",{style:{color:"var(--accent)",fontWeight:"600"},children:"חשבון מנהל לדמו:"}),v.jsxs("div",{children:["שם משתמש: ",v.jsx("strong",{children:"admin"})]}),v.jsxs("div",{children:["סיסמה: ",v.jsx("strong",{children:"admin"})]})]})]})]}):v.jsxs(v.Fragment,{children:[v.jsx("h4",{style:{margin:"0 0 8px 0",color:"var(--text)",fontSize:"14px",fontWeight:"600"},children:"אימות ADFS:"}),v.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",lineHeight:"1.4"},children:[v.jsx("div",{children:"ההרשאות נקבעות אוטומטית על פי חברות בקבוצות Active Directory:"}),v.jsxs("div",{children:[v.jsx("strong",{children:"מנהלים:"})," admin, admins, Administrators"]}),v.jsxs("div",{children:[v.jsx("strong",{children:"עורכים:"})," editor, editors, Writers"]}),v.jsxs("div",{children:[v.jsx("strong",{children:"צופים:"})," כל המשתמשים האחרים"]}),s&&v.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(124, 192, 255, 0.3)"},children:v.jsx("div",{style:{color:"var(--accent)",fontWeight:"600"},children:"ניתן לעבור בין מצבי אימות בלחיצה על הכפתור למעלה"})})]})]})})]})}):null},Re=()=>{const{user:e,logout:t,canManageUsers:r,authMode:n}=V(),[i,o]=g.useState(!1);return e?v.jsxs("div",{style:{position:"relative",direction:"rtl"},children:[v.jsxs("button",{onClick:()=>o(!i),style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 14px",maxHeight:"35px",backgroundColor:"var(--panel)",border:"1px solid var(--border)",borderRadius:"12px",color:"var(--text)",fontSize:"10px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",transition:"all 0.2s",direction:"rtl"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="var(--border)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="var(--panel)"},children:[v.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",backgroundColor:"var(--accent)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"14px",fontWeight:"600"},children:e.name.charAt(0).toUpperCase()}),v.jsxs("div",{style:{textAlign:"right"},children:[v.jsx("div",{style:{fontWeight:"600",fontSize:"12px"},children:e.name}),v.jsx("div",{style:{fontSize:"10px",color:"var(--muted)",marginTop:"2px"},children:J(e.role)})]}),v.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",transform:i?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},children:"▼"})]}),i&&v.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"4px",backgroundColor:"var(--panel)",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:1e3,minWidth:"200px",direction:"rtl"},children:[v.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--border)"},children:[v.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"var(--text)",marginBottom:"4px"},children:e.name}),v.jsx("div",{style:{fontSize:"12px",color:"var(--muted)",marginBottom:"2px"},children:e.email}),v.jsx("div",{style:{fontSize:"12px",color:"var(--accent)",fontWeight:"500"},children:J(e.role)}),v.jsx("div",{style:{fontSize:"10px",color:"var(--muted)",marginTop:"2px"},children:$(n)})]}),v.jsxs("div",{style:{padding:"8px"},children:[r()&&v.jsx("button",{onClick:()=>{window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"פונקציונליות ניהול משתמשים תהיה זמינה בקרוב",type:"info",durationMs:3e3}})),o(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",color:"var(--accent)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",borderRadius:"8px",transition:"background-color 0.2s",textAlign:"right",direction:"rtl",marginBottom:"8px"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="rgba(124, 192, 255, 0.1)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent"},children:"👥 ניהול משתמשים"}),v.jsx("button",{onClick:()=>{t(),o(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",color:"var(--text)",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",borderRadius:"8px",transition:"background-color 0.2s",textAlign:"right",direction:"rtl"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="rgba(255, 0, 0, 0.1)",e.currentTarget.style.color="#ff4444"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="var(--text)"},children:"התנתק"})]})]}),i&&v.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:999},onClick:()=>o(!1)})]}):null};function $e({isOpen:e,onClose:t}){const{user:r,canManageUsers:n}=V(),[i,o]=g.useState([]),[a,s]=g.useState(null),[c,p]=g.useState(!1),[u,x]=g.useState({name:"",email:"",role:"viewer"});g.useEffect(()=>{e&&m()},[e]);const m=()=>{try{const e=localStorage.getItem("admin_users");if(e){const t=JSON.parse(e);o(t)}else r&&o([r])}catch(Oe){console.error("Failed to load users:",Oe),o([])}},h=e=>{try{localStorage.setItem("admin_users",JSON.stringify(e)),o(e)}catch(Oe){console.error("Failed to save users:",Oe),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"שגיאה בשמירת משתמשים",type:"error",durationMs:3e3}}))}},f=()=>{if(!a)return;const e=i.map(e=>e.id===a.id?a:e);h(e),s(null),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`משתמש ${a.name} עודכן בהצלחה`,type:"ok",durationMs:3e3}}))};return e&&n()?v.jsx("div",{className:"permission-manager-overlay",onClick:t,children:v.jsxs("div",{className:"permission-manager-modal",onClick:e=>e.stopPropagation(),children:[v.jsxs("div",{className:"permission-manager-header",children:[v.jsx("h2",{style:{margin:0,color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif"},children:"ניהול הרשאות משתמשים"}),v.jsx("button",{className:"close-button",onClick:t,style:{background:"none",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:"4px 8px"},children:"×"})]}),v.jsxs("div",{className:"permission-manager-content",children:[v.jsxs("div",{className:"add-user-section",children:[v.jsx("button",{className:"btn primary",onClick:()=>p(!c),style:{marginBottom:"16px"},children:c?"ביטול":"הוסף משתמש חדש"}),c&&v.jsx("div",{className:"add-user-form",style:{background:"rgba(255,255,255,0.1)",padding:"16px",borderRadius:"8px",marginBottom:"20px",border:"1px solid rgba(255,255,255,0.2)"},children:v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[v.jsx("input",{type:"text",placeholder:"שם משתמש",value:u.name||"",onChange:e=>x(d(l({},u),{name:e.target.value})),style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.1)",color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl"}}),v.jsx("input",{type:"email",placeholder:"אימייל",value:u.email||"",onChange:e=>x(d(l({},u),{email:e.target.value})),style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.1)",color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl"}}),v.jsxs("select",{value:u.role||"viewer",onChange:e=>x(d(l({},u),{role:e.target.value})),style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.1)",color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl"},children:[v.jsx("option",{value:"viewer",children:"צופה"}),v.jsx("option",{value:"editor",children:"עורך"}),v.jsx("option",{value:"admin",children:"מנהל"})]}),v.jsxs("div",{style:{display:"flex",gap:"8px"},children:[v.jsx("button",{className:"btn primary",onClick:()=>{if(!u.name||!u.email)return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"יש למלא שם ואימייל",type:"warn",durationMs:3e3}}));if(i.some(e=>e.email===u.email))return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"משתמש עם אימייל זה כבר קיים",type:"warn",durationMs:3e3}}));const e={id:`user_${Date.now()}`,name:u.name,email:u.email,role:u.role,lastLogin:(new Date).toISOString()},t=[...i,e];h(t),x({name:"",email:"",role:"viewer"}),p(!1),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`משתמש ${e.name} נוסף בהצלחה`,type:"ok",durationMs:3e3}}))},style:{flex:1},children:"הוסף"}),v.jsx("button",{className:"btn ghost",onClick:()=>{p(!1),x({name:"",email:"",role:"viewer"})},style:{flex:1},children:"ביטול"})]})]})})]}),v.jsxs("div",{className:"users-list",children:[v.jsx("h3",{style:{color:"#fff",marginBottom:"16px",fontFamily:"Segoe UI, Arial, sans-serif"},children:"רשימת משתמשים"}),0===i.length?v.jsx("div",{style:{color:"#ccc",textAlign:"center",padding:"20px"},children:"אין משתמשים רשומים"}):v.jsx("div",{className:"users-table",children:i.map(e=>v.jsxs("div",{className:"user-row",style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px",background:"rgba(255,255,255,0.05)",borderRadius:"6px",marginBottom:"8px",border:"1px solid rgba(255,255,255,0.1)"},children:[v.jsxs("div",{className:"user-info",style:{flex:1},children:[v.jsx("div",{style:{color:"#fff",fontWeight:"bold",fontFamily:"Segoe UI, Arial, sans-serif"},children:e.name}),v.jsx("div",{style:{color:"#ccc",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif"},children:e.email}),e.lastLogin&&v.jsxs("div",{style:{color:"#999",fontSize:"12px",fontFamily:"Segoe UI, Arial, sans-serif"},children:["התחברות אחרונה: ",new Date(e.lastLogin).toLocaleString("he-IL")]})]}),v.jsx("div",{className:"user-actions",style:{display:"flex",alignItems:"center",gap:"8px"},children:(null==a?void 0:a.id)===e.id?v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[v.jsxs("select",{value:a.role,onChange:e=>s(d(l({},a),{role:e.target.value})),style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.1)",color:"#fff",fontFamily:"Segoe UI, Arial, sans-serif",direction:"rtl"},children:[v.jsx("option",{value:"viewer",children:"צופה"}),v.jsx("option",{value:"editor",children:"עורך"}),v.jsx("option",{value:"admin",children:"מנהל"})]}),v.jsx("button",{className:"btn primary",onClick:f,style:{padding:"4px 8px",fontSize:"12px"},children:"שמור"}),v.jsx("button",{className:"btn ghost",onClick:()=>s(null),style:{padding:"4px 8px",fontSize:"12px"},children:"ביטול"})]}):v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("span",{style:{color:"#fff",background:"rgba(124,192,255,0.2)",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontFamily:"Segoe UI, Arial, sans-serif"},children:J(e.role)}),v.jsx("button",{className:"btn ghost",onClick:()=>(e=>{s(e)})(e),style:{padding:"4px 8px",fontSize:"12px"},children:"ערוך"}),e.id!==(null==r?void 0:r.id)&&v.jsx("button",{className:"btn ghost",onClick:()=>(e=>{if(e===(null==r?void 0:r.id))return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"לא ניתן למחוק את המשתמש הנוכחי",type:"warn",durationMs:3e3}}));const t=i.filter(t=>t.id!==e);h(t),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"משתמש נמחק בהצלחה",type:"ok",durationMs:3e3}}))})(e.id),style:{padding:"4px 8px",fontSize:"12px",color:"#ff6b6b"},children:"מחק"})]})})]},e.id))})]})]})]})}):null}class _e extends g.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("🚨 ErrorBoundary caught an error:",e,t),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?v.jsxs("div",{style:{padding:"20px",backgroundColor:"#ffebee",border:"1px solid #f44336",borderRadius:"8px",margin:"20px",fontFamily:"Segoe UI, sans-serif"},children:[v.jsx("h2",{style:{color:"#d32f2f",margin:"0 0 10px 0"},children:"🚨 Application Error"}),v.jsx("p",{style:{color:"#666",margin:"0 0 10px 0"},children:"Something went wrong. Please check the console for details."}),v.jsxs("details",{style:{marginTop:"10px"},children:[v.jsx("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Error Details"}),v.jsxs("pre",{style:{backgroundColor:"#f5f5f5",padding:"10px",borderRadius:"4px",overflow:"auto",marginTop:"10px",fontSize:"12px"},children:[this.state.error&&this.state.error.toString(),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}),v.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:"10px",padding:"8px 16px",backgroundColor:"#2196f3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Reload Page"})]}):this.props.children}}function Be(){const{user:e,isLoading:t,canManageUsers:r}=V(),{sagachimStatus:n}=pe(),[i,o]=g.useState(!1),[a,s]=g.useState(!1),[c,p]=g.useState(!1),[u,x]=g.useState("status"),[m,h]=g.useState(null),[f,y]=g.useState("ok"),[b,w]=g.useState(!1),[S,j]=g.useState(!1),k=g.useRef(null),C=g.useRef(null),[E,D]=g.useState('{\n  "person": {\n    "id": "GILI-2025-001",\n    "basic_info": {\n      "first_name": "Gili",\n      "last_name": "Levi",\n      "gender": "Male",\n      "date_of_birth": "1992-05-14",\n      "nationality": "Israeli",\n      "description": "Gili is a 33-year-old software engineer who enjoys hiking, photography, and playing the guitar."\n    },\n    "contact_details": {\n      "phone_numbers": [\n        {\n          "type": "mobile",\n          "country_code": "+972",\n          "number": "54-123-4567",\n          "description": "Primary contact number"\n        },\n        {\n          "type": "home",\n          "country_code": "+972",\n          "number": "3-987-6543",\n          "description": "Landline at home"\n        }\n      ],\n      "email": "gili.levi@example.com"\n    },\n    "address": {\n      "primary_residence": {\n        "street": "HaPalmach Street",\n        "house_number": 17,\n        "city": "Tel Aviv",\n        "postal_code": "6329204",\n        "country": "Israel",\n        "coordinates": {\n          "latitude": 32.0853,\n          "longitude": 34.7818\n        },\n        "description": "Main apartment located in the heart of Tel Aviv, close to cafes and the beach."\n      },\n      "secondary_residence": {\n        "street": "Herzl Avenue",\n        "house_number": 45,\n        "city": "Haifa",\n        "postal_code": "3200000",\n        "country": "Israel",\n        "description": "Vacation apartment in Haifa with a view of the Mediterranean Sea."\n      }\n    },\n    "employment": {\n      "current_job": {\n        "position": "Senior Software Engineer",\n        "company": "TechNova Ltd.",\n        "department": "AI Research & Development",\n        "start_date": "2018-09-01",\n        "description": "Leads a team of 6 engineers developing machine learning models for predictive analytics."\n      },\n      "previous_jobs": [\n        {\n          "position": "Backend Developer",\n          "company": "CodeWorks",\n          "start_date": "2015-06-15",\n          "end_date": "2018-08-31",\n          "description": "Worked on API development and database optimization."\n        },\n        {\n          "position": "Junior Web Developer",\n          "company": "Creative Web Studio",\n          "start_date": "2013-02-01",\n          "end_date": "2015-05-30",\n          "description": "Built responsive websites for small businesses."\n        }\n      ]\n    },\n    "personal_interests": {\n      "hobbies": [\n        {\n          "name": "Hiking",\n          "description": "Explores nature trails around Israel and abroad."\n        },\n        {\n          "name": "Photography",\n          "description": "Specializes in landscape and street photography."\n        },\n        {\n          "name": "Music",\n          "description": "Plays acoustic guitar and writes original songs."\n        }\n      ],\n      "sports": [\n        {\n          "name": "Basketball",\n          "description": "Plays in a local amateur league every weekend."\n        }\n      ]\n    },\n    "identifiers": {\n      "passport_number": "IL9876543",\n      "national_id": "203456789",\n      "driver_license": {\n        "number": "DL-IL-456789",\n        "category": "B",\n        "expiry_date": "2030-12-31"\n      }\n    },\n    "emergency_contacts": [\n      {\n        "name": "Maya Levi",\n        "relationship": "Sister",\n        "phone": {\n          "country_code": "+972",\n          "number": "52-765-4321"\n        }\n      },\n      {\n        "name": "David Cohen",\n        "relationship": "Friend",\n        "phone": {\n          "country_code": "+972",\n          "number": "50-987-6543"\n        }\n      }\n    ]\n  }\n}'),[T,N]=g.useState(null),[I,A]=g.useState(null),[F,$]=g.useState(!1),[_,B]=g.useState(1),[W,O]=g.useState({x:0,y:0}),[U,P]=g.useState(!1),[q,Y]=g.useState({x:0,y:0}),[H,J]=g.useState(""),[X,G]=g.useState([]),[K,Q]=g.useState(!1),[Z,ee]=g.useState(!1),[te,re]=g.useState(null),[ne,ie]=g.useState(""),[oe,ae]=g.useState(""),[se,le]=g.useState(""),[de,ce]=g.useState(!1),[ue,xe]=g.useState(""),[me,he]=g.useState([]),[fe,ye]=g.useState(""),[be,ve]=g.useState(!1),[we,ke]=g.useState(!1),[Ce,Ee]=g.useState(!0),[De,Te]=g.useState(!1),[Ne,ze]=g.useState(!1),[Me,_e]=g.useState(!1),[Be,We]=g.useState(!1),[Oe,Ue]=g.useState(!1),[Pe,qe]=g.useState(null),[Ye,He]=g.useState(null),[Ve,Je]=g.useState(null),Xe=g.useRef(null),Ge=g.useRef(1),Ke=g.useRef({x:0,y:0}),Qe=g.useRef(null),Ze=g.useRef(null),et=g.useRef(null),tt=g.useRef(null),rt=g.useRef(null),nt=g.useRef(null),it=g.useRef([]);g.useEffect(()=>{e&&"admin"!==e.role&&("viz"!==u&&"dictionary"!==u&&"common"!==u||x("status"))},[e,u]);const ot=g.useMemo(()=>{try{return typeof JSON.parse(E)}catch(e){return null}},[E]),at=g.useMemo(()=>{if(!T)return[];const e=[],t=(r,n)=>{var i;const o=null!=(i=r.children)?i:[],a=0===o.length,s=!!(r.excelMeta&&Object.keys(r.excelMeta).length>0),l="required"===r.requiredState,d=[...n,r.name];if(a&&l&&!s){const t=d.slice(1).join(" -> ");e.push({id:r.id,path:t,requiredState:r.requiredState})}o.forEach(e=>t(e,d))};return t(T,[]),e},[T]),st=g.useMemo(()=>at,[at]),lt=g.useCallback(()=>{try{if(!fe)return void window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"בחר סכמה לויזואליזציה בעץ",type:"error",durationMs:4e3}}));const e=ct[fe];if(e){D(JSON.stringify(e.schema,null,2)),A(null);const t=z(e.schema),r=gt(t,me);N(r)}else A("Selected schema not found")}catch(e){A(e instanceof Error?e.message:"Failed to parse JSON")}},[fe,me]),dt=g.useCallback(()=>{D(""),N(null),A(null)},[]),ct={person:{title:"Person",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"Person",type:"object",required:["firstName","lastName","address"],properties:{firstName:{type:"string",description:"Given name of the person",minLength:1},lastName:{type:"string",description:"Family name of the person",minLength:1},email:{type:"string",format:"email",description:"Primary contact email address"},phone:{type:"string",pattern:"^\\+?[0-9\n\r-s]{7,15}$",description:"Phone number with optional country code"},account:{type:"object",description:"User account settings and preferences",properties:{username:{type:"string",description:"Unique username for login",minLength:3,maxLength:16},password:{type:"string",description:"Secure password for account access",minLength:8},preferences:{type:"object",description:"User interface and notification preferences",properties:{notifications:{type:"boolean",description:"Enable push notifications"},theme:{type:"string",description:"Visual theme preference",enum:["light","dark","system"]},shortcuts:{type:"array",description:"Custom keyboard shortcuts",items:{type:"object",required:["name","keys"],properties:{name:{type:"string",description:"Shortcut action name"},keys:{type:"string",description:"Keyboard combination",pattern:"^[A-Z]++[A-Z]+$"}}}}}}}},address:{type:"object",description:"Primary residential address",required:["street","city"],properties:{street:{type:"string",description:"Street name and number",minLength:1},city:{type:"string",description:"City name",minLength:1},state:{type:"string",description:"State or province"},zip:{type:"string",description:"Postal code",pattern:"^[0-9]{5}(?:-[0-9]{4})?$"}}},secondary_residence:{type:"object",description:"Optional secondary residence; if present, street and city are required",required:["street","city"],properties:{street:{type:"string",description:"Street name and number"},city:{type:"string",description:"City name"},coordinates:{type:"object",description:"Geographic coordinates of the residence",properties:{lat:{type:"number",description:"Latitude coordinate",minimum:-90,maximum:90},lng:{type:"number",description:"Longitude coordinate",minimum:-180,maximum:180}}}}},documents:{type:"array",description:"Collection of uploaded documents",items:{type:"object",required:["fileName","mimeType"],properties:{fileName:{type:"string",description:"Original filename of the document"},mimeType:{type:"string",description:"MIME type of the document",pattern:"^[-w.]+/[-w.]+$"},sizeKb:{type:"integer",description:"File size in kilobytes",minimum:1,maximum:10240}}}},age:{type:"integer",description:"Age in years",minimum:0,maximum:120},tags:{type:"array",description:"User-defined tags for categorization",items:{type:"string",maxLength:20}}}}},gps_location:{title:"GPS Location Device",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"GPSLocationDevice",type:"object",required:["deviceId","location","timestamp"],properties:{deviceId:{type:"string",description:"Unique identifier for the GPS device",minLength:1},deviceInfo:{type:"object",description:"Device hardware and software information",required:["model","firmwareVersion"],properties:{model:{type:"string",description:"Device model name",minLength:1},manufacturer:{type:"string",description:"Device manufacturer",minLength:1},firmwareVersion:{type:"string",description:"Current firmware version",pattern:"^\\d+\\.\\d+\\.\\d+$"},serialNumber:{type:"string",description:"Device serial number",pattern:"^[A-Z0-9]{8,16}$"},batteryLevel:{type:"number",description:"Battery level percentage",minimum:0,maximum:100},lastMaintenance:{type:"string",description:"Last maintenance date",format:"date"}}},location:{type:"object",description:"Current GPS location data",required:["latitude","longitude","accuracy"],properties:{latitude:{type:"number",description:"Latitude coordinate in decimal degrees",minimum:-90,maximum:90},longitude:{type:"number",description:"Longitude coordinate in decimal degrees",minimum:-180,maximum:180},accuracy:{type:"number",description:"GPS accuracy in meters",minimum:0,maximum:1e3},altitude:{type:"number",description:"Altitude above sea level in meters",minimum:-1e3,maximum:1e4},heading:{type:"number",description:"Direction of movement in degrees",minimum:0,maximum:360},speed:{type:"number",description:"Speed in meters per second",minimum:0,maximum:100},satellites:{type:"integer",description:"Number of GPS satellites in view",minimum:0,maximum:32}}},timestamp:{type:"string",description:"ISO 8601 timestamp of location reading",format:"date-time"},environmental:{type:"object",description:"Environmental sensor data if available",properties:{temperature:{type:"number",description:"Ambient temperature in Celsius",minimum:-50,maximum:80},humidity:{type:"number",description:"Relative humidity percentage",minimum:0,maximum:100},pressure:{type:"number",description:"Atmospheric pressure in hPa",minimum:800,maximum:1200}}},connectivity:{type:"object",description:"Communication and connectivity status",required:["status"],properties:{status:{type:"string",description:"Connection status",enum:["online","offline","error","maintenance"]},signalStrength:{type:"number",description:"Signal strength in dBm",minimum:-120,maximum:-30},lastSync:{type:"string",description:"Last successful data sync timestamp",format:"date-time"},protocol:{type:"string",description:"Communication protocol used",enum:["4G","5G","WiFi","Satellite"]}}},alerts:{type:"array",description:"Active alerts and notifications",items:{type:"object",required:["type","message","severity"],properties:{type:{type:"string",description:"Alert type",enum:["low_battery","out_of_range","maintenance_due","error"]},message:{type:"string",description:"Alert description",minLength:1},severity:{type:"string",description:"Alert severity level",enum:["low","medium","high","critical"]},timestamp:{type:"string",description:"When the alert was generated",format:"date-time"}}}}}}},cellular_tracking:{title:"Cellular Mobile Tracking",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"CellularMobileTracking",type:"object",required:["mobileNumber","trackingData","timestamp"],properties:{mobileNumber:{type:"string",description:"Mobile phone number being tracked",pattern:"^\\+[1-9]\\d{1,14}$"},subscriberInfo:{type:"object",description:"Mobile subscriber identification and details",required:["imsi","msisdn"],properties:{imsi:{type:"string",description:"International Mobile Subscriber Identity",pattern:"^[0-9]{14,15}$"},msisdn:{type:"string",description:"Mobile Station International Subscriber Directory Number",pattern:"^[0-9]{12,15}$"},iccid:{type:"string",description:"Integrated Circuit Card Identifier",pattern:"^[0-9]{19,20}$"},carrier:{type:"string",description:"Mobile network operator name",minLength:1},planType:{type:"string",description:"Subscription plan type",enum:["prepaid","postpaid","corporate"]}}},trackingData:{type:"object",description:"Real-time location and movement tracking information",required:["cellTower","signalStrength"],properties:{cellTower:{type:"object",description:"Current serving cell tower information",required:["cellId","lac","mcc","mnc"],properties:{cellId:{type:"integer",description:"Cell tower identifier",minimum:1,maximum:65535},lac:{type:"integer",description:"Location Area Code",minimum:1,maximum:65535},mcc:{type:"integer",description:"Mobile Country Code",minimum:100,maximum:999},mnc:{type:"integer",description:"Mobile Network Code",minimum:0,maximum:999},coordinates:{type:"object",description:"Cell tower geographic coordinates",properties:{latitude:{type:"number",description:"Tower latitude",minimum:-90,maximum:90},longitude:{type:"number",description:"Tower longitude",minimum:-180,maximum:180}}}}},signalStrength:{type:"number",description:"Signal strength in dBm",minimum:-120,maximum:-30},networkType:{type:"string",description:"Current network technology",enum:["2G","3G","4G","5G"]},roaming:{type:"boolean",description:"Whether device is roaming"},estimatedLocation:{type:"object",description:"Estimated device location based on cell tower triangulation",properties:{latitude:{type:"number",description:"Estimated latitude",minimum:-90,maximum:90},longitude:{type:"number",description:"Estimated longitude",minimum:-180,maximum:180},accuracy:{type:"number",description:"Location accuracy in meters",minimum:100,maximum:5e4}}}}},timestamp:{type:"string",description:"Tracking data timestamp",format:"date-time"},movement:{type:"object",description:"Movement and velocity information",properties:{speed:{type:"number",description:"Movement speed in km/h",minimum:0,maximum:500},direction:{type:"number",description:"Movement direction in degrees",minimum:0,maximum:360},acceleration:{type:"number",description:"Acceleration in m/s²",minimum:-50,maximum:50},stationary:{type:"boolean",description:"Whether device is currently stationary"}}},callLog:{type:"array",description:"Recent call activity log",items:{type:"object",required:["type","timestamp","duration"],properties:{type:{type:"string",description:"Call type",enum:["incoming","outgoing","missed"]},timestamp:{type:"string",description:"Call timestamp",format:"date-time"},duration:{type:"integer",description:"Call duration in seconds",minimum:0},number:{type:"string",description:"Phone number involved in call",pattern:"^\\+[1-9]\\d{1,14}$"}}}},dataUsage:{type:"object",description:"Mobile data consumption statistics",properties:{currentPeriod:{type:"integer",description:"Data used in current billing period (MB)",minimum:0},totalLimit:{type:"integer",description:"Total data limit for period (MB)",minimum:0},lastReset:{type:"string",description:"Last data reset date",format:"date"}}}}}},license_plate:{title:"License Plate Identification",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"LicensePlateIdentification",type:"object",required:["plateNumber","detectionData","timestamp"],properties:{plateNumber:{type:"string",description:"Identified license plate number",pattern:"^[A-Z0-9\\-\\s]{2,12}$"},vehicleInfo:{type:"object",description:"Vehicle information associated with the license plate",required:["make","model"],properties:{make:{type:"string",description:"Vehicle manufacturer brand",minLength:1},model:{type:"string",description:"Vehicle model name",minLength:1},year:{type:"integer",description:"Vehicle manufacturing year",minimum:1900,maximum:2030},color:{type:"string",description:"Primary vehicle color",minLength:1},bodyType:{type:"string",description:"Vehicle body style",enum:["sedan","suv","truck","motorcycle","bus","van"]},fuelType:{type:"string",description:"Vehicle fuel type",enum:["gasoline","diesel","electric","hybrid","hydrogen"]}}},detectionData:{type:"object",description:"License plate detection and recognition details",required:["confidence","imageQuality"],properties:{confidence:{type:"number",description:"Recognition confidence score (0-100)",minimum:0,maximum:100},imageQuality:{type:"string",description:"Image quality assessment",enum:["excellent","good","fair","poor"]},processingTime:{type:"number",description:"Processing time in milliseconds",minimum:0,maximum:1e4},algorithm:{type:"string",description:"Recognition algorithm used",minLength:1},ocrVersion:{type:"string",description:"OCR software version",pattern:"^\\d+\\.\\d+\\.\\d+$"}}},timestamp:{type:"string",description:"Detection timestamp",format:"date-time"},location:{type:"object",description:"Location where the license plate was detected",required:["cameraId","coordinates"],properties:{cameraId:{type:"string",description:"Unique camera identifier",minLength:1},coordinates:{type:"object",description:"Geographic coordinates of detection point",required:["latitude","longitude"],properties:{latitude:{type:"number",description:"Detection latitude",minimum:-90,maximum:90},longitude:{type:"number",description:"Detection longitude",minimum:-180,maximum:180},altitude:{type:"number",description:"Detection altitude in meters",minimum:-1e3,maximum:1e4}}},address:{type:"string",description:"Human-readable address of detection point"},zone:{type:"string",description:"Traffic zone or area designation"}}},imageData:{type:"object",description:"Captured image and processing information",required:["imageUrl"],properties:{imageUrl:{type:"string",description:"URL to captured image",format:"uri"},thumbnailUrl:{type:"string",description:"URL to thumbnail version",format:"uri"},imageFormat:{type:"string",description:"Image file format",enum:["JPEG","PNG","BMP","TIFF"]},resolution:{type:"string",description:"Image resolution (width x height)",pattern:"^\\d+x\\d+$"},fileSize:{type:"integer",description:"Image file size in bytes",minimum:1}}},trafficViolations:{type:"array",description:"Traffic violations associated with this vehicle",items:{type:"object",required:["type","timestamp","location"],properties:{type:{type:"string",description:"Violation type",enum:["speeding","red_light","parking","toll_evasion","other"]},timestamp:{type:"string",description:"Violation timestamp",format:"date-time"},location:{type:"string",description:"Violation location description"},fine:{type:"number",description:"Fine amount in local currency",minimum:0},status:{type:"string",description:"Violation status",enum:["pending","paid","disputed","dismissed"]}}}},registration:{type:"object",description:"Vehicle registration and ownership information",properties:{ownerName:{type:"string",description:"Registered owner name",minLength:1},registrationDate:{type:"string",description:"Registration date",format:"date"},expiryDate:{type:"string",description:"Registration expiry date",format:"date"},insurance:{type:"object",description:"Insurance policy details",properties:{provider:{type:"string",description:"Insurance company name"},policyNumber:{type:"string",description:"Insurance policy number"},expiryDate:{type:"string",description:"Insurance expiry date",format:"date"}}}}}}}},product:{title:"Product",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"Product",type:"object",required:["name","price","category"],properties:{name:{type:"string",description:"Product name",minLength:1},price:{type:"number",minimum:0,description:"Product price"},category:{type:"string",description:"Product category"},description:{type:"string",description:"Product description"},inStock:{type:"boolean",description:"Product availability"},tags:{type:"array",items:{type:"string"}}}}},order:{title:"Order",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"Order",type:"object",required:["orderId","customer","items"],properties:{orderId:{type:"string",description:"Unique order identifier"},customer:{type:"object",properties:{name:{type:"string"},email:{type:"string",format:"email"}}},items:{type:"array",items:{type:"object",properties:{productId:{type:"string"},quantity:{type:"integer",minimum:1},price:{type:"number",minimum:0}}}}}}},optional_hierarchy_demo:{title:"Optional hierarchy demo",schema:{$schema:"https://json-schema.org/draft/2020-12/schema",title:"OptionalHierarchyDemo",type:"object",required:["userId"],properties:{userId:{type:"string",description:"Unique user identifier",minLength:1},profile:{type:"object",description:"Optional profile. If present, name and email are mandatory",required:["name","email"],properties:{name:{type:"string",description:"Full name",minLength:1},email:{type:"string",description:"Email",format:"email"},bio:{type:"string",description:"Short biography",maxLength:200},address:{type:"object",description:"Optional address. If present, street and city are mandatory",required:["street","city"],properties:{street:{type:"string",minLength:1},city:{type:"string",minLength:1},country:{type:"string"},zip:{type:"string",pattern:"^[0-9]{5}(?:-[0-9]{4})?$"}}}}},attachments:{type:"array",description:"Optional attachments. If used, fileName is mandatory",items:{type:"object",required:["fileName"],properties:{fileName:{type:"string",minLength:1},mimeType:{type:"string",pattern:"^[-w.]+/[-w.]+$"},sizeKb:{type:"integer",minimum:1}}}}}}}};g.useEffect(()=>{const e=e=>{e.ctrlKey&&"f"===e.key&&(e.preventDefault(),ee(!0),setTimeout(()=>{const e=document.getElementById("tree-search");null==e||e.focus()},50)),"Escape"===e.key&&(ee(!1),J(""),$(!1),re(null),ve(!1),ze(!1),_e(!1))},t=e=>{const{targetNode:t,field:r}=e.detail;if(me.find(e=>{var n,i,o,a;const s=(null==(n=null==e?void 0:e.targetNode)?void 0:n.name)===(null==t?void 0:t.name)&&(null==(i=null==e?void 0:e.targetNode)?void 0:i.type)===(null==t?void 0:t.type),l=(null==(o=null==e?void 0:e.field)?void 0:o.name)!==(null==r?void 0:r.name)||(null==(a=null==e?void 0:e.field)?void 0:a.fieldType)!==(null==r?void 0:r.fieldType);return s&&l}))return He({targetNode:t,field:r}),Je("drop"),void Ue(!0);re({targetNode:t,field:r}),ie(r.name||""),ae(""),le(t.name||""),ce(!1),xe("")},r=e=>{var t;console.log("Sending saved mappings to ExcelExtractor:",it.current);const r=null==(t=e.detail)?void 0:t.callback;r&&"function"==typeof r&&r(it.current)},n=e=>{var t;const r=null==(t=e.detail)?void 0:t.callback;r&&"function"==typeof r&&r(fe)},i=e=>{var t;const r=null==(t=e.detail)?void 0:t.key;if(r&&"string"==typeof r){ye(r);const e=ct[r];if(e){D(JSON.stringify(e.schema,null,2)),A(null);const t=z(e.schema),r=nt.current&&nt.current.length>0?nt.current:me,n=gt(t,r);N(n),nt.current=null,window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`נטענה סכמה: ${e.title}`,type:"ok",durationMs:2500}}))}else window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"סכמה שהוטענה מהאקסל לא נמצאה",type:"error",durationMs:4e3}}))}},o=e=>{var t;const r=(null==(t=e.detail)?void 0:t.mappings)||[];r.length&&(nt.current=r,he(e=>{const t=e=>{var t,r,n,i;return`${null==(t=null==e?void 0:e.targetNode)?void 0:t.name}__${null==(r=null==e?void 0:e.targetNode)?void 0:r.type}__${null==(n=null==e?void 0:e.field)?void 0:n.name}__${null==(i=null==e?void 0:e.field)?void 0:i.fieldType}`},n=new Map;e.forEach(e=>n.set(t(e),e)),r.forEach(e=>n.set(t(e),e));const i=Array.from(n.values());return it.current=i,i}),T&&N(gt(T,r)))};return window.addEventListener("keydown",e),window.addEventListener("excel:drop-on-node",t),window.addEventListener("excel:request-mappings",r),window.addEventListener("excel:request-selected-schema",n),window.addEventListener("excel:apply-selected-schema",i),window.addEventListener("excel:mappings-imported",o),()=>{window.removeEventListener("keydown",e),window.removeEventListener("excel:drop-on-node",t),window.removeEventListener("excel:request-mappings",r),window.removeEventListener("excel:request-selected-schema",n),window.removeEventListener("excel:apply-selected-schema",i),window.removeEventListener("excel:mappings-imported",o)}},[me,fe,T]),g.useEffect(()=>{const e=e=>{var t;const r=e.target;et.current&&!et.current.contains(r)&&ze(!1),tt.current&&!tt.current.contains(r)&&_e(!1);const n=rt.current&&rt.current.contains(r),i=null==(t=null==r?void 0:r.closest)?void 0:t.call(r,'.schema-dropdown[role="menu"]');n||i||We(!1)};return document.addEventListener("mousedown",e,!0),()=>document.removeEventListener("mousedown",e,!0)},[]),g.useEffect(()=>{const e=()=>ke(!0);return window.addEventListener("excel:uploaded",e),()=>window.removeEventListener("excel:uploaded",e)},[]),g.useEffect(()=>{if(!F)return;const e=e=>{var t,r;const n=e.target,i=null==(t=Qe.current)?void 0:t.contains(n),o=null==(r=Ze.current)?void 0:r.contains(n);i||o||$(!1)};return document.addEventListener("mousedown",e,!0),()=>document.removeEventListener("mousedown",e,!0)},[F]),g.useEffect(()=>{if(!be)return;const e=e=>{var t;const r=e.target;(null==(t=document.querySelector(".schema-selector"))?void 0:t.contains(r))||ve(!1)};return document.addEventListener("mousedown",e,!0),()=>document.removeEventListener("mousedown",e,!0)},[be]),g.useEffect(()=>{(()=>{if(document.querySelectorAll(".search-highlight").forEach(e=>{const t=e.parentNode;t.replaceChild(document.createTextNode(e.textContent||""),e),t.normalize()}),!H.trim())return;const e=document.createTreeWalker(document.querySelector(".tree-view")||document.body,NodeFilter.SHOW_TEXT,{acceptNode:e=>{const t=e.parentElement;return t&&!t.classList.contains("search-highlight")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),t=[];let r;for(;r=e.nextNode();)t.push(r);const n=new RegExp(`(${H.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");t.forEach(e=>{const t=e.textContent||"";if(n.test(t)){const r=e.parentElement,i=t.replace(n,'<span class="search-highlight">$1</span>'),o=document.createElement("div");for(o.innerHTML=i,r.replaceChild(o,e);o.firstChild;)r.insertBefore(o.firstChild,o);r.removeChild(o)}})})()},[H,T]);const pt=(e,t=[],r=[])=>{var n;const i=Array.isArray(e.rules)&&e.rules.length?e.rules.join(" "):void 0,o=[...r,e.name].slice(1).join(" -> ");return t.push({id:e.id,path:o,name:e.name,description:e.description,rulesText:i}),null==(n=e.children)||n.forEach(n=>pt(n,t,[...r,e.name])),t},gt=(e,t)=>{var r,n,i;if(!t||0===t.length)return e;const o=new Map,a=new Map;for(const l of t){const e=((null==(r=null==l?void 0:l.targetNode)?void 0:r.path)||"").trim();e&&o.set(e,l);const t=`${(null==(n=null==l?void 0:l.targetNode)?void 0:n.name)||""}__${(null==(i=null==l?void 0:l.targetNode)?void 0:i.type)||""}`;a.set(t,l)}const s=e=>{const t=(e=>(e.id||"").split(":")[0])(e),r=o.get(t),n=a.get(`${e.name}__${e.type}`),i=r||n,c=i?d(l({},e),{excelMeta:(p=i,{fieldEssence:(null==(g=null==p?void 0:p.field)?void 0:g.fieldEssence)||"",dgh:(null==(u=null==p?void 0:p.field)?void 0:u.dgh)||"",always:(null==(x=null==p?void 0:p.field)?void 0:x.always)||"",mappingDetails:(null==p?void 0:p.mappingDetails)||"",outputs:(null==p?void 0:p.outputs)||""})}):e;var p,g,u,x;return c.children&&c.children.length>0?d(l({},c),{children:c.children.map(e=>s(e))}):c};return s(e)};g.useEffect(()=>{if(!H.trim())return G([]),Q(!1),void document.querySelectorAll(".search-highlight").forEach(e=>{e.classList.remove("search-highlight")});const e=T?pt(T):[],t=H.trim().toLowerCase(),r=e.reduce((e,r)=>{const n=r.path.toLowerCase().includes(t),i=r.description||"",o=i.toLowerCase().indexOf(t),a=r.rulesText||"",s=a.toLowerCase().indexOf(t);if(n||-1!==o||-1!==s){let n;if(-1!==o){const e=40,r=60,a=Math.max(0,o-e),s=Math.min(i.length,o+t.length+r),l=a>0?"…":"",d=s<i.length?"…":"";n=`${l}${i.slice(a,s)}${d}`}else if(-1!==s){const e=40,r=60,i=Math.max(0,s-e),o=Math.min(a.length,s+t.length+r),l=i>0?"…":"",d=o<a.length?"…":"";n=`${l}${a.slice(i,o)}${d}`}e.push(d(l({},r),{snippet:n}))}return e},[]).slice(0,20);G(r),Q(r.length>0)},[T,H]);const ut=e=>Math.min(2.5,Math.max(.5,Math.round(100*e)/100));g.useEffect(()=>{const e=e=>{if(!window.__excelDragging)return;const t=Xe.current;if(!t)return;const r=t.getBoundingClientRect();e.preventDefault();const n=e.deltaY>0?-.08:.08,i=Ge.current,o=ut(i+n);if(o===i)return;const a=e.clientX-r.left,s=e.clientY-r.top,l=o/i,d=Ke.current,c=a-(a-d.x)*l,p=s-(s-d.y)*l;B(o),O({x:c,y:p})},t={passive:!1};return window.addEventListener("wheel",e,t),document.addEventListener("wheel",e,t),document.body.addEventListener("wheel",e,t),window.addEventListener("mousewheel",e,t),document.addEventListener("mousewheel",e,t),document.addEventListener("DOMMouseScroll",e,t),()=>{window.removeEventListener("wheel",e),document.removeEventListener("wheel",e),document.body.removeEventListener("wheel",e),window.removeEventListener("mousewheel",e),document.removeEventListener("mousewheel",e),document.removeEventListener("DOMMouseScroll",e)}},[]),g.useEffect(()=>{it.current=me},[me]),g.useEffect(()=>{Ge.current=_},[_]),g.useEffect(()=>{Ke.current=W},[W]);const xt=e=>{try{he(t=>{const r=e=>{var t,r;return`${null==(t=null==e?void 0:e.field)?void 0:t.name}__${null==(r=null==e?void 0:e.field)?void 0:r.fieldType}`},n=new Map;t.forEach(e=>n.set(r(e),e)),n.set(r(e),e);const i=Array.from(n.values());return it.current=i,i});const t=r=>r.id===e.targetNode.id?d(l({},r),{excelMeta:{fieldEssence:e.field.fieldEssence||"",dgh:e.field.dgh||"",always:e.field.always||"",mappingDetails:e.mappingDetails||"",outputs:e.outputs||""}}):r.children?d(l({},r),{children:r.children.map(e=>t(e))}):r;if(T){const e=t(T);N(e)}window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`Mapping saved for ${e.targetNode.name}`,type:"ok",durationMs:3e3}})),window.dispatchEvent(new CustomEvent("excel:mapping-saved",{detail:{field:e.field,targetNode:e.targetNode}})),re(null)}catch(t){console.error("Failed to save mapping:",t),alert("Failed to save mapping. Check console for details.")}},mt=(e,t)=>{e.style.transform=t?"translateY(-1px)":"translateY(0px)",e.style.boxShadow=t?"0 6px 20px rgba(0,0,0,0.35)":"none"},ht=(e,t,r)=>{if(e.dataset.baseBg||(e.dataset.baseBg=e.style.background||""),e.classList.contains("opt-orange")){if(t)return void(e.style.background="rgba(228, 184, 27, 0.55)")}else if(e.classList.contains("opt-green")&&t)return void(e.style.background="rgba(38, 216, 56, 0.55)");const n=e.dataset.baseBg;"string"==typeof n?e.style.background=n:e.style.removeProperty("background")};return g.useEffect(()=>{const e=()=>{k.current&&(window.clearTimeout(k.current),k.current=null),C.current&&(window.clearTimeout(C.current),C.current=null)},t=t=>{const{message:r,type:n,durationMs:i}=t.detail||{};e(),w(!1),j(!1),h(r||""),y(n||"ok"),requestAnimationFrame(()=>j(!0));const o="number"==typeof i?i:5e3;k.current=window.setTimeout(()=>{w(!0),C.current=window.setTimeout(()=>{h(null),w(!1),j(!1)},420)},o)};return window.addEventListener("excel:status",t),()=>{e(),window.removeEventListener("excel:status",t)}},[]),g.useEffect(()=>{const e=()=>{try{if(he([]),it.current=[],T){const e=t=>d(l({},t),{excelMeta:void 0,children:t.children?t.children.map(e):t.children});N(e(T))}window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"נוקו כל המיפויים מהעץ",type:"ok",durationMs:2500}}))}catch(e){console.error("Failed to clear mappings:",e),window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:`ניקוי מיפויים נכשל: ${e}`,type:"error",durationMs:4e3}}))}};return window.addEventListener("excel:clear-all-mappings",e),()=>window.removeEventListener("excel:clear-all-mappings",e)},[T]),v.jsxs("div",{className:"page-root",children:[v.jsxs("div",{className:"app-shell",children:[v.jsxs("header",{className:"app-header floating",children:[v.jsxs("div",{className:"brand",children:[v.jsx("img",{src:"./images/logo.png",alt:"העץ הירוק",style:{height:"80px",width:"80px",objectFit:"contain",marginRight:"8px",marginTop:"-12px",marginBottom:"-12px"}}),"archive"===u&&v.jsx("div",{className:"archive-back",style:{marginRight:"16px"},children:v.jsxs("button",{className:"btn glow-blue",onClick:()=>x("status"),style:{padding:"12px 16px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl",fontFamily:"Segoe UI, sans-serif"},title:"חזור לסטטוס סגחים",children:[v.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",style:{marginLeft:"8px"},children:v.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})}),"חזרה"]})}),"analytics"===u&&v.jsx("div",{className:"analytics-back",style:{marginRight:"16px"},children:v.jsxs("button",{className:"btn glow-blue",onClick:()=>x("status"),style:{padding:"12px 16px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl",fontFamily:"Segoe UI, sans-serif"},title:"חזור לסטטוס סגחים",children:[v.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",style:{marginLeft:"8px"},children:v.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})}),"חזרה"]})}),"status"===u&&v.jsxs("div",{className:"status-controls",style:{display:"flex",alignItems:"center",gap:"12px",marginRight:"16px"},children:[v.jsxs("button",{className:"btn glow-blue",onClick:()=>x("archive"),style:{padding:"12px 16px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl",fontFamily:"Segoe UI, sans-serif"},title:"ארכיון סגחים מובצעים",children:[v.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",style:{marginLeft:"8px"},children:v.jsx("path",{d:"M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 9.5l4 4h-2.5V16h-3v-2.5H8l4-4z"})}),"ארכיון"]}),v.jsxs("button",{className:"btn glow-green",onClick:()=>x("analytics"),style:{padding:"12px 16px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl",fontFamily:"Segoe UI, sans-serif"},title:"אנליטיקות סגחים",children:[v.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",style:{marginLeft:"8px"},children:v.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"})}),"אנליטיקות"]})]}),"viz"===u&&"admin"===(null==e?void 0:e.role)&&v.jsxs("div",{className:"excel-header-actions",style:{display:"flex",alignItems:"center",gap:8},children:[v.jsxs("div",{className:"action-dropdown",ref:et,style:{position:"relative",width:240},children:[v.jsxs("button",{className:"btn glow-orange",style:{width:"100%",padding:"12px 14px",minHeight:"35px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl"},onClick:()=>{ze(!Ne),_e(!1)},onMouseEnter:e=>mt(e.currentTarget,!0),onMouseLeave:e=>mt(e.currentTarget,!1),children:[v.jsx("span",{style:{marginLeft:5,marginTop:"2px",fontSize:"10px"},children:"▲"}),v.jsx("span",{style:{display:"flex",alignItems:"center",gap:6},children:v.jsx("span",{children:"העלאה"})})]}),Ne&&v.jsxs("div",{className:"schema-dropdown",style:{right:0,left:"auto",width:"100%",minWidth:"100%",border:"1px solid rgba(201, 168, 25, 0.17)",borderRadius:"12px",marginTop:"4px",maxHeight:"200px",overflowY:"auto",background:"rgba(182, 130, 32, 0.93)",boxShadow:"0 18px 44px rgba(0,0,0,0.7)",backdropFilter:"blur(48px)",overflow:"hidden"},children:[v.jsx("div",{className:"schema-option opt-orange",onClick:()=>{window.dispatchEvent(new Event("excel:upload-mapping-request")),ze(!1)},dir:"rtl",style:{padding:"10px 12px",borderBottom:"1px solid rgba(255,255,255,0.08)",textAlign:"center",background:"rgba(10,24,45,0.98)",color:"#ffffff"},onMouseEnter:e=>ht(e.currentTarget,!0),onMouseLeave:e=>ht(e.currentTarget,!1),children:"העלה Mapping"}),v.jsx("div",{className:"schema-option opt-orange",onClick:()=>{window.dispatchEvent(new Event("excel:upload-request")),ze(!1)},style:{padding:"10px 12px",borderBottom:"none",textAlign:"center",background:"rgba(10,24,45,0.98)",color:"#ffffff"},onMouseEnter:e=>ht(e.currentTarget,!0),onMouseLeave:e=>ht(e.currentTarget,!1),children:'העלה קובץ דג"ח'})]})]}),v.jsxs("div",{className:"action-dropdown",ref:tt,style:{position:"relative",width:240},children:[v.jsxs("button",{className:"btn glow-green",style:{width:"100%",padding:"12px 14px",minHeight:"35px",maxHeight:"35px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",direction:"rtl"},onClick:()=>{_e(!Me),ze(!1)},onMouseEnter:e=>mt(e.currentTarget,!0),onMouseLeave:e=>mt(e.currentTarget,!1),children:[v.jsx("span",{style:{marginLeft:5,marginTop:"2px",fontSize:"10px"},children:"▼"}),v.jsx("span",{style:{display:"flex",alignItems:"center",textAlign:"center",justifyContent:"center",gap:6},children:v.jsx("span",{children:"הורדה"})})]}),Me&&v.jsxs("div",{className:"schema-dropdown",style:{right:0,left:"auto",width:"100%",minWidth:"100%",border:"1px solid rgba(39, 228, 22, 0.76)",borderRadius:"12px",marginTop:"4px",maxHeight:"200px",overflowY:"auto",background:"rgba(10,24,45,0.98)",boxShadow:"0 12px 32px rgba(0,0,0,0.6)",backdropFilter:"blur(40px)",overflow:"hidden"},children:[v.jsx("div",{className:"schema-option opt-green",onClick:()=>0===me.length?(window.dispatchEvent(new CustomEvent("excel:status",{detail:{message:"No mappings to download yet",type:"warn",durationMs:2500}})),void _e(!1)):(st.length,window.dispatchEvent(new Event("excel:download-mapping-request")),void _e(!1)),dir:"rtl",style:{padding:"10px 12px",borderBottom:"1px solid rgba(255,255,255,0.08)",textAlign:"center",background:"rgba(10,24,45,0.98)",color:"#ffffff"},onMouseEnter:e=>ht(e.currentTarget,!0),onMouseLeave:e=>ht(e.currentTarget,!1),children:"הורד Mapping"}),v.jsx("div",{className:"schema-option opt-green",onClick:()=>{window.dispatchEvent(new Event("excel:download-template-request")),_e(!1)},style:{padding:"10px 12px",borderBottom:"none",textAlign:"center",background:"rgba(10,24,45,0.98)",color:"#ffffff"},onMouseEnter:e=>ht(e.currentTarget,!0),onMouseLeave:e=>ht(e.currentTarget,!1),children:'הורד פורמט דג"ח'})]})]})]})]}),v.jsxs("div",{className:"header-actions",children:[v.jsx("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:e?v.jsxs(v.Fragment,{children:[v.jsx(Re,{}),r()&&v.jsxs("button",{onClick:()=>s(!0),style:{padding:"8px 16px",backgroundColor:"rgba(255, 165, 0, 0.2)",color:"#ffa500",border:"1px solid rgba(255, 165, 0, 0.4)",borderRadius:"8px",fontSize:"12px",maxHeight:"35px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",transition:"all 0.2s",direction:"rtl",display:"flex",alignItems:"center",gap:"6px"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="rgba(255, 165, 0, 0.3)",e.currentTarget.style.borderColor="rgba(255, 165, 0, 0.6)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="rgba(255, 165, 0, 0.2)",e.currentTarget.style.borderColor="rgba(255, 165, 0, 0.4)"},children:[v.jsx("span",{children:"⚙️"}),"ניהול הרשאות"]})]}):v.jsx("button",{onClick:()=>o(!0),style:{padding:"8px 16px",backgroundColor:"var(--accent)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontFamily:"Segoe UI, Arial, sans-serif",cursor:"pointer",transition:"background-color 0.2s",direction:"rtl"},onMouseOver:e=>e.currentTarget.style.backgroundColor="var(--accent-hover)",onMouseOut:e=>e.currentTarget.style.backgroundColor="var(--accent)",children:"התחבר"})}),"viz"===u&&"admin"===(null==e?void 0:e.role)&&v.jsx("div",{className:"schema-group",style:{display:"flex",alignItems:"center",gap:6},children:v.jsxs("div",{className:"schema-selector",children:[v.jsxs("button",{className:"btn ghost "+(fe?"":"is-placeholder"),onClick:()=>ve(!be),children:[fe&&ct[fe]?ct[fe].title:v.jsx("span",{className:"schema-placeholder",dir:"rtl",children:"בחר תקן"}),v.jsx("span",{style:{marginLeft:"8px"},children:"▼"})]}),be&&v.jsx("div",{className:"schema-dropdown",children:Object.entries(ct).map(([e,t])=>v.jsx("div",{className:"schema-option",onClick:()=>{ye(e),ve(!1)},children:t.title},e))})]})}),"viz"===u&&"admin"===(null==e?void 0:e.role)&&v.jsxs(v.Fragment,{children:[v.jsx("button",{className:"btn ghost",onClick:dt,style:{display:"flex",padding:"12px 14px",maxHeight:"35px",justifyContent:"center",alignItems:"center",alignSelf:"center"},children:"נקה"}),v.jsx("button",{className:"btn primary",onClick:lt,style:{display:"flex",padding:"12px 14px",maxHeight:"35px",justifyContent:"center",alignItems:"center",alignSelf:"center"},children:"ויזואליזציה"}),v.jsx("div",{className:"zoom-controls",children:v.jsxs("div",{className:"zoom-readout",children:[Math.round(100*_),"%"]})})]}),"admin"===(null==e?void 0:e.role)&&v.jsx("div",{ref:Qe,className:"input-dropdown anchored "+(F?"open":""),children:v.jsxs("div",{className:"panel input dropdown",children:[v.jsx("div",{className:"panel-title",children:"קלט JSON"}),v.jsx("textarea",{className:"json-input",spellCheck:!1,placeholder:"הדבק JSON כאן...",value:E,onChange:e=>D(e.target.value)}),v.jsxs("div",{className:"panel-footer",children:[I?v.jsx("div",{className:"notice error",children:I}):v.jsx("div",{className:"notice ok",children:ot?`זוהה: ${ot}`:"ממתין ל-JSON תקין..."}),v.jsx("div",{style:{display:"flex",gap:8},children:v.jsx("button",{className:"btn primary",onClick:lt,style:{padding:"12px 14px",minHeight:"48px"},children:"ויזואליזציה"})})]})]})}),"common"===u&&"admin"===(null==e?void 0:e.role)&&v.jsx("div",{className:"notification-container",children:v.jsxs("button",{className:"notification-btn",onClick:()=>console.log("Notifications clicked"),children:[v.jsx("svg",{className:"notification-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:v.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"})}),v.jsx("span",{className:"notification-count",children:"3"})]})}),v.jsxs("div",{className:"action-dropdown",ref:rt,style:{position:"relative"},children:[v.jsx("button",{className:"btn ghost","aria-haspopup":"menu","aria-expanded":Be?"true":"false",onClick:()=>{console.log("Hamburger clicked, current isNavOpen:",Be,"activeScreen:",u),We(!Be)},title:"ניווט",children:v.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("rect",{x:"3",y:"6",width:"18",height:"2",rx:"1"}),v.jsx("rect",{x:"3",y:"11",width:"18",height:"2",rx:"1"}),v.jsx("rect",{x:"3",y:"16",width:"18",height:"2",rx:"1"})]})}),Be&&v.jsxs("div",{className:"schema-dropdown",style:{right:0,left:"auto",minWidth:220,position:"absolute"},role:"menu",dir:"rtl",children:["admin"===(null==e?void 0:e.role)&&v.jsx("div",{className:"schema-option",role:"menuitem",onClick:()=>{console.log("Clicking viz option"),x("viz"),We(!1),ze(!1),_e(!1),ve(!1)},onMouseEnter:()=>console.log("Hovering over viz option"),onMouseLeave:()=>console.log("Leaving viz option"),style:{position:"relative",padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",pointerEvents:"auto",zIndex:9999999},children:"ויואליזציה + Mapping"}),"admin"===(null==e?void 0:e.role)&&v.jsx("div",{className:"schema-option",role:"menuitem",onClick:()=>{console.log("Clicking dictionary option"),x("dictionary"),We(!1),ze(!1),_e(!1),ve(!1)},onMouseEnter:()=>console.log("Hovering over dictionary option"),onMouseLeave:()=>console.log("Leaving dictionary option"),style:{position:"relative",padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",pointerEvents:"auto",zIndex:9999999},children:"מילון התקן"}),v.jsx("div",{className:"schema-option",role:"menuitem",onClick:()=>{console.log("Clicking status option"),x("status"),We(!1),ze(!1),_e(!1),ve(!1)},onMouseEnter:()=>console.log("Hovering over status option"),onMouseLeave:()=>console.log("Leaving status option"),style:{position:"relative",padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",pointerEvents:"auto",zIndex:9999999},children:'סטטוס סג"חים'}),v.jsx("div",{className:"schema-option",role:"menuitem",onClick:()=>{console.log("Clicking validator option"),x("validator"),We(!1),ze(!1),_e(!1),ve(!1)},onMouseEnter:()=>console.log("Hovering over validator option"),onMouseLeave:()=>console.log("Leaving validator option"),style:{position:"relative",padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background 0.2s ease",fontSize:"14px",color:"#ffffff",textAlign:"center",pointerEvents:"auto",zIndex:9999999},children:"בודק תקינות JSON"})]})]})]})]}),"viz"===u&&"admin"===(null==e?void 0:e.role)?v.jsxs("main",{className:"app-main full-screen has-extractor",children:[v.jsx(R,{}),Z&&v.jsxs("div",{className:"search-overlay",children:[v.jsxs("div",{className:"search-box",children:[v.jsx("input",{id:"tree-search",type:"text",placeholder:"Search cubes and descriptions...",value:H,onChange:e=>J(e.target.value),className:"search-input"}),v.jsx("button",{onClick:()=>{ee(!1),J("")},className:"search-close",children:"×"})]}),K&&v.jsx("div",{className:"search-results",children:X.map(e=>v.jsxs("div",{className:"search-result-item",onClick:()=>{(e=>{document.querySelectorAll(".search-highlight").forEach(e=>{e.classList.remove("search-highlight")});const t=e.split(":")[0].split(".");(()=>{const e=document.querySelector(".tree-root .node-tile"),r=null==e?void 0:e.getBoundingClientRect(),n=r?r.left+r.width/2:window.innerWidth/2;for(let i=1;i<=t.length;i++){const e=t.slice(0,i).join("."),r=document.querySelector(`[data-node-id^="${e}:"]`);if(r){const e=r.closest(".tree-li"),t=null==e?void 0:e.querySelector(".node-tile"),i=null==e?void 0:e.querySelector(".binary-children");if(t&&i&&(!i.classList.contains("open")||!("hidden"!==i.style.overflow||i.offsetHeight>0))){const r=t.getBoundingClientRect(),i=r.left+r.width/2<n?"left":"right";e&&(e.dataset.forceSide=i),t.click(),requestAnimationFrame(()=>{const e=new CustomEvent("search:layout-update",{detail:{forceSide:i}});t.dispatchEvent(e)})}}}})();const r=document.querySelector(`[data-node-id="${e}"]`);r&&setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{r.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),r.classList.add("search-highlight"),setTimeout(()=>r.classList.remove("search-highlight"),3e3)})})},100)})(e.id),Q(!1)},children:[v.jsx("div",{className:"search-result-path",children:e.path}),e.snippet&&v.jsx("div",{className:"search-snippet",dangerouslySetInnerHTML:{__html:(e=>{const t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=new RegExp(`(${(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))(H)})`,"gi");return t.replace(r,'<span class="search-snippet-highlight">$1</span>')})(e.snippet)}})]},e.id))})]}),v.jsx("section",{className:"viz-section",onWheel:e=>{var t;if(window.__excelDragging)return;e.preventDefault();const r=e.deltaY>0?-.08:.08,n=ut(_+r);if(n!==_){const r=(null!=(t=Xe.current)?t:e.currentTarget).getBoundingClientRect(),i=e.clientX-r.left,o=e.clientY-r.top,a=W.x,s=W.y,l=n/_,d=i-(i-a)*l,c=o-(o-s)*l;B(n),O({x:d,y:c})}},children:v.jsx("div",{className:"full-viz",onMouseDown:e=>{0===e.button&&(P(!0),Y({x:e.clientX-W.x,y:e.clientY-W.y}))},onMouseMove:e=>{U&&O({x:e.clientX-q.x,y:e.clientY-q.y})},onMouseUp:()=>P(!1),onMouseLeave:()=>P(!1),children:v.jsxs("div",{className:"viz-wrapper",ref:Xe,style:{transform:`translate(${W.x}px, ${W.y}px) scale(${_})`},children:[T?v.jsx(M,{root:T}):v.jsx("div",{className:"placeholder",children:"בחר סכמה ולחץ על ויזואליזציה"}),T&&v.jsx(L,{containerRef:Xe})]})})})]}):"dictionary"===u&&"admin"===(null==e?void 0:e.role)?v.jsx(je,{schemas:ct}):"common"===u&&"admin"===(null==e?void 0:e.role)?v.jsx(ge,{}):"status"===u?v.jsx(Se,{}):"archive"===u?v.jsx(Ie,{onBack:()=>x("status")}):"analytics"===u?v.jsx(Le,{}):"validator"===u?v.jsx(Ae,{onBack:()=>x("status")}):e&&"admin"!==e.role?v.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",padding:"40px",textAlign:"center",direction:"rtl"},children:v.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(255,165,0,0.1), rgba(255,165,0,0.05))",border:"1px solid rgba(255,165,0,0.3)",borderRadius:"16px",padding:"40px",maxWidth:"600px",boxShadow:"0 8px 32px rgba(0,0,0,0.1)"},children:[v.jsx("div",{style:{fontSize:"48px",marginBottom:"20px",color:"var(--accent)"},children:"🔒"}),v.jsx("h2",{style:{color:"var(--text)",fontSize:"24px",fontWeight:"600",marginBottom:"16px"},children:"גישה מוגבלת"}),v.jsxs("p",{style:{color:"var(--muted)",fontSize:"16px",lineHeight:"1.6",marginBottom:"24px"},children:["רק מנהלים יכולים לגשת למסכי העץ, הבנק והמרחב המשותף.",v.jsx("br",{}),'אתה יכול לגשת למסך סטטוס הסג"חים בלבד.']}),v.jsx("div",{style:{display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap"},children:v.jsxs("div",{style:{background:"rgba(124,192,255,0.1)",border:"1px solid rgba(124,192,255,0.3)",borderRadius:"8px",padding:"12px 16px",fontSize:"14px",color:"var(--accent)"},children:[v.jsx("strong",{children:"תפקיד נוכחי:"})," ","viewer"===e.role?"צופה":"editor"===e.role?"עורך":"מנהל"]})})]})}):null,"viz"===u&&T&&"admin"===(null==e?void 0:e.role)&&v.jsxs("div",{className:"required-panel "+(Ce?"open":"collapsed"),children:[v.jsxs("div",{className:"required-header",dir:"rtl",onClick:()=>Ee(e=>!e),children:[v.jsx("div",{className:"required-title",children:"שדות חובה בתקן:"}),v.jsx("button",{className:"required-toggle","aria-label":Ce?"סגור":"פתח",children:Ce?"▲":"▼"})]}),Ce&&v.jsx("div",{className:"required-body",dir:"rtl",children:0===st.length?v.jsx("div",{className:"required-empty",children:"אין שדות חובה חסרים"}):v.jsx("ul",{className:"required-list",children:st.map(e=>v.jsxs("li",{className:"req-item","data-state":"required",title:e.path,children:[v.jsx("span",{className:"req-dot","aria-hidden":"true"}),v.jsx("span",{className:"req-text",children:e.path})]},e.id))})})]}),m&&v.jsx("div",{className:`toast-bottom ${f} ${b?"leaving":""} ${S?"show":""}`,dir:"rtl",children:m}),te&&v.jsx("div",{className:"modal-overlay",onClick:()=>re(null),children:v.jsx("div",{className:"modal",onClick:e=>e.stopPropagation(),children:v.jsxs("div",{style:{padding:"24px"},children:[v.jsx("h2",{style:{margin:"0 0 20px 0",fontSize:"18px",fontWeight:"600"},children:"Field Mapping"}),v.jsxs("div",{className:"mapping-grid",style:{gridTemplateColumns:de?"1fr auto 1fr auto 1fr auto 1fr":"1fr auto 1fr auto 1fr",alignItems:"center"},children:[v.jsxs("div",{className:"map-col",children:[v.jsx("div",{className:"small-h",dir:"rtl",style:{textAlign:"center"},children:"שדה בתקן"}),v.jsxs("div",{className:"map-card",style:{textAlign:"center"},children:[v.jsx("div",{className:"map-main",children:te.targetNode.name}),v.jsx("div",{className:"map-sub",children:te.targetNode.type}),v.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",marginTop:"8px"},children:[v.jsxs("div",{children:[v.jsx("strong",{children:"Description:"})," ",te.targetNode.description||"No description"]}),te.targetNode.rules&&te.targetNode.rules.length>0&&v.jsxs("div",{children:[v.jsx("strong",{children:"Rules:"})," ",te.targetNode.rules.join(", ")]}),te.targetNode.valuePreview&&v.jsxs("div",{children:[v.jsx("strong",{children:"Preview:"})," ",te.targetNode.valuePreview]})]})]})]}),v.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"0 8px"},children:v.jsx("span",{style:{fontSize:"24px",color:"var(--muted)"},children:"←"})}),de&&v.jsxs(v.Fragment,{children:[v.jsxs("div",{className:"map-col",children:[v.jsx("div",{className:"small-h",dir:"rtl",style:{textAlign:"center"},children:"רק בOUTPUTS"}),v.jsx("div",{className:"map-card",children:v.jsx("textarea",{className:"map-notes",placeholder:"Specify outputs...",value:ue,onChange:e=>xe(e.target.value),style:{minHeight:"120px",textAlign:"center"}})})]}),v.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"0 8px"},children:v.jsx("span",{style:{fontSize:"24px",color:"var(--muted)"},children:"←"})})]}),v.jsxs("div",{className:"map-col",children:[v.jsx("div",{className:"small-h",dir:"rtl",style:{textAlign:"center"},children:"פירוט הפרסר"}),v.jsx("div",{className:"map-card",children:v.jsx("textarea",{className:"map-notes",placeholder:"Define mapping logic...",value:oe,onChange:e=>ae(e.target.value),style:{minHeight:"120px",textAlign:"center"}})})]}),v.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"0 8px"},children:v.jsx("span",{style:{fontSize:"24px",color:"var(--muted)"},children:"←"})}),v.jsxs("div",{className:"map-col",children:[v.jsx("div",{className:"small-h",dir:"rtl",style:{textAlign:"center"},children:'שדה מהדג"ח'}),v.jsxs("div",{className:"map-card",style:{textAlign:"center"},children:[v.jsx("div",{className:"map-main",children:te.field.name}),v.jsx("div",{className:"map-sub",children:te.field.fieldType}),v.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",marginTop:"8px"},children:[v.jsxs("div",{children:[v.jsx("strong",{children:"מהות השדה:"})," ",te.field.fieldEssence||"-"]}),v.jsxs("div",{children:[v.jsx("strong",{children:'דג"ח:'})," ",te.field.dgh||"-"]}),v.jsxs("div",{children:[v.jsx("strong",{children:"האם יחזור תמיד:"})," ",te.field.always||"-"]})]})]})]})]}),v.jsx("div",{style:{marginTop:"20px",display:"flex",alignItems:"center",gap:"12px"},children:v.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"14px"},children:[v.jsx("input",{type:"checkbox",checked:de,onChange:e=>ce(e.target.checked),style:{width:"16px",height:"16px",accentColor:"var(--accent)",cursor:"pointer"}}),v.jsx("span",{dir:"rtl",children:"הפרסור יתבצע רק בoutputs ספציפיים"})]})}),v.jsxs("div",{style:{marginTop:"24px",display:"flex",gap:"12px",justifyContent:"flex-end"},children:[v.jsx("button",{className:"btn ghost",onClick:()=>re(null),children:"Cancel"}),v.jsx("button",{className:"btn primary",onClick:()=>{try{const e={targetNode:te.targetNode,field:te.field,mappingDetails:oe,outputs:ue,timestamp:Date.now()};xt(e)}catch(e){console.error("Failed to prepare mapping:",e),alert("Failed to save mapping. Check console for details.")}},children:"Save Mapping"})]})]})})}),Oe&&v.jsx("div",{className:"modal-overlay",onClick:()=>{Ue(!1),qe(null)},children:v.jsx("div",{className:"modal",onClick:e=>e.stopPropagation(),children:v.jsxs("div",{style:{padding:"20px"},dir:"rtl",children:[v.jsx("h3",{style:{margin:"0 0 12px 0",textAlign:"center"},children:"זהירות!"}),v.jsx("p",{style:{margin:"0 0 16px 0",textAlign:"center"},children:'אתם משתמשים בשדה בתקן שכבר נמצא בשימוש עם שדה אחר בדג"ח! אתם בטוחים שאתם רוצים להמשיך?'}),v.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[v.jsx("button",{className:"btn ghost",onClick:()=>{Ue(!1),qe(null),He(null),Je(null)},children:"בטל"}),v.jsx("button",{className:"btn primary",onClick:()=>{if("drop"===Ve&&Ye){const{targetNode:e,field:t}=Ye;re({targetNode:e,field:t}),ie(t.name||""),ae(""),le(e.name||""),ce(!1),xe("")}else"save"===Ve&&Pe&&xt(Pe);Ue(!1),qe(null),He(null),Je(null)},children:"המשך"})]})]})})}),De&&v.jsx("div",{className:"modal-overlay",onClick:()=>Te(!1),children:v.jsx("div",{className:"modal",onClick:e=>e.stopPropagation(),children:v.jsxs("div",{style:{padding:"20px"},dir:"rtl",children:[v.jsx("h3",{style:{margin:"0 0 12px 0",textAlign:"center"},children:"חסרים שדות חובה"}),v.jsxs("p",{style:{margin:"0 0 16px 0",textAlign:"center"},children:["ישנם ",st.length," שדות חובה שעדיין לא מולאו."]}),v.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[v.jsx("button",{className:"btn ghost",onClick:()=>Te(!1),children:"בטל"}),v.jsx("button",{className:"btn primary",onClick:()=>{window.dispatchEvent(new Event("excel:download-mapping-request")),Te(!1)},children:"הורד בכל זאת"})]})]})})})]}),v.jsx(Fe,{isOpen:i,onClose:()=>o(!1)}),v.jsx($e,{isOpen:a,onClose:()=>s(!1)})]})}function We(){return v.jsx(_e,{children:v.jsx(H,{children:v.jsx(ce,{children:v.jsx(Be,{})})})})}w.createRoot(document.getElementById("root")).render(v.jsx(x.StrictMode,{children:v.jsx(We,{})}))}},function(){return b||(0,y[n(y)[0]])((b={exports:{}}).exports,b),b.exports});export default v();
